<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shispring.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://shispring.github.io/page/9/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="shispring">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://shispring.github.io/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources" rel="section"><i class="fa fa-download fa-fw"></i>èµ„æº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/20/intresting-tools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/20/intresting-tools/" class="post-title-link" itemprop="url">intresting tools</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-20 17:34:46" itemprop="dateCreated datePublished" datetime="2025-01-20T17:34:46+08:00">2025-01-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-08 18:00:04" itemprop="dateModified" datetime="2025-09-08T18:00:04+08:00">2025-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="gdu"><a href="#gdu" class="headerlink" title="gdu"></a>gdu</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/dundee/gdu</span><br></pre></td></tr></table></figure>

<h2 id="chsrc"><a href="#chsrc" class="headerlink" title="chsrc"></a>chsrc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/RubyMetric/chsrc</span><br></pre></td></tr></table></figure>

<h2 id="lnav"><a href="#lnav" class="headerlink" title="lnav"></a>lnav</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/tstack/lnav</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ç”¨æ³•</span><br><span class="line">lnav /var/log/messages</span><br><span class="line">journalctl -a -o json | lnav</span><br><span class="line"></span><br><span class="line">#å¦‚æœä½¿ç”¨ systemd v236 æˆ–æ›´æ–°ç‰ˆæœ¬ï¼Œè¾“å‡ºå­—æ®µå¯ä»¥é™åˆ¶ä¸ºlnavå®é™…è¯†åˆ«çš„å­—æ®µï¼Œä»¥æé«˜æ•ˆç‡ï¼š</span><br><span class="line">journalctl -o json --output-fields=MESSAGE,PRIORITY,_PID,SYSLOG_IDENTIFIER,_SYSTEMD_UNIT | lnav</span><br></pre></td></tr></table></figure>

<h2 id="lancet"><a href="#lancet" class="headerlink" title="lancet"></a>lancet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/duke-git/lancet</span><br></pre></td></tr></table></figure>

<h2 id="oha"><a href="#oha" class="headerlink" title="oha"></a>oha</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/hatoo/oha</span><br></pre></td></tr></table></figure>

<h2 id="icones"><a href="#icones" class="headerlink" title="icones"></a>icones</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/antfu-collective/icones</span><br></pre></td></tr></table></figure>

<h2 id="go2rtc"><a href="#go2rtc" class="headerlink" title="go2rtc"></a>go2rtc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/AlexxIT/go2rtc</span><br></pre></td></tr></table></figure>

<h2 id="ç™½å™ªéŸ³"><a href="#ç™½å™ªéŸ³" class="headerlink" title="ç™½å™ªéŸ³"></a>ç™½å™ªéŸ³</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://moodist.mvze.net/</span><br></pre></td></tr></table></figure>
<h2 id="freeze-ç”Ÿæˆä»£ç å›¾ç‰‡çš„ç»ˆç«¯å·¥å…·"><a href="#freeze-ç”Ÿæˆä»£ç å›¾ç‰‡çš„ç»ˆç«¯å·¥å…·" class="headerlink" title="freeze :ç”Ÿæˆä»£ç å›¾ç‰‡çš„ç»ˆç«¯å·¥å…·"></a>freeze :ç”Ÿæˆä»£ç å›¾ç‰‡çš„ç»ˆç«¯å·¥å…·</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/charmbracelet/freeze</span><br></pre></td></tr></table></figure>

<h2 id="githubé•œåƒæ›¿æ¢"><a href="#githubé•œåƒæ›¿æ¢" class="headerlink" title="githubé•œåƒæ›¿æ¢"></a>githubé•œåƒæ›¿æ¢</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">githubé•œåƒç½‘ç«™1ï¼šhttps://2git.xyz</span><br><span class="line"></span><br><span class="line">githubé•œåƒç½‘ç«™2ï¼šhttps://lgithub.xyz</span><br><span class="line"></span><br><span class="line">https://github.com/Alvin9999/new-pac</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/10/ipvsadm%E4%B8%8Eiptables%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/10/ipvsadm%E4%B8%8Eiptables%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">ipvsadmä¸iptablesä¸€äº›å‘½ä»¤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-10 18:08:03" itemprop="dateCreated datePublished" datetime="2025-01-10T18:08:03+08:00">2025-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-11-07 12:30:29" itemprop="dateModified" datetime="2025-11-07T12:30:29+08:00">2025-11-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="iptables-ç”¨æ³•è¡¨"><a href="#iptables-ç”¨æ³•è¡¨" class="headerlink" title="iptables ç”¨æ³•è¡¨"></a><strong><code>iptables</code> ç”¨æ³•è¡¨</strong></h3><table>
<thead>
<tr>
<th><strong>åŠŸèƒ½</strong></th>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>å®ä¾‹</strong></th>
<th><strong>å«ä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td>æŸ¥çœ‹å½“å‰è§„åˆ™</td>
<td><code>iptables -L -n -v</code></td>
<td><code>iptables -L -n -v</code></td>
<td>åˆ—å‡ºæ‰€æœ‰é“¾è§„åˆ™ï¼Œæ˜¾ç¤ºè®¡æ•°å™¨ã€å­—èŠ‚æ•°ï¼Œå¹¶ä»¥æ•°å­—å½¢å¼æ˜¾ç¤º IP å’Œç«¯å£ã€‚</td>
</tr>
<tr>
<td>æ·»åŠ å…è®¸è§„åˆ™</td>
<td><code>iptables -A INPUT -p tcp --dport 22 -j ACCEPT</code></td>
<td><code>iptables -A INPUT -p tcp --dport 80 -j ACCEPT</code></td>
<td>å…è®¸æ‰€æœ‰ TCP æµé‡é€šè¿‡ 80 ç«¯å£è¿›å…¥ã€‚</td>
</tr>
<tr>
<td>æ‹’ç»ç‰¹å®š IP æµé‡</td>
<td><code>iptables -A INPUT -s 192.168.1.100 -j DROP</code></td>
<td><code>iptables -A INPUT -s 192.168.1.100 -j DROP</code></td>
<td>é˜»æ­¢æ¥è‡ª 192.168.1.100 çš„æ‰€æœ‰æµé‡ã€‚</td>
</tr>
<tr>
<td>åˆ é™¤è§„åˆ™</td>
<td><code>iptables -D INPUT &lt;rule-number&gt;</code></td>
<td><code>iptables -D INPUT 1</code></td>
<td>åˆ é™¤ INPUT é“¾ä¸­çš„ç¬¬ 1 æ¡è§„åˆ™ã€‚</td>
</tr>
<tr>
<td>æ¸…ç©ºæ‰€æœ‰è§„åˆ™</td>
<td><code>iptables -F</code></td>
<td><code>iptables -F</code></td>
<td>æ¸…ç©ºæ‰€æœ‰é“¾ä¸­çš„è§„åˆ™ã€‚</td>
</tr>
<tr>
<td>ä¿å­˜è§„åˆ™</td>
<td><code>iptables-save &gt; /etc/iptables.rules</code></td>
<td><code>iptables-save &gt; /etc/iptables.rules</code></td>
<td>å°†å½“å‰è§„åˆ™ä¿å­˜åˆ°æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>æ¢å¤è§„åˆ™</td>
<td><code>iptables-restore &lt; /etc/iptables.rules</code></td>
<td><code>iptables-restore &lt; /etc/iptables.rules</code></td>
<td>ä»æ–‡ä»¶æ¢å¤è§„åˆ™ã€‚</td>
</tr>
<tr>
<td>å…è®¸ç‰¹å®šç½‘æ®µè®¿é—®</td>
<td><code>iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3306 -j ACCEPT</code></td>
<td><code>iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3306 -j ACCEPT</code></td>
<td>å…è®¸æ¥è‡ª 192.168.1.0&#x2F;24 ç½‘æ®µçš„æµé‡è®¿é—® 3306 ç«¯å£ï¼ˆMySQLï¼‰ã€‚</td>
</tr>
<tr>
<td>è®¾ç½®é»˜è®¤ç­–ç•¥</td>
<td><code>iptables -P INPUT DROP</code></td>
<td><code>iptables -P INPUT DROP</code></td>
<td>å°† INPUT é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºä¸¢å¼ƒæ‰€æœ‰æµé‡ã€‚</td>
</tr>
<tr>
<td>NAT è½¬å‘è§„åˆ™</td>
<td><code>iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.10:80</code></td>
<td><code>iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination 10.0.0.2:80</code></td>
<td>å°†æ‰€æœ‰è®¿é—®æœ¬æœº 8080 ç«¯å£çš„æµé‡è½¬å‘åˆ° 192.168.1.10 çš„ 80 ç«¯å£ã€‚</td>
</tr>
</tbody></table>
<hr>
<h3 id="ipvsadm-ç”¨æ³•è¡¨"><a href="#ipvsadm-ç”¨æ³•è¡¨" class="headerlink" title="ipvsadm ç”¨æ³•è¡¨"></a><strong><code>ipvsadm</code> ç”¨æ³•è¡¨</strong></h3><table>
<thead>
<tr>
<th><strong>åŠŸèƒ½</strong></th>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>å®ä¾‹</strong></th>
<th><strong>å«ä¹‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td>æŸ¥çœ‹å½“å‰è§„åˆ™</td>
<td><code>ipvsadm -L -n</code></td>
<td><code>ipvsadm -L -n</code></td>
<td>åˆ—å‡ºæ‰€æœ‰è™šæ‹ŸæœåŠ¡å’ŒçœŸå®æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>æ·»åŠ è™šæ‹ŸæœåŠ¡</td>
<td><code>ipvsadm -A -t &lt;VIP&gt;:&lt;PORT&gt; -s &lt;SCHEDULER&gt;</code></td>
<td><code>ipvsadm -A -t 192.168.1.100:80 -s rr</code></td>
<td>æ·»åŠ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼ŒVIP ä¸º 192.168.1.100ï¼Œç«¯å£ 80ï¼Œè°ƒåº¦ç®—æ³•ä¸ºè½®è¯¢ï¼ˆ<code>rr</code>ï¼‰ã€‚</td>
</tr>
<tr>
<td>æ·»åŠ çœŸå®æœåŠ¡å™¨</td>
<td><code>ipvsadm -a -t &lt;VIP&gt;:&lt;PORT&gt; -r &lt;RIP&gt;:&lt;PORT&gt; -m</code></td>
<td><code>ipvsadm -a -t 192.168.1.100:80 -r 192.168.1.101:80 -m</code></td>
<td>ä¸ºè™šæ‹ŸæœåŠ¡æ·»åŠ çœŸå®æœåŠ¡å™¨ï¼ŒRIP ä¸º 192.168.1.101ï¼Œç«¯å£ 80ï¼Œä½¿ç”¨ NAT æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td>åˆ é™¤è™šæ‹ŸæœåŠ¡</td>
<td><code>ipvsadm -D -t &lt;VIP&gt;:&lt;PORT&gt;</code></td>
<td><code>ipvsadm -D -t 192.168.1.100:80</code></td>
<td>åˆ é™¤ VIP ä¸º 192.168.1.100ï¼Œç«¯å£ä¸º 80 çš„è™šæ‹ŸæœåŠ¡ã€‚</td>
</tr>
<tr>
<td>åˆ é™¤çœŸå®æœåŠ¡å™¨</td>
<td><code>ipvsadm -d -t &lt;VIP&gt;:&lt;PORT&gt; -r &lt;RIP&gt;:&lt;PORT&gt;</code></td>
<td><code>ipvsadm -d -t 192.168.1.100:80 -r 192.168.1.101:80</code></td>
<td>åˆ é™¤è™šæ‹ŸæœåŠ¡ä¸­æŒ‡å®šçš„çœŸå®æœåŠ¡å™¨ã€‚</td>
</tr>
<tr>
<td>è®¾ç½®è¿æ¥è¶…æ—¶</td>
<td><code>ipvsadm --set &lt;tcp_timeout&gt; &lt;tcpfin_timeout&gt; &lt;udp_timeout&gt;</code></td>
<td><code>ipvsadm --set 900 120 300</code></td>
<td>è®¾ç½® TCP è¿æ¥è¶…æ—¶ä¸º 900 ç§’ï¼ŒTCP FIN ç­‰å¾…æ—¶é—´ä¸º 120 ç§’ï¼ŒUDP è¶…æ—¶ä¸º 300 ç§’ã€‚</td>
</tr>
<tr>
<td>æŸ¥çœ‹æœåŠ¡ç»Ÿè®¡</td>
<td><code>ipvsadm -L -n --stats</code></td>
<td><code>ipvsadm -L -n --stats</code></td>
<td>æ˜¾ç¤ºè™šæ‹ŸæœåŠ¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚æ•°ã€è¿æ¥æ•°ç­‰ã€‚</td>
</tr>
<tr>
<td>ä¿å­˜è§„åˆ™</td>
<td><code>ipvsadm-save &gt; /etc/ipvs.rules</code></td>
<td><code>ipvsadm-save &gt; /etc/ipvs.rules</code></td>
<td>ä¿å­˜å½“å‰ IPVS é…ç½®åˆ°æ–‡ä»¶ä¸­ã€‚</td>
</tr>
<tr>
<td>æ¢å¤è§„åˆ™</td>
<td><code>ipvsadm-restore &lt; /etc/ipvs.rules</code></td>
<td><code>ipvsadm-restore &lt; /etc/ipvs.rules</code></td>
<td>ä»æ–‡ä»¶ä¸­æ¢å¤ IPVS é…ç½®ã€‚</td>
</tr>
<tr>
<td>æ¸…ç©ºæ‰€æœ‰è§„åˆ™</td>
<td><code>ipvsadm -C</code></td>
<td><code>ipvsadm -C</code></td>
<td>æ¸…ç©ºæ‰€æœ‰è™šæ‹ŸæœåŠ¡å’ŒçœŸå®æœåŠ¡å™¨è§„åˆ™ã€‚</td>
</tr>
<tr>
<td>DR æ¨¡å¼çš„çœŸå®æœåŠ¡å™¨</td>
<td><code>ipvsadm -a -t &lt;VIP&gt;:&lt;PORT&gt; -r &lt;RIP&gt;:&lt;PORT&gt; -g</code></td>
<td><code>ipvsadm -a -t 192.168.1.100:80 -r 192.168.1.101:80 -g</code></td>
<td>æ·»åŠ ä¸€ä¸ª DR æ¨¡å¼çš„çœŸå®æœåŠ¡å™¨ã€‚</td>
</tr>
</tbody></table>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ul>
<li><strong><code>iptables</code></strong> ä¸»è¦ç”¨äºç®¡ç† Linux é˜²ç«å¢™è§„åˆ™ï¼Œæ§åˆ¶ç½‘ç»œæµé‡çš„è®¿é—®ç­–ç•¥ã€‚</li>
<li><strong><code>ipvsadm</code></strong> æ˜¯ LVSï¼ˆLinux Virtual Serverï¼‰ç»„ä»¶çš„ç”¨æˆ·ç©ºé—´å·¥å…·ï¼Œç”¨äºé…ç½®å’Œç®¡ç†è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</li>
</ul>
<hr>
<h1 id="ğŸ§ -ipvsadm-å®æˆ˜ä¸åŸç†åˆ†ææ–‡æ¡£"><a href="#ğŸ§ -ipvsadm-å®æˆ˜ä¸åŸç†åˆ†ææ–‡æ¡£" class="headerlink" title="ğŸ§  ipvsadm å®æˆ˜ä¸åŸç†åˆ†ææ–‡æ¡£"></a>ğŸ§  <code>ipvsadm</code> å®æˆ˜ä¸åŸç†åˆ†ææ–‡æ¡£</h1><h2 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h2><p><code>ipvsadm</code> æ˜¯ <strong>IP Virtual Server (IPVS)</strong> çš„ç”¨æˆ·æ€ç®¡ç†å·¥å…·ï¼Œç”¨äºé…ç½® Linux å†…æ ¸çš„ L4 è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚<br>å®ƒå±äº <strong>LVS (Linux Virtual Server)</strong> é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡å†…æ ¸æ¨¡å— <code>ip_vs</code> å®ç°é«˜æ€§èƒ½ TCP&#x2F;UDP è´Ÿè½½å‡è¡¡ã€‚</p>
<blockquote>
<p>ğŸ“˜ æ ¸å¿ƒç‚¹ï¼š</p>
<ul>
<li>å·¥ä½œåœ¨å†…æ ¸æ€ï¼Œæ€§èƒ½é«˜äºç”¨æˆ·æ€ä»£ç†ï¼ˆå¦‚ Nginxã€HAProxyï¼‰ã€‚</li>
<li>å¸¸ç”¨äº Kubernetes kube-proxy çš„ <code>--proxy-mode=ipvs</code> æ¨¡å¼ã€‚</li>
<li>è°ƒåº¦ç®—æ³•ã€è½¬å‘æ¨¡å¼çµæ´»ï¼Œæ”¯æŒ NATï¼ˆMasqï¼‰ã€Direct Routingï¼ˆDRï¼‰ã€IP Tunnelingï¼ˆTUNï¼‰ç­‰ã€‚</li>
</ul>
</blockquote>
<hr>
<h2 id="äºŒã€ipvsadm-L-n-è¾“å‡ºè§£é‡Š"><a href="#äºŒã€ipvsadm-L-n-è¾“å‡ºè§£é‡Š" class="headerlink" title="äºŒã€ipvsadm -L -n è¾“å‡ºè§£é‡Š"></a>äºŒã€<code>ipvsadm -L -n</code> è¾“å‡ºè§£é‡Š</h2><p>ä½ çš„è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line"><span class="comment">#yum install -y ipvsadm</span></span><br><span class="line">[root@base-001 ~]# ipvsadm -L -n</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  11.0.56.240:18668 rr</span><br><span class="line">TCP  100.10.0.1:443 rr</span><br><span class="line">  -&gt; 11.0.54.202:6443            Masq    1      5          0</span><br><span class="line">  -&gt; 11.0.56.240:6443            Masq    1      3          0</span><br><span class="line">  -&gt; 11.0.61.78:6443             Masq    1      4          0</span><br></pre></td></tr></table></figure>

<h3 id="å­—æ®µè§£æï¼š"><a href="#å­—æ®µè§£æï¼š" class="headerlink" title="å­—æ®µè§£æï¼š"></a>å­—æ®µè§£æï¼š</h3><table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Prot</strong></td>
<td>åè®®ç±»å‹ï¼ˆTCP &#x2F; UDPï¼‰</td>
</tr>
<tr>
<td><strong>LocalAddress:Port</strong></td>
<td>è™šæ‹ŸæœåŠ¡åœ°å€ï¼ˆVIP:Portï¼‰â€”â€”å®¢æˆ·ç«¯è®¿é—®çš„åœ°å€</td>
</tr>
<tr>
<td><strong>Scheduler</strong></td>
<td>è°ƒåº¦ç®—æ³•ï¼ˆå¦‚ <code>rr</code> è¡¨ç¤º Round Robin è½®è¯¢ï¼‰</td>
</tr>
<tr>
<td><strong>Forward</strong></td>
<td>è½¬å‘æ¨¡å¼ï¼ˆè§ä¸‹è¡¨ï¼‰</td>
</tr>
<tr>
<td><strong>Weight</strong></td>
<td>æœåŠ¡å™¨æƒé‡ï¼Œå½±å“è°ƒåº¦æ¯”ä¾‹</td>
</tr>
<tr>
<td><strong>ActiveConn</strong></td>
<td>å½“å‰æ´»è·ƒè¿æ¥æ•°ï¼ˆå·²å»ºç«‹çš„ TCP ä¼šè¯ï¼‰</td>
</tr>
<tr>
<td><strong>InActConn</strong></td>
<td>éæ´»è·ƒè¿æ¥æ•°ï¼ˆå¦‚å·²å…³é—­æˆ–ç­‰å¾…å…³é—­çš„ä¼šè¯ï¼‰</td>
</tr>
</tbody></table>
<h3 id="å¸¸è§è½¬å‘æ¨¡å¼è¯´æ˜ï¼š"><a href="#å¸¸è§è½¬å‘æ¨¡å¼è¯´æ˜ï¼š" class="headerlink" title="å¸¸è§è½¬å‘æ¨¡å¼è¯´æ˜ï¼š"></a>å¸¸è§è½¬å‘æ¨¡å¼è¯´æ˜ï¼š</h3><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>å…³é”®å­—</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>NAT</td>
<td><code>Masq</code></td>
<td>LVS ä¿®æ”¹è¯·æ±‚åŒ…ç›®æ ‡åœ°å€å¹¶è½¬å‘ï¼ˆæœ€å¸¸ç”¨ï¼Œé€šç”¨ï¼‰</td>
</tr>
<tr>
<td>DR</td>
<td><code>Route</code></td>
<td>LVS ä»…ä¿®æ”¹ MAC å±‚ï¼Œå°†è¯·æ±‚å‘ç»™çœŸå®æœåŠ¡å™¨ï¼Œå“åº”ç›´è¿”å®¢æˆ·ç«¯ï¼ˆé«˜æ€§èƒ½ï¼‰</td>
</tr>
<tr>
<td>TUN</td>
<td><code>Tunnel</code></td>
<td>LVS å°è£… IPIP éš§é“è½¬å‘è¯·æ±‚ï¼Œå“åº”ç›´è¿”å®¢æˆ·ç«¯ï¼ˆè·¨ç½‘æ®µåœºæ™¯ï¼‰</td>
</tr>
</tbody></table>
<blockquote>
<p>ç¤ºä¾‹è§£é‡Šï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TCP  100.10.0.1:443 rr</span><br><span class="line">  -&gt; 11.0.54.202:6443 Masq 1 5 0</span><br></pre></td></tr></table></figure>

<p>è¡¨ç¤ºï¼šå®¢æˆ·ç«¯è®¿é—® <code>100.104.0.1:443</code> æ—¶ï¼ŒLVS ä¼šä½¿ç”¨ <strong>è½®è¯¢ç®—æ³•</strong> å°†è¯·æ±‚è½¬å‘ç»™ä¸‰å°åç«¯èŠ‚ç‚¹ï¼š</p>
<ul>
<li>11.0.54.202:6443</li>
<li>11.0.56.240:6443</li>
<li>11.0.61.78:6443<br>è½¬å‘æ¨¡å¼æ˜¯ <code>Masq</code>ï¼ˆNAT æ¨¡å¼ï¼‰ï¼Œå½“å‰æ´»è·ƒè¿æ¥åˆ†åˆ«ä¸º 5&#x2F;3&#x2F;4ã€‚</li>
</ul>
</blockquote>
<hr>
<h2 id="ä¸‰ã€å¸¸ç”¨å‘½ä»¤æ¸…å•"><a href="#ä¸‰ã€å¸¸ç”¨å‘½ä»¤æ¸…å•" class="headerlink" title="ä¸‰ã€å¸¸ç”¨å‘½ä»¤æ¸…å•"></a>ä¸‰ã€å¸¸ç”¨å‘½ä»¤æ¸…å•</h2><h3 id="1ï¸âƒ£-æŸ¥çœ‹å½“å‰-IPVS-è§„åˆ™"><a href="#1ï¸âƒ£-æŸ¥çœ‹å½“å‰-IPVS-è§„åˆ™" class="headerlink" title="1ï¸âƒ£ æŸ¥çœ‹å½“å‰ IPVS è§„åˆ™"></a>1ï¸âƒ£ æŸ¥çœ‹å½“å‰ IPVS è§„åˆ™</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -L -n</span><br></pre></td></tr></table></figure>

<h3 id="2ï¸âƒ£-æŒ‰è¿æ¥ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º"><a href="#2ï¸âƒ£-æŒ‰è¿æ¥ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º" class="headerlink" title="2ï¸âƒ£ æŒ‰è¿æ¥ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º"></a>2ï¸âƒ£ æŒ‰è¿æ¥ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Ln --stats</span><br></pre></td></tr></table></figure>

<h3 id="3ï¸âƒ£-æŒ‰è¿æ¥æ•°æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡"><a href="#3ï¸âƒ£-æŒ‰è¿æ¥æ•°æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡" class="headerlink" title="3ï¸âƒ£ æŒ‰è¿æ¥æ•°æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡"></a>3ï¸âƒ£ æŒ‰è¿æ¥æ•°æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Ln --rate</span><br></pre></td></tr></table></figure>

<h3 id="4ï¸âƒ£-æ·»åŠ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡"><a href="#4ï¸âƒ£-æ·»åŠ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡" class="headerlink" title="4ï¸âƒ£ æ·»åŠ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡"></a>4ï¸âƒ£ æ·»åŠ ä¸€ä¸ªè™šæ‹ŸæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -A -t 192.168.0.1:80 -s rr</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-A</code>: æ·»åŠ è™šæ‹ŸæœåŠ¡ï¼ˆVirtual Serviceï¼‰</li>
<li><code>-t</code>: TCP æœåŠ¡</li>
<li><code>-s</code>: æŒ‡å®šè°ƒåº¦ç®—æ³•ï¼ˆ<code>rr</code>, <code>wrr</code>, <code>lc</code>, <code>wlc</code>, <code>lblc</code>, <code>lblcr</code>, <code>sh</code>, <code>dh</code> ç­‰ï¼‰</li>
</ul>
<h3 id="5ï¸âƒ£-æ·»åŠ çœŸå®æœåŠ¡å™¨ï¼ˆReal-Serverï¼‰"><a href="#5ï¸âƒ£-æ·»åŠ çœŸå®æœåŠ¡å™¨ï¼ˆReal-Serverï¼‰" class="headerlink" title="5ï¸âƒ£ æ·»åŠ çœŸå®æœåŠ¡å™¨ï¼ˆReal Serverï¼‰"></a>5ï¸âƒ£ æ·»åŠ çœŸå®æœåŠ¡å™¨ï¼ˆReal Serverï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -a -t 192.168.0.1:80 -r 10.0.0.2:80 -m -w 2</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-a</code>: æ·»åŠ  Real Server</li>
<li><code>-r</code>: åç«¯çœŸå®æœåŠ¡å™¨ IP:Port</li>
<li><code>-m</code>: ä½¿ç”¨ NATï¼ˆMasqï¼‰æ¨¡å¼</li>
<li><code>-w</code>: æƒé‡è®¾ç½®</li>
</ul>
<h3 id="6ï¸âƒ£-åˆ é™¤è™šæ‹ŸæœåŠ¡æˆ–-Real-Server"><a href="#6ï¸âƒ£-åˆ é™¤è™šæ‹ŸæœåŠ¡æˆ–-Real-Server" class="headerlink" title="6ï¸âƒ£ åˆ é™¤è™šæ‹ŸæœåŠ¡æˆ– Real Server"></a>6ï¸âƒ£ åˆ é™¤è™šæ‹ŸæœåŠ¡æˆ– Real Server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -D -t 192.168.0.1:80</span><br><span class="line">ipvsadm -d -t 192.168.0.1:80 -r 10.0.0.2:80</span><br></pre></td></tr></table></figure>

<h3 id="7ï¸âƒ£-ä¿å­˜-æ¢å¤é…ç½®"><a href="#7ï¸âƒ£-ä¿å­˜-æ¢å¤é…ç½®" class="headerlink" title="7ï¸âƒ£ ä¿å­˜ &#x2F; æ¢å¤é…ç½®"></a>7ï¸âƒ£ ä¿å­˜ &#x2F; æ¢å¤é…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm-save &gt; /etc/sysconfig/ipvsadm</span><br><span class="line">ipvsadm-restore &lt; /etc/sysconfig/ipvsadm</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å››ã€å…¸å‹åº”ç”¨åœºæ™¯"><a href="#å››ã€å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="å››ã€å…¸å‹åº”ç”¨åœºæ™¯"></a>å››ã€å…¸å‹åº”ç”¨åœºæ™¯</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Kubernetes kube-proxy (ipvs æ¨¡å¼)</strong></td>
<td>ä½¿ç”¨ <code>ipvsadm</code> è¿›è¡ŒæœåŠ¡è´Ÿè½½å‡è¡¡ï¼Œæ€§èƒ½ä¼˜äº iptables</td>
</tr>
<tr>
<td><strong>é«˜æ€§èƒ½å››å±‚è´Ÿè½½å‡è¡¡</strong></td>
<td>åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­ä½œä¸º L4 è´Ÿè½½å‡è¡¡å™¨ (TCP&#x2F;UDP)</td>
</tr>
<tr>
<td><strong>HA é›†ç¾¤å‰ç«¯è´Ÿè½½</strong></td>
<td>æ­é… Keepalived å®ç° VIP æ¼‚ç§»ï¼ˆé«˜å¯ç”¨ LVSï¼‰</td>
</tr>
<tr>
<td><strong>ç›‘æ§ä¸è°ƒè¯•</strong></td>
<td>æ’æŸ¥è¿æ¥è°ƒåº¦ã€åç«¯å¥åº·æ£€æŸ¥çŠ¶æ€</td>
</tr>
</tbody></table>
<hr>
<h2 id="äº”ã€å®æˆ˜å»ºè®®ä¸æŠ€å·§"><a href="#äº”ã€å®æˆ˜å»ºè®®ä¸æŠ€å·§" class="headerlink" title="äº”ã€å®æˆ˜å»ºè®®ä¸æŠ€å·§"></a>äº”ã€å®æˆ˜å»ºè®®ä¸æŠ€å·§</h2><ul>
<li><p>ğŸ”¹ <strong>æŸ¥çœ‹å½“å‰è¿æ¥æƒ…å†µ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n1 <span class="string">&#x27;ipvsadm -Ln --rate&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸ”¹ <strong>å¿«é€Ÿæ‰¾å‡º VIP æ‰€å± real servers</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -Ln | grep -A3 <span class="string">&#x27;100.104.0.1:443&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸ”¹ <strong>é…åˆ Kubernetes è°ƒè¯•</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc -A</span><br><span class="line">ipvsadm -Ln | grep &lt;ClusterIP&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ğŸ”¹ <strong>æ¸…ç©ºæ‰€æœ‰ IPVS è§„åˆ™</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -C</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="å…­ã€æ€»ç»“ä¸æ€è€ƒ"><a href="#å…­ã€æ€»ç»“ä¸æ€è€ƒ" class="headerlink" title="å…­ã€æ€»ç»“ä¸æ€è€ƒ"></a>å…­ã€æ€»ç»“ä¸æ€è€ƒ</h2><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>LVS &#x2F; IPVS</th>
</tr>
</thead>
<tbody><tr>
<td>æ€§èƒ½</td>
<td>å†…æ ¸çº§è½¬å‘ï¼Œç™¾ä¸‡çº§ QPS</td>
</tr>
<tr>
<td>åœºæ™¯</td>
<td>Kubernetesã€LBã€ç½‘å…³</td>
</tr>
<tr>
<td>å¯¹æ¯”</td>
<td>ä¼˜äº iptablesï¼Œä½†ä»…æ”¯æŒ L4</td>
</tr>
<tr>
<td>å·¥å…·</td>
<td>ipvsadmï¼ˆæ‰‹å·¥æ“ä½œï¼‰ &#x2F; kube-proxyï¼ˆè‡ªåŠ¨ç®¡ç†ï¼‰</td>
</tr>
<tr>
<td>å»ºè®®</td>
<td>é…åˆ <code>keepalived</code> ä½¿ç”¨ï¼Œå®ç° HA</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“„-é™„å½•ï¼šè°ƒåº¦ç®—æ³•ç®€è¡¨"><a href="#ğŸ“„-é™„å½•ï¼šè°ƒåº¦ç®—æ³•ç®€è¡¨" class="headerlink" title="ğŸ“„ é™„å½•ï¼šè°ƒåº¦ç®—æ³•ç®€è¡¨"></a>ğŸ“„ é™„å½•ï¼šè°ƒåº¦ç®—æ³•ç®€è¡¨</h2><table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>åç§°</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><code>rr</code></td>
<td>Round Robin</td>
<td>å¹³å‡åˆ†é…</td>
</tr>
<tr>
<td><code>wrr</code></td>
<td>Weighted RR</td>
<td>æŒ‰æƒé‡åˆ†é…</td>
</tr>
<tr>
<td><code>lc</code></td>
<td>Least Connection</td>
<td>åŠ¨æ€è´Ÿè½½å‡è¡¡</td>
</tr>
<tr>
<td><code>wlc</code></td>
<td>Weighted LC</td>
<td>æŒ‰æƒé‡åŠ æƒæœ€å°è¿æ¥</td>
</tr>
<tr>
<td><code>lblc</code></td>
<td>Locality-Based LC</td>
<td>ä¼šè¯æœ¬åœ°æ€§</td>
</tr>
<tr>
<td><code>lblcr</code></td>
<td>Locality-Based Replicated LC</td>
<td>ä¼šè¯æœ¬åœ°æ€§ + å†—ä½™</td>
</tr>
<tr>
<td><code>sh</code></td>
<td>Source Hashing</td>
<td>åŸºäºæº IP å“ˆå¸Œ</td>
</tr>
<tr>
<td><code>dh</code></td>
<td>Destination Hashing</td>
<td>åŸºäºç›®çš„ IP å“ˆå¸Œ</td>
</tr>
</tbody></table>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/10/docker-ctr-crictl%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/10/docker-ctr-crictl%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">docker ctr crictl nerdctlå‘½ä»¤ä½¿ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-10 18:01:54" itemprop="dateCreated datePublished" datetime="2025-01-10T18:01:54+08:00">2025-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-15 17:43:30" itemprop="dateModified" datetime="2025-09-15T17:43:30+08:00">2025-09-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‘½ä»¤å¯¹æ¯”"><a href="#å‘½ä»¤å¯¹æ¯”" class="headerlink" title="å‘½ä»¤å¯¹æ¯”"></a>å‘½ä»¤å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>docker</th>
<th>ctrï¼ˆcontainerdï¼‰</th>
<th>crictlï¼ˆkubernetesï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨</td>
<td>docker ps</td>
<td>ctr task ls &#x2F; ctr container ls</td>
<td>crictl ps</td>
</tr>
<tr>
<td>æŸ¥çœ‹é•œåƒ</td>
<td>docker images</td>
<td>ctr image ls &#x2F; ctr i ls</td>
<td>crictl images</td>
</tr>
<tr>
<td>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</td>
<td>docker logs</td>
<td>æ— </td>
<td>crictl logs</td>
</tr>
<tr>
<td>æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</td>
<td>docker inspect</td>
<td>ctr container info</td>
<td>crictl inspect</td>
</tr>
<tr>
<td>æŸ¥çœ‹å®¹å™¨èµ„æº</td>
<td>docker stats</td>
<td>æ— </td>
<td>crictl stats</td>
</tr>
<tr>
<td>å¯åŠ¨&#x2F;å…³é—­å·²æœ‰çš„å®¹å™¨</td>
<td>docker start&#x2F;stop</td>
<td>ctr task start&#x2F;kill</td>
<td>crictl start&#x2F;stop</td>
</tr>
<tr>
<td>è¿è¡Œä¸€ä¸ªæ–°çš„å®¹å™¨</td>
<td>docker run</td>
<td>ctr run</td>
<td>æ— ï¼ˆæœ€å°å•å…ƒä¸º Podï¼‰</td>
</tr>
<tr>
<td>ä¿®æ”¹é•œåƒæ ‡ç­¾</td>
<td>docker tag</td>
<td>ctr image tag</td>
<td>æ— </td>
</tr>
<tr>
<td>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨</td>
<td>docker create</td>
<td>ctr container create</td>
<td>crictl create</td>
</tr>
<tr>
<td>å¯¼å…¥é•œåƒ</td>
<td>docker load</td>
<td>ctr image import</td>
<td>æ— </td>
</tr>
<tr>
<td>å¯¼å‡ºé•œåƒ</td>
<td>docker save</td>
<td>ctr image export</td>
<td>æ— </td>
</tr>
<tr>
<td>åˆ é™¤å®¹å™¨</td>
<td>docker rm</td>
<td>ctr container rm</td>
<td>crictl rm</td>
</tr>
<tr>
<td>åˆ é™¤é•œåƒ</td>
<td>docker rmi</td>
<td>ctr image rm</td>
<td>crictl rmi</td>
</tr>
<tr>
<td>æ‹‰å–é•œåƒ</td>
<td>docker pull</td>
<td>ctr image pull</td>
<td>crictl pull</td>
</tr>
<tr>
<td>æ¨é€é•œåƒ</td>
<td>docker push</td>
<td>ctr image push</td>
<td>æ— </td>
</tr>
<tr>
<td>åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤</td>
<td>docker exec</td>
<td>æ— </td>
<td>crictl exec</td>
</tr>
</tbody></table>
<hr>
<h2 id="dockeræ¸…ç†èµ„æº"><a href="#dockeræ¸…ç†èµ„æº" class="headerlink" title="dockeræ¸…ç†èµ„æº"></a>dockeræ¸…ç†èµ„æº</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹åœæ­¢çš„å®¹å™¨</span><br><span class="line">docker ps --filter status=exited --filter status=dead -q</span><br><span class="line">docker ps --filter status=exited --filter status=dead -s</span><br><span class="line">#åœæ­¢æ‰€æœ‰å®¹å™¨</span><br><span class="line">#docker stop $(docker ps -q)</span><br><span class="line"></span><br><span class="line">#æ¸…ç†åœæ­¢çš„å®¹å™¨</span><br><span class="line">docker container prune -f</span><br><span class="line"></span><br><span class="line">#åˆ—å‡ºæ‰€æœ‰æ‚¬ç©ºé•œåƒ</span><br><span class="line">docker images -f &quot;dangling=true&quot;</span><br><span class="line">#æ¸…ç†æœªä½¿ç”¨çš„é•œåƒï¼ˆæ‚¬ç©ºæˆ–æ— æ ‡ç­¾ï¼‰</span><br><span class="line">docker image prune -a -f</span><br><span class="line"></span><br><span class="line">#æ¸…é™¤é»˜è®¤æ„å»ºç¼“å­˜</span><br><span class="line">docker buildx prune -f</span><br><span class="line"></span><br><span class="line">#æ¸…ç†æœªä½¿ç”¨çš„å·</span><br><span class="line">docker volume prune -f</span><br><span class="line"></span><br><span class="line">#æ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ</span><br><span class="line">docker network prune -f</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å®¹å™¨ã€é•œåƒã€å·ç­‰èµ„æºçš„å ç”¨æƒ…å†µ</span><br><span class="line">docker system df</span><br><span class="line"></span><br><span class="line">#ç»¼åˆæ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®ï¼Œæ‰€æœ‰åºŸå¼ƒé•œåƒä¸Build Cache</span><br><span class="line">docker system prune -a -f --volumes</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ</span><br><span class="line">df -lh</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ctr"><a href="#ctr" class="headerlink" title="ctr"></a>ctr</h2><blockquote>
<p>ctr æ˜¯ä¸€ä¸ªä¸å—æ”¯æŒçš„ï¼Œç”¨äºä¸ containerd å®ˆæŠ¤è¿›ç¨‹äº¤äº’çš„è°ƒè¯•å’Œç®¡ç†å®¢æˆ·ç«¯ </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- æŸ¥çœ‹containerdå‘½åç©ºé—´ï¼šctr namespace ls</span><br><span class="line">- æŸ¥çœ‹containerdçš„é•œåƒï¼šctr images lsï¼ˆå¯æŒ‡å®šå‘½åç©ºé—´ï¼Œå¦‚ctr -n k8s.io images lsï¼‰</span><br><span class="line">- æ‹‰å–containerdçš„é•œåƒï¼šctr -n k8s.io images pull &lt;image&gt;</span><br><span class="line">- åˆ é™¤containerdçš„é•œåƒï¼šctr -n k8s.io images rm &lt;image&gt;</span><br><span class="line">- å¯¼å‡ºcontainerdçš„é•œåƒï¼šctr -n k8s.io images export &lt;image&gt;</span><br><span class="line">- å¯¼å…¥containerdçš„é•œåƒï¼šctr -n k8s.io image import &lt;image&gt;</span><br><span class="line">- æ ‡è®°containerdçš„é•œåƒï¼ˆèµ·åˆ«åï¼‰ï¼šctr -n k8s.io images tag &lt;image&gt; &lt;alias&gt;</span><br><span class="line">- è¿è¡Œcontainerdçš„å®¹å™¨ï¼šctr -n k8s.io run &lt;container&gt;</span><br><span class="line">- æŸ¥çœ‹è¿è¡Œå®¹å™¨çš„taskï¼šctr -n k8s.io task ls</span><br><span class="line">- å¯åŠ¨æŒ‡å®šå®¹å™¨çš„taskï¼šctr -n k8s.io task start &lt;container&gt;</span><br><span class="line">- è¿›å…¥æŒ‡å®šå®¹å™¨çš„taskï¼šctr -n k8s.io task exec --exec-id &lt;id&gt; -t &lt;container&gt; /bin/bash</span><br><span class="line">- åˆ é™¤æŒ‡å®šå®¹å™¨çš„taskï¼šctr -n k8s.io task rm -f &lt;container&gt;</span><br><span class="line">- åœæ­¢æŒ‡å®šå®¹å™¨çš„taskï¼šctr -n k8s.io task kill --signal &lt;signal&gt; &lt;container&gt;</span><br><span class="line">- æŸ¥çœ‹å®¹å™¨ï¼šctr -n k8s.io c list</span><br><span class="line">- åˆ é™¤å®¹å™¨ï¼šctr -n k8s.io c rm &lt;container&gt;</span><br></pre></td></tr></table></figure>

<h2 id="crictl"><a href="#crictl" class="headerlink" title="crictl"></a>crictl</h2><blockquote>
<p>crictl æ˜¯ä¸€ä¸ªç¬¦åˆ CRI æ¥å£è§„èŒƒçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šå¸¸ç”¨äºæ£€æŸ¥å’Œç®¡ç† kubelet èŠ‚ç‚¹ä¸Šçš„å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒ</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- å–æ¶ˆDEBUGä¿¡æ¯ï¼šcrictl --debug=false xxx</span><br><span class="line">- æŸ¥çœ‹é•œåƒï¼šcrictl images</span><br><span class="line">- æ‹‰å–é•œåƒï¼šcrictl pull &lt;image-name&gt;:&lt;tag&gt;</span><br><span class="line">- åˆ é™¤é•œåƒï¼šcrictl rmi &lt;image-id&gt;</span><br><span class="line">- åˆ—å‡ºå½“å‰è¿è¡Œçš„å®¹å™¨ï¼šcrictl ps</span><br><span class="line">- åˆ—å‡ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰ï¼šcrictl ps -a</span><br><span class="line">- æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼šcrictl inspect &lt;container-id&gt;</span><br><span class="line">- åœæ­¢æŒ‡å®šIDçš„å®¹å™¨ï¼šcrictl stop &lt;container-id&gt;</span><br><span class="line">- åˆ é™¤æŒ‡å®šIDçš„å®¹å™¨ï¼šcrictl rm &lt;container-id&gt;</span><br><span class="line">- åˆ—å‡ºå½“å‰è¿è¡Œçš„Podï¼šcrictl pods</span><br><span class="line">- æŸ¥çœ‹æŒ‡å®šPodçš„è¯¦ç»†ä¿¡æ¯ï¼šcrictl inspectp &lt;pod-id&gt;</span><br><span class="line">- åœæ­¢æŒ‡å®šIDçš„Podï¼šcrictl stopp &lt;pod-id&gt;</span><br><span class="line">- åˆ é™¤æŒ‡å®šIDçš„Podï¼šcrictl rmp &lt;pod-id&gt;</span><br><span class="line">- è·å–æŒ‡å®šå®¹å™¨çš„æ—¥å¿—è¾“å‡ºï¼šcrictl logs &lt;container-id&gt;</span><br><span class="line">- åˆ—å‡ºæŒ‡å®šå®¹å™¨çš„èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼šcrictl stats &lt;container-id&gt;</span><br><span class="line">- åˆ—å‡ºæŒ‡å®šPodçš„èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼šcrictl statsp &lt;pod-id&gt;</span><br><span class="line">- æ˜¾ç¤ºcrictlå’Œå®¹å™¨è¿è¡Œæ—¶çš„ç‰ˆæœ¬ä¿¡æ¯ï¼šcrictl version</span><br><span class="line">- åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼šcrictl exec -it &lt;container-id&gt; -- &lt;command&gt;</span><br></pre></td></tr></table></figure>

<h2 id="nerdctl"><a href="#nerdctl" class="headerlink" title="nerdctl"></a>nerdctl</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/containerd/nerdctl/releases">https://github.com/containerd/nerdctl/releases</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- nerdctl runï¼šåœ¨æ–°å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤</span><br><span class="line">- nerdctl execï¼šåœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤</span><br><span class="line">- nerdctl create : åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨</span><br><span class="line">- nerdctl logs : è·å–å®¹å™¨æ—¥å¿—</span><br><span class="line">- nerdctl startï¼šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</span><br><span class="line">- nerdctl stopï¼šåœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</span><br><span class="line">- nerdctl restartï¼šé‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚</span><br><span class="line">- nerdctl rm/rmiï¼šåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨/å›¾åƒã€‚</span><br><span class="line">- nerdctl container pruneï¼šåˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨ã€‚</span><br><span class="line">- nerdctl buildï¼šä» Dockerfile æ„å»ºå›¾åƒã€‚</span><br><span class="line">- nerdctl pull/pushï¼šä»æ³¨å†Œè¡¨ä¸­æ‹‰å–/æ¨é€å›¾åƒã€‚</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="å¿«é€Ÿéƒ¨ç½²dockeræœåŠ¡"><a href="#å¿«é€Ÿéƒ¨ç½²dockeræœåŠ¡" class="headerlink" title="å¿«é€Ÿéƒ¨ç½²dockeræœåŠ¡"></a>å¿«é€Ÿéƒ¨ç½²dockeræœåŠ¡</h2><ul>
<li>æ‰§è¡Œæ–¹å¼ï¼šDATA_ROOT&#x3D;&#x2F;mnt&#x2F;docker DOCKER_VERSION&#x3D;25.0.5 .&#x2F;install-docker.sh<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">set -euo pipefail</span><br><span class="line"></span><br><span class="line"># ==============================</span><br><span class="line"># Configurable options</span><br><span class="line"># ==============================</span><br><span class="line">DOCKER_VERSION=&quot;$&#123;DOCKER_VERSION:-25.0.4&#125;&quot;</span><br><span class="line">DOCKER_CLI_VERSION=&quot;$&#123;DOCKER_CLI_VERSION:-25.0.4&#125;&quot;</span><br><span class="line">CONTAINERD_VERSION=&quot;$&#123;CONTAINERD_VERSION:-1.6.32&#125;&quot;</span><br><span class="line">COMPOSE_VERSION=&quot;$&#123;COMPOSE_VERSION:-2.27.0&#125;&quot;</span><br><span class="line">DATA_ROOT=&quot;$&#123;DATA_ROOT:-/data/docker&#125;&quot;</span><br><span class="line">MTU=&quot;$&#123;MTU:-1450&#125;&quot;</span><br><span class="line"></span><br><span class="line">DOCKER_BASE_URL=&quot;https://mirrors.aliyun.com/docker-ce/linux/centos/8/x86_64/stable/Packages&quot;</span><br><span class="line"></span><br><span class="line"># ==============================</span><br><span class="line"># Helper functions</span><br><span class="line"># ==============================</span><br><span class="line">log() &#123;</span><br><span class="line">    echo -e &quot;\033[1;32m[INFO]\033[0m $*&quot;</span><br><span class="line">&#125;</span><br><span class="line">warn() &#123;</span><br><span class="line">    echo -e &quot;\033[1;33m[WARN]\033[0m $*&quot;</span><br><span class="line">&#125;</span><br><span class="line">err() &#123;</span><br><span class="line">    echo -e &quot;\033[1;31m[ERROR]\033[0m $*&quot; &gt;&amp;2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ==============================</span><br><span class="line"># Install Docker</span><br><span class="line"># ==============================</span><br><span class="line">log &quot;Installing Docker CE version $&#123;DOCKER_VERSION&#125;...&quot;</span><br><span class="line"></span><br><span class="line">dnf install -y \</span><br><span class="line">  $&#123;DOCKER_BASE_URL&#125;/docker-ce-$&#123;DOCKER_VERSION&#125;-1.el8.x86_64.rpm \</span><br><span class="line">  $&#123;DOCKER_BASE_URL&#125;/docker-ce-cli-$&#123;DOCKER_CLI_VERSION&#125;-1.el8.x86_64.rpm \</span><br><span class="line">  $&#123;DOCKER_BASE_URL&#125;/containerd.io-$&#123;CONTAINERD_VERSION&#125;-3.1.el8.x86_64.rpm \</span><br><span class="line">  $&#123;DOCKER_BASE_URL&#125;/docker-compose-plugin-$&#123;COMPOSE_VERSION&#125;-1.el8.x86_64.rpm \</span><br><span class="line">  || &#123; err &quot;Docker installation failed&quot;; exit 1; &#125;</span><br><span class="line"></span><br><span class="line">log &quot;Docker installed successfully.&quot;</span><br><span class="line"></span><br><span class="line"># ==============================</span><br><span class="line"># Configure Docker</span><br><span class="line"># ==============================</span><br><span class="line">log &quot;Configuring Docker daemon...&quot;</span><br><span class="line"></span><br><span class="line">mkdir -p &quot;$&#123;DATA_ROOT&#125;&quot;</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">   &quot;registry-mirrors&quot;: [</span><br><span class="line">     &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="line">     &quot;https://fw92oidw.mirror.aliyuncs.com&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;log-opts&quot;: &#123;</span><br><span class="line">        &quot;max-file&quot;: &quot;3&quot;,</span><br><span class="line">        &quot;max-size&quot;: &quot;500m&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;data-root&quot;: &quot;$&#123;DATA_ROOT&#125;&quot;,</span><br><span class="line">    &quot;mtu&quot;: $&#123;MTU&#125;,</span><br><span class="line">    &quot;iptables&quot;: true,</span><br><span class="line">    &quot;live-restore&quot;: true,</span><br><span class="line">    &quot;init&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">log &quot;Docker configuration written to /etc/docker/daemon.json&quot;</span><br><span class="line"></span><br><span class="line"># ==============================</span><br><span class="line"># Enable and restart Docker</span><br><span class="line"># ==============================</span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">log &quot;Docker service enabled and restarted successfully.&quot;</span><br><span class="line">log &quot;Data root set to $&#123;DATA_ROOT&#125;, MTU set to $&#123;MTU&#125;.&quot;</span><br><span class="line"></span><br><span class="line">log &quot;Docker Registry Mirrors&quot;</span><br><span class="line">docker info | grep -A3 &quot;Registry Mirrors&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æŸ¥çœ‹å®¹å™¨ä¸è¿›ç¨‹æ˜ å°„"><a href="#æŸ¥çœ‹å®¹å™¨ä¸è¿›ç¨‹æ˜ å°„" class="headerlink" title="æŸ¥çœ‹å®¹å™¨ä¸è¿›ç¨‹æ˜ å°„"></a>æŸ¥çœ‹å®¹å™¨ä¸è¿›ç¨‹æ˜ å°„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#dockerè¿è¡Œæ—¶</span><br><span class="line">docker ps -q | while read cid; do</span><br><span class="line">    pid=$(docker inspect -f &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; $cid)</span><br><span class="line">    echo &quot;$cid -&gt; $pid&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#containerdè¿è¡Œæ—¶</span><br><span class="line">crictl --debug=false ps -q | while read cid; do</span><br><span class="line">    pid=$(crictl --debug=false inspect $cid | jq -r &#x27;.info.pid&#x27;)</span><br><span class="line">    echo &quot;$cid -&gt; $pid&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<ul>
<li>k8sèŠ‚ç‚¹æ‰“å°å¤šé¡¹ä¿¡æ¯<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#dockerè¿è¡Œæ—¶</span><br><span class="line">#!/usr/bin/env bash</span><br><span class="line">set -euo pipefail</span><br><span class="line"></span><br><span class="line"># æ‰“å°è¡¨å¤´</span><br><span class="line">printf &quot;%-20s %-10s %-40s %-30s %-20s %-20s\n&quot; \</span><br><span class="line">  &quot;CONTAINER_ID&quot; &quot;PID&quot; &quot;POD_UID&quot; &quot;POD_NAME&quot; &quot;NAMESPACE&quot; &quot;CONTAINER_NAME&quot;</span><br><span class="line"></span><br><span class="line">docker ps -q | while read -r cid; do</span><br><span class="line">    inspect_json=$(docker inspect &quot;$cid&quot;)</span><br><span class="line"></span><br><span class="line">    pid=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.[0].State.Pid&#x27;)</span><br><span class="line">    pod_uid=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.[0].Config.Labels.&quot;io.kubernetes.pod.uid&quot;&#x27;)</span><br><span class="line">    pod_name=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.[0].Config.Labels.&quot;io.kubernetes.pod.name&quot;&#x27;)</span><br><span class="line">    namespace=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.[0].Config.Labels.&quot;io.kubernetes.pod.namespace&quot;&#x27;)</span><br><span class="line">    container_name=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.[0].Config.Labels.&quot;io.kubernetes.container.name&quot;&#x27;)</span><br><span class="line"></span><br><span class="line">    printf &quot;%-20s %-10s %-40s %-30s %-20s %-20s\n&quot; \</span><br><span class="line">      &quot;$cid&quot; &quot;$pid&quot; &quot;$pod_uid&quot; &quot;$pod_name&quot; &quot;$namespace&quot; &quot;$container_name&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#containerdè¿è¡Œæ—¶</span><br><span class="line">#!/usr/bin/env bash</span><br><span class="line">set -euo pipefail</span><br><span class="line"></span><br><span class="line"># æ‰“å°è¡¨å¤´</span><br><span class="line">printf &quot;%-20s %-10s %-40s %-30s\n&quot; &quot;CONTAINER_ID&quot; &quot;PID&quot; &quot;POD_UID&quot; &quot;POD_NAME&quot;</span><br><span class="line"></span><br><span class="line">crictl --debug=false ps -q | while read -r cid; do</span><br><span class="line">    inspect_json=$(crictl --debug=false inspect &quot;$cid&quot;)</span><br><span class="line">    pid=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.info.pid&#x27;)</span><br><span class="line">    pod_uid=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.status.labels.&quot;io.kubernetes.pod.uid&quot;&#x27;)</span><br><span class="line">    pod_name=$(echo &quot;$inspect_json&quot; | jq -r &#x27;.status.labels.&quot;io.kubernetes.pod.name&quot;&#x27;)</span><br><span class="line"></span><br><span class="line">    printf &quot;%-20s %-10s %-40s %-30s\n&quot; &quot;$cid&quot; &quot;$pid&quot; &quot;$pod_uid&quot; &quot;$pod_name&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/09/linux%E8%B4%9F%E8%BD%BD%E8%BE%83%E9%AB%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/09/linux%E8%B4%9F%E8%BD%BD%E8%BE%83%E9%AB%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">linuxè´Ÿè½½è¾ƒé«˜æ’æŸ¥æ­¥éª¤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-09 11:10:22" itemprop="dateCreated datePublished" datetime="2025-01-09T11:10:22+08:00">2025-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-08 16:34:37" itemprop="dateModified" datetime="2025-12-08T16:34:37+08:00">2025-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜çš„æ’æŸ¥æ­¥éª¤ä¸å‘½ä»¤æ±‡æ€»"><a href="#ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜çš„æ’æŸ¥æ­¥éª¤ä¸å‘½ä»¤æ±‡æ€»" class="headerlink" title="ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜çš„æ’æŸ¥æ­¥éª¤ä¸å‘½ä»¤æ±‡æ€»"></a><strong>ç³»ç»Ÿè´Ÿè½½è¾ƒé«˜çš„æ’æŸ¥æ­¥éª¤ä¸å‘½ä»¤æ±‡æ€»</strong></h3><p>ä»¥ä¸‹ä» <strong>CPUã€å†…å­˜ã€ç£ç›˜ I&#x2F;Oã€ç½‘ç»œã€ç³»ç»Ÿæ•´ä½“</strong> äº”ä¸ªæ–¹é¢æ€»ç»“æ’æŸ¥æ­¥éª¤å’Œå¸¸ç”¨å‘½ä»¤ï¼Œç»“åˆå…·ä½“æŒ‡æ ‡è¿›è¡Œåˆ†æï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<hr>
<h4 id="1-CPU-è´Ÿè½½æ’æŸ¥"><a href="#1-CPU-è´Ÿè½½æ’æŸ¥" class="headerlink" title="1. CPU è´Ÿè½½æ’æŸ¥"></a><strong>1. CPU è´Ÿè½½æ’æŸ¥</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>æŒ‡æ ‡&#x2F;å‚æ•°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>top</code></td>
<td><code>%CPU</code></td>
<td>æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ï¼ŒæŒ‰ <code>P</code> æ’åºé«˜ä½¿ç”¨ç‡è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>mpstat -P ALL</code></td>
<td><code>%usr</code>, <code>%sys</code>, <code>%idle</code></td>
<td>æŸ¥çœ‹æ¯ä¸ªæ ¸å¿ƒçš„ CPU ä½¿ç”¨ç‡ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå•æ ¸ç“¶é¢ˆæˆ–å¤šæ ¸å‡é«˜ã€‚</td>
</tr>
<tr>
<td><code>sar -P ALL</code></td>
<td><code>%iowait</code></td>
<td>æ£€æŸ¥ CPU æ˜¯å¦å›  I&#x2F;O ç­‰å¾…ï¼ˆ<code>%iowait</code> é«˜ï¼‰å¯¼è‡´è´Ÿè½½é«˜ã€‚</td>
</tr>
<tr>
<td><code>pidstat -p &lt;PID&gt;</code></td>
<td><code>%CPU</code></td>
<td>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ï¼Œæ˜¯å¦æœ‰å¼‚å¸¸é«˜è€—ç”¨ã€‚</td>
</tr>
<tr>
<td><code>htop</code></td>
<td>å›¾å½¢åŒ–ç›‘æ§</td>
<td>æ›´ç›´è§‚åœ°æŸ¥çœ‹é«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹å’Œçº¿ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>iotop</code></td>
<td>CPU åˆ—</td>
<td>æ£€æŸ¥æ˜¯å¦æœ‰ I&#x2F;O ç›¸å…³çš„ CPU æ¶ˆè€—ã€‚</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong><code>%idle</code> ä½</strong>ï¼šCPU ä½¿ç”¨ç‡é«˜ï¼Œéœ€æ’æŸ¥é«˜è€— CPU è¿›ç¨‹ã€‚</li>
<li><strong><code>%iowait</code> é«˜</strong>ï¼šå¯èƒ½æ˜¯ç£ç›˜æˆ–ç½‘ç»œ I&#x2F;O ç“¶é¢ˆã€‚</li>
<li><strong>å•æ ¸é«˜è´Ÿè½½</strong>ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºå•çº¿ç¨‹ä»»åŠ¡å¯¼è‡´ç“¶é¢ˆã€‚</li>
<li><strong>å¤šæ ¸é«˜è´Ÿè½½</strong>ï¼šé€šå¸¸ä¸ºå¹¶è¡Œä»»åŠ¡å ç”¨ï¼Œéœ€è¦ä¼˜åŒ–ä»»åŠ¡åˆ†é…ã€‚</li>
</ul>
<hr>
<h4 id="2-å†…å­˜è´Ÿè½½æ’æŸ¥"><a href="#2-å†…å­˜è´Ÿè½½æ’æŸ¥" class="headerlink" title="2. å†…å­˜è´Ÿè½½æ’æŸ¥"></a><strong>2. å†…å­˜è´Ÿè½½æ’æŸ¥</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>æŒ‡æ ‡&#x2F;å‚æ•°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>free -m</code></td>
<td><code>used</code>, <code>free</code>, <code>buffers</code></td>
<td>æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œ<code>free</code> å€¼ä½å¯èƒ½æ˜¯å†…å­˜ä¸è¶³ã€‚</td>
</tr>
<tr>
<td><code>vmstat 1 5</code></td>
<td><code>si</code>, <code>so</code></td>
<td>æ£€æŸ¥å†…å­˜æ¢å…¥æ¢å‡ºï¼ˆswap in&#x2F;outï¼‰ï¼Œ<code>si/so</code> é«˜è¯´æ˜å†…å­˜ä¸è¶³ã€‚</td>
</tr>
<tr>
<td><code>top</code></td>
<td><code>%MEM</code></td>
<td>æŒ‰ <code>M</code> æ’åºï¼Œå®šä½é«˜å†…å­˜å ç”¨è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>ps -eo pid,%mem,cmd</code></td>
<td><code>%MEM</code></td>
<td>åˆ—å‡ºè¿›ç¨‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè¾…åŠ©å®šä½å†…å­˜æ³„æ¼è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>smem</code></td>
<td><code>PSS</code>, <code>USS</code></td>
<td>åˆ†æè¿›ç¨‹çš„å…±äº«å†…å­˜ï¼ˆ<code>PSS</code>ï¼‰å’Œç‹¬å å†…å­˜ï¼ˆ<code>USS</code>ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>iotop</code></td>
<td>SWAP åˆ—</td>
<td>æ£€æŸ¥æ˜¯å¦æœ‰è¿›ç¨‹é¢‘ç¹ä½¿ç”¨ swapã€‚</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜ä¸è¶³</strong>ï¼š<code>free</code> å€¼ä½ï¼Œå¯èƒ½éœ€è¦æ‰©å±•å†…å­˜æˆ–ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</li>
<li><strong>swap ä½¿ç”¨é«˜</strong>ï¼šå¯èƒ½æ˜¯å†…å­˜ä¸è¶³å¯¼è‡´ï¼Œswap ä¼šæ‹–æ…¢ç³»ç»Ÿã€‚</li>
<li><strong>é«˜å†…å­˜å ç”¨è¿›ç¨‹</strong>ï¼šæ’æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼æˆ–éœ€ä¼˜åŒ–ç¨‹åºé€»è¾‘ã€‚</li>
</ul>
<hr>
<h4 id="3-ç£ç›˜-I-O-è´Ÿè½½æ’æŸ¥"><a href="#3-ç£ç›˜-I-O-è´Ÿè½½æ’æŸ¥" class="headerlink" title="3. ç£ç›˜ I&#x2F;O è´Ÿè½½æ’æŸ¥"></a><strong>3. ç£ç›˜ I&#x2F;O è´Ÿè½½æ’æŸ¥</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>æŒ‡æ ‡&#x2F;å‚æ•°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>iostat -x 1 5</code></td>
<td><code>%util</code>, <code>await</code></td>
<td><code>%util</code> é«˜ï¼ˆæ¥è¿‘ 100%ï¼‰è¯´æ˜ç£ç›˜ç¹å¿™ï¼Œ<code>await</code> é«˜è¯´æ˜ç£ç›˜å»¶è¿Ÿå¤§ã€‚</td>
</tr>
<tr>
<td><code>iotop</code></td>
<td>DISK READ&#x2F;WRITE åˆ—</td>
<td>å®æ—¶æŸ¥çœ‹è¿›ç¨‹çš„ç£ç›˜è¯»å†™é‡ï¼Œå®šä½é«˜ I&#x2F;O è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>pidstat -d -p &lt;PID&gt;</code></td>
<td><code>kB_rd/s</code>, <code>kB_wr/s</code></td>
<td>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç£ç›˜è¯»å†™é€Ÿç‡ã€‚</td>
</tr>
<tr>
<td><code>df -h</code></td>
<td><code>Use%</code></td>
<td>æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡æ˜¯å¦æ¥è¿‘ 100%ï¼Œå¯èƒ½å¯¼è‡´ I&#x2F;O ç“¶é¢ˆã€‚</td>
</tr>
<tr>
<td><code>du -sh /path/to/dir</code></td>
<td>æ–‡ä»¶å¤¹å¤§å°</td>
<td>å®šä½å¤§æ–‡ä»¶æˆ–ç›®å½•ï¼Œæ¸…ç†ç£ç›˜ç©ºé—´ã€‚</td>
</tr>
<tr>
<td><code>lsblk</code></td>
<td>ç£ç›˜åˆ†åŒº</td>
<td>æŸ¥çœ‹ç£ç›˜æŒ‚è½½å’Œåˆ†åŒºä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æŒ‚è½½é”™è¯¯ã€‚</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong><code>%util</code> é«˜ï¼Œ<code>await</code> é«˜</strong>ï¼šç£ç›˜æ€§èƒ½ç“¶é¢ˆï¼Œéœ€ä¼˜åŒ–ç£ç›˜è¯»å†™æˆ–å‡çº§å­˜å‚¨è®¾å¤‡ã€‚</li>
<li><strong>é«˜ I&#x2F;O è¿›ç¨‹</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é¢‘ç¹è¯»å†™æ“ä½œï¼Œä¼˜åŒ–ç¨‹åºé€»è¾‘ã€‚</li>
<li><strong>ç£ç›˜ç©ºé—´ä¸è¶³</strong>ï¼šæ¸…ç†å¤§æ–‡ä»¶æˆ–æ‰©å±•ç£ç›˜ç©ºé—´ã€‚</li>
</ul>
<hr>
<h4 id="4-ç½‘ç»œ-I-O-è´Ÿè½½æ’æŸ¥"><a href="#4-ç½‘ç»œ-I-O-è´Ÿè½½æ’æŸ¥" class="headerlink" title="4. ç½‘ç»œ I&#x2F;O è´Ÿè½½æ’æŸ¥"></a><strong>4. ç½‘ç»œ I&#x2F;O è´Ÿè½½æ’æŸ¥</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>æŒ‡æ ‡&#x2F;å‚æ•°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>sar -n DEV 1 5</code></td>
<td><code>rxpck/s</code>, <code>txpck/s</code></td>
<td>æŸ¥çœ‹ç½‘ç»œæ¥å£çš„æ¥æ”¶&#x2F;å‘é€æ•°æ®åŒ…é€Ÿç‡ã€‚</td>
</tr>
<tr>
<td><code>iftop</code></td>
<td>æµé‡å ç”¨</td>
<td>å®æ—¶æŸ¥çœ‹å…·ä½“ IP æˆ–ç«¯å£çš„ç½‘ç»œæµé‡å ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>netstat -ant</code> æˆ– <code>ss</code></td>
<td>è¿æ¥çŠ¶æ€</td>
<td>æ£€æŸ¥ TCP è¿æ¥æ˜¯å¦è¿‡å¤šï¼ˆå¦‚å¤§é‡ <code>TIME_WAIT</code>ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>ip -s link</code></td>
<td>æ¥å£çŠ¶æ€</td>
<td>æŸ¥çœ‹ç½‘ç»œæ¥å£çš„æµé‡ç»Ÿè®¡å’Œé”™è¯¯ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>nload</code></td>
<td>å›¾å½¢åŒ–æµé‡æ˜¾ç¤º</td>
<td>å®æ—¶æŸ¥çœ‹ç½‘ç»œæµé‡ï¼Œå®šä½é«˜æµé‡æ¥å£ã€‚</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>é«˜æµé‡</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸æµé‡æˆ–å¸¦å®½ç“¶é¢ˆã€‚</li>
<li><strong>TCP è¿æ¥è¿‡å¤š</strong>ï¼šä¼˜åŒ–è¿æ¥ç®¡ç†æˆ–å¢åŠ è´Ÿè½½å‡è¡¡ã€‚</li>
<li><strong>ç½‘ç»œæ¥å£é”™è¯¯</strong>ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ä¸¢åŒ…æˆ–ç¡¬ä»¶é—®é¢˜ã€‚</li>
</ul>
<hr>
<h4 id="5-ç³»ç»Ÿæ•´ä½“æ€§èƒ½æ’æŸ¥"><a href="#5-ç³»ç»Ÿæ•´ä½“æ€§èƒ½æ’æŸ¥" class="headerlink" title="5. ç³»ç»Ÿæ•´ä½“æ€§èƒ½æ’æŸ¥"></a><strong>5. ç³»ç»Ÿæ•´ä½“æ€§èƒ½æ’æŸ¥</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤</strong></th>
<th><strong>æŒ‡æ ‡&#x2F;å‚æ•°</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>uptime</code></td>
<td><code>load average</code></td>
<td>æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ï¼Œäº†è§£æ˜¯å¦æœ‰æŒç»­é«˜è´Ÿè½½ã€‚</td>
</tr>
<tr>
<td><code>vmstat 1 5</code></td>
<td><code>r</code>, <code>b</code>, <code>wa</code></td>
<td><code>r</code> è¡¨ç¤ºè¿è¡Œé˜Ÿåˆ—ï¼Œ<code>b</code> è¡¨ç¤ºé˜»å¡è¿›ç¨‹ï¼Œ<code>wa</code> è¡¨ç¤º I&#x2F;O ç­‰å¾…ã€‚</td>
</tr>
<tr>
<td><code>top</code></td>
<td>ç»¼åˆç›‘æ§</td>
<td>æŸ¥çœ‹ CPUã€å†…å­˜ã€è¿›ç¨‹ã€I&#x2F;O çš„ç»¼åˆä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>htop</code></td>
<td>å›¾å½¢åŒ–è¿›ç¨‹ç›‘æ§</td>
<td>æ›´ç›´è§‚åœ°ç›‘æ§ç³»ç»Ÿèµ„æºã€‚</td>
</tr>
<tr>
<td><code>iotop</code></td>
<td>ç»¼åˆ I&#x2F;O å ç”¨</td>
<td>å®æ—¶æŸ¥çœ‹ç£ç›˜ I&#x2F;O å’Œ CPU å…³è”çš„è¿›ç¨‹ã€‚</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>é«˜è´Ÿè½½ä½† CPU ä½¿ç”¨ç‡ä½</strong>ï¼šé€šå¸¸æ˜¯ I&#x2F;O æˆ–å†…å­˜ç“¶é¢ˆã€‚</li>
<li><strong>è¿è¡Œé˜Ÿåˆ—é«˜</strong>ï¼šè¡¨æ˜ä»»åŠ¡å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œéœ€åˆ†æå…·ä½“ç“¶é¢ˆã€‚</li>
<li><strong>é˜»å¡è¿›ç¨‹å¤š</strong>ï¼šé€šå¸¸æ˜¯ I&#x2F;O æˆ–èµ„æºäº‰ç”¨é—®é¢˜ã€‚</li>
</ul>
<hr>
<h3 id="iostatå®‰è£…åŠå‘½ä»¤è§£æ"><a href="#iostatå®‰è£…åŠå‘½ä»¤è§£æ" class="headerlink" title="iostatå®‰è£…åŠå‘½ä»¤è§£æ"></a>iostatå®‰è£…åŠå‘½ä»¤è§£æ</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://jueee.github.io/2020/12/2020-12-16-Linux%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8iostat%E5%91%BD%E4%BB%A4">https://jueee.github.io/2020/12/2020-12-16-Linux%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8iostat%E5%91%BD%E4%BB%A4</a></p>
</blockquote>
<ul>
<li>å®‰è£…ï¼šyum -y install sysstat<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">é€‰é¡¹:</span><br><span class="line">-cï¼šä»…æ˜¾ç¤º CPU ä½¿ç”¨æƒ…å†µï¼›</span><br><span class="line">-dï¼šä»…æ˜¾ç¤ºè®¾å¤‡åˆ©ç”¨ç‡ï¼›</span><br><span class="line">-kï¼šæ˜¾ç¤ºçŠ¶æ€ä»¥åƒå­—èŠ‚æ¯ç§’ä¸ºå•ä½ï¼Œè€Œä¸ä½¿ç”¨å—æ¯ç§’ï¼›</span><br><span class="line">-mï¼šæ˜¾ç¤ºçŠ¶æ€ä»¥å…†å­—èŠ‚æ¯ç§’ä¸ºå•ä½ï¼›</span><br><span class="line">-pï¼šä»…æ˜¾ç¤ºå—è®¾å¤‡å’Œæ‰€æœ‰è¢«ä½¿ç”¨çš„å…¶ä»–åˆ†åŒºçš„çŠ¶æ€ï¼›</span><br><span class="line">-tï¼šæ˜¾ç¤ºæ¯ä¸ªæŠ¥å‘Šäº§ç”Ÿæ—¶çš„æ—¶é—´ï¼›</span><br><span class="line">-Vï¼šæ˜¾ç¤ºç‰ˆå·å¹¶é€€å‡ºï¼›</span><br><span class="line">-xï¼šæ˜¾ç¤ºæ‰©å±•çŠ¶æ€ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">é—´éš”æ—¶é—´ï¼šæ¯æ¬¡æŠ¥å‘Šçš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ï¼›</span><br><span class="line">æ¬¡æ•°ï¼šæ˜¾ç¤ºæŠ¥å‘Šçš„æ¬¡æ•°ã€‚</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®"><a href="#æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®"></a><strong>æ€»ç»“ä¸ä¼˜åŒ–å»ºè®®</strong></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/linhuchong/5241886">https://blog.51cto.com/linhuchong/5241886</a></p>
</blockquote>
<ol>
<li><strong>æ’æŸ¥é¡ºåº</strong>ï¼š<ul>
<li>å…ˆæ£€æŸ¥ç³»ç»Ÿæ•´ä½“è´Ÿè½½ï¼ˆ<code>uptime</code>ã€<code>top</code>ï¼‰ã€‚</li>
<li>å†åˆ†åˆ«æ£€æŸ¥ CPUã€å†…å­˜ã€ç£ç›˜ I&#x2F;O å’Œç½‘ç»œã€‚</li>
</ul>
</li>
<li><strong>ç»“åˆå·¥å…·</strong>ï¼š<ul>
<li>ä½¿ç”¨ <code>iotop</code>ã€<code>htop</code> ç­‰å·¥å…·å¿«é€Ÿå®šä½é«˜èµ„æºå ç”¨çš„è¿›ç¨‹ã€‚</li>
<li>ä½¿ç”¨ <code>sar</code>ã€<code>vmstat</code> ç­‰å·¥å…·åˆ†æå†å²æ•°æ®ã€‚</li>
</ul>
</li>
<li><strong>ä¼˜åŒ–æ–¹å‘</strong>ï¼š<ul>
<li>CPUï¼šä¼˜åŒ–é«˜è€—ä»»åŠ¡æˆ–å¢åŠ æ ¸æ•°ã€‚</li>
<li>å†…å­˜ï¼šä¼˜åŒ–ç¨‹åºé€»è¾‘æˆ–æ‰©å±•ç‰©ç†å†…å­˜ã€‚</li>
<li>ç£ç›˜ I&#x2F;Oï¼šå‡å°‘é¢‘ç¹è¯»å†™æˆ–å‡çº§å­˜å‚¨è®¾å¤‡ã€‚</li>
<li>ç½‘ç»œï¼šä¼˜åŒ–æµé‡åˆ†å‘æˆ–é™åˆ¶å¼‚å¸¸æµé‡ã€‚</li>
</ul>
</li>
</ol>
<h2 id="å‚è€ƒå›¾ç‰‡"><a href="#å‚è€ƒå›¾ç‰‡" class="headerlink" title="å‚è€ƒå›¾ç‰‡"></a>å‚è€ƒå›¾ç‰‡</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://liuhao163.github.io/%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96-%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E7%9A%84%E5%A5%97%E8%B7%AF%E6%80%BB%E7%BB%93/">https://liuhao163.github.io/%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96-%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E7%9A%84%E5%A5%97%E8%B7%AF%E6%80%BB%E7%BB%93/</a></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/shispring/picgo/master/b16f34a197e1b9a6137f8ea263ea5063.png" alt="æ€§èƒ½æ’æŸ¥"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/08/PromQL%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/08/PromQL%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">PromQLä¸€äº›ç”¨æ³•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-08 11:49:44 / ä¿®æ”¹æ—¶é—´ï¼š11:50:23" itemprop="dateCreated datePublished" datetime="2025-01-08T11:49:44+08:00">2025-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/promql/" itemprop="url" rel="index"><span itemprop="name">promql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="å¸¸ç”¨-PromQL-æŸ¥è¯¢ç¤ºä¾‹"><a href="#å¸¸ç”¨-PromQL-æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="å¸¸ç”¨ PromQL æŸ¥è¯¢ç¤ºä¾‹"></a><strong>å¸¸ç”¨ PromQL æŸ¥è¯¢ç¤ºä¾‹</strong></h3><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§åœºæ™¯å’Œ PromQL æŸ¥è¯¢ç”¨æ³•ï¼š</p>
<h4 id="1-æŸ¥è¯¢ç‰¹å®šæŒ‡æ ‡çš„å½“å‰å€¼"><a href="#1-æŸ¥è¯¢ç‰¹å®šæŒ‡æ ‡çš„å½“å‰å€¼" class="headerlink" title="1. æŸ¥è¯¢ç‰¹å®šæŒ‡æ ‡çš„å½“å‰å€¼"></a><strong>1. æŸ¥è¯¢ç‰¹å®šæŒ‡æ ‡çš„å½“å‰å€¼</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total</span><br></pre></td></tr></table></figure>

<h4 id="2-æŸ¥è¯¢ç‰¹å®šå®ä¾‹çš„-CPU-ä½¿ç”¨ç‡"><a href="#2-æŸ¥è¯¢ç‰¹å®šå®ä¾‹çš„-CPU-ä½¿ç”¨ç‡" class="headerlink" title="2. æŸ¥è¯¢ç‰¹å®šå®ä¾‹çš„ CPU ä½¿ç”¨ç‡"></a><strong>2. æŸ¥è¯¢ç‰¹å®šå®ä¾‹çš„ CPU ä½¿ç”¨ç‡</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_cpu_seconds_total&#123;mode=&quot;user&quot;, instance=&quot;server1&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>

<h4 id="3-æŸ¥è¯¢æ‰€æœ‰å®ä¾‹çš„-CPU-ä½¿ç”¨ç‡"><a href="#3-æŸ¥è¯¢æ‰€æœ‰å®ä¾‹çš„-CPU-ä½¿ç”¨ç‡" class="headerlink" title="3. æŸ¥è¯¢æ‰€æœ‰å®ä¾‹çš„ CPU ä½¿ç”¨ç‡"></a><strong>3. æŸ¥è¯¢æ‰€æœ‰å®ä¾‹çš„ CPU ä½¿ç”¨ç‡</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_cpu_seconds_total&#123;mode=&quot;user&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>

<h4 id="4-æŸ¥è¯¢å†…å­˜ä½¿ç”¨ç‡"><a href="#4-æŸ¥è¯¢å†…å­˜ä½¿ç”¨ç‡" class="headerlink" title="4. æŸ¥è¯¢å†…å­˜ä½¿ç”¨ç‡"></a><strong>4. æŸ¥è¯¢å†…å­˜ä½¿ç”¨ç‡</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes</span><br></pre></td></tr></table></figure>

<h4 id="5-æŸ¥è¯¢ç£ç›˜-I-O-è¯»å–é€Ÿç‡"><a href="#5-æŸ¥è¯¢ç£ç›˜-I-O-è¯»å–é€Ÿç‡" class="headerlink" title="5. æŸ¥è¯¢ç£ç›˜ I&#x2F;O è¯»å–é€Ÿç‡"></a><strong>5. æŸ¥è¯¢ç£ç›˜ I&#x2F;O è¯»å–é€Ÿç‡</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(node_disk_read_bytes_total[5m])</span><br></pre></td></tr></table></figure>

<h4 id="6-æŸ¥è¯¢-HTTP-è¯·æ±‚çŠ¶æ€ç åˆ†å¸ƒ"><a href="#6-æŸ¥è¯¢-HTTP-è¯·æ±‚çŠ¶æ€ç åˆ†å¸ƒ" class="headerlink" title="6. æŸ¥è¯¢ HTTP è¯·æ±‚çŠ¶æ€ç åˆ†å¸ƒ"></a><strong>6. æŸ¥è¯¢ HTTP è¯·æ±‚çŠ¶æ€ç åˆ†å¸ƒ</strong></h4>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(rate(http_requests_total[5m])) by (status)</span><br></pre></td></tr></table></figure>

<h4 id="7-æŸ¥è¯¢åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æŒ‡æ ‡"><a href="#7-æŸ¥è¯¢åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æŒ‡æ ‡" class="headerlink" title="7. æŸ¥è¯¢åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æŒ‡æ ‡"></a><strong>7. æŸ¥è¯¢åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æŒ‡æ ‡</strong></h4><ul>
<li>åŒ¹é… <code>job</code> æ ‡ç­¾åŒ…å« â€œappâ€ çš„æ‰€æœ‰æŒ‡æ ‡ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;job=~&quot;.*app.*&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„æŒ‡æ ‡å€¼"><a href="#8-æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„æŒ‡æ ‡å€¼" class="headerlink" title="8. æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„æŒ‡æ ‡å€¼"></a><strong>8. æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„æŒ‡æ ‡å€¼</strong></h4><ul>
<li>æŸ¥è¯¢è¿‡å» 1 å°æ—¶çš„ <code>node_cpu_seconds_total</code>ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total[1h]</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="9-è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„å¹³å‡å€¼"><a href="#9-è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„å¹³å‡å€¼" class="headerlink" title="9. è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„å¹³å‡å€¼"></a><strong>9. è®¡ç®—æŸä¸€æ—¶é—´æ®µçš„å¹³å‡å€¼</strong></h4><ul>
<li>è®¡ç®—è¿‡å» 5 åˆ†é’Ÿå†…çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">avg(rate(node_cpu_seconds_total[5m]))</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-æŸ¥è¯¢æœ€å¤§å€¼æˆ–æœ€å°å€¼"><a href="#10-æŸ¥è¯¢æœ€å¤§å€¼æˆ–æœ€å°å€¼" class="headerlink" title="10. æŸ¥è¯¢æœ€å¤§å€¼æˆ–æœ€å°å€¼"></a><strong>10. æŸ¥è¯¢æœ€å¤§å€¼æˆ–æœ€å°å€¼</strong></h4><ul>
<li>æŸ¥è¯¢æ‰€æœ‰å®ä¾‹çš„æœ€å¤§ CPU ä½¿ç”¨ç‡ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max(rate(node_cpu_seconds_total[5m])) by (instance)</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥è¯¢æœ€å°å€¼ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min(rate(node_cpu_seconds_total[5m])) by (instance)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="PromQL-æ¨¡ç³ŠæŸ¥æ‰¾çš„å¸¸ç”¨æ–¹æ³•"><a href="#PromQL-æ¨¡ç³ŠæŸ¥æ‰¾çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="PromQL æ¨¡ç³ŠæŸ¥æ‰¾çš„å¸¸ç”¨æ–¹æ³•"></a><strong>PromQL æ¨¡ç³ŠæŸ¥æ‰¾çš„å¸¸ç”¨æ–¹æ³•</strong></h3><ol>
<li><p><strong>åŒ¹é…æ ‡ç­¾å€¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼‰</strong><br>ä½¿ç”¨ <code>=~</code> è¿ç®—ç¬¦å¯ä»¥å¯¹æ ‡ç­¾å€¼è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric_name&#123;label_name=~&quot;regex_pattern&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>åŒ¹é… <code>job</code> æ ‡ç­¾ä¸­åŒ…å« â€œnodeâ€ çš„æ‰€æœ‰æ—¶é—´åºåˆ—ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up&#123;job=~&quot;.*node.*&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>æ’é™¤ç‰¹å®šæ ‡ç­¾å€¼</strong><br>ä½¿ç”¨ <code>!~</code> è¿ç®—ç¬¦æ’é™¤ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„æ ‡ç­¾å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric_name&#123;label_name!~&quot;regex_pattern&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>æ’é™¤ <code>job</code> æ ‡ç­¾ä¸­åŒ…å« â€œnodeâ€ çš„æ—¶é—´åºåˆ—ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up&#123;job!~&quot;.*node.*&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>æŒ‡å®šå¤šä¸ªæ ‡ç­¾å€¼</strong><br>ä½¿ç”¨ <code>|</code> ç»„åˆå¤šä¸ªå€¼è¿›è¡ŒåŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric_name&#123;label_name=~&quot;value1|value2&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>åŒ¹é… <code>instance</code> æ ‡ç­¾ä¸º â€œserver1â€ æˆ– â€œserver2â€ çš„æ—¶é—´åºåˆ—ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpu_usage&#123;instance=~&quot;server1|server2&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>åŒ¹é…æ ‡ç­¾å­˜åœ¨æˆ–ä¸å­˜åœ¨</strong></p>
<ul>
<li>åŒ¹é…æ—¶é—´åºåˆ—ä¸­å­˜åœ¨æŸä¸ªæ ‡ç­¾ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric_name&#123;label_name=~&quot;.+&quot;&#125;</span><br></pre></td></tr></table></figure></li>
<li>åŒ¹é…æ—¶é—´åºåˆ—ä¸­ä¸å­˜åœ¨æŸä¸ªæ ‡ç­¾ï¼š<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metric_name&#123;label_name=&quot;&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<hr>
<h3 id="PromQL-å¸¸ç”¨æ“ä½œç¬¦"><a href="#PromQL-å¸¸ç”¨æ“ä½œç¬¦" class="headerlink" title="PromQL å¸¸ç”¨æ“ä½œç¬¦"></a><strong>PromQL å¸¸ç”¨æ“ä½œç¬¦</strong></h3><table>
<thead>
<tr>
<th>æ“ä½œç¬¦</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>=</code></td>
<td>ç²¾ç¡®åŒ¹é…æ ‡ç­¾å€¼</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>æ’é™¤åŒ¹é…çš„æ ‡ç­¾å€¼</td>
</tr>
<tr>
<td><code>=~</code></td>
<td>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ ‡ç­¾å€¼</td>
</tr>
<tr>
<td><code>!~</code></td>
<td>æ’é™¤åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„æ ‡ç­¾å€¼</td>
</tr>
<tr>
<td><code>+</code></td>
<td>åŠ æ³•è¿ç®—</td>
</tr>
<tr>
<td><code>-</code></td>
<td>å‡æ³•è¿ç®—</td>
</tr>
<tr>
<td><code>*</code></td>
<td>ä¹˜æ³•è¿ç®—</td>
</tr>
<tr>
<td><code>/</code></td>
<td>é™¤æ³•è¿ç®—</td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td>å¤§äºæ¯”è¾ƒ</td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td>å°äºæ¯”è¾ƒ</td>
</tr>
<tr>
<td><code>and</code></td>
<td>è¿”å›ä¸¤ä¸ªæ—¶é—´åºåˆ—ä¸­éƒ½æœ‰çš„æ ‡ç­¾</td>
</tr>
<tr>
<td><code>or</code></td>
<td>è¿”å›ä¸¤ä¸ªæ—¶é—´åºåˆ—ä¸­ä»»æ„ä¸€ä¸ªæ—¶é—´åºåˆ—çš„å€¼</td>
</tr>
<tr>
<td><code>unless</code></td>
<td>ä»å·¦ä¾§æ—¶é—´åºåˆ—ä¸­æ’é™¤å³ä¾§æ—¶é—´åºåˆ—</td>
</tr>
</tbody></table>
<hr>
<h3 id="æ¨èå·¥å…·å’Œæ–‡æ¡£"><a href="#æ¨èå·¥å…·å’Œæ–‡æ¡£" class="headerlink" title="æ¨èå·¥å…·å’Œæ–‡æ¡£"></a><strong>æ¨èå·¥å…·å’Œæ–‡æ¡£</strong></h3><ul>
<li><strong>Prometheus å®˜æ–¹æ–‡æ¡£</strong>: <a target="_blank" rel="noopener" href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL æŸ¥è¯¢è¯­è¨€</a></li>
<li><strong>PromLens</strong>: å¯è§†åŒ– PromQL æŸ¥è¯¢å·¥å…·ï¼Œå¸®åŠ©è°ƒè¯•å¤æ‚æŸ¥è¯¢ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/08/linux%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/08/linux%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">linuxæ€§èƒ½é—®é¢˜æ’æŸ¥æŒ‡ä»¤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-08 09:57:09" itemprop="dateCreated datePublished" datetime="2025-01-08T09:57:09+08:00">2025-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-11 15:08:07" itemprop="dateModified" datetime="2025-09-11T15:08:07+08:00">2025-09-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å¯åŠ¨æ—¶é—´ç›¸å…³"><a href="#å¯åŠ¨æ—¶é—´ç›¸å…³" class="headerlink" title="å¯åŠ¨æ—¶é—´ç›¸å…³"></a>å¯åŠ¨æ—¶é—´ç›¸å…³</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">w</span><br><span class="line">uptime</span><br><span class="line">who -b</span><br><span class="line">last reboot</span><br><span class="line">date -d &quot;`cut -f1 -d. /proc/uptime` seconds ago&quot;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»æœºæ€§èƒ½æŒ‡æ ‡ç›‘æ§ä¸åˆ†ææŒ‡å—"><a href="#ä¸»æœºæ€§èƒ½æŒ‡æ ‡ç›‘æ§ä¸åˆ†ææŒ‡å—" class="headerlink" title="ä¸»æœºæ€§èƒ½æŒ‡æ ‡ç›‘æ§ä¸åˆ†ææŒ‡å—"></a><strong>ä¸»æœºæ€§èƒ½æŒ‡æ ‡ç›‘æ§ä¸åˆ†ææŒ‡å—</strong></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010420283/article/details/114502674">https://blog.csdn.net/u010420283/article/details/114502674</a></p>
</blockquote>
<h4 id="1-CPU-æ€§èƒ½ç›‘æ§"><a href="#1-CPU-æ€§èƒ½ç›‘æ§" class="headerlink" title="1. CPU æ€§èƒ½ç›‘æ§"></a><strong>1. CPU æ€§èƒ½ç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>top å†…å¿«æ·é”®</strong></td>
<td></td>
</tr>
<tr>
<td><code>1</code></td>
<td>æ˜¾ç¤ºæ¯ä¸ªé€»è¾‘ CPU çš„ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>P</code></td>
<td>æŒ‰ CPU ä½¿ç”¨ç‡æ’åºã€‚</td>
</tr>
<tr>
<td><code>T</code></td>
<td>æŒ‰è¿è¡Œæ—¶é—´æ’åºã€‚</td>
</tr>
<tr>
<td><code>N</code></td>
<td>æŒ‰ PID æ’åºã€‚</td>
</tr>
<tr>
<td><code>i</code></td>
<td>è¿‡æ»¤æ‰ç©ºé—²è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>u</code> + ç”¨æˆ·å</td>
<td>ä»…æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>f</code> + <code>s</code> + <code>ESC</code></td>
<td>è‡ªå®šä¹‰åˆ—æ’åºï¼ˆæŒ‰åˆ—åé€‰æ‹©ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>x</code></td>
<td>é«˜äº®æ’åºåˆ—ã€‚</td>
</tr>
<tr>
<td><code>mpstat -P ALL</code></td>
<td>æ˜¾ç¤ºæ¯ä¸ª CPU æ ¸å¿ƒçš„è¯¦ç»†ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>sar -P ALL</code></td>
<td>æŸ¥çœ‹æ¯ä¸ª CPU æ ¸çš„ä½¿ç”¨æƒ…å†µï¼Œæ”¯æŒå†å²æ•°æ®åˆ†æã€‚</td>
</tr>
<tr>
<td><strong>çº¿ç¨‹æŸ¥çœ‹</strong></td>
<td></td>
</tr>
<tr>
<td><code>top -Hp &lt;PID&gt;</code></td>
<td>æŸ¥çœ‹æŸè¿›ç¨‹çš„çº¿ç¨‹ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>ps -Tp &lt;PID&gt;</code></td>
<td>æŸ¥çœ‹æŸè¿›ç¨‹çš„çº¿ç¨‹åˆ—è¡¨ã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="2-å†…å­˜æ€§èƒ½ç›‘æ§"><a href="#2-å†…å­˜æ€§èƒ½ç›‘æ§" class="headerlink" title="2. å†…å­˜æ€§èƒ½ç›‘æ§"></a><strong>2. å†…å­˜æ€§èƒ½ç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>free -m</code></td>
<td>æŸ¥çœ‹ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆå•ä½ MBï¼‰ã€‚</td>
</tr>
<tr>
<td><code>vmstat</code></td>
<td>æ˜¾ç¤ºå†…å­˜ã€è¿›ç¨‹ã€CPU çš„ç»¼åˆç»Ÿè®¡ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>top</code> æŒ‰é”® <code>M</code></td>
<td>æŒ‰å†…å­˜ä½¿ç”¨ç‡æ’åºã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="3-ç£ç›˜æ€§èƒ½ç›‘æ§"><a href="#3-ç£ç›˜æ€§èƒ½ç›‘æ§" class="headerlink" title="3. ç£ç›˜æ€§èƒ½ç›‘æ§"></a><strong>3. ç£ç›˜æ€§èƒ½ç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>df -h</code></td>
<td>æŸ¥çœ‹ç£ç›˜åˆ†åŒºä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>iostat -x 1 5</code></td>
<td>æŸ¥çœ‹ç£ç›˜ I&#x2F;O æ€§èƒ½ï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>iotop</code></td>
<td>å®æ—¶ç›‘æ§è¿›ç¨‹çš„ç£ç›˜ I&#x2F;O ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>pidstat -d -p &lt;PID&gt;</code></td>
<td>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ç£ç›˜ I&#x2F;O ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>lsblk</code></td>
<td>æ˜¾ç¤ºå—è®¾å¤‡ä¿¡æ¯ï¼ˆæŒ‚è½½ç‚¹å’Œå¤§å°ï¼‰ã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="4-ç½‘ç»œæ€§èƒ½ç›‘æ§"><a href="#4-ç½‘ç»œæ€§èƒ½ç›‘æ§" class="headerlink" title="4. ç½‘ç»œæ€§èƒ½ç›‘æ§"></a><strong>4. ç½‘ç»œæ€§èƒ½ç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>ifconfig</code> æˆ– <code>ip a</code></td>
<td>æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶æ€å’Œ IP åœ°å€ã€‚</td>
</tr>
<tr>
<td><code>sar -n DEV 1 5</code></td>
<td>æŸ¥çœ‹ç½‘ç»œæ¥å£çš„ååé‡ï¼ˆå‘é€å’Œæ¥æ”¶ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>nload</code></td>
<td>å›¾å½¢åŒ–å®æ—¶æ˜¾ç¤ºç½‘ç»œæµé‡ã€‚</td>
</tr>
<tr>
<td><code>netstat -ant</code> æˆ– <code>ss -ant</code></td>
<td>æŸ¥çœ‹æ‰€æœ‰çš„ TCP è¿æ¥çŠ¶æ€ã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="5-æŒ‚è½½ç‚¹ä¸æ–‡ä»¶ç³»ç»Ÿç›‘æ§"><a href="#5-æŒ‚è½½ç‚¹ä¸æ–‡ä»¶ç³»ç»Ÿç›‘æ§" class="headerlink" title="5. æŒ‚è½½ç‚¹ä¸æ–‡ä»¶ç³»ç»Ÿç›‘æ§"></a><strong>5. æŒ‚è½½ç‚¹ä¸æ–‡ä»¶ç³»ç»Ÿç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>mount</code></td>
<td>æŸ¥çœ‹æŒ‚è½½ç‚¹åŠæŒ‚è½½é€‰é¡¹ã€‚</td>
</tr>
<tr>
<td><code>du -sh /path/to/dir</code></td>
<td>æŸ¥çœ‹ç›®å½•çš„æ€»å¤§å°ã€‚</td>
</tr>
<tr>
<td><code>df -i</code></td>
<td>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„ inode ä½¿ç”¨æƒ…å†µã€‚</td>
</tr>
<tr>
<td><code>lsblk</code></td>
<td>æ˜¾ç¤ºè®¾å¤‡çš„æŒ‚è½½ç‚¹å’Œåˆ†åŒºä¿¡æ¯ã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="6-ç³»ç»Ÿæ•´ä½“æ€§èƒ½ç›‘æ§"><a href="#6-ç³»ç»Ÿæ•´ä½“æ€§èƒ½ç›‘æ§" class="headerlink" title="6. ç³»ç»Ÿæ•´ä½“æ€§èƒ½ç›‘æ§"></a><strong>6. ç³»ç»Ÿæ•´ä½“æ€§èƒ½ç›‘æ§</strong></h4><table>
<thead>
<tr>
<th><strong>å‘½ä»¤&#x2F;æ“ä½œ</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>uptime</code></td>
<td>æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½å’Œè¿è¡Œæ—¶é—´ã€‚</td>
</tr>
<tr>
<td><code>top</code></td>
<td>å®æ—¶ç›‘æ§ç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚</td>
</tr>
<tr>
<td><code>htop</code></td>
<td>å›¾å½¢åŒ–è¿›ç¨‹ç›‘æ§å·¥å…·ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚</td>
</tr>
<tr>
<td><code>vmstat 1 5</code></td>
<td>æŸ¥çœ‹ CPUã€å†…å­˜ã€I&#x2F;O çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ¯ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰ã€‚</td>
</tr>
</tbody></table>
<hr>
<h4 id="7-å¿«æ·é”®æ±‡æ€»ï¼ˆåŸºäº-topï¼‰"><a href="#7-å¿«æ·é”®æ±‡æ€»ï¼ˆåŸºäº-topï¼‰" class="headerlink" title="7. å¿«æ·é”®æ±‡æ€»ï¼ˆåŸºäº topï¼‰"></a><strong>7. å¿«æ·é”®æ±‡æ€»ï¼ˆåŸºäº <code>top</code>ï¼‰</strong></h4><table>
<thead>
<tr>
<th><strong>å¿«æ·é”®</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>u</code> + ç”¨æˆ·å</td>
<td>ä»…æ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>c</code></td>
<td>æ˜¾ç¤ºå®Œæ•´çš„å‘½ä»¤è·¯å¾„ã€‚</td>
</tr>
<tr>
<td><code>o</code> + <code>COMMAND=&lt;å€¼&gt;</code></td>
<td>æŒ‰ç‰¹å®šæ¡ä»¶è¿‡æ»¤è¿›ç¨‹ï¼ˆéœ€åŒ¹é…åˆ—åï¼‰ã€‚</td>
</tr>
<tr>
<td><code>P</code></td>
<td>æŒ‰ CPU ä½¿ç”¨ç‡æ’åºã€‚</td>
</tr>
<tr>
<td><code>M</code></td>
<td>æŒ‰å†…å­˜ä½¿ç”¨ç‡æ’åºã€‚</td>
</tr>
<tr>
<td><code>T</code></td>
<td>æŒ‰è¿è¡Œæ—¶é—´æ’åºã€‚</td>
</tr>
<tr>
<td><code>i</code></td>
<td>è¿‡æ»¤æ‰ç©ºé—²è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>x</code></td>
<td>é«˜äº®æ’åºåˆ—ã€‚</td>
</tr>
<tr>
<td><code>f</code> + <code>s</code></td>
<td>è‡ªå®šä¹‰æ’åºåˆ—ã€‚</td>
</tr>
</tbody></table>
<hr>
<h3 id="è¡¥å……è¯´æ˜"><a href="#è¡¥å……è¯´æ˜" class="headerlink" title="è¡¥å……è¯´æ˜"></a><strong>è¡¥å……è¯´æ˜</strong></h3><ul>
<li><p><strong>I&#x2F;O ç­‰å¾…åˆ†æ</strong>: </p>
<ul>
<li>å¦‚æœ <code>wa</code> å€¼è¾ƒé«˜ï¼ˆ<code>iostat</code> æˆ– <code>top</code> ä¸­æ˜¾ç¤ºï¼‰ï¼Œå¯èƒ½æ˜¯ç£ç›˜ I&#x2F;O æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li>å¯ç»“åˆ <code>iotop</code> æˆ– <code>pidstat -d</code> å®šä½é«˜ I&#x2F;O è¿›ç¨‹ã€‚</li>
</ul>
</li>
<li><p><strong>è´Ÿè½½åˆ†æ</strong>:</p>
<ul>
<li>è´Ÿè½½é«˜ä½† CPU ä½¿ç”¨ç‡ä½ï¼Œé€šå¸¸æ˜¯ I&#x2F;O æˆ–å†…å­˜ä¸è¶³å¯¼è‡´ã€‚</li>
<li>é…åˆ <code>iostat</code>ã€<code>vmstat</code> å’Œ <code>iotop</code> å·¥å…·è¿›ä¸€æ­¥åˆ†æã€‚</li>
</ul>
</li>
</ul>
<h3 id="å®‰è£…å‘½ä»¤"><a href="#å®‰è£…å‘½ä»¤" class="headerlink" title="å®‰è£…å‘½ä»¤"></a>å®‰è£…å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#å®‰è£…iostatã€pidstatçš„å‘½ä»¤</span><br><span class="line">yum install -y  sysstat</span><br><span class="line">#ç¡®è®¤ioç¹å¿™çŠ¶æ€</span><br><span class="line">iostat -x 1</span><br><span class="line">#æŸ¥çœ‹å“ªäº›è¿›ç¨‹åœ¨é¢‘ç¹è¯»å†™æ–‡ä»¶</span><br><span class="line">pidstat -d 1 </span><br><span class="line"></span><br><span class="line">#å®‰è£…dig</span><br><span class="line">yum install -y  bind-utils</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/07/tcpdump%E6%8A%93%E5%8C%85%E7%9A%84%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/07/tcpdump%E6%8A%93%E5%8C%85%E7%9A%84%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">tcpdumpæŠ“åŒ…çš„å‡ ä¸ªå‘½ä»¤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-07 16:41:59" itemprop="dateCreated datePublished" datetime="2025-01-07T16:41:59+08:00">2025-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-30 09:52:51" itemprop="dateModified" datetime="2025-04-30T09:52:51+08:00">2025-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><ul>
<li>-i any ç›‘å¬æ‰€æœ‰çš„ç½‘å¡æ¥å£ï¼Œç”¨æ¥æŸ¥çœ‹æ˜¯å¦æœ‰ç½‘ç»œæµé‡</li>
<li>-i eth0 åªç›‘å¬eth0ç½‘å¡æ¥å£</li>
<li>-D æ˜¾ç¤ºå¯ç”¨çš„æ¥å£åˆ—è¡¨</li>
<li>-n ä¸è¦è§£æä¸»æœºå</li>
<li>-nn ä¸è¦è§£æä¸»æœºåæˆ–è€…ç«¯å£å</li>
<li>-q æ˜¾ç¤ºæ›´å°‘çš„è¾“å‡º(æ›´åŠ quiet)</li>
<li>-t è¾“å‡ºå¯è¯»çš„æ—¶é—´æˆ³</li>
<li>-tttt è¾“å‡ºæœ€å¤§ç¨‹åº¦å¯è¯»çš„æ—¶é—´æˆ³</li>
<li>-X ä»¥hexå’ŒASCIIä¸¤ç§å½¢å¼æ˜¾ç¤ºåŒ…çš„å†…å®¹</li>
<li>-XX ä¸**-X**ç±»ä¼¼ï¼Œå¢åŠ ä»¥å¤ªç½‘headerçš„æ˜¾ç¤º</li>
<li>-v, -vv, -vvv æ˜¾ç¤ºæ›´åŠ å¤šçš„åŒ…ä¿¡æ¯</li>
<li>-c åªè¯»å–xä¸ªåŒ…ï¼Œç„¶ååœæ­¢</li>
<li>-s æŒ‡å®šæ¯ä¸€ä¸ªåŒ…æ•è·çš„é•¿åº¦ï¼Œå•ä½æ˜¯byteï¼Œä½¿ç”¨ -s 0 å¯ä»¥æ•è·æ•´ä¸ªåŒ…çš„å†…å®¹</li>
<li>-S è¾“å‡ºç»å¯¹çš„åºåˆ—å·</li>
<li>-e è·å–ä»¥å¤ªç½‘header</li>
<li>-E ä½¿ç”¨æä¾›çš„ç§˜é’¥è§£å¯†IPSECæµé‡</li>
</ul>
<hr>
<h2 id="tcpdump-ä¸€äº›å‘½ä»¤"><a href="#tcpdump-ä¸€äº›å‘½ä»¤" class="headerlink" title="tcpdump ä¸€äº›å‘½ä»¤"></a>tcpdump ä¸€äº›å‘½ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹ç½‘ç»œæ¥å£åˆ—è¡¨:</span><br><span class="line">tcpdump -D</span><br><span class="line"></span><br><span class="line">ç®€å•æŠ“åŒ…ï¼š</span><br><span class="line">æŠ“å–æŸæ¥å£çš„æ‰€æœ‰æµé‡ï¼š</span><br><span class="line">tcpdump -i eth0</span><br><span class="line"></span><br><span class="line">ä¿å­˜æŠ“åŒ…æ–‡ä»¶:</span><br><span class="line">sudo tcpdump -i eth0 -w capture.pcap</span><br><span class="line"></span><br><span class="line">æŠ“å–æŒ‡å®šIPåœ°å€çš„æ•°æ®åŒ…:</span><br><span class="line">åªæŠ“å–æºåœ°å€æˆ–ç›®æ ‡åœ°å€ä¸º `192.168.3.110` çš„æµé‡</span><br><span class="line">sudo tcpdump -i eth0 host 192.168.3.110</span><br><span class="line"></span><br><span class="line">æŠ“å–HTTPæµé‡ï¼ˆç«¯å£8080ï¼‰ï¼š</span><br><span class="line">sudo tcpdump -i eth0 port 8080</span><br><span class="line"></span><br><span class="line">æŠ“å–å¤šä¸ªç«¯å£ï¼š</span><br><span class="line">sudo tcpdump -i eth0 portrange 8000-9000</span><br><span class="line"></span><br><span class="line">æŠ“å–TCPæµé‡</span><br><span class="line">sudo tcpdump -i eth0 tcp</span><br><span class="line">æŠ“å–UDPæµé‡</span><br><span class="line">sudo tcpdump -i eth0 udp</span><br><span class="line"></span><br><span class="line">æŠ“å–ICMPæµé‡ï¼ˆå¦‚pingï¼‰ï¼š</span><br><span class="line">sudo tcpdump -i eth0 icmp</span><br><span class="line"></span><br><span class="line">æŠ“å–æŒ‡å®šæºåœ°å€å’Œç›®æ ‡ç«¯å£çš„æ•°æ®åŒ…ï¼š</span><br><span class="line">sudo tcpdump -i eth0 src 192.168.3.110 and port 22</span><br><span class="line">é€»è¾‘è¿ç®—ç¬¦ï¼š andï¼šä¸ or ï¼šæˆ–  notï¼šé</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºæ•°æ®åŒ…çš„è¯¦ç»†ä¿¡æ¯:</span><br><span class="line">sudo tcpdump -i eth0 -v</span><br><span class="line"></span><br><span class="line">å¦‚æœæµé‡å¼‚å¸¸å¯†é›†ï¼Œå¯ä»¥é€šè¿‡ `-c` é™åˆ¶æŠ“åŒ…æ•°é‡</span><br><span class="line">sudo tcpdump -i eth0 port 22 -c 100</span><br><span class="line"></span><br><span class="line">æŠ“åŒ…æ–‡ä»¶è¿‡å¤§,æ¯10MBä¿å­˜ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">sudo tcpdump -i eth0 -w capture.pcap -C 10</span><br><span class="line"></span><br><span class="line">è¯»å–åŒ…å†…å®¹</span><br><span class="line">sudo tcpdump -r capture.pcap</span><br><span class="line"></span><br><span class="line">æŠ“å–æŒ‡å®šæ—¶é—´èŒƒå›´çš„åŒ…ï¼ŒæŠ“åŒ…10ç§’åè‡ªåŠ¨åœæ­¢</span><br><span class="line">timeout 10s tcpdump -i eth0</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><table>
<thead>
<tr>
<th><strong>éœ€æ±‚</strong></th>
<th><strong>å‘½ä»¤</strong></th>
</tr>
</thead>
<tbody><tr>
<td>æ•è·æŒ‡å®šæ¥å£æµé‡</td>
<td><code>sudo tcpdump -i eth0</code></td>
</tr>
<tr>
<td>æ•è·æŒ‡å®šç«¯å£æµé‡</td>
<td><code>sudo tcpdump -i eth0 port 80</code></td>
</tr>
<tr>
<td>ä¿å­˜æŠ“åŒ…åˆ°æ–‡ä»¶</td>
<td><code>sudo tcpdump -i eth0 -w capture.pcap</code></td>
</tr>
<tr>
<td>é™åˆ¶æŠ“åŒ…æ•°é‡</td>
<td><code>sudo tcpdump -i eth0 -c 100</code></td>
</tr>
<tr>
<td>è¿‡æ»¤ç‰¹å®šæº IP æˆ–ç›®æ ‡ IP</td>
<td><code>sudo tcpdump -i eth0 src host 192.168.1.10</code></td>
</tr>
<tr>
<td>è¿‡æ»¤ç‰¹å®šåè®®</td>
<td><code>sudo tcpdump -i eth0 tcp</code></td>
</tr>
<tr>
<td>è¾“å‡ºåŒ…è¯¦ç»†å†…å®¹</td>
<td><code>sudo tcpdump -i eth0 -X</code></td>
</tr>
<tr>
<td>é™åˆ¶åŒ…çš„å¤§å°</td>
<td><code>sudo tcpdump -i eth0 -s 128</code></td>
</tr>
<tr>
<td>æ•è· DNS æµé‡</td>
<td><code>sudo tcpdump -i eth0 port 53 -vvv</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="æŠ“åŒ…ingressè¯·æ±‚case"><a href="#æŠ“åŒ…ingressè¯·æ±‚case" class="headerlink" title="æŠ“åŒ…ingressè¯·æ±‚case"></a>æŠ“åŒ…ingressè¯·æ±‚case</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#æŠ“åŒ…è¯·æ±‚</span><br><span class="line">curl -H &quot;host:test.xxx.com&quot; http://10.221.100.200/api/v1/xxx</span><br><span class="line">#æŸ¥çœ‹æ—¥å¿—è¾“å‡º</span><br><span class="line">crictl logs  -f &lt;container-id&gt; 2&gt;&amp;1 | grep &quot;/api/v1/xxx&quot;</span><br><span class="line">#æŠ“åŒ…è¿‡æ»¤</span><br><span class="line">tcpdump -i eth0  -ttt -nnn -v dst host 10.221.100.200 and port 80 and src host 10.100.100.100</span><br></pre></td></tr></table></figure>

<h2 id="æŠ“åŒ…è„šæœ¬åŠæ³¨æ„äº‹é¡¹"><a href="#æŠ“åŒ…è„šæœ¬åŠæ³¨æ„äº‹é¡¹" class="headerlink" title="æŠ“åŒ…è„šæœ¬åŠæ³¨æ„äº‹é¡¹"></a>æŠ“åŒ…è„šæœ¬åŠæ³¨æ„äº‹é¡¹</h2><ul>
<li>ä½¿ç”¨ifconfigæŸ¥çœ‹è¦æŠ“çš„æºipçš„ç½‘å¡(è¦çŸ¥é“è¯·æ±‚ipåœ°å€æ‰€åœ¨ç½‘å¡)</li>
<li>æˆ–è€…ä½¿ç”¨bmon æˆ–è€… iptraf-ng æŸ¥çœ‹ç½‘å¡çš„æµé‡</li>
<li>æˆ–è€…è®¾å®šè¦æŠ“å–çš„ç½‘å¡ï¼ˆä¹Ÿå¯ä»¥æŒ‡å®šä¸ºï¼šanyï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># è¾“å‡ºä»¥æ—¶é—´æˆ³å‘½åçš„ pcap æ–‡ä»¶ï¼Œä¾¿äºåç»­ Wireshark åˆ†æ</span><br><span class="line"></span><br><span class="line">VIP=&quot;10.xxx.xxx.xxx&quot;</span><br><span class="line">PORT=&quot;443&quot;</span><br><span class="line">DURATION=60  # æŠ“åŒ…æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ï¼Œå¯æ ¹æ®éœ€è¦ä¿®æ”¹</span><br><span class="line">OUT_FILE=&quot;./tcpdump_k8s_$(date +%Y%m%d_%H%M%S).pcap&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;[*] Starting tcpdump for $DURATION seconds on host $VIP:$PORT...&quot;</span><br><span class="line">sudo timeout $DURATION tcpdump -i any host $VIP and port $PORT -ttt -nn -vv -s 0 -w $OUT_FILE</span><br><span class="line"></span><br><span class="line">echo &quot;[+] Capture complete: $OUT_FILE&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://github.com/mylxsw/growing-up/blob/master/doc/tcpdump%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B.md">githubå‚è€ƒ</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/01/07/%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/07/%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">é›†ç¾¤æµ‹è¯•ç›¸å…³</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-01-07 15:50:05 / ä¿®æ”¹æ—¶é—´ï¼š15:58:12" itemprop="dateCreated datePublished" datetime="2025-01-07T15:50:05+08:00">2025-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/test/" itemprop="url" rel="index"><span itemprop="name">test</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="coreDNSå‹æµ‹"><a href="#coreDNSå‹æµ‹" class="headerlink" title="coreDNSå‹æµ‹"></a>coreDNSå‹æµ‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">## å‚è€ƒ</span><br><span class="line">https://github.com/guessi/dnsperf-bench</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">kubectl get configmap coredns -n kube-system -o jsonpath=&#x27;&#123;$.data.Corefile&#125;&#x27;</span><br><span class="line">kubectl get deployments coredns -n kube-system -o jsonpath=&#x27;&#123;$.spec.template.spec.containers[0].resources&#125;&#x27; | jq</span><br><span class="line">kubectl get service kube-dns -n kube-system -o jsonpath=&#x27;&#123;$.spec.clusterIP&#125;&#x27;</span><br><span class="line"></span><br><span class="line">kubectl top pods -n kube-system -l k8s-app=kube-dns</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## é›†ç¾¤å¤–æµ‹è¯•</span><br><span class="line">dnsperf -s 11.33.162.100 -d domain_test.txt -Q 10000 -l 30</span><br><span class="line"></span><br><span class="line">#domain_test.txtå†…å®¹</span><br><span class="line">www.google.com A</span><br><span class="line">www.amazon.com A</span><br><span class="line">kubernetes.default.svc.cluster.local A</span><br><span class="line">kube-dns.kube-system.svc.cluster.local A</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2024/12/31/grpc%E6%9C%8D%E5%8A%A1%E7%AB%AFTLS%E5%8A%A0%E5%AF%86%E6%AD%A5%E9%AA%A4%E5%8F%8A%E5%8D%95%E5%85%83%E8%B0%83%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/31/grpc%E6%9C%8D%E5%8A%A1%E7%AB%AFTLS%E5%8A%A0%E5%AF%86%E6%AD%A5%E9%AA%A4%E5%8F%8A%E5%8D%95%E5%85%83%E8%B0%83%E8%AF%95/" class="post-title-link" itemprop="url">grpcæœåŠ¡ç«¯TLSåŠ å¯†æ­¥éª¤åŠå•å…ƒè°ƒè¯•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-12-31 17:52:29" itemprop="dateCreated datePublished" datetime="2024-12-31T17:52:29+08:00">2024-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-27 10:53:40" itemprop="dateModified" datetime="2025-03-27T10:53:40+08:00">2025-03-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="githubå‚è€ƒåœ°å€"><a href="#githubå‚è€ƒåœ°å€" class="headerlink" title="githubå‚è€ƒåœ°å€"></a>githubå‚è€ƒåœ°å€</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/shispring/grpcdemo">https://github.com/shispring/grpcdemo</a></p>
</blockquote>
<h2 id="CA-è¯ä¹¦åˆ¶ä½œï¼š"><a href="#CA-è¯ä¹¦åˆ¶ä½œï¼š" class="headerlink" title="CA è¯ä¹¦åˆ¶ä½œï¼š"></a>CA è¯ä¹¦åˆ¶ä½œï¼š</h2><h3 id="1ã€ç”Ÿæˆ-key-ç§é’¥æ–‡ä»¶"><a href="#1ã€ç”Ÿæˆ-key-ç§é’¥æ–‡ä»¶" class="headerlink" title="1ã€ç”Ÿæˆ.key  ç§é’¥æ–‡ä»¶"></a>1ã€ç”Ÿæˆ.key  ç§é’¥æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>

<h3 id="2ã€ç”Ÿæˆè¯ä¹¦"><a href="#2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="2ã€ç”Ÿæˆè¯ä¹¦"></a>2ã€ç”Ÿæˆè¯ä¹¦</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#ç”Ÿæˆ.csr è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</span><br><span class="line">openssl req -new -key ca.key -out ca.csr  -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=demo/OU=IT Department/CN=www.demo.cn&quot;</span><br><span class="line"></span><br><span class="line">#è‡ªç­¾åç”Ÿæˆ.crt è¯ä¹¦æ–‡ä»¶</span><br><span class="line">openssl req -new -x509 -days 3650 -key ca.key -out ca.crt -config /opt/homebrew/etc/openssl@3/openssl.cnf \</span><br><span class="line">  -extensions v3_ca \</span><br><span class="line">  -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=demo/OU=IT Department/CN=www.demo.cn&quot;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åˆæˆä¸€æ­¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 3650 -key ca.key -out ca.crt \</span><br><span class="line">  -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=demo/OU=IT Department/CN=www.demo.cn&quot; \</span><br><span class="line">  -config /opt/homebrew/etc/openssl@3/openssl.cnf \</span><br><span class="line">  -extensions v3_ca</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æœåŠ¡ç«¯è¯ä¹¦"><a href="#æœåŠ¡ç«¯è¯ä¹¦" class="headerlink" title="æœåŠ¡ç«¯è¯ä¹¦"></a>æœåŠ¡ç«¯è¯ä¹¦</h2><h3 id="1ã€ç”Ÿæˆ-key-ç§é’¥æ–‡ä»¶-1"><a href="#1ã€ç”Ÿæˆ-key-ç§é’¥æ–‡ä»¶-1" class="headerlink" title="1ã€ç”Ÿæˆ .key ç§é’¥æ–‡ä»¶"></a>1ã€ç”Ÿæˆ .key ç§é’¥æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out server.key 2048</span><br></pre></td></tr></table></figure>

<h3 id="2ã€ç”Ÿæˆ-csr-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#2ã€ç”Ÿæˆ-csr-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="2ã€ç”Ÿæˆ .csr è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>2ã€ç”Ÿæˆ .csr è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹openssl.conf</span><br><span class="line">openssl version -d</span><br><span class="line"></span><br><span class="line">#æ‹·è´ä¸€ä»½æ–°çš„é…ç½®</span><br><span class="line">cp /opt/homebrew/etc/openssl@3/openssl.cnf server_openssl.cnf</span><br><span class="line"></span><br><span class="line">#æ·»åŠ SANé…ç½®</span><br><span class="line">echo &quot;[SAN]&quot; &gt;&gt; server_openssl.cnf</span><br><span class="line">echo &quot;subjectAltName=DNS:*.demo.cn,DNS:www.demo.cn&quot; &gt;&gt; server_openssl.cnf</span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆ .csr</span><br><span class="line">openssl req -new -key server.key -out server.csr -config server_openssl.cnf -reqexts SAN \</span><br><span class="line">  -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=demo/OU=IT Department/CN=www.demo.cn&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3ã€ç­¾åç”Ÿæˆ-crt-è¯ä¹¦æ–‡ä»¶"><a href="#3ã€ç­¾åç”Ÿæˆ-crt-è¯ä¹¦æ–‡ä»¶" class="headerlink" title="3ã€ç­¾åç”Ÿæˆ.crt è¯ä¹¦æ–‡ä»¶"></a>3ã€ç­¾åç”Ÿæˆ.crt è¯ä¹¦æ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -days 3650 -in server.csr -out server.crt \</span><br><span class="line">  -CA ca.crt -CAkey ca.key -CAcreateserial \</span><br><span class="line">  -extensions SAN -extfile server_openssl.cnf</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æŸ¥çœ‹è¯ä¹¦å†…å®¹"><a href="#æŸ¥çœ‹è¯ä¹¦å†…å®¹" class="headerlink" title="æŸ¥çœ‹è¯ä¹¦å†…å®¹"></a>æŸ¥çœ‹è¯ä¹¦å†…å®¹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in ./ca.crt -text -noout</span><br><span class="line">openssl x509 -in ./server.crt -text -noout</span><br></pre></td></tr></table></figure>


<h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go test -v ./test/server_test.go </span><br><span class="line">go test -v ./test/client_test.go </span><br></pre></td></tr></table></figure>

<h2 id="grpcurlè°ƒè¯•"><a href="#grpcurlè°ƒè¯•" class="headerlink" title="grpcurlè°ƒè¯•"></a>grpcurlè°ƒè¯•</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/fullstorydev/grpcurl/releases">https://github.com/fullstorydev/grpcurl/releases</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/fullstorydev/grpcurl/releases/download/v1.9.3/grpcurl_1.9.3_linux_amd64.rpm</span><br><span class="line">sudo rpm -ivh grpcurl_1.9.3_linux_amd64.rpm</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨äº†TLSæ¨¡å¼è°ƒè¯•æ­¥éª¤</span><br><span class="line">grpcurl -v \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  127.0.0.1:8972 list</span><br><span class="line"></span><br><span class="line">grpcurl -v \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  127.0.0.1:8972 list helloworld.Greeter</span><br><span class="line"></span><br><span class="line">grpcurl -v \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  127.0.0.1:8972 describe helloworld.Greeter.SayHello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grpcurl -v \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  127.0.0.1:8972 describe helloworld.HelloRequest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grpcurl \</span><br><span class="line">  -cert server.crt \</span><br><span class="line">  -key server.key \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  -d &#x27;&#123;&quot;name&quot;: &quot;China&quot;&#125;&#x27; \</span><br><span class="line">  127.0.0.1:8972 helloworld.Greeter/SayHello</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line"></span><br><span class="line">grpcurl \</span><br><span class="line">  -cert server.crt \</span><br><span class="line">  -key server.key \</span><br><span class="line">  -cacert ca.crt \</span><br><span class="line">  -authority www.demo.cn \</span><br><span class="line">  -d &#x27;&#123;&quot;name&quot;: &quot;China&quot;&#125;&#x27; \</span><br><span class="line">  127.0.0.1:8972 helloworld.Greeter.SayHello</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.-cert server.crt</span><br><span class="line">æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯æœåŠ¡ç«¯è¯ä¹¦æ–‡ä»¶ server.crtã€‚</span><br><span class="line">2.-key server.key</span><br><span class="line">æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„ç§é’¥æ–‡ä»¶ï¼Œä¸ server.crt é…å¥—ä½¿ç”¨ã€‚</span><br><span class="line">3.-cacert ca.crt</span><br><span class="line">æŒ‡å®š CA æ ¹è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºéªŒè¯æœåŠ¡ç«¯è¯ä¹¦çš„åˆæ³•æ€§ã€‚</span><br><span class="line">4.-authority www.demo.cn</span><br><span class="line">æŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦çš„ Common Name æˆ– subjectAltNameï¼Œè¿™é‡Œéœ€è¦ä¸æœåŠ¡ç«¯è¯ä¹¦ä¸­çš„ CN æˆ– SAN åŒ¹é…ï¼ˆä¾‹å¦‚ www.demo.cnï¼‰ã€‚</span><br><span class="line">5.-d &#x27;&#123;&quot;name&quot;: &quot;China&quot;&#125;&#x27;</span><br><span class="line">æŒ‡å®šè¯·æ±‚æ•°æ®ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ª JSON æ ¼å¼çš„è¯·æ±‚ä½“ï¼Œè°ƒç”¨æœåŠ¡ç«¯çš„ SayHello æ–¹æ³•æ—¶éœ€è¦ä¼ é€’æ­¤æ•°æ®ã€‚ </span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å…³äº-subj-çš„ä½¿ç”¨ä¸å«ä¹‰"><a href="#å…³äº-subj-çš„ä½¿ç”¨ä¸å«ä¹‰" class="headerlink" title="å…³äº -subj çš„ä½¿ç”¨ä¸å«ä¹‰"></a><strong>å…³äº <code>-subj</code> çš„ä½¿ç”¨ä¸å«ä¹‰</strong></h3><p><code>-subj</code> å‚æ•°ç”¨äºåœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥æŒ‡å®šè¯ä¹¦çš„ä¸»é¢˜ä¿¡æ¯ï¼Œé¿å…äº¤äº’å¼è¾“å…¥ã€‚è¿™æ˜¯éäº¤äº’å¼ç”Ÿæˆè¯ä¹¦æ—¶éå¸¸å¸¸ç”¨çš„æ–¹å¼ã€‚</p>
<h4 id="subj-å‚æ•°çš„æ ¼å¼"><a href="#subj-å‚æ•°çš„æ ¼å¼" class="headerlink" title="-subj å‚æ•°çš„æ ¼å¼"></a><strong><code>-subj</code> å‚æ•°çš„æ ¼å¼</strong></h4><p><code>-subj</code> å‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªä»¥ <code>/</code> åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—æ®µçš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å…¨ç§°</th>
<th>å«ä¹‰</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>C</code></td>
<td>Country Name</td>
<td>å›½å®¶ä»£ç ï¼Œéœ€ä¸ºä¸¤ä½ ISO 3166 å›½å®¶ä»£ç </td>
<td><code>C=CN</code></td>
</tr>
<tr>
<td><code>ST</code></td>
<td>State or Province Name</td>
<td>å·æˆ–çœçš„åç§°ï¼ˆå¯é€‰ï¼‰</td>
<td><code>ST=Beijing</code></td>
</tr>
<tr>
<td><code>L</code></td>
<td>Locality Name</td>
<td>åœ°åŒºæˆ–åŸå¸‚åç§°</td>
<td><code>L=Beijing</code></td>
</tr>
<tr>
<td><code>O</code></td>
<td>Organization Name</td>
<td>ç»„ç»‡åç§°ï¼ˆé€šå¸¸æ˜¯å…¬å¸åç§°ï¼‰</td>
<td><code>O=demo</code></td>
</tr>
<tr>
<td><code>OU</code></td>
<td>Organizational Unit</td>
<td>ç»„ç»‡éƒ¨é—¨åç§°ï¼ˆå¯é€‰ï¼Œé€šå¸¸æ˜¯å›¢é˜Ÿæˆ–éƒ¨é—¨åç§°ï¼‰</td>
<td><code>OU=IT Department</code></td>
</tr>
<tr>
<td><code>CN</code></td>
<td>Common Name</td>
<td>é€šç”¨åç§°ï¼Œé€šå¸¸æ˜¯åŸŸåæˆ–ä¸»æœºå</td>
<td><code>CN=www.demo.cn</code></td>
</tr>
<tr>
<td><code>emailAddress</code></td>
<td>Email Address</td>
<td>é‚®ç®±åœ°å€ï¼ˆå¯é€‰ï¼‰</td>
<td><code>emailAddress=admin@demo.cn</code></td>
</tr>
</tbody></table>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a><strong>ç¤ºä¾‹</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-subj <span class="string">&quot;/C=CN/ST=Beijing/L=Beijing/O=demo/OU=IT Department/CN=www.demo.cn&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a><strong>æ³¨æ„äº‹é¡¹</strong></h3><ol>
<li><p><strong>å­—æ®µçš„åŒ¹é…</strong>ï¼š</p>
<ul>
<li><code>CN</code>ï¼ˆCommon Nameï¼‰å­—æ®µå¿…é¡»ä¸æ‚¨å¸Œæœ›åŒ¹é…çš„åŸŸåä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œ<code>CN=www.demo.cn</code> è¡¨ç¤ºè¯¥è¯ä¹¦é€‚ç”¨äº <code>www.demo.cn</code>ã€‚</li>
<li>å¦‚æœéœ€è¦æ”¯æŒå¤šä¸ªåŸŸåï¼Œè¯·åœ¨æ‰©å±•å­—æ®µï¼ˆå¦‚ <code>subjectAltName</code>ï¼‰ä¸­æ·»åŠ æ›´å¤šåŸŸåï¼Œè€Œä¸æ˜¯åªä¾èµ– <code>CN</code>ã€‚</li>
</ul>
</li>
<li><p><strong>æ ¼å¼æ­£ç¡®æ€§</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªå­—æ®µå¿…é¡»ä»¥ <code>/</code> å¼€å¤´ï¼Œä¸èƒ½æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</li>
<li>å¦‚æœæŸäº›å­—æ®µä¸ºç©ºï¼Œå¯ä»¥çœç•¥ï¼Œä½†å¿…é¡»ç¡®ä¿å…¶ä»–å­—æ®µæ­£ç¡®å¡«å†™ã€‚</li>
</ul>
</li>
<li><p><strong>å…¼å®¹æ€§é—®é¢˜</strong>ï¼š</p>
<ul>
<li><code>CN</code> å­—æ®µåœ¨ç°ä»£è¯ä¹¦ä¸­å·²é€æ¸è¢« <code>subjectAltName</code> æ›¿ä»£ï¼Œå› æ­¤æ¨èåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜ç¡®æ·»åŠ  <code>SAN</code> æ‰©å±•ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="Issuer-çš„å«ä¹‰"><a href="#Issuer-çš„å«ä¹‰" class="headerlink" title="Issuer çš„å«ä¹‰"></a><strong>Issuer çš„å«ä¹‰</strong></h3><p>åœ¨è¯»å–è¯ä¹¦æ—¶ï¼Œ<code>Issuer</code> è¡¨ç¤ºç­¾å‘è¯¥è¯ä¹¦çš„å®ä½“ä¿¡æ¯ï¼Œå³è¯ä¹¦çš„é¢å‘è€…ï¼ˆCAï¼‰ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„å­—æ®µåŠå…¶å«ä¹‰ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>å«ä¹‰</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>C</code></td>
<td>ç­¾å‘è€…æ‰€åœ¨å›½å®¶ä»£ç </td>
<td><code>C=CN</code></td>
</tr>
<tr>
<td><code>ST</code></td>
<td>ç­¾å‘è€…æ‰€åœ¨å·æˆ–çœä»½</td>
<td><code>ST=Beijing</code></td>
</tr>
<tr>
<td><code>L</code></td>
<td>ç­¾å‘è€…æ‰€åœ¨åŸå¸‚</td>
<td><code>L=Beijing</code></td>
</tr>
<tr>
<td><code>O</code></td>
<td>ç­¾å‘è€…ç»„ç»‡åç§°</td>
<td><code>O=demo Root CA</code></td>
</tr>
<tr>
<td><code>OU</code></td>
<td>ç­¾å‘è€…ç»„ç»‡éƒ¨é—¨</td>
<td><code>OU=Certificate Authority</code></td>
</tr>
<tr>
<td><code>CN</code></td>
<td>ç­¾å‘è€…çš„é€šç”¨åç§°ï¼ˆé€šå¸¸æ˜¯ CA çš„åç§°ï¼‰</td>
<td><code>CN=demo Root CA</code></td>
</tr>
</tbody></table>
<hr>
<h4 id="Issuer-å’Œ-Subject-çš„åŒºåˆ«"><a href="#Issuer-å’Œ-Subject-çš„åŒºåˆ«" class="headerlink" title="Issuer å’Œ Subject çš„åŒºåˆ«"></a><strong>Issuer å’Œ Subject çš„åŒºåˆ«</strong></h4><ul>
<li>**<code>Issuer</code>**ï¼šè¡¨ç¤ºè¯ä¹¦çš„é¢å‘è€…ï¼Œå³ç­¾ç½²è¯¥è¯ä¹¦çš„ CAã€‚</li>
<li>**<code>Subject</code>**ï¼šè¡¨ç¤ºè¯ä¹¦çš„æŒæœ‰è€…ï¼Œå³è¯ä¹¦æ‰€ä»£è¡¨çš„å®ä½“ã€‚</li>
</ul>
<hr>
<h3 id="å¦‚ä½•æŸ¥çœ‹è¯ä¹¦çš„-Issuer-ä¿¡æ¯"><a href="#å¦‚ä½•æŸ¥çœ‹è¯ä¹¦çš„-Issuer-ä¿¡æ¯" class="headerlink" title="å¦‚ä½•æŸ¥çœ‹è¯ä¹¦çš„ Issuer ä¿¡æ¯"></a><strong>å¦‚ä½•æŸ¥çœ‹è¯ä¹¦çš„ Issuer ä¿¡æ¯</strong></h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è¯ä¹¦çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> server.crt -text -noout</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ol>
<li><code>-subj</code> æä¾›äº†ä¸€ç§ç®€æ´ã€éäº¤äº’å¼çš„æ–¹å¼æŒ‡å®šè¯ä¹¦çš„ä¸»é¢˜ä¿¡æ¯ã€‚</li>
<li>è¯ä¹¦çš„ <code>Issuer</code> è¡¨ç¤ºç­¾å‘è¯ä¹¦çš„ CA ä¿¡æ¯ï¼Œé€šå¸¸éœ€è¦ä¸ä¿¡ä»»é“¾ä¸­çš„æ ¹è¯ä¹¦åŒ¹é…ã€‚</li>
<li>åœ¨ç°ä»£è¯ä¹¦ä¸­ï¼Œ<code>subjectAltName</code> çš„é…ç½®éå¸¸é‡è¦ï¼Œ<code>CN</code> ä»…ä½œä¸ºå¤‡ç”¨å­—æ®µã€‚</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2024/12/30/grpc-demo-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%B0%83%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/30/grpc-demo-%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%B0%83%E8%AF%95/" class="post-title-link" itemprop="url">grpc demo éƒ¨ç½²åŠè°ƒè¯•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2024-12-30 18:53:47" itemprop="dateCreated datePublished" datetime="2024-12-30T18:53:47+08:00">2024-12-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-08 10:51:26" itemprop="dateModified" datetime="2025-09-08T10:51:26+08:00">2025-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040761594">https://segmentfault.com/a/1190000040761594</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lubanproj/grpc-read">https://github.com/lubanproj/grpc-read</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/grpc/grpc-go/tree/master/examples/helloworld">https://github.com/grpc/grpc-go/tree/master/examples/helloworld</a></li>
</ul>
<h2 id="ä¸€ã€å®‰è£…protobuf"><a href="#ä¸€ã€å®‰è£…protobuf" class="headerlink" title="ä¸€ã€å®‰è£…protobuf"></a>ä¸€ã€å®‰è£…protobuf</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸‹è½½åœ°å€ï¼ˆç”¨ä½œç¼–è¯‘ï¼Œç‰ˆæœ¬æ— è¦æ±‚ï¼‰ï¼š</span></span><br><span class="line"><span class="comment">#https://github.com/protocolbuffers/protobuf/releases</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">wget https://github.com/protocolbuffers/protobuf/releases/download/v29.2/protoc-29.2-osx-aarch_64.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å‹</span></span><br><span class="line">unzip protoc-29.2-osx-aarch_64.zip</span><br><span class="line"></span><br><span class="line">/Users/xxx/soft/grpc/bin/protoc --version</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€å®‰è£…protoc-gen-go"><a href="#äºŒã€å®‰è£…protoc-gen-go" class="headerlink" title="äºŒã€å®‰è£…protoc-gen-go"></a>äºŒã€å®‰è£…protoc-gen-go</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># go version</span></span><br><span class="line">go version go1.23.0 darwin/arm64</span><br><span class="line"></span><br><span class="line"><span class="comment">#wget https://github.com/protocolbuffers/protobuf-go/releases/download/v1.36.1/protoc-gen-go.v1.36.1.darwin.arm64.tar.gz</span></span><br><span class="line"></span><br><span class="line">go install github.com/golang/protobuf/protoc-gen-go@latest</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€é¡¹ç›®Demo"><a href="#ä¸‰ã€é¡¹ç›®Demo" class="headerlink" title="ä¸‰ã€é¡¹ç›®Demo"></a>ä¸‰ã€é¡¹ç›®Demo</h2><h3 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir grpcDemo</span></span><br><span class="line"><span class="comment"># go mod init grpcdemo</span></span><br></pre></td></tr></table></figure>

<h3 id="greeter-client-main-goå†…å®¹"><a href="#greeter-client-main-goå†…å®¹" class="headerlink" title="greeter_client&#x2F;main.goå†…å®¹"></a>greeter_client&#x2F;main.goå†…å®¹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	pb <span class="string">&quot;grpcdemo/helloworld&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc/credentials/insecure&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	defaultName = <span class="string">&quot;world&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	addr = flag.String(<span class="string">&quot;addr&quot;</span>, <span class="string">&quot;localhost:50051&quot;</span>, <span class="string">&quot;the address to connect to&quot;</span>)</span><br><span class="line">	name = flag.String(<span class="string">&quot;name&quot;</span>, defaultName, <span class="string">&quot;Name to greet&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	<span class="comment">// Set up a connection to the server.</span></span><br><span class="line">	conn, err := grpc.NewClient(*addr, grpc.WithTransportCredentials(insecure.NewCredentials()))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;did not connect: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">	c := pb.NewGreeterClient(conn)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Contact the server and print out its response.</span></span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line">	r, err := c.SayHello(ctx, &amp;pb.HelloRequest&#123;Name: *name&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;could not greet: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Printf(<span class="string">&quot;Greeting: %s&quot;</span>, r.GetMessage())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="greeter-server-main-go"><a href="#greeter-server-main-go" class="headerlink" title="greeter_server&#x2F;main.go"></a>greeter_server&#x2F;main.go</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line"></span><br><span class="line">	pb <span class="string">&quot;grpcdemo/helloworld&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc/reflection&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	port = flag.Int(<span class="string">&quot;port&quot;</span>, <span class="number">50051</span>, <span class="string">&quot;The server port&quot;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// server is used to implement helloworld.GreeterServer.</span></span><br><span class="line"><span class="keyword">type</span> server <span class="keyword">struct</span> &#123;</span><br><span class="line">	pb.UnimplementedGreeterServer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SayHello implements helloworld.GreeterServer</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *server)</span></span> SayHello(_ context.Context, in *pb.HelloRequest) (*pb.HelloReply, <span class="type">error</span>) &#123;</span><br><span class="line">	log.Printf(<span class="string">&quot;Received: %v&quot;</span>, in.GetName())</span><br><span class="line">	<span class="keyword">return</span> &amp;pb.HelloReply&#123;Message: <span class="string">&quot;Hello &quot;</span> + in.GetName()&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	lis, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, fmt.Sprintf(<span class="string">&quot;:%d&quot;</span>, *port))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to listen: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	s := grpc.NewServer()</span><br><span class="line">	pb.RegisterGreeterServer(s, &amp;server&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¯ç”¨ Reflection</span></span><br><span class="line">	reflection.Register(s)</span><br><span class="line">	log.Printf(<span class="string">&quot;server listening at %v&quot;</span>, lis.Addr())</span><br><span class="line">	<span class="keyword">if</span> err := s.Serve(lis); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to serve: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="helloworld-proto"><a href="#helloworld-proto" class="headerlink" title="helloworld.proto"></a>helloworld.proto</h2><ul>
<li>æ³¨æ„ï¼šgo_package è·¯å¾„</li>
</ul>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;./&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The greeting service definition.</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Greeter</span> &#123;</span><br><span class="line">  <span class="comment">// Sends a greeting</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> SayHello (HelloRequest) <span class="keyword">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The request message containing the user&#x27;s name.</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The response message containing the greetings</span></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloReply</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å››ã€æ‰§è¡Œå‘½ä»¤"><a href="#å››ã€æ‰§è¡Œå‘½ä»¤" class="headerlink" title="å››ã€æ‰§è¡Œå‘½ä»¤"></a>å››ã€æ‰§è¡Œå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># cd grpcDemo </span></span><br><span class="line"><span class="comment"># go mod tidy</span></span><br><span class="line"><span class="comment"># /Users/xxx/soft/grpc/bin/protoc -I helloworld/ helloworld/helloworld.proto --go_out=plugins=grpc:helloworld</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ greeter_client</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ greeter_server</span><br><span class="line">â”‚Â Â  â””â”€â”€ main.go</span><br><span class="line">â””â”€â”€ helloworld</span><br><span class="line">    â”œâ”€â”€ helloworld.pb.go</span><br><span class="line">    â””â”€â”€ helloworld.proto</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œç¨‹åº</span></span><br><span class="line">go run greeter_server/main.go</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦ä¸€ç»ˆç«¯è¿è¡Œ</span></span><br><span class="line">go run greeter_client/main.go</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€grpcurlè°ƒè¯•"><a href="#äº”ã€grpcurlè°ƒè¯•" class="headerlink" title="äº”ã€grpcurlè°ƒè¯•"></a>äº”ã€grpcurlè°ƒè¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…grpcurl</span></span><br><span class="line">brew install grpcurl</span><br><span class="line">æˆ–è€…</span><br><span class="line">go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest</span><br><span class="line"></span><br><span class="line"><span class="comment">#è°ƒè¯•</span></span><br><span class="line">grpcurl -plaintext 127.0.0.1:50051 list</span><br><span class="line">grpcurl -plaintext 127.0.0.1:50051 list helloworld.Greeter</span><br><span class="line">grpcurl -plaintext 127.0.0.1:50051 describe helloworld.Greeter.SayHello</span><br><span class="line">grpcurl -plaintext 127.0.0.1:50051 describe helloworld.HelloRequest</span><br><span class="line">grpcurl -d <span class="string">&#x27;&#123;&quot;name&quot;: &quot;zhangsan&quot;&#125;&#x27;</span>  -plaintext 127.0.0.1:50051 helloworld.Greeter.SayHello</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="shispring"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">shispring</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">162</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shispring</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
