<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shispring.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://shispring.github.io/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="shispring">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://shispring.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources" rel="section"><i class="fa fa-download fa-fw"></i>èµ„æº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/10/16/%E6%B8%85%E7%90%86docker%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/16/%E6%B8%85%E7%90%86docker%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">æ¸…ç†dockerç¼“å­˜æ•°æ®</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-16 10:51:19 / ä¿®æ”¹æ—¶é—´ï¼š10:57:37" itemprop="dateCreated datePublished" datetime="2025-10-16T10:51:19+08:00">2025-10-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´"><a href="#ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´" class="headerlink" title="ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´"></a>ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#docker build xxx</span><br><span class="line">...</span><br><span class="line">mkdir /tmp/go-build1189934179/b521/: no space left on device</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹è®¾å¤‡å­˜å‚¨</span><br><span class="line">#df -lh</span><br><span class="line">/dev/sda1        99G   54G   41G  57% /</span><br><span class="line">/dev/sdb        100G  100G  945M 100% /data</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹dockerèµ„æºå ç”¨æƒ…å†µ</span><br><span class="line">#docker system df</span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images          69        15        13.21GB   10.8GB (81%)</span><br><span class="line">Containers      25        0         24.54MB   24.54MB (100%)</span><br><span class="line">Local Volumes   43        1         2.966GB   2.958GB (99%)</span><br><span class="line">Build Cache     376       0         85.73GB   85.73GB</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ğŸ§­-ä¸€ã€æ€»ä½“åˆ†æ"><a href="#ğŸ§­-ä¸€ã€æ€»ä½“åˆ†æ" class="headerlink" title="ğŸ§­ ä¸€ã€æ€»ä½“åˆ†æ"></a>ğŸ§­ ä¸€ã€æ€»ä½“åˆ†æ</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å ç”¨</th>
<th>å¯å›æ”¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Images</strong></td>
<td>13.21 GB</td>
<td>10.8 GB (81%)</td>
<td>å¾ˆå¤šæ—§é•œåƒæœªä½¿ç”¨</td>
</tr>
<tr>
<td><strong>Containers</strong></td>
<td>24 MB</td>
<td>100% å¯å›æ”¶</td>
<td>åœæ­¢å®¹å™¨æœªæ¸…ç†</td>
</tr>
<tr>
<td><strong>Local Volumes</strong></td>
<td>2.96 GB</td>
<td>99% å¯å›æ”¶</td>
<td>æ—§å·æœªä½¿ç”¨</td>
</tr>
<tr>
<td><strong>Build Cache</strong></td>
<td><strong>85.73 GB</strong></td>
<td><strong>85.73 GB (å·¨é‡)</strong></td>
<td>Docker build ä¸­äº§ç”Ÿçš„å¤§é‡ä¸­é—´å±‚ç¼“å­˜</td>
</tr>
</tbody></table>
<h2 id="ğŸ§¹-äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥"><a href="#ğŸ§¹-äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥" class="headerlink" title="ğŸ§¹ äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥"></a>ğŸ§¹ äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥</h2><blockquote>
<p>âœ… å»ºè®®åˆ†ä¸‰æ­¥æ‰§è¡Œï¼Œä»â€œå®‰å…¨â€åˆ°â€œå½»åº•â€ã€‚</p>
</blockquote>
<h3 id="1ï¸âƒ£-å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰"><a href="#1ï¸âƒ£-å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰" class="headerlink" title="1ï¸âƒ£ å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰"></a>1ï¸âƒ£ å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ— ç”¨ build cacheï¼ˆæ¨èç¬¬ä¸€æ­¥ï¼‰</span></span><br><span class="line">docker builder prune</span><br></pre></td></tr></table></figure>

<blockquote>
<p>äº¤äº’æ—¶è¾“å…¥ <code>y</code> ç¡®è®¤å³å¯ï¼Œé€šå¸¸èƒ½é‡Šæ”¾ 80GB ä»¥ä¸Šç©ºé—´ã€‚<br>ä¸å½±å“ç°æœ‰é•œåƒæˆ–è¿è¡Œä¸­çš„å®¹å™¨ã€‚</p>
</blockquote>
<hr>
<h3 id="2ï¸âƒ£-æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰"><a href="#2ï¸âƒ£-æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰" class="headerlink" title="2ï¸âƒ£ æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰"></a>2ï¸âƒ£ æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -a --volumes</span><br></pre></td></tr></table></figure>

<p>å«ä¹‰ï¼š</p>
<ul>
<li><code>-a</code>ï¼šåˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æ‚¬ç©ºé•œåƒ <code>&lt;none&gt;</code>ï¼‰ã€‚</li>
<li><code>--volumes</code>ï¼šåˆ é™¤æœªè¢«æŒ‚è½½çš„å·ã€‚</li>
<li><code>system prune</code>ï¼šåŒæ—¶æ¸…ç† network &#x2F; container &#x2F; build cacheã€‚</li>
</ul>
<p>ğŸ’¡ <strong>æ…ç”¨</strong><br>æ­¤å‘½ä»¤ä¼šåˆ æ‰æ‰€æœ‰æ—§é•œåƒï¼Œä¸‹æ¬¡æ„å»ºä¼šé‡æ–°æ‹‰å–ï¼ˆæ—¶é—´æˆæœ¬è¾ƒé«˜ï¼Œä½†å¯å½»åº•é‡Šæ”¾ç©ºé—´ï¼‰ã€‚</p>
<hr>
<h3 id="3ï¸âƒ£-é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰"><a href="#3ï¸âƒ£-é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰" class="headerlink" title="3ï¸âƒ£ é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰"></a>3ï¸âƒ£ é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰</h3><h4 id="æ¸…ç†æ— ç”¨é•œåƒ"><a href="#æ¸…ç†æ— ç”¨é•œåƒ" class="headerlink" title="æ¸…ç†æ— ç”¨é•œåƒ"></a>æ¸…ç†æ— ç”¨é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune -a</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†åœæ­¢å®¹å™¨"><a href="#æ¸…ç†åœæ­¢å®¹å™¨" class="headerlink" title="æ¸…ç†åœæ­¢å®¹å™¨"></a>æ¸…ç†åœæ­¢å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container prune</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†æœªä½¿ç”¨çš„å·"><a href="#æ¸…ç†æœªä½¿ç”¨çš„å·" class="headerlink" title="æ¸…ç†æœªä½¿ç”¨çš„å·"></a>æ¸…ç†æœªä½¿ç”¨çš„å·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰"><a href="#æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰" class="headerlink" title="æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰"></a>æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker builder prune --all</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ"><a href="#ğŸ”-ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ" class="headerlink" title="ğŸ” ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ"></a>ğŸ” ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ</h2><p>æ‰§è¡Œå®Œåå†æ£€æŸ¥ç©ºé—´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker system df</span></span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images          69        15        13.21GB   10.8GB (81%)</span><br><span class="line">Containers      25        0         24.54MB   24.54MB (100%)</span><br><span class="line">Local Volumes   43        1         2.966GB   2.958GB (99%)</span><br><span class="line">Build Cache     63        0         0B        0B</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ Build Cache ä¼šä» 85 GB é™åˆ° &lt;5 GBï¼Œç£ç›˜é‡Šæ”¾éå¸¸æ˜æ˜¾ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/23/bash-profile%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/23/bash-profile%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">bash_profileé…ç½®</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-23 15:10:53 / ä¿®æ”¹æ—¶é—´ï¼š15:17:38" itemprop="dateCreated datePublished" datetime="2025-09-23T15:10:53+08:00">2025-09-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="bash-profileé…ç½®"><a href="#bash-profileé…ç½®" class="headerlink" title=".bash_profileé…ç½®"></a>.bash_profileé…ç½®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">############################</span><br><span class="line"># åŸºç¡€å·¥å…·å¢å¼º</span><br><span class="line">############################</span><br><span class="line">alias grep=&#x27;grep --color=auto&#x27;</span><br><span class="line">alias fgrep=&#x27;fgrep --color=auto&#x27;</span><br><span class="line">alias egrep=&#x27;egrep --color=auto&#x27;</span><br><span class="line">alias lzd=&#x27;lazydocker&#x27;   # è½»é‡çº§ Docker ç®¡ç†å·¥å…·</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes åŸºç¡€å‘½ä»¤</span><br><span class="line">############################</span><br><span class="line">alias k=&#x27;kubecolor&#x27;                         # å½©è‰² kubectl è¾“å‡º</span><br><span class="line">alias kn=&#x27;k get nodes&#x27;                      # æŸ¥çœ‹èŠ‚ç‚¹</span><br><span class="line">alias knw=&#x27;k get nodes -o wide&#x27;             # æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…</span><br><span class="line">alias kp=&#x27;k get pod -o wide&#x27;                # å½“å‰å‘½åç©ºé—´ Pod</span><br><span class="line">alias kpa=&#x27;k get pod -A -o wide&#x27;            # æ‰€æœ‰å‘½åç©ºé—´ Pod</span><br><span class="line">alias kgn=&#x27;k get ns&#x27;                        # å‘½åç©ºé—´</span><br><span class="line">alias kgs=&#x27;k get secret&#x27;                    # Secret</span><br><span class="line">alias ki=&#x27;k get ing&#x27;                        # Ingress</span><br><span class="line">alias kio=&#x27;k get ing -o yaml&#x27;               # Ingress è¯¦ç»†</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes é…ç½®ç®¡ç†</span><br><span class="line">############################</span><br><span class="line">alias kcg=&#x27;k config get-contexts&#x27;           # æŸ¥çœ‹æ‰€æœ‰ context</span><br><span class="line">alias kcc=&#x27;k config current-context&#x27;        # å½“å‰ context</span><br><span class="line">alias kcu=&#x27;kubectl config use-context &#x27;     # åˆ‡æ¢ context</span><br><span class="line">alias kv=&#x27;k config view&#x27;                    # æŸ¥çœ‹é…ç½®</span><br><span class="line">alias kcn=&#x27;k config view --minify --output &quot;jsonpath=&#123;..namespace&#125;&quot; &#x27;  # å½“å‰ namespace</span><br><span class="line">alias kapi=&#x27;k api-resources --sort-by=name&#x27; # API èµ„æºåˆ—è¡¨</span><br><span class="line"></span><br><span class="line"># æ‰©å±•ï¼škrew æ’ä»¶ã€kubectl neat ç­‰</span><br><span class="line">alias kk=&#x27;kubectl krew &#x27;                    # krew æ’ä»¶ç®¡ç†</span><br><span class="line">alias kns=&#x27;kubectl config set-context --current --namespace &#x27;  # åˆ‡æ¢ namespace</span><br><span class="line">alias knw=&#x27;k get nodes -o wide&#x27;</span><br><span class="line">alias kn=&#x27;k get nodes&#x27;</span><br><span class="line">alias knyaml=&#x27;k neat -o yaml&#x27;               # è¾“å‡ºæ ¼å¼åŒ– yaml</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes è§£é‡Šä¸è°ƒè¯•</span><br><span class="line">############################</span><br><span class="line">alias ke=&#x27;kubectl explain &#x27;                 # è§£é‡Šèµ„æº</span><br><span class="line">alias ker=&#x27;kubectl explain --recursive &#x27;    # é€’å½’è§£é‡Š</span><br><span class="line">alias kdr=&#x27;kubectl --dry-run=client -o yaml&#x27; # ç”Ÿæˆ yaml è‰ç¨¿</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># è‡ªå®šä¹‰å°è£…</span><br><span class="line">############################</span><br><span class="line"># æ·»åŠ  kubeconfig contextï¼Œç®€åŒ–åˆ‡æ¢</span><br><span class="line">kcadd() &#123; kubectl kc add -cf /home/shijianpeng/.kube/$1.conf --context-name $1; &#125;</span><br><span class="line">pingt() &#123;</span><br><span class="line">    ping &quot;$@&quot; | ts &#x27;[%Y-%m-%d %H:%M:%S]&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å¸¸ç”¨ kc æ‰©å±•</span><br><span class="line">alias kc=&#x27;kubectl kc&#x27;</span><br><span class="line">alias kcl=&#x27;kubectl kc list&#x27;</span><br><span class="line">alias kcs=&#x27;kubectl kc switch&#x27;</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># é›†ç¾¤ä¿¡æ¯</span><br><span class="line">############################</span><br><span class="line">alias kci=&#x27;k cluster-info&#x27;   # é›†ç¾¤ä¿¡æ¯</span><br><span class="line"># kubectl version</span><br><span class="line"># kubectl api-resources</span><br><span class="line"># kubectl api-versions</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/19/%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/19/%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD/" class="post-title-link" itemprop="url">å®¹å™¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-19 12:36:25 / ä¿®æ”¹æ—¶é—´ï¼š12:44:45" itemprop="dateCreated datePublished" datetime="2025-09-19T12:36:25+08:00">2025-09-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-æŸ¥çœ‹æŒ‚è½½æƒ…å†µ"><a href="#1-æŸ¥çœ‹æŒ‚è½½æƒ…å†µ" class="headerlink" title="1. æŸ¥çœ‹æŒ‚è½½æƒ…å†µ"></a>1. æŸ¥çœ‹æŒ‚è½½æƒ…å†µ</h2><ul>
<li><p><strong>çœ‹æŒ‚è½½æƒ…å†µ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep /run/containerd/io.containerd.runtime.v2.task/k8s.io</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çœ‹æ˜¯å¦æœ‰è¿›ç¨‹å ç”¨</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y psmisc</span><br><span class="line">fuser -vm /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep 200ab1146de</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çœ‹ containerd é‡Œæ˜¯å¦æœ‰æ®‹ç•™ metadata</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctr -n k8s.io containers list | grep 200ab1146de</span><br><span class="line">ctr -n k8s.io tasks list | grep 200ab1146de</span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li><strong><code>ctr -n k8s.io tasks list | grep 200ab1146de</code> â†’ çŠ¶æ€ STOPPED</strong></li>
<li><strong><code>fuser -vm</code> æ˜¾ç¤ºå¾ˆå¤š <code>containerd-shim</code>ã€<code>qemu-system-x86</code>ã€<code>virtiofsd</code> ç­‰è¿›ç¨‹å¼•ç”¨è¿™ä¸ªç›®å½•</strong><ul>
<li>è¯´æ˜è¿™ä¸ªç›®å½•ï¼ˆmountpointï¼‰ä»ç„¶è¢«å¤šä¸ªè¿›ç¨‹å ç”¨ç€ã€‚</li>
<li>æ³¨æ„ï¼šè¿™é‡Œçš„ â€œF.c..â€ &#x2F; â€œfrc..â€ è¡¨ç¤ºæ‰“å¼€äº†è¿™ä¸ªç›®å½•çš„ <strong>æ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œå¹¶ä¸”æœ‰è¯»å†™&#x2F;æ§åˆ¶å¼•ç”¨ã€‚</li>
</ul>
</li>
<li><strong>æ•´ä½“æƒ…å†µ</strong><ul>
<li>å†…æ ¸ <code>overlayfs</code> æŒ‚è½½ç‚¹è¿˜åœ¨ï¼Œinode æ²¡å›æ”¶ã€‚</li>
<li>å®¹å™¨å·²ç» â€œSTOPPEDâ€ï¼ˆä¸å¯ç”¨ï¼‰ï¼Œä½†æ˜¯æŒ‚è½½ç‚¹è¢«å…¶ä»– shim &#x2F; qemu &#x2F; virtiofsd å¼•ç”¨ï¼Œæ‰€ä»¥æ— æ³•è‡ªåŠ¨å¸è½½ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="2-mount-l-å‘½ä»¤å«ä¹‰ï¼š"><a href="#2-mount-l-å‘½ä»¤å«ä¹‰ï¼š" class="headerlink" title="2. mount -l å‘½ä»¤å«ä¹‰ï¼š"></a>2. mount -l å‘½ä»¤å«ä¹‰ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep <span class="string">&#x27;/run/containerd/io.containerd.runtime.v2.task/k8s.io&#x27;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -r <span class="built_in">sudo</span> umount -l</span><br></pre></td></tr></table></figure>

<h3 id="è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ"><a href="#è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ"></a>è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ</h3><ul>
<li>æ‰¾å‡ºæ‰€æœ‰æŒ‚è½½åœ¨ <code>/run/containerd/io.containerd.runtime.v2.task/k8s.io/*</code> ä¸‹çš„ mount pointã€‚</li>
<li>å¯¹å®ƒä»¬æ‰§è¡Œ <code>umount -l</code>ï¼ˆlazy umountï¼‰ã€‚</li>
</ul>
<p><strong>lazy umount å«ä¹‰</strong>ï¼š</p>
<ul>
<li>é©¬ä¸ŠæŠŠæŒ‚è½½ç‚¹ä» mount namespace é‡Œâ€œæ‘˜æ‰â€ï¼Œè¿›ç¨‹ä¸å†èƒ½é€šè¿‡è·¯å¾„è®¿é—®å®ƒã€‚</li>
<li>å¦‚æœæœ‰è¿›ç¨‹ä»ç„¶æŒæœ‰ fdï¼Œä¼šç­‰å®ƒä»¬å…³é—­ fd ä¹‹åå†çœŸæ­£é‡Šæ”¾èµ„æºï¼ˆinodeã€dentryã€slabï¼‰ã€‚</li>
<li>è¿™æ ·é¿å…äº† <code>umount</code> æŠ¥é”™ â€œbusyâ€ï¼Œç®—æ˜¯æ¯”è¾ƒæ¸©å’Œçš„æ–¹å¼ã€‚</li>
</ul>
<hr>
<h2 id="3-å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“"><a href="#3-å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“" class="headerlink" title="3. å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“"></a>3. å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“</h2><ul>
<li><p><strong>å¦‚æœå®¹å™¨ä»ç„¶æ´»è·ƒ</strong>ï¼šå¯¹åº” Pod ä¼šç«‹åˆ»å¤±æ•ˆï¼Œå› ä¸º rootfs è¢«æ‘˜æ‰äº†ï¼Œé‡Œé¢çš„æ–‡ä»¶ç³»ç»Ÿæ¶ˆå¤±ã€‚</p>
</li>
<li><p><strong>å¦‚æœå®¹å™¨å·²ç» STOPPED</strong>ï¼ˆåƒä½ è¿™ç§ï¼‰ï¼š</p>
<ul>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹å½±å“æœ‰é™ï¼Œç­‰ä»·äºæ¸…ç†åƒåœ¾æŒ‚è½½ç‚¹ã€‚</li>
<li>ä¸è¿‡è¦å°å¿ƒï¼šå¦‚æœ containerd metadata é‡Œè¿˜è®°å½•è¿™ä¸ªå®¹å™¨å­˜åœ¨ï¼Œcontainerd åœ¨åç»­ GC æˆ–è€…å›æ”¶æ—¶å¯èƒ½ä¼šå‘ç°æ‰¾ä¸åˆ°æŒ‚è½½ç‚¹ï¼Œä»è€ŒæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-å»ºè®®æ“ä½œé¡ºåº"><a href="#4-å»ºè®®æ“ä½œé¡ºåº" class="headerlink" title="4. å»ºè®®æ“ä½œé¡ºåº"></a>4. å»ºè®®æ“ä½œé¡ºåº</h2><p>æ›´æ¸©å’Œçš„æ–¹æ¡ˆå¯ä»¥è¿™æ ·åˆ†çº§ï¼š</p>
<ol>
<li><p><strong>ä¼˜å…ˆè®© containerd æ¸…ç†</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctr -n k8s.io tasks <span class="built_in">rm</span> 200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br><span class="line">ctr -n k8s.io containers <span class="built_in">rm</span> 200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>

<p>ï¼ˆå¦‚æœå¡ä½ï¼Œè¯´æ˜ shim&#x2F;è¿›ç¨‹ä¾èµ–è¿˜åœ¨ï¼‰</p>
</li>
<li><p><strong>ç¡®è®¤ mount</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep 200ab1146de</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å† lazy umount</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> umount -l /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9/rootfs</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æœ€åæ¸…ç†ç›®å½•</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¦‚æœæœ‰å¤§é‡æ®‹ç•™</strong>ï¼Œä½ é‚£ä¸ª <code>awk | xargs umount -l</code> å¯ä»¥ä½œä¸ºæ‰¹é‡æ¸…ç†æ‰‹æ®µï¼Œä½†æœ€å¥½åœ¨ç¡®è®¤è¿™äº›å®¹å™¨éƒ½å·²ç» STOPPED æˆ–å·²è¢« K8s åˆ é™¤çš„å‰æä¸‹åšã€‚</p>
</li>
</ol>
<hr>
<p>âœ… ç»“è®ºï¼š</p>
<ul>
<li>ä½ çš„ <code>umount -l</code> æ˜¯æ¸©å’Œå¯è¡Œçš„ï¼Œä¸ä¼šç›´æ¥ kill è¿›ç¨‹ï¼Œä½†ä¼šè®©å®¹å™¨ rootfs æ¶ˆå¤±ã€‚</li>
<li><strong>å¦‚æœåªæ˜¯æ¸…ç† STOPPED çš„æ®‹ç•™å®¹å™¨</strong>ï¼Œå‡ ä¹æ²¡å‰¯ä½œç”¨ï¼Œè¿˜èƒ½å›æ”¶ inode&#x2F;slabã€‚</li>
<li>å»ºè®® <strong>å…ˆç”¨ ctr rm</strong> å°è¯•è®© containerd è‡ªå·±æ¸…ç†ï¼Œå†æ‰‹åŠ¨ umount + rm å…œåº•ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/16/MTU%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%E5%92%8C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/16/MTU%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%E5%92%8C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" class="post-title-link" itemprop="url">MTUå®Œæ•´æŒ‡å—å’Œæ•…éšœæ’æŸ¥</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-16 11:03:44" itemprop="dateCreated datePublished" datetime="2025-09-16T11:03:44+08:00">2025-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-27 10:54:04" itemprop="dateModified" datetime="2025-10-27T10:54:04+08:00">2025-10-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ğŸ¯-MTUå¿«é€Ÿç†è§£"><a href="#ğŸ¯-MTUå¿«é€Ÿç†è§£" class="headerlink" title="ğŸ¯ MTUå¿«é€Ÿç†è§£"></a>ğŸ¯ MTUå¿«é€Ÿç†è§£</h2><h3 id="ä»€ä¹ˆæ˜¯MTUï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MTUï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MTUï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MTUï¼Ÿ</h3><p><strong>MTU (Maximum Transmission Unit)</strong> &#x3D; ç½‘ç»œæ¥å£ä¸€æ¬¡èƒ½ä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ï¼ˆå­—èŠ‚ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç®€å•ç±»æ¯”ï¼š</span><br><span class="line">MTUå°±åƒè´§è½¦çš„è½½é‡é™åˆ¶</span><br><span class="line">- è´§è½¦é™é‡5å¨ï¼Œè£…6å¨å°±è¶…è½½äº†</span><br><span class="line">- ç½‘å¡MTU=1500ï¼Œå‘é€1600å­—èŠ‚åŒ…å°±ä¼šæœ‰é—®é¢˜</span><br></pre></td></tr></table></figure>

<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ ‡å‡†ä»¥å¤ªç½‘MTU = 1500å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ IPå¤´: 20å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ TCPå¤´: 20å­—èŠ‚  </span><br><span class="line">â””â”€â”€ æ•°æ®è½½è·: æœ€å¤§1460å­—èŠ‚</span><br><span class="line"></span><br><span class="line">è™šæ‹ŸåŒ–ç¯å¢ƒMTU &lt; 1500å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ åŸå§‹æ•°æ®: 1460å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ TCP/IPå¤´: 40å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ è™šæ‹ŸåŒ–å¼€é”€: 50å­—èŠ‚</span><br><span class="line">â””â”€â”€ æ€»è®¡: 1550å­—èŠ‚ &gt; 1500å­—èŠ‚ âŒè¶…å‡ºé™åˆ¶</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”-MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤"><a href="#ğŸ”-MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤" class="headerlink" title="ğŸ” MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤"></a>ğŸ” MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤</h2><h3 id="1-æŸ¥çœ‹å½“å‰MTUå€¼"><a href="#1-æŸ¥çœ‹å½“å‰MTUå€¼" class="headerlink" title="1. æŸ¥çœ‹å½“å‰MTUå€¼"></a>1. æŸ¥çœ‹å½“å‰MTUå€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£MTU</span></span><br><span class="line">ip <span class="built_in">link</span> show</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šæ¥å£</span></span><br><span class="line">ip <span class="built_in">link</span> show eth0</span><br><span class="line">ip <span class="built_in">link</span> show docker0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€è¡Œå‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æ¥å£MTU</span></span><br><span class="line">ip -o <span class="built_in">link</span> show | awk <span class="string">&#x27;&#123;print $2, $5&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-æµ‹è¯•MTUå¤§å°"><a href="#2-æµ‹è¯•MTUå¤§å°" class="headerlink" title="2. æµ‹è¯•MTUå¤§å°"></a>2. æµ‹è¯•MTUå¤§å°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pingæµ‹è¯•MTU (Linux)</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 8.8.8.8    <span class="comment"># 1472 + 28(ICMPå¤´) = 1500</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1500 8.8.8.8    <span class="comment"># ä¼šå¤±è´¥ï¼Œå› ä¸ºåŠ ä¸Šå¤´éƒ¨è¶…è¿‡MTU</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windowsä¸‹æµ‹è¯•</span></span><br><span class="line">ping -f -l 1472 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨å‘ç°è·¯å¾„MTU</span></span><br><span class="line">tracepath google.com</span><br></pre></td></tr></table></figure>

<h3 id="3-Docker-MTUæŸ¥çœ‹"><a href="#3-Docker-MTUæŸ¥çœ‹" class="headerlink" title="3. Docker MTUæŸ¥çœ‹"></a>3. Docker MTUæŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹Dockerç½‘ç»œMTU</span></span><br><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">docker network inspect bridge | grep -i mtu</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ç½‘ç»œMTU</span></span><br><span class="line">docker <span class="built_in">exec</span> &lt;container&gt; ip <span class="built_in">link</span> show eth0</span><br></pre></td></tr></table></figure>

<h2 id="âš™ï¸-MTUé…ç½®æ–¹æ³•"><a href="#âš™ï¸-MTUé…ç½®æ–¹æ³•" class="headerlink" title="âš™ï¸ MTUé…ç½®æ–¹æ³•"></a>âš™ï¸ MTUé…ç½®æ–¹æ³•</h2><h3 id="1-ä¸´æ—¶ä¿®æ”¹MTU"><a href="#1-ä¸´æ—¶ä¿®æ”¹MTU" class="headerlink" title="1. ä¸´æ—¶ä¿®æ”¹MTU"></a>1. ä¸´æ—¶ä¿®æ”¹MTU</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç½‘ç»œæ¥å£MTU</span></span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 mtu 1450</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 mtu 1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Dockeræ¡¥æ¥MTU</span></span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 down</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 mtu 1450</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 up</span><br></pre></td></tr></table></figure>

<h3 id="2-æ°¸ä¹…é…ç½®MTU"><a href="#2-æ°¸ä¹…é…ç½®MTU" class="headerlink" title="2. æ°¸ä¹…é…ç½®MTU"></a>2. æ°¸ä¹…é…ç½®MTU</h3><h4 id="Docker-daemoné…ç½®"><a href="#Docker-daemoné…ç½®" class="headerlink" title="Docker daemoné…ç½®"></a>Docker daemoné…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mtu&quot;</span>: 1450,</span><br><span class="line">  <span class="string">&quot;bridge&quot;</span>: <span class="string">&quot;docker0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯DockeræœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®"><a href="#ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®" class="headerlink" title="ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®"></a>ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS/RHEL: /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line">MTU=1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu: /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      mtu: 1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> netplan apply</span><br></pre></td></tr></table></figure>

<h3 id="3-Kubernetesç¯å¢ƒMTUé…ç½®"><a href="#3-Kubernetesç¯å¢ƒMTUé…ç½®" class="headerlink" title="3. Kubernetesç¯å¢ƒMTUé…ç½®"></a>3. Kubernetesç¯å¢ƒMTUé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CNIæ’ä»¶é…ç½® (ä»¥Calicoä¸ºä¾‹)</span></span><br><span class="line"><span class="comment"># /etc/cni/net.d/10-calico.conf</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;k8s-pod-network&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cniVersion&quot;</span>: <span class="string">&quot;0.3.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;calico&quot;</span>,</span><br><span class="line">      <span class="string">&quot;mtu&quot;</span>: 1450</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸš¨-éœ€è¦å…³æ³¨MTUçš„åœºæ™¯"><a href="#ğŸš¨-éœ€è¦å…³æ³¨MTUçš„åœºæ™¯" class="headerlink" title="ğŸš¨ éœ€è¦å…³æ³¨MTUçš„åœºæ™¯"></a>ğŸš¨ éœ€è¦å…³æ³¨MTUçš„åœºæ™¯</h2><h3 id="1-è™šæ‹ŸåŒ–ç¯å¢ƒ-â­â­â­"><a href="#1-è™šæ‹ŸåŒ–ç¯å¢ƒ-â­â­â­" class="headerlink" title="1. è™šæ‹ŸåŒ–ç¯å¢ƒ â­â­â­"></a>1. è™šæ‹ŸåŒ–ç¯å¢ƒ â­â­â­</h3><p><strong>åœºæ™¯</strong>: VMwareã€KVMã€Hyper-Vç­‰è™šæ‹Ÿæœº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">ip <span class="built_in">link</span> show | grep mtu</span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 &lt;target&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- VMç½‘å¡MTU=1500ï¼Œä½†ç‰©ç†ç½‘å¡å®é™…æ”¯æŒ&lt;1500</span><br><span class="line">- å¤šå±‚è™šæ‹ŸåŒ–å åŠ å¯¼è‡´MTUé€’å‡</span><br><span class="line">- VXLAN/GREéš§é“é¢å¤–å¼€é”€</span><br></pre></td></tr></table></figure>

<h3 id="2-å®¹å™¨ç¯å¢ƒ-â­â­â­"><a href="#2-å®¹å™¨ç¯å¢ƒ-â­â­â­" class="headerlink" title="2. å®¹å™¨ç¯å¢ƒ â­â­â­"></a>2. å®¹å™¨ç¯å¢ƒ â­â­â­</h3><p><strong>åœºæ™¯</strong>: Dockerã€Kubernetesã€å®¹å™¨ç½‘ç»œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">docker network inspect bridge</span><br><span class="line">kubectl get nodes -o custom-columns=<span class="string">&quot;NAME:.metadata.name,MTU:.status.addresses[0].type&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- Dockeræ¡¥æ¥ç½‘ç»œMTUä¸åŒ¹é…</span><br><span class="line">- Overlayç½‘ç»œé¢å¤–å°è£…</span><br><span class="line">- CNIæ’ä»¶é…ç½®é”™è¯¯</span><br></pre></td></tr></table></figure>

<h3 id="3-äº‘ç¯å¢ƒ-â­â­"><a href="#3-äº‘ç¯å¢ƒ-â­â­" class="headerlink" title="3. äº‘ç¯å¢ƒ â­â­"></a>3. äº‘ç¯å¢ƒ â­â­</h3><p><strong>åœºæ™¯</strong>: AWSã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å…¬æœ‰äº‘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">curl -s http://169.254.169.254/latest/meta-data/network/interfaces/macs/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- äº‘ä¸»æœºé»˜è®¤MTUå¯èƒ½&lt;1500</span><br><span class="line">- VPCç½‘ç»œé—´MTUä¸ä¸€è‡´</span><br><span class="line">- è·¨å¯ç”¨åŒºç½‘ç»œMTUå·®å¼‚</span><br></pre></td></tr></table></figure>

<h3 id="4-SD-WAN-éš§é“ç½‘ç»œ-â­â­"><a href="#4-SD-WAN-éš§é“ç½‘ç»œ-â­â­" class="headerlink" title="4. SD-WAN&#x2F;éš§é“ç½‘ç»œ â­â­"></a>4. SD-WAN&#x2F;éš§é“ç½‘ç»œ â­â­</h3><p><strong>åœºæ™¯</strong>: VPNã€ä¸“çº¿ã€éš§é“è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">tracepath &lt;remote-host&gt;</span><br><span class="line">mtr --report &lt;remote-host&gt;</span><br><span class="line">mtr -rn www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚è€ƒ</span></span><br><span class="line">https://www.cnblogs.com/xzongblogs/p/15062134.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- VPNéš§é“é¢å¤–å¼€é”€</span><br><span class="line">- MPLSç½‘ç»œMTUé™åˆ¶</span><br><span class="line">- è·¨è¿è¥å•†ç½‘ç»œMTUä¸ç»Ÿä¸€</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ› ï¸-MTUæ•…éšœæ’æŸ¥æµç¨‹"><a href="#ğŸ› ï¸-MTUæ•…éšœæ’æŸ¥æµç¨‹" class="headerlink" title="ğŸ› ï¸ MTUæ•…éšœæ’æŸ¥æµç¨‹"></a>ğŸ› ï¸ MTUæ•…éšœæ’æŸ¥æµç¨‹</h2><h3 id="é˜¶æ®µ1-ç—‡çŠ¶è¯†åˆ«"><a href="#é˜¶æ®µ1-ç—‡çŠ¶è¯†åˆ«" class="headerlink" title="é˜¶æ®µ1: ç—‡çŠ¶è¯†åˆ«"></a>é˜¶æ®µ1: ç—‡çŠ¶è¯†åˆ«</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸¸è§ç—‡çŠ¶</span></span><br><span class="line">âœ“ å¤§æ–‡ä»¶ä¼ è¾“å¤±è´¥æˆ–å¾ˆæ…¢</span><br><span class="line">âœ“ SSHè¿æ¥å»ºç«‹åå‘½ä»¤æ‰§è¡Œå¡æ­»</span><br><span class="line">âœ“ HTTPè¯·æ±‚é—´æ­‡æ€§å¤±è´¥</span><br><span class="line">âœ“ æ•°æ®åº“è¿æ¥è¶…æ—¶</span><br><span class="line">âœ“ æ–‡ä»¶ä¸Šä¼ å¤±è´¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿«é€Ÿæ£€æµ‹å‘½ä»¤</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 &lt;target&gt;     <span class="comment"># æµ‹è¯•æ˜¯å¦èƒ½é€š</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1400 &lt;target&gt;     <span class="comment"># é™ä½æµ‹è¯•</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ2-MTUè·¯å¾„å‘ç°"><a href="#é˜¶æ®µ2-MTUè·¯å¾„å‘ç°" class="headerlink" title="é˜¶æ®µ2: MTUè·¯å¾„å‘ç°"></a>é˜¶æ®µ2: MTUè·¯å¾„å‘ç°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1: tracepath (æ¨è)</span></span><br><span class="line">tracepath google.com</span><br><span class="line"><span class="comment"># è¾“å‡ºä¼šæ˜¾ç¤ºè·¯å¾„ä¸Šçš„MTUå€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2: pingäºŒåˆ†æ³•æµ‹è¯•</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">find_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> host=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> low=1</span><br><span class="line">    <span class="built_in">local</span> high=1500</span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$low</span> -lt <span class="variable">$high</span> ]; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">local</span> mid=$(( (low + high + <span class="number">1</span>) / <span class="number">2</span> ))</span><br><span class="line">        <span class="keyword">if</span> ping -c 1 -M <span class="keyword">do</span> -s <span class="variable">$mid</span> <span class="variable">$host</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            low=<span class="variable">$mid</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            high=$((mid - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æœ€å¤§MTU: <span class="subst">$((low + 28)</span>)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: find_mtu google.com</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ3-åˆ†å±‚æ’æŸ¥"><a href="#é˜¶æ®µ3-åˆ†å±‚æ’æŸ¥" class="headerlink" title="é˜¶æ®µ3: åˆ†å±‚æ’æŸ¥"></a>é˜¶æ®µ3: åˆ†å±‚æ’æŸ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¸»æœºç½‘ç»œå±‚</span></span><br><span class="line">ip <span class="built_in">link</span> show                    <span class="comment"># æŸ¥çœ‹æ¥å£MTU</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/route             <span class="comment"># æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line">netstat -i                      <span class="comment"># æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è™šæ‹ŸåŒ–å±‚</span></span><br><span class="line"><span class="comment"># VMware</span></span><br><span class="line">vmware-toolbox-cmd <span class="built_in">stat</span> speed</span><br><span class="line"><span class="comment"># KVM</span></span><br><span class="line">virsh domiflist &lt;vm-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®¹å™¨å±‚</span></span><br><span class="line">docker network inspect bridge</span><br><span class="line">kubectl describe node | grep -i mtu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åº”ç”¨å±‚</span></span><br><span class="line">ss -i                           <span class="comment"># æŸ¥çœ‹TCPè¿æ¥ä¿¡æ¯</span></span><br><span class="line">netstat -s | grep -i fragment   <span class="comment"># æŸ¥çœ‹åˆ†ç‰‡ç»Ÿè®¡</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ4-æ€§èƒ½éªŒè¯"><a href="#é˜¶æ®µ4-æ€§èƒ½éªŒè¯" class="headerlink" title="é˜¶æ®µ4: æ€§èƒ½éªŒè¯"></a>é˜¶æ®µ4: æ€§èƒ½éªŒè¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯•è„šæœ¬</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># mtu_test.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== MTUæ€§èƒ½æµ‹è¯• ===&quot;</span></span><br><span class="line"><span class="keyword">for</span> size <span class="keyword">in</span> 1400 1450 1472 1500; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;æµ‹è¯• MTU <span class="variable">$size</span>: &quot;</span></span><br><span class="line">    <span class="keyword">if</span> ping -c 3 -M <span class="keyword">do</span> -s $((size-<span class="number">28</span>)) 8.8.8.8 &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âœ“ é€šè¿‡&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âœ— å¤±è´¥&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“Š-ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼"><a href="#ğŸ“Š-ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼" class="headerlink" title="ğŸ“Š ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼"></a>ğŸ“Š ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼</h2><h3 id="æ ‡å‡†ç½‘ç»œç¯å¢ƒ"><a href="#æ ‡å‡†ç½‘ç»œç¯å¢ƒ" class="headerlink" title="æ ‡å‡†ç½‘ç»œç¯å¢ƒ"></a>æ ‡å‡†ç½‘ç»œç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä»¥å¤ªç½‘: 1500          <span class="comment"># æ ‡å‡†å€¼</span></span><br><span class="line">åƒå…†ä»¥å¤ªç½‘: 9000      <span class="comment"># Jumbo Frame</span></span><br><span class="line">Wi-Fi: 1500           <span class="comment"># é€šå¸¸ä¸ä»¥å¤ªç½‘ç›¸åŒ</span></span><br></pre></td></tr></table></figure>

<h3 id="è™šæ‹ŸåŒ–ç¯å¢ƒ"><a href="#è™šæ‹ŸåŒ–ç¯å¢ƒ" class="headerlink" title="è™šæ‹ŸåŒ–ç¯å¢ƒ"></a>è™šæ‹ŸåŒ–ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VMware vSphere: 1450-1480    <span class="comment"># è€ƒè™‘VXLANå¼€é”€</span></span><br><span class="line">KVM/QEMU: 1450               <span class="comment"># ä¿å®ˆå€¼</span></span><br><span class="line">Hyper-V: 1500                <span class="comment"># é€šå¸¸æ”¯æŒæ ‡å‡†å€¼</span></span><br><span class="line">Docker: 1450-1480            <span class="comment"># å–å†³äºåº•å±‚ç½‘ç»œ</span></span><br></pre></td></tr></table></figure>

<h3 id="äº‘ç¯å¢ƒ"><a href="#äº‘ç¯å¢ƒ" class="headerlink" title="äº‘ç¯å¢ƒ"></a>äº‘ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AWS EC2: 1500 (enhanced networking)</span><br><span class="line">       : 1500-9000 (placement group)</span><br><span class="line">é˜¿é‡Œäº‘ECS: 1500</span><br><span class="line">è…¾è®¯äº‘CVM: 1500</span><br><span class="line">Azure VM: 1500</span><br></pre></td></tr></table></figure>

<h3 id="å®¹å™¨ç½‘ç»œ"><a href="#å®¹å™¨ç½‘ç»œ" class="headerlink" title="å®¹å™¨ç½‘ç»œ"></a>å®¹å™¨ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Docker bridge: 1450-1480</span><br><span class="line">Kubernetes:</span><br><span class="line">  - Flannel: 1450</span><br><span class="line">  - Calico: 1440-1480  </span><br><span class="line">  - Weave: 1376</span><br><span class="line">  - Cilium: 1450</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬"><a href="#ğŸ”§-è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬" class="headerlink" title="ğŸ”§ è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬"></a>ğŸ”§ è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬</h2><h3 id="MTUæ£€æµ‹è„šæœ¬"><a href="#MTUæ£€æµ‹è„šæœ¬" class="headerlink" title="MTUæ£€æµ‹è„šæœ¬"></a>MTUæ£€æµ‹è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auto_mtu_detect.sh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">detect_optimal_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> target=<span class="variable">$&#123;1:-8.8.8.8&#125;</span></span><br><span class="line">    <span class="built_in">local</span> max_mtu=1500</span><br><span class="line">    <span class="built_in">local</span> min_mtu=1200</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æ£€æµ‹åˆ° <span class="variable">$target</span> çš„æœ€ä¼˜MTU...&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ((mtu=max_mtu; mtu&gt;=min_mtu; mtu-=<span class="number">50</span>)); <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> ping -c 2 -M <span class="keyword">do</span> -s $((mtu-<span class="number">28</span>)) <span class="variable">$target</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;å‘ç°å¯ç”¨MTU: <span class="variable">$mtu</span>&quot;</span></span><br><span class="line">            <span class="comment"># ç²¾ç¡®æœç´¢</span></span><br><span class="line">            <span class="keyword">for</span> ((i=mtu; i&lt;=mtu+<span class="number">50</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> ! ping -c 1 -M <span class="keyword">do</span> -s $((i-<span class="number">28</span>)) <span class="variable">$target</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;æœ€ä¼˜MTU: <span class="subst">$((i-1)</span>)&quot;</span></span><br><span class="line">                    <span class="built_in">return</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æœªèƒ½æ£€æµ‹åˆ°åˆé€‚çš„MTUå€¼&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">detect_optimal_mtu</span><br></pre></td></tr></table></figure>

<h3 id="ç³»ç»ŸMTUé…ç½®è„šæœ¬"><a href="#ç³»ç»ŸMTUé…ç½®è„šæœ¬" class="headerlink" title="ç³»ç»ŸMTUé…ç½®è„šæœ¬"></a>ç³»ç»ŸMTUé…ç½®è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># set_system_mtu.sh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_system_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> mtu=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> interface=<span class="variable">$&#123;2:-eth0&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;è®¾ç½® <span class="variable">$interface</span> MTUä¸º <span class="variable">$mtu</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¸´æ—¶è®¾ç½®</span></span><br><span class="line">    <span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev <span class="variable">$interface</span> mtu <span class="variable">$mtu</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ°¸ä¹…è®¾ç½® (Ubuntu)</span></span><br><span class="line">    <span class="keyword">if</span> [[ -f /etc/netplan/01-netcfg.yaml ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">sudo</span> sed -i <span class="string">&quot;/mtu:/d&quot;</span> /etc/netplan/01-netcfg.yaml</span><br><span class="line">        <span class="built_in">sudo</span> sed -i <span class="string">&quot;/dhcp4: true/a\\      mtu: <span class="variable">$mtu</span>&quot;</span> /etc/netplan/01-netcfg.yaml</span><br><span class="line">        <span class="built_in">sudo</span> netplan apply</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Dockeré…ç½®</span></span><br><span class="line">    <span class="keyword">if</span> systemctl is-active --quiet docker; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;é…ç½®Docker MTU...&quot;</span></span><br><span class="line">        <span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;mtu&quot;: &#x27;</span><span class="variable">$mtu</span><span class="string">&#x27;&#125;&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json</span><br><span class="line">        <span class="built_in">sudo</span> systemctl restart docker</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MTUé…ç½®å®Œæˆ&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: set_system_mtu 1450</span></span><br></pre></td></tr></table></figure>

<h2 id="âš ï¸-æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ"><a href="#âš ï¸-æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ" class="headerlink" title="âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ"></a>âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ</h2><h3 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h3><ul>
<li><strong>ç”Ÿäº§ç¯å¢ƒä¿®æ”¹è¦è°¨æ…</strong>: MTUä¿®æ”¹å¯èƒ½å¯¼è‡´ç½‘ç»œä¸­æ–­</li>
<li><strong>é€æ­¥è°ƒæ•´</strong>: ä»å°å€¼å¼€å§‹ï¼Œé€æ­¥è°ƒæ•´åˆ°æœ€ä¼˜å€¼</li>
<li><strong>å¤‡ä»½é…ç½®</strong>: ä¿®æ”¹å‰å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶</li>
<li><strong>æµ‹è¯•éªŒè¯</strong>: ä¿®æ”¹åå……åˆ†æµ‹è¯•ç½‘ç»œè¿é€šæ€§</li>
</ul>
<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><ol>
<li><strong>è‡ªåŠ¨å‘ç°ä¼˜äºæ‰‹åŠ¨é…ç½®</strong>: ä½¿ç”¨å·¥å…·è‡ªåŠ¨æ£€æµ‹æœ€ä¼˜MTU</li>
<li><strong>åˆ†å±‚ä¸€è‡´æ€§</strong>: ç¡®ä¿å„ç½‘ç»œå±‚MTUé…ç½®ä¸€è‡´</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>: ç›‘æ§ç½‘ç»œåˆ†ç‰‡å’Œä¸¢åŒ…æƒ…å†µ</li>
<li><strong>æ–‡æ¡£è®°å½•</strong>: è®°å½•MTUé…ç½®çš„åŸå› å’Œæ•°å€¼</li>
</ol>
<h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><p>âŒ <strong>è®¤ä¸ºMTUè¶Šå¤§è¶Šå¥½</strong>: ä¸æ˜¯çš„ï¼Œè¦åŒ¹é…ç½‘ç»œç¯å¢ƒ<br>âŒ <strong>åªè®¾ç½®åº”ç”¨å±‚MTU</strong>: éœ€è¦å…¨é“¾è·¯ä¸€è‡´<br>âŒ <strong>å¿½ç•¥è™šæ‹ŸåŒ–å¼€é”€</strong>: è™šæ‹Ÿç¯å¢ƒéœ€è¦é¢„ç•™å¼€é”€<br>âŒ <strong>è®¾ç½®åä¸éªŒè¯</strong>: å¿…é¡»é€šè¿‡å®é™…æµ‹è¯•éªŒè¯æ•ˆæœ</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/16/lsns%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/16/lsns%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" class="post-title-link" itemprop="url">lsnså‘½ä»¤ä½¿ç”¨æŒ‡å—ä¸æ•…éšœæ’æŸ¥</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-16 10:49:11 / ä¿®æ”¹æ—¶é—´ï¼š10:49:35" itemprop="dateCreated datePublished" datetime="2025-09-16T10:49:11+08:00">2025-09-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="lsnsåŸºç¡€ç”¨æ³•"><a href="#lsnsåŸºç¡€ç”¨æ³•" class="headerlink" title="lsnsåŸºç¡€ç”¨æ³•"></a>lsnsåŸºç¡€ç”¨æ³•</h2><h3 id="1-åŸºæœ¬å‘½ä»¤"><a href="#1-åŸºæœ¬å‘½ä»¤" class="headerlink" title="1. åŸºæœ¬å‘½ä»¤"></a>1. åŸºæœ¬å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">lsns</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns -p &lt;PID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šç±»å‹çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns -t net        <span class="comment"># ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">lsns -t mnt        <span class="comment"># æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">lsns -t pid        <span class="comment"># PIDå‘½åç©ºé—´</span></span><br><span class="line">lsns -t user       <span class="comment"># ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">lsns -t uts        <span class="comment"># UTSå‘½åç©ºé—´</span></span><br><span class="line">lsns -t ipc        <span class="comment"># IPCå‘½åç©ºé—´</span></span><br><span class="line">lsns -t cgroup     <span class="comment"># cgroupå‘½åç©ºé—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¯¦ç»†è¾“å‡ºæ ¼å¼</span></span><br><span class="line">lsns -l            <span class="comment"># é•¿æ ¼å¼æ˜¾ç¤º</span></span><br><span class="line">lsns -J            <span class="comment"># JSONæ ¼å¼è¾“å‡º</span></span><br><span class="line">lsns -r            <span class="comment"># æ˜¾ç¤ºåŸå§‹è®¾å¤‡å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºç‰¹å®šåˆ—</span></span><br><span class="line">lsns -o NS,TYPE,NPROCS,PID,USER,NETNSID,COMMAND</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ˜¾ç¤ºå¤´éƒ¨</span></span><br><span class="line">lsns -n</span><br></pre></td></tr></table></figure>

<h3 id="2-é«˜çº§ç”¨æ³•"><a href="#2-é«˜çº§ç”¨æ³•" class="headerlink" title="2. é«˜çº§ç”¨æ³•"></a>2. é«˜çº§ç”¨æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">lsns --nsfs-file /proc/1/ns/net</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç±»å‹å’Œè¿›ç¨‹æ•°æ’åº</span></span><br><span class="line">lsns -t net -o NS,TYPE,NPROCS,PID,COMMAND | <span class="built_in">sort</span> -k3 -nr</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ç›¸å…³çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns | grep docker</span><br><span class="line">lsns | grep containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹systemdç›¸å…³å‘½åç©ºé—´</span></span><br><span class="line">lsns | grep systemd</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åç©ºé—´æ“ä½œå‘½ä»¤"><a href="#å‘½åç©ºé—´æ“ä½œå‘½ä»¤" class="headerlink" title="å‘½åç©ºé—´æ“ä½œå‘½ä»¤"></a>å‘½åç©ºé—´æ“ä½œå‘½ä»¤</h2><h3 id="1-è¿›å…¥å‘½åç©ºé—´"><a href="#1-è¿›å…¥å‘½åç©ºé—´" class="headerlink" title="1. è¿›å…¥å‘½åç©ºé—´"></a>1. è¿›å…¥å‘½åç©ºé—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ç‰¹å®šè¿›ç¨‹çš„ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å¤šä¸ªå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n -p -m bash     <span class="comment"># ç½‘ç»œ+PID+æŒ‚è½½</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -a bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ipå‘½ä»¤è¿›å…¥ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip netns <span class="built_in">exec</span> &lt;netns-name&gt; bash</span><br></pre></td></tr></table></figure>

<h3 id="2-æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…"><a href="#2-æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…" class="headerlink" title="2. æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…"></a>2. æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹çš„å‘½åç©ºé—´æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ls</span> -la /proc/&lt;PID&gt;/ns/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip netns list</span><br><span class="line">ip netns show</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/mounts</span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/mountinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PIDå‘½åç©ºé—´</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/status | grep NSpid</span><br></pre></td></tr></table></figure>

<h3 id="3-å‘½åç©ºé—´ç›‘æ§"><a href="#3-å‘½åç©ºé—´ç›‘æ§" class="headerlink" title="3. å‘½åç©ºé—´ç›‘æ§"></a>3. å‘½åç©ºé—´ç›‘æ§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®æ—¶ç›‘æ§å‘½åç©ºé—´å˜åŒ–</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;lsns -t net&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½åç©ºé—´ç»Ÿè®¡</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br></pre></td></tr></table></figure>

<h2 id="æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•"><a href="#æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•" class="headerlink" title="æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•"></a>æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•</h2><h3 id="ğŸ”-åœºæ™¯1-å®¹å™¨ç½‘ç»œé—®é¢˜"><a href="#ğŸ”-åœºæ™¯1-å®¹å™¨ç½‘ç»œé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯1: å®¹å™¨ç½‘ç»œé—®é¢˜"></a>ğŸ” åœºæ™¯1: å®¹å™¨ç½‘ç»œé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨æ— æ³•è®¿é—®ç½‘ç»œï¼ŒDNSè§£æå¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹å®¹å™¨ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">docker inspect &lt;container&gt; | grep NetworkMode</span><br><span class="line">lsns -t net | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨ç½‘ç»œå‘½åç©ºé—´æ’æŸ¥</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -n bash</span><br><span class="line">ip addr show                    <span class="comment"># æŸ¥çœ‹ç½‘ç»œæ¥å£</span></span><br><span class="line">ip route show                   <span class="comment"># æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf            <span class="comment"># æŸ¥çœ‹DNSé…ç½®</span></span><br><span class="line">ping 8.8.8.8                    <span class="comment"># æµ‹è¯•ç½‘ç»œè¿é€šæ€§</span></span><br><span class="line">nslookup google.com             <span class="comment"># æµ‹è¯•DNSè§£æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯¹æ¯”å®¿ä¸»æœºç½‘ç»œ</span></span><br><span class="line"><span class="built_in">exit</span>  <span class="comment"># é€€å‡ºå®¹å™¨ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip addr show                    <span class="comment"># å®¿ä¸»æœºç½‘ç»œæ¥å£</span></span><br><span class="line">ip route show                   <span class="comment"># å®¿ä¸»æœºè·¯ç”±è¡¨</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯2-å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜"><a href="#ğŸ”-åœºæ™¯2-å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯2: å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜"></a>ğŸ” åœºæ™¯2: å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…æ–‡ä»¶ä¸¢å¤±ï¼ŒæŒ‚è½½ç‚¹å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">lsns -t mnt | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -m bash</span><br><span class="line">mount | grep &lt;path&gt;             <span class="comment"># æŸ¥çœ‹ç‰¹å®šè·¯å¾„æŒ‚è½½</span></span><br><span class="line"><span class="built_in">df</span> -h                           <span class="comment"># æŸ¥çœ‹ç£ç›˜ä½¿ç”¨</span></span><br><span class="line">findmnt                         <span class="comment"># è¯¦ç»†æŒ‚è½½ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯¹æ¯”å®¿ä¸»æœºæŒ‚è½½</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">mount | grep &lt;container-volume&gt;</span><br><span class="line">docker inspect &lt;container&gt; | grep Mounts</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯3-è¿›ç¨‹PIDé—®é¢˜"><a href="#ğŸ”-åœºæ™¯3-è¿›ç¨‹PIDé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯3: è¿›ç¨‹PIDé—®é¢˜"></a>ğŸ” åœºæ™¯3: è¿›ç¨‹PIDé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…PIDå†²çªï¼Œè¿›ç¨‹ç®¡ç†å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹PIDå‘½åç©ºé—´</span></span><br><span class="line">lsns -t pid | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨PIDå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -p bash</span><br><span class="line">ps aux                          <span class="comment"># æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span></span><br><span class="line">pstree                          <span class="comment"># è¿›ç¨‹æ ‘</span></span><br><span class="line"><span class="built_in">cat</span> /proc/1/cmdline             <span class="comment"># å®¹å™¨å†…PID 1è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹å®¿ä¸»æœºè§†è§’çš„è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ps aux | grep &lt;container-name&gt;</span><br><span class="line">pstree -p &lt;container-pid&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯4-ç”¨æˆ·æƒé™é—®é¢˜"><a href="#ğŸ”-åœºæ™¯4-ç”¨æˆ·æƒé™é—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯4: ç”¨æˆ·æƒé™é—®é¢˜"></a>ğŸ” åœºæ™¯4: ç”¨æˆ·æƒé™é—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…ç”¨æˆ·æƒé™å¼‚å¸¸ï¼Œæ–‡ä»¶è®¿é—®è¢«æ‹’ç»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">lsns -t user | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥ç”¨æˆ·æ˜ å°„</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/uid_map</span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/gid_map</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¿›å…¥å®¹å™¨ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -U bash</span><br><span class="line"><span class="built_in">id</span>                              <span class="comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">ls</span> -la /                        <span class="comment"># æŸ¥çœ‹æ–‡ä»¶æƒé™</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯5-ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜"><a href="#ğŸ”-åœºæ™¯5-ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯5: ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜"></a>ğŸ” åœºæ™¯5: ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨èµ„æºé™åˆ¶å¼‚å¸¸ï¼Œæ€§èƒ½é—®é¢˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹cgroupå‘½åç©ºé—´</span></span><br><span class="line">lsns -t cgroup | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥cgroupé…ç½®</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/cgroup</span><br><span class="line">systemd-cgls | grep &lt;container&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹èµ„æºä½¿ç”¨</span></span><br><span class="line">docker stats &lt;container&gt;</span><br><span class="line"><span class="built_in">cat</span> /sys/fs/cgroup/memory/docker/&lt;container-id&gt;/memory.usage_in_bytes</span><br><span class="line"><span class="built_in">cat</span> /sys/fs/cgroup/cpu/docker/&lt;container-id&gt;/cpu.shares</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯6-Kubernetes-Podç½‘ç»œé—®é¢˜"><a href="#ğŸ”-åœºæ™¯6-Kubernetes-Podç½‘ç»œé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯6: Kubernetes Podç½‘ç»œé—®é¢˜"></a>ğŸ” åœºæ™¯6: Kubernetes Podç½‘ç»œé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: Podé—´é€šä¿¡å¤±è´¥ï¼ŒServiceè®¿é—®å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥æ‰¾Podè¿›ç¨‹</span></span><br><span class="line">kubectl get pods -o wide</span><br><span class="line">ps aux | grep &lt;pod-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æŸ¥çœ‹Podç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">PID=$(pgrep -f &lt;pod-container&gt;)</span><br><span class="line">lsns -t net | grep <span class="variable">$PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¿›å…¥Podç½‘ç»œç©ºé—´æ’æŸ¥</span></span><br><span class="line">nsenter -t <span class="variable">$PID</span> -n bash</span><br><span class="line">ip addr show                    <span class="comment"># æŸ¥çœ‹Pod IP</span></span><br><span class="line">ip route show                   <span class="comment"># æŸ¥çœ‹è·¯ç”±</span></span><br><span class="line">iptables -L                     <span class="comment"># æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰</span></span><br><span class="line">nslookup kubernetes.default     <span class="comment"># æµ‹è¯•é›†ç¾¤DNS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æŸ¥çœ‹CNIé…ç½®</span></span><br><span class="line"><span class="built_in">cat</span> /etc/cni/net.d/*            <span class="comment"># CNIæ’ä»¶é…ç½®</span></span><br><span class="line">ip <span class="built_in">link</span> show                    <span class="comment"># ç½‘ç»œè®¾å¤‡</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯7-å®¹å™¨å¯åŠ¨å¤±è´¥"><a href="#ğŸ”-åœºæ™¯7-å®¹å™¨å¯åŠ¨å¤±è´¥" class="headerlink" title="ğŸ” åœºæ™¯7: å®¹å™¨å¯åŠ¨å¤±è´¥"></a>ğŸ” åœºæ™¯7: å®¹å™¨å¯åŠ¨å¤±è´¥</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡ºï¼ŒçŠ¶æ€å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span><br><span class="line">docker logs &lt;container&gt;</span><br><span class="line">kubectl logs &lt;pod&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æŸ¥çœ‹å®¹å™¨å‘½åç©ºé—´çŠ¶æ€</span></span><br><span class="line">docker inspect &lt;container&gt; | grep State -A 10</span><br><span class="line">lsns | grep &lt;container-name&gt;    <span class="comment"># çœ‹æ˜¯å¦è¿˜æœ‰å‘½åç©ºé—´æ®‹ç•™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ¨¡æ‹Ÿå®¹å™¨ç¯å¢ƒè°ƒè¯•</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> &lt;image&gt; bash</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">kubectl run debug-pod --image=&lt;image&gt; -it --<span class="built_in">rm</span> -- bash</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ"><a href="#å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ" class="headerlink" title="å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ"></a>å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ</h2><h3 id="1-æ’æŸ¥æµç¨‹"><a href="#1-æ’æŸ¥æµç¨‹" class="headerlink" title="1. æ’æŸ¥æµç¨‹"></a>1. æ’æŸ¥æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1: è¯†åˆ«é—®é¢˜è¿›ç¨‹</span></span><br><span class="line">ps aux | grep &lt;service-name&gt;</span><br><span class="line">pgrep -f &lt;pattern&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: æŸ¥çœ‹å‘½åç©ºé—´æ¦‚å†µ</span></span><br><span class="line">lsns -p &lt;PID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: é’ˆå¯¹æ€§è¿›å…¥é—®é¢˜å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n -p -m bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: åœ¨å‘½åç©ºé—´å†…æ’æŸ¥</span></span><br><span class="line"><span class="comment"># ç½‘ç»œ: ip addr, ip route, netstat</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ç³»ç»Ÿ: mount, df, ls</span></span><br><span class="line"><span class="comment"># è¿›ç¨‹: ps, pstree</span></span><br><span class="line"><span class="comment"># æƒé™: id, whoami, ls -la</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å¸¸ç”¨ç»„åˆå‘½ä»¤"><a href="#2-å¸¸ç”¨ç»„åˆå‘½ä»¤" class="headerlink" title="2. å¸¸ç”¨ç»„åˆå‘½ä»¤"></a>2. å¸¸ç”¨ç»„åˆå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¿«é€ŸæŸ¥çœ‹å®¹å™¨æ‰€æœ‰å‘½åç©ºé—´ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">container_ns_info</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> pid=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;=== å‘½åç©ºé—´æ¦‚å†µ ===&quot;</span></span><br><span class="line">    lsns -p <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== ç½‘ç»œä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -n ip addr show</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== æŒ‚è½½ä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -m mount | <span class="built_in">head</span> -10</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== è¿›ç¨‹ä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -p ps aux | <span class="built_in">head</span> -10</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: container_ns_info &lt;PID&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-ç›‘æ§è„šæœ¬"><a href="#3-ç›‘æ§è„šæœ¬" class="headerlink" title="3. ç›‘æ§è„šæœ¬"></a>3. ç›‘æ§è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ns_monitor.sh - å‘½åç©ºé—´ç›‘æ§è„šæœ¬</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== å‘½åç©ºé—´ç»Ÿè®¡ ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç±»å‹ç»Ÿè®¡:&quot;</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nè¿›ç¨‹æ•°æœ€å¤šçš„å‘½åç©ºé—´:&quot;</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2, $3, $5&#125;&#x27;</span> | <span class="built_in">sort</span> -k2 -nr | <span class="built_in">head</span> -5</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nå®¹å™¨ç›¸å…³å‘½åç©ºé—´:&quot;</span></span><br><span class="line">lsns | grep -E <span class="string">&quot;(docker|containerd|runc)&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>âš ï¸ <strong>å®‰å…¨æé†’</strong>:</p>
<ul>
<li>ä½¿ç”¨<code>nsenter</code>éœ€è¦rootæƒé™æˆ–ç›¸åº”çš„capabilities</li>
<li>è¿›å…¥ç”Ÿäº§å®¹å™¨å‘½åç©ºé—´è¦è°¨æ…ï¼Œé¿å…å½±å“ä¸šåŠ¡</li>
<li>æŸäº›å‘½åç©ºé—´æ“ä½œå¯èƒ½å½±å“ç³»ç»Ÿç¨³å®šæ€§</li>
</ul>
<p>ğŸ’¡ <strong>æœ€ä½³å®è·µ</strong>:</p>
<ul>
<li>å…ˆç”¨<code>lsns</code>è§‚å¯Ÿï¼Œå†ç”¨<code>nsenter</code>è¿›å…¥</li>
<li>æ’æŸ¥æ—¶è®°å½•æ“ä½œæ­¥éª¤ï¼Œä¾¿äºå¤ç°å’Œåˆ†æ</li>
<li>ç»“åˆå®¹å™¨ç¼–æ’å·¥å…·çš„æ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯</li>
<li>å®šæœŸç›‘æ§å‘½åç©ºé—´æ•°é‡ï¼Œé¿å…æ³„æ¼</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/11/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/11/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">åŸºç¡€é•œåƒå¯¹æ¯”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-11 13:15:13 / ä¿®æ”¹æ—¶é—´ï¼š13:17:53" itemprop="dateCreated datePublished" datetime="2025-09-11T13:15:13+08:00">2025-09-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ğŸ“Š-åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian-Ubuntu-Alpine-CentOSï¼‰"><a href="#ğŸ“Š-åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian-Ubuntu-Alpine-CentOSï¼‰" class="headerlink" title="ğŸ“Š åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian &#x2F; Ubuntu &#x2F; Alpine &#x2F; CentOSï¼‰"></a>ğŸ“Š åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian &#x2F; Ubuntu &#x2F; Alpine &#x2F; CentOSï¼‰</h1><table>
<thead>
<tr>
<th>ç³»ç»Ÿ</th>
<th>ä½“ç§¯ (é•œåƒå¤§å°)</th>
<th>å…¼å®¹æ€§</th>
<th>ç¨³å®šæ€§</th>
<th>ç”Ÿæ€æ”¯æŒ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Debian</strong></td>
<td><strong>ä¸­ç­‰</strong>ï¼ˆ<code>slim</code> ~ 22MBï¼Œå®Œæ•´ ~ 124MBï¼‰</td>
<td>ä¸ Linux ä¸»æµå‘è¡Œç‰ˆé«˜åº¦å…¼å®¹ï¼ˆglibcï¼‰</td>
<td>æé«˜ï¼Œé•¿æœŸæ”¯æŒ + å®‰å…¨æ›´æ–°å¿«</td>
<td>Docker å®˜æ–¹æ¨èï¼Œæ–‡æ¡£ä¸°å¯Œï¼ŒCI&#x2F;CD å¸¸ç”¨</td>
<td>æ¨èå¤§å¤šæ•°åº”ç”¨ï¼Œç¨³å®šã€å®‰å…¨ã€è½»é‡</td>
</tr>
<tr>
<td><strong>Ubuntu</strong></td>
<td>ä¸­ç­‰åå¤§ï¼ˆ<code>slim</code> ~ 29MBï¼Œå®Œæ•´ ~ 77MBï¼‰</td>
<td>ä¸ Debian å®Œå…¨å…¼å®¹ï¼Œé¢å¤–å¸¦ Canonical æ”¯æŒ</td>
<td>é«˜ï¼ŒLTS ç‰ˆæœ¬æ”¯æŒ 5 å¹´</td>
<td>æœ€æµè¡Œï¼Œç¤¾åŒº &amp; ä¼ä¸šæ–‡æ¡£æœ€å…¨ï¼Œäº‘åŸç”Ÿç”Ÿæ€å¥½</td>
<td>æ¨èéœ€è¦ LTS çš„åœºæ™¯ï¼Œå¦‚å¾®æœåŠ¡ã€ä¼ä¸šåº”ç”¨</td>
</tr>
<tr>
<td><strong>Alpine</strong></td>
<td><strong>æå°</strong>ï¼ˆ5MB å·¦å³ï¼‰</td>
<td>ä½¿ç”¨ <code>musl libc</code> ä¸ <code>busybox</code>ï¼Œéƒ¨åˆ†åº“å…¼å®¹æ€§å·®</td>
<td>ä¸­ç­‰ï¼Œæ»šåŠ¨æ›´æ–°å¿«ä½†å¯èƒ½å¼•å…¥é—®é¢˜</td>
<td>æ–‡æ¡£è¾ƒå°‘ï¼Œè°ƒè¯•å·¥å…·ç¼ºå¤±ï¼Œæ„å»ºå¤æ‚</td>
<td>é€‚åˆæç®€åº”ç”¨ï¼Œé™æ€ç¼–è¯‘ Go &#x2F; Rust &#x2F; Java é•œåƒ</td>
</tr>
<tr>
<td><strong>CentOS</strong>ï¼ˆå« Rocky&#x2F;Almaï¼‰</td>
<td>å¤§ï¼ˆ200MB+ï¼‰</td>
<td>ä¸ RHEL å®Œå…¨å…¼å®¹ï¼Œé€‚åˆä¼ä¸š RHEL ç¯å¢ƒ</td>
<td>é«˜ï¼Œä¼ä¸šçº§ï¼Œç”Ÿå‘½å‘¨æœŸé•¿ï¼ˆå–å†³äºç‰ˆæœ¬ï¼‰</td>
<td>ä¼ ç»Ÿä¼ä¸šç”¨å¾—å¤šï¼Œä½†äº‘åŸç”Ÿç¤¾åŒºçƒ­åº¦ä¸‹é™</td>
<td>é€‚åˆå¯¹ <strong>RHEL å…¼å®¹æ€§</strong> æœ‰å¼ºéœ€æ±‚çš„ç¯å¢ƒ</td>
</tr>
</tbody></table>
<hr>
<h1 id="ğŸ·-Debian-é•œåƒ-tag-è¯´æ˜"><a href="#ğŸ·-Debian-é•œåƒ-tag-è¯´æ˜" class="headerlink" title="ğŸ· Debian é•œåƒ tag è¯´æ˜"></a>ğŸ· Debian é•œåƒ tag è¯´æ˜</h1><p>Debian çš„ tag æ¯”è¾ƒå¤šï¼Œæˆ‘å¸®ä½ åˆ†ç±»æ•´ç†ï¼š</p>
<table>
<thead>
<tr>
<th>Tag ç¤ºä¾‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>bookworm</code></td>
<td>Debian 12 ç¨³å®šç‰ˆï¼ˆæœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰</td>
</tr>
<tr>
<td><code>bullseye</code></td>
<td>Debian 11 ç¨³å®šç‰ˆ</td>
</tr>
<tr>
<td><code>buster</code></td>
<td>Debian 10 ç¨³å®šç‰ˆï¼ˆè€ç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td><code>12</code>, <code>11</code>, <code>10</code></td>
<td>å¯¹åº” Debian ä¸»ç‰ˆæœ¬å·ï¼Œå’Œä»£å·ç­‰ä»·</td>
</tr>
<tr>
<td><code>bookworm-slim</code></td>
<td>ç²¾ç®€ç‰ˆï¼Œå»æ‰ man&#x2F;info&#x2F;localeï¼Œä¸å¸¦å¤šä½™å·¥å…·ï¼Œä½“ç§¯æ›´å°</td>
</tr>
<tr>
<td><code>bookworm-20240904</code></td>
<td>å¸¦æ„å»ºæ—¥æœŸçš„é•œåƒï¼Œä¿è¯å¯é‡å¤æ„å»º</td>
</tr>
<tr>
<td><code>stable</code></td>
<td>å½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆï¼ˆç›®å‰æ˜¯ <code>bookworm</code>ï¼‰</td>
</tr>
<tr>
<td><code>testing</code></td>
<td>å³å°†æˆä¸ºä¸‹ä¸€ä¸ªç¨³å®šç‰ˆçš„æ»šåŠ¨ç‰ˆæœ¬ï¼Œä¸ä¿è¯å®Œå…¨ç¨³å®š</td>
</tr>
<tr>
<td><code>unstable</code></td>
<td>æ°¸è¿œæŒ‡å‘ <strong>sid</strong>ï¼Œå¼€å‘ä¸­ï¼Œä¸æ¨èç”Ÿäº§ä½¿ç”¨</td>
</tr>
<tr>
<td><code>experimental</code></td>
<td>å®éªŒæ€§åˆ†æ”¯ï¼Œé£é™©é«˜</td>
</tr>
</tbody></table>
<p>ğŸ‘‰ <strong>æ¨èé€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒï¼š<code>debian:bookworm-slim</code>ï¼ˆå°è€Œç¨³ï¼‰</li>
<li>è°ƒè¯•ç¯å¢ƒï¼š<code>debian:bookworm</code>ï¼ˆå¸¦å·¥å…·ï¼Œæ–¹ä¾¿æ’æŸ¥ï¼‰</li>
<li>å¯é‡å¤æ„å»ºï¼š<code>debian:bookworm-20240904</code>ï¼ˆå›ºå®šå¿«ç…§ï¼‰</li>
</ul>
<hr>
<h1 id="ğŸ·-Ubuntu-é•œåƒ-tag-è¯´æ˜"><a href="#ğŸ·-Ubuntu-é•œåƒ-tag-è¯´æ˜" class="headerlink" title="ğŸ· Ubuntu é•œåƒ tag è¯´æ˜"></a>ğŸ· Ubuntu é•œåƒ tag è¯´æ˜</h1><p>Ubuntu çš„ç‰ˆæœ¬éµå¾ª <strong>å¹´.æœˆ</strong> æ ¼å¼ï¼Œåˆ†ä¸º <strong>LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰</strong> å’Œ <strong>é LTSï¼ˆçŸ­æœŸæ”¯æŒï¼‰</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>Tag ç¤ºä¾‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>22.04</code>, <code>jammy</code></td>
<td>Ubuntu 22.04 LTSï¼ˆæ”¯æŒè‡³ 2027ï¼ŒExtended Security åˆ° 2032ï¼‰</td>
</tr>
<tr>
<td><code>20.04</code>, <code>focal</code></td>
<td>Ubuntu 20.04 LTSï¼ˆæ”¯æŒè‡³ 2025ï¼‰</td>
</tr>
<tr>
<td><code>18.04</code>, <code>bionic</code></td>
<td>Ubuntu 18.04 LTSï¼ˆæ”¯æŒè‡³ 2023ï¼‰</td>
</tr>
<tr>
<td><code>24.04</code>, <code>noble</code></td>
<td>Ubuntu 24.04 LTSï¼ˆæœ€æ–° LTSï¼Œæ”¯æŒè‡³ 2029ï¼‰</td>
</tr>
<tr>
<td><code>latest</code></td>
<td>å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼ˆâš ï¸ ä¸æ¨èç”Ÿäº§ç”¨ï¼Œå¯èƒ½éšæ—¶é—´å˜ï¼‰</td>
</tr>
<tr>
<td><code>22.04-slim</code></td>
<td>ç²¾ç®€ç‰ˆï¼Œä½“ç§¯æ›´å°</td>
</tr>
<tr>
<td><code>rolling</code></td>
<td>æ»šåŠ¨ç‰ˆæœ¬ï¼Œå§‹ç»ˆè·Ÿéšæœ€æ–°ç¨³å®šç‰ˆ</td>
</tr>
</tbody></table>
<p>ğŸ‘‰ <strong>æ¨èé€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒï¼š<code>ubuntu:22.04</code> æˆ– <code>ubuntu:22.04-slim</code></li>
<li>é•¿æœŸç»´æŠ¤ï¼š<code>ubuntu:24.04</code>ï¼ˆæ–° LTSï¼‰</li>
<li>å¿«é€Ÿè¯•éªŒï¼š<code>ubuntu:latest</code>ï¼ˆä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ï¼‰</li>
</ul>
<hr>
<h1 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h1><ul>
<li><strong>é¦–é€‰</strong>ï¼š<code>debian:bookworm-slim</code>ï¼ˆå°ã€ç¨³ã€å®‰å…¨æ›´æ–°å¿«ï¼‰</li>
<li><strong>éœ€è¦ LTS é•¿æœŸæ”¯æŒ</strong>ï¼š<code>ubuntu:22.04</code> æˆ– <code>ubuntu:24.04</code></li>
<li><strong>æå°é•œåƒ</strong>ï¼š<code>alpine:3.20</code>ï¼Œä½†è¦è€ƒè™‘å…¼å®¹æ€§é—®é¢˜</li>
<li><strong>ä¼ä¸š RHEL å…¼å®¹åœºæ™¯</strong>ï¼š<code>rockylinux:8</code> &#x2F; <code>almalinux:8</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/10/%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/10/%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">å†…å­˜ç›¸å…³ä¿¡æ¯æ•´ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-10 14:15:38" itemprop="dateCreated datePublished" datetime="2025-09-10T14:15:38+08:00">2025-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-11 15:09:05" itemprop="dateModified" datetime="2025-09-11T15:09:05+08:00">2025-09-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="slab"><a href="#slab" class="headerlink" title="slab"></a>slab</h2><ul>
<li>SUnreclaimï¼ˆéå¯å›æ”¶ slabï¼‰</li>
<li>SReclaimableï¼ˆå¯å›æ”¶ slab, å¦‚ inode&#x2F;dentry cacheï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#å‡ ä¸ªè®¡ç®—å…³ç³»</span><br><span class="line">#Slab = å†…æ ¸ç»´æŠ¤å¯¹è±¡çš„ç¼“å­˜ï¼ˆinodeã€dentryã€socket buffer ç­‰ï¼‰</span><br><span class="line">Slab = SReclaimable + SUnreclaim</span><br><span class="line">#å«ä¹‰</span><br><span class="line">SUnreclaim â€“ Non-reclaimable slab memory (kernel objects) å æ¯”ç¨³å®šï¼Œå†…æ ¸ä¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line">SReclaimable â€“ Potentially reclaimable slab memory (e.g., inode cache) å æ¯”è¾ƒé«˜ï¼Œå†…æ ¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line"></span><br><span class="line"># buff/cache å¯å›æ”¶å†…å­˜ï¼ŒSReclaimableé«˜ã€å›æ”¶æ…¢å¯æŒç»­å¢é«˜ï¼Œä»è€Œå‡ºç°â€œå¯å›æ”¶ä½†å®é™…ä¸Šå›æ”¶ä¸æ‰â€ </span><br><span class="line">buff/cache â‰ˆ Buffers + Cached + SReclaimable</span><br><span class="line"></span><br><span class="line">#MemAvailable</span><br><span class="line">MemAvailable â‰ˆ MemFree + Buffers + Cached + SReclaimable - ä¸€äº›ä¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line"></span><br><span class="line">#è§‚å¯Ÿæ–¹å¼ï¼š</span><br><span class="line">top</span><br><span class="line">watch -n1 &quot;grep -E &#x27;MemTotal|MemFree|MemAvailable|Cached|Slab|SReclaimable|SUnreclaim&#x27; /proc/meminfo&quot;</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å†…æ ¸å†…å­˜å‚æ•°</span><br><span class="line">sysctl -a | grep vm</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹slabä¿¡æ¯: cat /proc/slabinfo</span><br><span class="line">#çœ‹å…·ä½“å“ªäº› slab ç±»å‹æ¶¨å¾—å¤š,å¦‚æœ top å‡ é¡¹æ˜¯ dentry/inode_cache â†’ è¯´æ˜ VFS å…ƒæ•°æ®ã€‚</span><br><span class="line">cat /proc/slabinfo | egrep -i &#x27;dentry|inode|path|ext4|xfs&#x27; </span><br><span class="line"></span><br><span class="line">#æˆ–è€…å‘½ä»¤</span><br><span class="line">slabtop</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å†…å­˜å›æ”¶-vfs-cache-pressure"><a href="#å†…å­˜å›æ”¶-vfs-cache-pressure" class="headerlink" title="å†…å­˜å›æ”¶:vfs_cache_pressure"></a>å†…å­˜å›æ”¶:vfs_cache_pressure</h2><blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/ygq13572549874/article/details/148332587">https://blog.csdn.net/ygq13572549874/article/details/148332587</a> </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">cat /proc/sys/vm/vfs_cache_pressure</span><br><span class="line"></span><br><span class="line">å«ä¹‰ï¼šæ§åˆ¶å†…æ ¸å›æ”¶ inode å’Œ dentry ç¼“å­˜çš„å€¾å‘ç¨‹åº¦ï¼š</span><br><span class="line">- inode ç¼“å­˜ï¼šå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶æƒé™ã€æ‰€æœ‰è€…ã€æ—¶é—´æˆ³ç­‰ï¼‰</span><br><span class="line">- dentry ç¼“å­˜ï¼šå­˜å‚¨ç›®å½•é¡¹ç¼“å­˜ï¼ˆå¦‚æ–‡ä»¶ååˆ° inode çš„æ˜ å°„å…³ç³»ï¼‰</span><br><span class="line"></span><br><span class="line">å‚æ•°å€¼èŒƒå›´ä¸º 0-1000ï¼Œé»˜è®¤å€¼ä¸º 100ï¼š</span><br><span class="line">- å€¼è¶Šå°ï¼šå†…æ ¸è¶Šå€¾å‘äºä¿ç•™ inode/dentry ç¼“å­˜ï¼ˆå³ä½¿å†…å­˜ç´§å¼ ï¼‰</span><br><span class="line">- å€¼è¶Šå¤§ï¼šå†…æ ¸è¶Šå€¾å‘äºä¼˜å…ˆå›æ”¶ inode/dentry ç¼“å­˜</span><br><span class="line"></span><br><span class="line">å½“ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶ï¼Œå†…æ ¸éœ€è¦å†³å®šå¦‚ä½•å¹³è¡¡å›æ”¶ä¸åŒç±»å‹çš„ç¼“å­˜ï¼š</span><br><span class="line">- é¡µé¢ç¼“å­˜ï¼ˆpage cacheï¼‰ï¼šæ–‡ä»¶å†…å®¹çš„ç¼“å­˜</span><br><span class="line">- inode/dentry ç¼“å­˜ï¼šæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„ç¼“å­˜</span><br><span class="line">-äº¤æ¢ç©ºé—´ï¼ˆswapï¼‰ï¼šå†…å­˜åˆ°ç£ç›˜çš„äº¤æ¢</span><br></pre></td></tr></table></figure>

<h2 id="drop-caches"><a href="#drop-caches" class="headerlink" title="drop caches"></a>drop caches</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#drop cachesï¼ˆæµ‹è¯•æ˜¯å¦å¯å›æ”¶ï¼‰</span><br><span class="line"># 1=pagecache, 2=dentries+inodes, 3=both</span><br><span class="line">sudo sync</span><br><span class="line">sudo sh -c &#x27;echo 2 &gt; /proc/sys/vm/drop_caches&#x27;</span><br><span class="line"># ä¹‹åé‡æ–°æ£€æŸ¥ /proc/meminfo çš„ Slab/SReclaimable æ˜¯å¦æ˜¾è‘—ä¸‹é™</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/05/cgroup-namespace-vs-Kata/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/05/cgroup-namespace-vs-Kata/" class="post-title-link" itemprop="url">cgroup/namespace vs Kata</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-05 11:03:32 / ä¿®æ”¹æ—¶é—´ï¼š17:01:58" itemprop="dateCreated datePublished" datetime="2025-09-05T11:03:32+08:00">2025-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="æ¦‚å¿µå¿«é€Ÿæ¢³ç†"><a href="#æ¦‚å¿µå¿«é€Ÿæ¢³ç†" class="headerlink" title="æ¦‚å¿µå¿«é€Ÿæ¢³ç†"></a>æ¦‚å¿µå¿«é€Ÿæ¢³ç†</h2><ul>
<li>namespace (PID&#x2F;NET&#x2F;IPC&#x2F;UTS&#x2F;MNT&#x2F;USER&#x2F;â€¦) ï¼šLinux æä¾›çš„è¿›ç¨‹éš”ç¦»æœºåˆ¶ï¼ˆåå­—ç©ºé—´ï¼‰ï¼Œç”¨äºéš”ç¦»è¿›ç¨‹è§†è§’ï¼ˆPIDã€ç½‘ç»œå‘½åç©ºé—´ç­‰ï¼‰ã€‚</li>
<li>cgroup (control groups) ï¼šLinux æä¾›çš„èµ„æºæ§åˆ¶ï¼ˆCPU&#x2F;memory&#x2F;io&#x2F;pidsï¼‰ï¼Œç”¨äºé™åˆ¶ä¸è®¡é‡èµ„æºæ¶ˆè€—ã€‚</li>
<li>ä¼ ç»Ÿå®¹å™¨ (Docker&#x2F;runc etc.) ï¼šåŸºäºå•ä¸€å®¿ä¸»æœºå†…æ ¸ + namespaces + cgroupsï¼Œä¸ºåº”ç”¨æä¾›è½»é‡éš”ç¦»ã€‚</li>
<li>Kata Containersï¼šä¸ºå®¹å™¨æä¾›è½»é‡çº§è™šæ‹ŸåŒ–ï¼šæ¯ä¸ªå®¹å™¨æˆ– Pod è¿è¡Œåœ¨ä¸€ä¸ªè½»é‡ VMï¼ˆæœ‰ç‹¬ç«‹å†…æ ¸ï¼‰ï¼Œå…¼é¡¾ VM çš„å¼ºéš”ç¦»ä¸å®¹å™¨çš„é€Ÿåº¦ã€‚</li>
</ul>
<hr>
<h2 id="å…³é”®å·®åˆ«ï¼ˆå¯¹æ¯”è¡¨ï¼‰"><a href="#å…³é”®å·®åˆ«ï¼ˆå¯¹æ¯”è¡¨ï¼‰" class="headerlink" title="å…³é”®å·®åˆ«ï¼ˆå¯¹æ¯”è¡¨ï¼‰"></a>å…³é”®å·®åˆ«ï¼ˆå¯¹æ¯”è¡¨ï¼‰</h2><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th align="right">Namespaces + cgroups (ä¼ ç»Ÿå®¹å™¨)</th>
<th>Kata Containers (è½»é‡ VM)</th>
</tr>
</thead>
<tbody><tr>
<td>éš”ç¦»çº§åˆ«</td>
<td align="right">è¿›ç¨‹çº§éš”ç¦»ï¼ŒåŒä¸€å®¿ä¸»æœºå†…æ ¸å…±äº«</td>
<td>æ¯ä¸ª VM æœ‰è‡ªå·±å†…æ ¸ï¼ˆæ›´å¼ºçš„éš”ç¦»ï¼‰</td>
</tr>
<tr>
<td>å†…æ ¸ bug å½±å“</td>
<td align="right">å®¿ä¸»æœºå†…æ ¸ bug å¯èƒ½å½±å“æ‰€æœ‰å®¹å™¨</td>
<td>å®¢æˆ· VM å†…æ ¸é—®é¢˜é€šå¸¸ä»…å½±å“è¯¥ VMï¼ˆä¿æŠ¤å®¿ä¸»ï¼‰</td>
</tr>
<tr>
<td>å¯åŠ¨é€Ÿåº¦</td>
<td align="right">æå¿«ï¼ˆms ~ sï¼‰</td>
<td>è¾ƒæ…¢ï¼ˆs é‡çº§ï¼Œå–å†³äº runtime&#x2F;VMï¼‰</td>
</tr>
<tr>
<td>èµ„æºå¼€é”€</td>
<td align="right">å¾ˆä½ï¼ˆå…±äº«å†…æ ¸ï¼Œå°‘é‡ overheadï¼‰</td>
<td>è¾ƒé«˜ï¼ˆæ¯ VM æœ‰ qemu&#x2F;kvm ç­‰å¼€é”€ï¼‰</td>
</tr>
<tr>
<td>å®‰å…¨è¾¹ç•Œ</td>
<td align="right">ç”¨æˆ·æ€è¾ƒå¼±ï¼ˆå®¹å™¨é€ƒé€¸æœ‰å†å²ï¼‰</td>
<td>æ›´å¼ºï¼ˆç¡¬éš”ç¦»ï¼Œé€‚åˆå¤šç§Ÿæˆ·&#x2F;ä¸ä¿¡ä»»å·¥ä½œè´Ÿè½½ï¼‰</td>
</tr>
<tr>
<td>è°ƒè¯•ä¸è¿ç»´</td>
<td align="right">ä¸å®¿ä¸»ä¸€è‡´ï¼ˆ&#x2F;proc, cgroupï¼‰</td>
<td>VM å†…&#x2F;å®¿ä¸» åŒå±‚è°ƒè¯•ï¼Œå¤æ‚åº¦é«˜</td>
</tr>
<tr>
<td>å¯¹å• Pod å†…å­˜æ³„æ¼å½±å“</td>
<td align="right">æ³„æ¼åœ¨ host kernel&#x2F;user spaceï¼Œå¯ç›´æ¥å½±å“ host</td>
<td>æ³„æ¼é™åˆ¶åœ¨ VMï¼ˆè‹¥VMæœ‰ memory limit åˆ™å—é™ï¼‰</td>
</tr>
<tr>
<td>ä½¿ç”¨åœºæ™¯</td>
<td align="right">å¤§å¤šæ•°äº‘åŸç”Ÿåº”ç”¨ã€CI&#x2F;CDã€ä½å»¶è¿ŸæœåŠ¡</td>
<td>å¤šç§Ÿæˆ·ä¸”å¯¹å®‰å…¨æ•æ„Ÿã€éœ€è¦é˜²æ­¢å†…æ ¸çº§é£é™©æˆ–ç‰¹å®šå†…æ ¸ç‰ˆæœ¬éš”ç¦»çš„åœºæ™¯</td>
</tr>
</tbody></table>
<hr>
<h2 id="Kata-èƒ½å¦é¿å…å•ä¸šåŠ¡å¯¼è‡´å…¨ä¸»æœºæŒ‚æ‰ï¼Ÿ"><a href="#Kata-èƒ½å¦é¿å…å•ä¸šåŠ¡å¯¼è‡´å…¨ä¸»æœºæŒ‚æ‰ï¼Ÿ" class="headerlink" title="Kata èƒ½å¦é¿å…å•ä¸šåŠ¡å¯¼è‡´å…¨ä¸»æœºæŒ‚æ‰ï¼Ÿ"></a>Kata èƒ½å¦é¿å…å•ä¸šåŠ¡å¯¼è‡´å…¨ä¸»æœºæŒ‚æ‰ï¼Ÿ</h2><ul>
<li><strong>èƒ½æ˜¾è‘—é™ä½é£é™©</strong>ï¼šå¦‚æœé—®é¢˜æ˜¯<strong>å†…æ ¸çº§ bug</strong> æˆ–éœ€è¦ç‰¹æ®Šå†…æ ¸æ¨¡å—å‡ºé—®é¢˜ï¼ˆä¾‹å¦‚æŸäº›é©±åŠ¨ã€netfilter bugï¼‰ï¼Œåœ¨ Kata ä¸­å‘ç”Ÿæ—¶é€šå¸¸åªå½±å“è¯¥ VMï¼Œä¸ä¼šç›´æ¥å½±å“å®¿ä¸»æœºå†…æ ¸å’Œå…¶ä»– VM&#x2F;å®¹å™¨ã€‚  </li>
<li><strong>å¯¹ç”¨æˆ·ç©ºé—´å†…å­˜æ³„æ¼</strong>ï¼šå¦‚æœå•ä¸ª VM çš„è¿›ç¨‹æ³„æ¼å†…å­˜å¹¶ä¸”è¯¥ VM çš„å†…å­˜ä¸Šé™è¢«è®¾ç½®ï¼ˆä¾‹å¦‚ç»™ VM åˆ†é… 4Giï¼‰ï¼Œåˆ™æ³„æ¼ä¼šè€—å°½è¯¥ VM å†…å­˜å¹¶å¯¼è‡´ VM å†… OOMï¼Œä½†ä¸ä¼šç›´æ¥è€—å°½å®¿ä¸»æ•´å°æœºå™¨çš„å†…å­˜ï¼ˆåªè¦å®¿ä¸»ä¸Šæ²¡æœ‰è¢«é…ç½®è¿‡å¤§çš„ VM æ•°é‡ï¼‰ã€‚  </li>
<li><strong>æ³¨æ„</strong>ï¼šå¤§é‡ Kata VM è¢«åŒæ—¶å¯åŠ¨ä¸”æ¯ä¸ªéƒ½æ³„æ¼ï¼Œä»ç„¶èƒ½ç”¨å°½å®¿ä¸»èµ„æº â€”â€” å› æ­¤ä»éœ€ä¸Šå±‚èµ„æºé™åˆ¶ &amp; è°ƒåº¦ç­–ç•¥ã€‚</li>
</ul>
<hr>
<h2 id="ä»€ä¹ˆæ—¶å€™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨-Kataï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨-Kataï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Kataï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Kataï¼Ÿ</h2><ul>
<li>å¤šç§Ÿæˆ·å¹³å°ï¼ˆæ¯ç§Ÿæˆ·ä»£ç ä¸ä¿¡ä»»ï¼‰ï¼Œéœ€è¦å¼ºå†…æ ¸éš”ç¦»ã€‚  </li>
<li>è¿è¡Œéœ€è¦è‡ªå®šä¹‰&#x2F;ä¸åŒå†…æ ¸ç‰ˆæœ¬æˆ–ç‰¹æ®Šå†…æ ¸æ¨¡å—çš„ workloadï¼Œé¿å…å®¿ä¸»å†…æ ¸æ±¡æŸ“ã€‚  </li>
<li>æ³•è§„æˆ–å®‰å…¨è¦æ±‚å¿…é¡»ä¸¥æ ¼éš”ç¦»ï¼ˆä¾‹å¦‚é‡‘è &#x2F; åŒ»ç–— &#x2F; éšç§æ•æ„Ÿåœºæ™¯ï¼‰ã€‚  </li>
<li>éœ€è¦å…¼é¡¾å®¹å™¨åŒ–ä¾¿æ·æ€§ä¸ VM çº§å®‰å…¨è¾¹ç•Œã€‚</li>
</ul>
<hr>
<h2 id="è¿ç»´ä¸æ’æŸ¥å·®å¼‚"><a href="#è¿ç»´ä¸æ’æŸ¥å·®å¼‚" class="headerlink" title="è¿ç»´ä¸æ’æŸ¥å·®å¼‚"></a>è¿ç»´ä¸æ’æŸ¥å·®å¼‚</h2><ul>
<li><strong>ä¼ ç»Ÿå®¹å™¨</strong>ï¼š<ul>
<li>ä¼˜åŠ¿ï¼šç›´æ¥æŸ¥çœ‹å®¿ä¸» <code>/sys/fs/cgroup</code>ã€<code>/proc</code> æ¥è¯Šæ–­ container å†…èµ„æºä½¿ç”¨ï¼ˆæ›´ç›´è§‚ï¼‰ã€‚  </li>
<li>å¸¸ç”¨å·¥å…·ï¼š<code>docker ps</code>&#x2F;<code>ctr</code>ã€<code>systemd-cgls</code>ã€<code>cat cgroup memory.stat</code>ã€‚</li>
</ul>
</li>
<li><strong>Kata</strong>ï¼š<ul>
<li>ä½ éœ€è¦åœ¨<strong>å®¿ä¸»å±‚</strong>å’Œ<strong>Guest VM å±‚</strong>éƒ½æ’æŸ¥ï¼šå®¿ä¸»å±‚çœ‹ VM è¿›ç¨‹ã€èµ„æºåˆ†é…ï¼Œguest å†…çœ‹åº”ç”¨è¡Œä¸ºã€‚  </li>
<li>æ›´å¤æ‚ï¼šä¸¤å±‚æ—¥å¿—ã€ä¸¤å±‚æŒ‡æ ‡ï¼Œä½†éš”ç¦»æ€§æ›´å¥½ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="å®è·µå»ºè®®ï¼ˆåŸºäºåœºæ™¯ï¼‰"><a href="#å®è·µå»ºè®®ï¼ˆåŸºäºåœºæ™¯ï¼‰" class="headerlink" title="å®è·µå»ºè®®ï¼ˆåŸºäºåœºæ™¯ï¼‰"></a>å®è·µå»ºè®®ï¼ˆåŸºäºåœºæ™¯ï¼‰</h2><ol>
<li><strong>å¤§å¤šæ•°åº”ç”¨</strong>ï¼šå…ˆç”¨ä¼ ç»Ÿå®¹å™¨ + ä¸¥æ ¼ cgroup &#x2F; kubelet eviction &#x2F;èµ„æºé™é¢ã€‚  </li>
<li><strong>ä¸ä¿¡ä»»ç§Ÿæˆ· &#x2F; å¼ºéš”ç¦»</strong>ï¼šç”¨ Kataï¼ˆæˆ– VM-based multi-tenantï¼‰å¹¶ä¸ºæ¯ VM è®¾ç½®åˆç†å†…å­˜ä¸Šé™ã€‚  </li>
<li><strong>IO &#x2F; å­˜å‚¨æ•æ„Ÿ</strong>ï¼šä¼˜åŒ–åç«¯å­˜å‚¨ã€è®¾ç½® <code>vm.dirty_*</code> é™é¢ã€åœ¨ runtime å±‚é…åˆ QoS é™åˆ¶ã€‚  </li>
<li><strong>æ··åˆéƒ¨ç½²</strong>ï¼šæŠŠé«˜é£é™©å·¥ä½œè´Ÿè½½æ”¾ Kataï¼Œæ™®é€šæœåŠ¡æ”¾å®¹å™¨ï¼Œå‡å°‘æ€»ä½“æˆæœ¬ã€‚</li>
</ol>
<hr>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><ul>
<li><code>cgroup + namespace</code> æä¾›é«˜æ•ˆã€ä½å¼€é”€çš„å¤šç§Ÿæˆ·èƒ½åŠ›ï¼Œé€‚åˆç»å¤§å¤šæ•°äº‘åŸç”Ÿåœºæ™¯ï¼›  </li>
<li><code>Kata</code> åœ¨<strong>å¼ºéš”ç¦»</strong>ä¸<strong>å®‰å…¨</strong>åœºæ™¯ä¸‹èƒœå‡ºï¼Œä½†æœ‰æˆæœ¬ä¸è¿ç»´å¤æ‚åº¦ï¼Œéœ€æƒè¡¡ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/05/%E5%86%85%E5%AD%98%E5%9B%9E%E5%86%99-%E8%84%8F%E9%A1%B5-%E5%9B%9E%E6%94%B6-OOM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/05/%E5%86%85%E5%AD%98%E5%9B%9E%E5%86%99-%E8%84%8F%E9%A1%B5-%E5%9B%9E%E6%94%B6-OOM/" class="post-title-link" itemprop="url">å†…å­˜å›å†™/è„é¡µ/å›æ”¶/OOM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-05 10:47:51 / ä¿®æ”¹æ—¶é—´ï¼š10:48:07" itemprop="dateCreated datePublished" datetime="2025-09-05T10:47:51+08:00">2025-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å†…å­˜å›å†™-è„é¡µ-å›æ”¶-OOM-â€”-å…¨æµç¨‹è¯´æ˜ä¸æ’æŸ¥æŒ‡å—"><a href="#å†…å­˜å›å†™-è„é¡µ-å›æ”¶-OOM-â€”-å…¨æµç¨‹è¯´æ˜ä¸æ’æŸ¥æŒ‡å—" class="headerlink" title="å†…å­˜å›å†™ &#x2F; è„é¡µ &#x2F; å›æ”¶ &#x2F; OOM â€” å…¨æµç¨‹è¯´æ˜ä¸æ’æŸ¥æŒ‡å—"></a>å†…å­˜å›å†™ &#x2F; è„é¡µ &#x2F; å›æ”¶ &#x2F; OOM â€” å…¨æµç¨‹è¯´æ˜ä¸æ’æŸ¥æŒ‡å—</h1><h2 id="æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰"><a href="#æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰" class="headerlink" title="æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰"></a>æ¦‚è§ˆï¼ˆä¸€å¥è¯ï¼‰</h2><p>ç”¨æˆ·è¿›ç¨‹å†™æ•°æ® â†’ æ•°æ®å…ˆå†™å…¥é¡µç¼“å­˜ï¼ˆpage cacheï¼‰æˆä¸º <em>dirty pages</em> â†’ å†…æ ¸å¼‚æ­¥å›å†™ï¼ˆwritebackï¼‰åˆ°ç£ç›˜ â†’ è‹¥ç£ç›˜&#x2F;åç«¯æ…¢æˆ–å†™å…¥é€Ÿç‡ä½äºç”Ÿæˆé€Ÿç‡ï¼Œdirty å°†ç§¯ç´¯ â†’ å†…å­˜å›æ”¶ï¼ˆkswapdï¼‰å°è¯•å›æ”¶æˆ–è§¦å‘å†™å›å¹¶é˜»å¡å†™è€… â†’ è‹¥å›æ”¶å¤±è´¥å¹¶è€—å°½å†…å­˜ï¼ŒOOM killer æ ¹æ®ç­–ç•¥é€‰æ‹©å¹¶æ€æ­»è¿›ç¨‹ &#x2F; cgroupã€‚</p>
<hr>
<h2 id="ä¸€ã€å…³é”®æ¦‚å¿µï¼ˆå¿«é€Ÿå›é¡¾ï¼‰"><a href="#ä¸€ã€å…³é”®æ¦‚å¿µï¼ˆå¿«é€Ÿå›é¡¾ï¼‰" class="headerlink" title="ä¸€ã€å…³é”®æ¦‚å¿µï¼ˆå¿«é€Ÿå›é¡¾ï¼‰"></a>ä¸€ã€å…³é”®æ¦‚å¿µï¼ˆå¿«é€Ÿå›é¡¾ï¼‰</h2><ul>
<li>**é¡µç¼“å­˜ (page cache)**ï¼šæ–‡ä»¶&#x2F;å— IO çš„ç¼“å­˜å±‚ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ <code>struct page</code>ã€‚</li>
<li><strong>Dirty pages</strong>ï¼šå·²ä¿®æ”¹ä½†å°šæœªå†™å›åˆ°ç£ç›˜çš„é¡µï¼ˆå ç”¨å†…å­˜ï¼Œå¯å†™å›ï¼‰ã€‚</li>
<li><strong>Writeback</strong>ï¼šå†…æ ¸å°† dirty page å†™å›å­˜å‚¨ï¼ˆç”± writeback kthreads &#x2F; flush workers æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>kswapd &#x2F; page reclaim</strong>ï¼šå½“å†…å­˜ç´§å¼ æ—¶å›æ”¶å¯å›æ”¶é¡µï¼ˆåŒ…æ‹¬è§¦å‘ writebackï¼‰ã€‚</li>
<li><strong>OOM killer</strong>ï¼šå½“å†…æ ¸æ— æ³•æ»¡è¶³åˆ†é…ä¸”æ— æ³•å›æ”¶ï¼Œé€‰æ‹©è¿›ç¨‹ä½œä¸ºç‰ºç‰²è€…ï¼ˆåŸºäº <code>oom_score</code>ã€<code>oom_score_adj</code>ã€cgroupï¼‰å¹¶ç»ˆæ­¢ä¹‹ã€‚</li>
<li><strong>cgroup v1&#x2F;v2</strong>ï¼šå®¹å™¨èµ„æºé™åˆ¶æœºåˆ¶ï¼Œå†…å­˜è¶…é™ä¼šè§¦å‘ cgroup OOM è¡Œä¸ºã€‚</li>
</ul>
<hr>
<h2 id="äºŒã€å…¸å‹è§¦å‘è·¯å¾„ï¼ˆæ›´è¯¦ç»†ï¼‰"><a href="#äºŒã€å…¸å‹è§¦å‘è·¯å¾„ï¼ˆæ›´è¯¦ç»†ï¼‰" class="headerlink" title="äºŒã€å…¸å‹è§¦å‘è·¯å¾„ï¼ˆæ›´è¯¦ç»†ï¼‰"></a>äºŒã€å…¸å‹è§¦å‘è·¯å¾„ï¼ˆæ›´è¯¦ç»†ï¼‰</h2><ol>
<li><p><strong>ç”¨æˆ·è¿›ç¨‹ write()</strong>  </p>
<ul>
<li>å†…æ ¸åœ¨ page cache åˆ†é…&#x2F;è·å– pageï¼Œå¤åˆ¶æ•°æ®åˆ° pageï¼Œç„¶åæ ‡è®°ä¸º <code>dirty</code>ã€‚</li>
<li>write è¿”å›å¿«ï¼ˆå†™å…¥å†…å­˜ï¼‰ï¼Œä¸ç­‰ç£ç›˜å†™å®Œ -&gt; å†™å…¥ååé«˜ä½†å»¶è¿Ÿä½ã€‚</li>
</ul>
</li>
<li><p><strong>åå° writeback</strong>  </p>
<ul>
<li>å†…æ ¸å‘¨æœŸæ€§&#x2F;é˜ˆå€¼è§¦å‘ writebackï¼ˆ<code>vm.dirty_background_ratio</code> &#x2F; <code>vm.dirty_ratio</code> æˆ–ç»å¯¹é‡ <code>vm.dirty_bytes</code>ï¼‰ã€‚</li>
<li>writeback ç”±å†…æ ¸ kthreads æ‰§è¡Œï¼Œå¼‚æ­¥æŠŠé¡µå†™åˆ°å—è®¾å¤‡æˆ–é€šè¿‡ NFS&#x2F;CIFS&#x2F;CSI ç­‰ä¸Šæ¸¸ã€‚</li>
</ul>
</li>
<li><p><strong>å½“ writeback è·Ÿä¸ä¸Š</strong>  </p>
<ul>
<li>è‹¥äº§ç”Ÿ dirty çš„é€Ÿåº¦ &gt; å†™å›é€Ÿåº¦ï¼ˆä¾‹å¦‚ç£ç›˜æ…¢&#x2F;IO å¡ä½ï¼‰ï¼Œdirty ä¼šç´¯ç§¯ã€‚</li>
<li>ä¸€æ—¦è¾¾åˆ° <code>vm.dirty_ratio</code>ï¼Œå†™è€…å¯èƒ½è¢«å¼ºåˆ¶é˜»å¡ï¼ˆåŒæ­¥åœ° flushï¼‰ï¼Œå¯¼è‡´å¤§é‡è¿›ç¨‹é˜»å¡åœ¨ D (uninterruptible sleep) çŠ¶æ€ã€‚</li>
<li>IO é•¿æ—¶é—´é˜»å¡ä¼šä½¿ç³»ç»Ÿå“åº”å˜å·®ï¼ˆssh å¡ã€syscalls å¡ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>å†…å­˜å›æ”¶ä¸ OOM</strong>  </p>
<ul>
<li>kswapd&#x2F;ç›´æ¥åˆ†é…è€…è§¦å‘å›æ”¶ï¼Œå›æ”¶ä¼˜å…ˆå›æ”¶å¯å›æ”¶çš„ç¼“å­˜é¡µæˆ–å›å†™è„é¡µã€‚</li>
<li>å¦‚æœå›æ”¶ä»ç„¶ä¸èƒ½æ»¡è¶³å†…å­˜è¯·æ±‚ï¼Œå†…æ ¸è§¦å‘ OOM killerï¼Œé€‰æ‹©æœ€åˆé€‚çš„ victimï¼ˆå‚è€ƒ oom_score, oom_score_adj, oom_badness ä»¥åŠ cgroup æƒé‡ï¼‰ï¼Œå¹¶æ€æ‰è¿›ç¨‹ã€‚</li>
<li>åœ¨ cgroup v2 ä¸‹ï¼Œè‹¥ cgroup è¾¾åˆ° <code>memory.max</code>ï¼Œå¯èƒ½åªæ€è¯¥ cgroup å†…çš„è¿›ç¨‹ï¼ˆcgroup OOMï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ä¸‰ã€å’Œ-buff-cache-MemAvailable-çš„å¸¸è§è¯¯è§£"><a href="#ä¸‰ã€å’Œ-buff-cache-MemAvailable-çš„å¸¸è§è¯¯è§£" class="headerlink" title="ä¸‰ã€å’Œ buff/cache &#x2F; MemAvailable çš„å¸¸è§è¯¯è§£"></a>ä¸‰ã€å’Œ <code>buff/cache</code> &#x2F; <code>MemAvailable</code> çš„å¸¸è§è¯¯è§£</h2><ul>
<li><code>buff/cache</code> é«˜ <strong>ä¸ç­‰äº</strong> å¯ç”¨æ€§ä½ï¼›<code>buff/cache</code> æ˜¯å¯å›æ”¶çš„ï¼ˆé€šå¸¸ï¼‰ã€‚  </li>
<li>ä½†å½“è„é¡µéå¸¸å¤šæˆ– slabï¼ˆå†…æ ¸å¯¹è±¡ï¼‰æ³„æ¼æ—¶ï¼Œå†…å­˜æ˜¯â€œä¸å¯å›æ”¶â€çš„ â†’ å³ä¾¿ <code>MemAvailable</code> æš‚æ—¶æ˜¾ç¤ºä¸æ˜¯ 0ï¼Œä¹Ÿå¯èƒ½å›æ”¶å¤±è´¥å¯¼è‡´å‡æ­»ã€‚  </li>
<li>åŒºåˆ†ç‚¹ï¼šçœ‹ <code>Dirty</code>&#x2F;<code>Writeback</code> ä¸ <code>SReclaimable</code> &#x2F; <code>SUnreclaim</code>ï¼ˆ<code>/proc/meminfo</code> ä¸ <code>slabtop</code>ï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="å››ã€å®æ“æ’æŸ¥æ¸…å•ï¼ˆä»è½»åˆ°é‡ï¼‰"><a href="#å››ã€å®æ“æ’æŸ¥æ¸…å•ï¼ˆä»è½»åˆ°é‡ï¼‰" class="headerlink" title="å››ã€å®æ“æ’æŸ¥æ¸…å•ï¼ˆä»è½»åˆ°é‡ï¼‰"></a>å››ã€å®æ“æ’æŸ¥æ¸…å•ï¼ˆä»è½»åˆ°é‡ï¼‰</h2><h3 id="1-å¿«é€ŸæŸ¥çœ‹å†…å­˜-è„é¡µ-å›å†™"><a href="#1-å¿«é€ŸæŸ¥çœ‹å†…å­˜-è„é¡µ-å›å†™" class="headerlink" title="1) å¿«é€ŸæŸ¥çœ‹å†…å­˜&#x2F;è„é¡µ&#x2F;å›å†™"></a>1) å¿«é€ŸæŸ¥çœ‹å†…å­˜&#x2F;è„é¡µ&#x2F;å›å†™</h3><pre><code class="bash">free -h
cat /proc/meminfo | egrep &#39;Dirty|Writeback|MemAvailable|Cached|Buffers|SUnreclaim|Slab|Swap&#39;
cat /proc/vmstat | egrep &#39;pgfault|pgmajfault|pgscan|pgsteal|nr_dirty|nr_writeback&#39;
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/01/%E9%83%A8%E7%BD%B2kube-prometheus-stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/01/%E9%83%A8%E7%BD%B2kube-prometheus-stack/" class="post-title-link" itemprop="url">éƒ¨ç½²kube-prometheus-stack</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-01 10:05:32 / ä¿®æ”¹æ—¶é—´ï¼š10:12:16" itemprop="dateCreated datePublished" datetime="2025-09-01T10:05:32+08:00">2025-09-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="éƒ¨ç½²æ­¥éª¤"><a href="#éƒ¨ç½²æ­¥éª¤" class="headerlink" title="éƒ¨ç½²æ­¥éª¤"></a>éƒ¨ç½²æ­¥éª¤</h2><h3 id="1ã€åŠ è½½ä»“åº“"><a href="#1ã€åŠ è½½ä»“åº“" class="headerlink" title="1ã€åŠ è½½ä»“åº“"></a>1ã€åŠ è½½ä»“åº“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br><span class="line">helm search repo prometheus-community/kube-prometheus-stack </span><br><span class="line">helm pull prometheus-community/kube-prometheus-stack</span><br></pre></td></tr></table></figure>

<h3 id="2ã€ä¿®æ”¹é•œåƒ"><a href="#2ã€ä¿®æ”¹é•œåƒ" class="headerlink" title="2ã€ä¿®æ”¹é•œåƒ"></a>2ã€ä¿®æ”¹é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf kube-prometheus-stack-77.0.2.tgz</span><br><span class="line">helm template ./kube-prometheus-stack &gt; kube-prometheus-stack.yaml</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å½“å‰é•œåƒ</span><br><span class="line">cat kube-prometheus-stack.yaml  | grep -w image:</span><br></pre></td></tr></table></figure>

<h3 id="3ã€æ›¿æ¢é•œåƒ"><a href="#3ã€æ›¿æ¢é•œåƒ" class="headerlink" title="3ã€æ›¿æ¢é•œåƒ"></a>3ã€æ›¿æ¢é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">set -euo pipefail</span><br><span class="line"></span><br><span class="line"># ç›®æ ‡ç§æœ‰ä»“åº“å‰ç¼€</span><br><span class="line">HARBOR_REGISTRY=&quot;harborqa.xxx.net/xxx&quot;</span><br><span class="line"></span><br><span class="line"># å¾…åŒæ­¥çš„é•œåƒåˆ—è¡¨</span><br><span class="line">IMAGES=(</span><br><span class="line">  &quot;quay.io/prometheus/node-exporter:v1.9.1&quot;</span><br><span class="line">  &quot;quay.io/kiwigrid/k8s-sidecar:1.30.3&quot;</span><br><span class="line">  &quot;docker.io/grafana/grafana:12.1.0&quot;</span><br><span class="line">  &quot;registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.16.0&quot;</span><br><span class="line">  &quot;quay.io/prometheus-operator/prometheus-operator:v0.85.0&quot;</span><br><span class="line">  &quot;quay.io/prometheus-operator/prometheus-config-reloader:v0.85.0&quot;</span><br><span class="line">  &quot;quay.io/prometheus/alertmanager:v0.28.1&quot;</span><br><span class="line">  &quot;quay.io/prometheus/prometheus:v3.5.0&quot;</span><br><span class="line">  &quot;docker.io/bats/bats:v1.4.1&quot;</span><br><span class="line">  &quot;registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.6.1&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">for IMAGE in &quot;$&#123;IMAGES[@]&#125;&quot;; do</span><br><span class="line">  echo &quot;&gt;&gt;&gt; å¤„ç†é•œåƒ: $IMAGE&quot;</span><br><span class="line"></span><br><span class="line">  # åˆ†å‰² repo ä¸ tag</span><br><span class="line">  NAME_TAG=&quot;$&#123;IMAGE##*/&#125;&quot;          # e.g. prometheus:v3.5.0</span><br><span class="line">  NAME=&quot;$&#123;NAME_TAG%%:*&#125;&quot;           # e.g. prometheus</span><br><span class="line">  TAG=&quot;$&#123;NAME_TAG##*:&#125;&quot;            # e.g. v3.5.0</span><br><span class="line"></span><br><span class="line">  # æå–ä»“åº“è·¯å¾„ï¼ˆå»æ‰å‰ç¼€ registryï¼‰</span><br><span class="line">  REPO_PATH=$(echo &quot;$IMAGE&quot; | cut -d&#x27;/&#x27; -f2- | cut -d&#x27;:&#x27; -f1)</span><br><span class="line"></span><br><span class="line">  # æ„é€ ç›®æ ‡é•œåƒ</span><br><span class="line">  TARGET=&quot;$&#123;HARBOR_REGISTRY&#125;/$&#123;REPO_PATH&#125;:$&#123;TAG&#125;&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;æ‹‰å–é•œåƒ: $IMAGE&quot;</span><br><span class="line">  docker pull &quot;$IMAGE&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;æ‰“æ ‡ç­¾: $IMAGE -&gt; $TARGET&quot;</span><br><span class="line">  docker tag &quot;$IMAGE&quot; &quot;$TARGET&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;æ¨é€åˆ°ç§æœ‰ä»“åº“: $TARGET&quot;</span><br><span class="line">  docker push &quot;$TARGET&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;æ¸…ç†æœ¬åœ°é•œåƒ: $IMAGE&quot;</span><br><span class="line">  docker rmi &quot;$IMAGE&quot; || true</span><br><span class="line">  echo &quot;=== å®Œæˆ $IMAGE ===&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="4ã€ä¿®æ”¹é•œåƒ"><a href="#4ã€ä¿®æ”¹é•œåƒ" class="headerlink" title="4ã€ä¿®æ”¹é•œåƒ"></a>4ã€ä¿®æ”¹é•œåƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak \</span><br><span class="line">    -e &#x27;s#quay.io#harborqa.xxx.net/xxx#g&#x27; \</span><br><span class="line">    -e &#x27;s#docker.io#harborqa.xxx.net/xxx#g&#x27; \</span><br><span class="line">    -e &#x27;s#registry.k8s.io#harborqa.xxx.net/xxx#g&#x27; \</span><br><span class="line">    kube-prometheus-stack.yaml</span><br></pre></td></tr></table></figure>
<h3 id="5ã€å®‰è£…éƒ¨ç½²"><a href="#5ã€å®‰è£…éƒ¨ç½²" class="headerlink" title="5ã€å®‰è£…éƒ¨ç½²"></a>5ã€å®‰è£…éƒ¨ç½²</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k apply -f kube-prometheus-stack.yaml</span><br></pre></td></tr></table></figure>
<h3 id="6ã€è®¿é—®grafana"><a href="#6ã€è®¿é—®grafana" class="headerlink" title="6ã€è®¿é—®grafana"></a>6ã€è®¿é—®grafana</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#æµè§ˆå™¨è®¿é—®ï¼š release-name-grafana-xxx-xxx pod ip ï¼š</span><br><span class="line">#eg: 11.123.243.66:3000</span><br><span class="line">#æŸ¥çœ‹å¯†ç </span><br><span class="line">#ç”¨æˆ·åï¼šadmin</span><br><span class="line">kubectl get secret release-name-grafana -n monitoring -o jsonpath=&quot;&#123;.data.admin-password&#125;&quot; | base64 -d</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="shispring"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">shispring</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">178</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shispring</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
