<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shispring.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://shispring.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="shispring">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://shispring.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources" rel="section"><i class="fa fa-download fa-fw"></i>èµ„æº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/11/05/%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E6%B1%87%E6%80%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/05/%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E6%B1%87%E6%80%BB/" class="post-title-link" itemprop="url">è®¾å¤‡ä¿¡æ¯æ±‡æ€»</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-05 10:53:50 / ä¿®æ”¹æ—¶é—´ï¼š11:13:31" itemprop="dateCreated datePublished" datetime="2025-11-05T10:53:50+08:00">2025-11-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="NUMAæ¶æ„lstopoæ˜¾ç¤ºç³»ç»Ÿæ‹“æ‰‘"><a href="#NUMAæ¶æ„lstopoæ˜¾ç¤ºç³»ç»Ÿæ‹“æ‰‘" class="headerlink" title="NUMAæ¶æ„lstopoæ˜¾ç¤ºç³»ç»Ÿæ‹“æ‰‘"></a>NUMAæ¶æ„lstopoæ˜¾ç¤ºç³»ç»Ÿæ‹“æ‰‘</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://cloud-atlas.readthedocs.io/zh-cn/latest/kernel/memory/numa/lstopo.html">https://cloud-atlas.readthedocs.io/zh-cn/latest/kernel/memory/numa/lstopo.html</a> </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">yum install -y hwloc hwloc-gui</span><br><span class="line"></span><br><span class="line">#æ–‡å­—è¡¨è¿°</span><br><span class="line">lstopo</span><br><span class="line"></span><br><span class="line">#ascii art æ ¼å¼è¾“å‡º</span><br><span class="line">lstopo --of ascii -p</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆ PNG å›¾ç‰‡</span><br><span class="line">lstopo --of png /root/topo.png</span><br><span class="line"></span><br><span class="line"># æˆ–è€…æ›´ç®€å•çš„å†™æ³•ï¼ˆè‡ªåŠ¨æ ¹æ®åç¼€è¯†åˆ«æ ¼å¼ï¼‰</span><br><span class="line">lstopo /root/topo.png</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆ SVG çŸ¢é‡å›¾ï¼ˆæ¨èï¼Œæ¸…æ™°ä¸”å¯æ”¾å¤§ï¼‰</span><br><span class="line">lstopo /root/topo.svg</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆ PDF æ ¼å¼</span><br><span class="line">lstopo /root/topo.pdf</span><br><span class="line"></span><br><span class="line"># æ‹“æ‰‘åŒ…å«æ‰€æœ‰ PCIe / ç½‘å¡è®¾å¤‡ä¿¡æ¯</span><br><span class="line">lstopo --whole-io topo-full.svg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ç”Ÿæˆä¸€å¼ å¸¦ç¼–å·ã€æ•´é½å¸ƒå±€çš„å›¾ï¼š</span><br><span class="line">lstopo --whole-io --rect --fontsize 9 --gridsize 8 /root/topo.svg</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆå¸¦ç½‘å¡çš„å®Œæ•´ NUMA + PCIe æ‹“æ‰‘å›¾</span><br><span class="line">sudo lstopo --whole-system --whole-io --rect --fontsize 9 --gridsize 8 /root/topo.svg</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å¯é€‰ç¾åŒ–ä¸è°ƒæ•´å‚æ•°"><a href="#å¯é€‰ç¾åŒ–ä¸è°ƒæ•´å‚æ•°" class="headerlink" title="å¯é€‰ç¾åŒ–ä¸è°ƒæ•´å‚æ•°"></a>å¯é€‰ç¾åŒ–ä¸è°ƒæ•´å‚æ•°</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>--fontsize 10</code></td>
<td>è°ƒæ•´å­—ä½“å¤§å°</td>
</tr>
<tr>
<td><code>--gridsize 10</code></td>
<td>æ§åˆ¶å…ƒç´ é—´è·</td>
</tr>
<tr>
<td><code>--rect</code></td>
<td>ä½¿ç”¨çŸ©å½¢å¸ƒå±€ï¼ˆæ›´è§„æ•´ï¼‰</td>
</tr>
<tr>
<td><code>--horiz</code> &#x2F; <code>--vert</code></td>
<td>å¼ºåˆ¶æ°´å¹³æˆ–å‚ç›´å¸ƒå±€</td>
</tr>
<tr>
<td><code>--physical</code></td>
<td>æ˜¾ç¤ºç‰©ç† CPU æ ¸ç¼–å·</td>
</tr>
<tr>
<td><code>--logical</code></td>
<td>æ˜¾ç¤ºé€»è¾‘ç¼–å·ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
</tbody></table>
<h3 id="ç¬¦å·è¯´æ˜"><a href="#ç¬¦å·è¯´æ˜" class="headerlink" title="ç¬¦å·è¯´æ˜"></a>ç¬¦å·è¯´æ˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PU P# æ˜¯å¤„ç†å•å…ƒå¤„ç†å™¨</span><br><span class="line">L#i ä»£è¡¨æŒ‡ä»¤é«˜é€Ÿç¼“å­˜ã€‚</span><br><span class="line">L#d ä»£è¡¨æ•°æ®é«˜é€Ÿç¼“å­˜ã€‚</span><br><span class="line">L1 ä»£è¡¨1çº§ç¼“å­˜ã€‚</span><br><span class="line">L2 ä»£è¡¨ç¬¬2çº§é«˜é€Ÿç¼“å­˜ã€‚</span><br><span class="line">L3 ä»£è¡¨ä¸‰çº§ç¼“å­˜</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/11/04/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/04/%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ç³»ç»Ÿåˆ†æ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-04 15:05:10 / ä¿®æ”¹æ—¶é—´ï¼š15:22:05" itemprop="dateCreated datePublished" datetime="2025-11-04T15:05:10+08:00">2025-11-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç³»ç»Ÿåˆ†æ"><a href="#ç³»ç»Ÿåˆ†æ" class="headerlink" title="ç³»ç»Ÿåˆ†æ"></a>ç³»ç»Ÿåˆ†æ</h2><blockquote>
<p>è¦†ç›–äº†ç½‘å¡ã€NUMAã€ä¸­æ–­ã€CPUç»‘å®šã€CPUè½¯ä¸­æ–­åˆ†å¸ƒã€I&#x2F;Oè´Ÿè½½(pidstat&#x2F;iostat)ã€é˜Ÿåˆ—ä¸ä¸­æ–­ç»‘å®šåˆ†æ</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"># ------------------------------------------------------------</span><br><span class="line"># ç½‘ç»œ + NUMA + CPU + ä¸­æ–­ ç»¼åˆæ’æŸ¥è„šæœ¬</span><br><span class="line"># ------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">NIC=$&#123;1:-eth2&#125;   # é»˜è®¤ç½‘å¡ eth2ï¼Œå¯é€šè¿‡å‚æ•°æŒ‡å®š</span><br><span class="line">echo -e &quot;\n\033[1;36m&gt;&gt;&gt; å¼€å§‹åˆ†æç½‘å¡: $NIC\033[0m&quot;</span><br><span class="line">echo &quot;------------------------------------------------------------&quot;</span><br><span class="line"></span><br><span class="line"># ========== 1. åŸºç¡€ç¡¬ä»¶ä¸NUMAç»“æ„ ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[1] NUMAä¸CPUæ‹“æ‰‘ä¿¡æ¯\033[0m&quot;</span><br><span class="line">lscpu | egrep &quot;Model name|Socket|Core|Thread|NUMA&quot;</span><br><span class="line">echo</span><br><span class="line">numactl --hardware | grep -E &quot;available:|node [0-9]+ cpus:&quot;</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">if [ -f &quot;/sys/class/net/$NIC/device/numa_node&quot; ]; then</span><br><span class="line">    NUMA_NODE=$(cat /sys/class/net/$NIC/device/numa_node)</span><br><span class="line">    echo &quot;ğŸ§© ç½‘å¡ $NIC å±äº NUMA èŠ‚ç‚¹: $NUMA_NODE&quot;</span><br><span class="line">    NODE_CPUS=$(cat /sys/devices/system/node/node$&#123;NUMA_NODE&#125;/cpulist)</span><br><span class="line">    echo &quot;ğŸ§  å¯¹åº” NUMA èŠ‚ç‚¹CPUåˆ—è¡¨: $NODE_CPUS&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;âš ï¸ æœªæ‰¾åˆ° $NIC çš„ NUMA èŠ‚ç‚¹ä¿¡æ¯&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># ========== 2. ç½‘å¡ç¡¬ä»¶ä¸é˜Ÿåˆ—ä¿¡æ¯ ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[2] ç½‘å¡ç¡¬ä»¶å‚æ•°ä¸é˜Ÿåˆ—æƒ…å†µ\033[0m&quot;</span><br><span class="line">ethtool -i $NIC | grep -E &quot;driver|version|firmware&quot;</span><br><span class="line">ethtool -l $NIC | grep -A1 &quot;Combined&quot;</span><br><span class="line">echo</span><br><span class="line">echo &quot;é˜Ÿåˆ—åˆ—è¡¨:&quot;</span><br><span class="line">ls /sys/class/net/$NIC/queues/ 2&gt;/dev/null || echo &quot;æ— é˜Ÿåˆ—ç›®å½•&quot;</span><br><span class="line">echo</span><br><span class="line">ethtool -x $NIC 2&gt;/dev/null | head -20 || echo &quot;è¯¥ç½‘å¡ä¸æ”¯æŒRSSæ˜ å°„æŸ¥çœ‹&quot;</span><br><span class="line"></span><br><span class="line"># ========== 3. ä¸­æ–­åˆ†å¸ƒä¸ç»‘å®š ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[3] ä¸­æ–­ä¸CPUç»‘å®šå…³ç³»\033[0m&quot;</span><br><span class="line">echo &quot;ğŸ‘‰ $NIC çš„ä¸­æ–­å·åˆ†å¸ƒï¼š&quot;</span><br><span class="line">grep $NIC /proc/interrupts | awk &#x27;&#123;print $1 &quot;\t&quot; $NF&#125;&#x27; | tr -d &#x27;:&#x27; | column -t</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nğŸ‘‰ æ¯ä¸ªä¸­æ–­å·ç»‘å®šCPUä¿¡æ¯:&quot;</span><br><span class="line">grep $NIC /proc/interrupts | cut -d: -f1 | while read irq; do</span><br><span class="line">    [ -n &quot;$irq&quot; ] &amp;&amp; printf &quot;IRQ %-4s -&gt; CPU(s): %s\n&quot; &quot;$irq&quot; &quot;$(cat /proc/irq/$irq/smp_affinity_list 2&gt;/dev/null)&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># ========== 4. ç½‘å¡æ¥æ”¶æ€§èƒ½å‚æ•° ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[4] ç½‘å¡æ¥æ”¶æ€§èƒ½å‚æ•°\033[0m&quot;</span><br><span class="line">sysctl -a 2&gt;/dev/null | grep &quot;net.core.netdev_max_backlog&quot;</span><br><span class="line">ethtool -S $NIC 2&gt;/dev/null | egrep &quot;rx_|tx_&quot; | head -20</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line"># ========== 5. CPUä¸­æ–­ä¸è½¯ä¸­æ–­è´Ÿè½½ ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[5] CPUä¸­æ–­ä¸è½¯ä¸­æ–­ç»Ÿè®¡\033[0m&quot;</span><br><span class="line">echo -e &quot;\nğŸ§® æŸ¥çœ‹å•æ ¸CPUçš„è½¯ä¸­æ–­(topå‰å‡ é¡¹)ï¼š&quot;</span><br><span class="line">mpstat -P ALL 1 1 | grep -v &quot;Average&quot; | grep -v &quot;^$&quot; | head -15</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nğŸ§© /proc/softirqs å‰20è¡Œï¼š&quot;</span><br><span class="line">head -20 /proc/softirqs</span><br><span class="line"></span><br><span class="line"># ========== 6. æœºå™¨æ•´ä½“æ€§èƒ½å¿«ç…§ ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[6] ç³»ç»Ÿæ•´ä½“æ€§èƒ½å¿«ç…§\033[0m&quot;</span><br><span class="line">echo -e &quot;\nğŸ“Š CPUä½¿ç”¨ç‡ï¼š&quot;</span><br><span class="line">mpstat 1 1 | tail -10</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nğŸ’¾ ç£ç›˜I/Oè´Ÿè½½ï¼š&quot;</span><br><span class="line">iostat -x -d 1 1 | grep -v &quot;^$&quot;</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nğŸ“ˆ ç½‘ç»œæµé‡é€Ÿç‡ï¼š&quot;</span><br><span class="line">sar -n DEV 1 1 | grep $NIC</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">echo -e &quot;\nğŸ‘€ è¿›ç¨‹çº§CPU/IOç»Ÿè®¡ï¼ˆå‰5åï¼‰ï¼š&quot;</span><br><span class="line">pidstat -dru 1 1 | head -20</span><br><span class="line"></span><br><span class="line"># ========== 7. é™„åŠ å»ºè®® ==========</span><br><span class="line">echo -e &quot;\n\033[1;33m[7] é™„åŠ å»ºè®®å‘½ä»¤ï¼ˆå¯é€‰æ‰‹åŠ¨æ‰§è¡Œï¼‰\033[0m&quot;</span><br><span class="line">cat &lt;&lt;EOF</span><br><span class="line"># æŸ¥çœ‹ä¸­æ–­å¹³è¡¡æœåŠ¡çŠ¶æ€ï¼ˆIRQBalanceï¼‰</span><br><span class="line">systemctl status irqbalance</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹RSSé…ç½®ä¸ä¸­æ–­CPUäº²å’Œæ€§è°ƒæ•´å»ºè®®</span><br><span class="line">grep . /sys/class/net/$NIC/queues/*/rps_cpus</span><br><span class="line">grep . /sys/class/net/$NIC/queues/*/xps_cpus</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å½“å‰æ´»è·ƒè¿æ¥æ•°</span><br><span class="line">ss -s</span><br><span class="line"></span><br><span class="line"># å®æ—¶ç›‘æ§å•æ ¸CPUä¸­æ–­å˜åŒ–ï¼ˆç¤ºä¾‹ï¼‰</span><br><span class="line">watch -n1 &#x27;cat /proc/softirqs | head -20&#x27;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">echo -e &quot;\n\033[1;32mâœ… å®Œæˆï¼Œä»¥ä¸Šä¸ºç½‘å¡ä¸NUMAæ€§èƒ½è¯Šæ–­ä¿¡æ¯ã€‚\033[0m&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ğŸ§© è¾“å‡ºé€»è¾‘æ¦‚è§ˆï¼ˆæ’æŸ¥é¡ºåºï¼‰</p>
<table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>ä¸»è¦ç›®çš„</th>
<th>æ ¸å¿ƒå‘½ä»¤</th>
</tr>
</thead>
<tbody><tr>
<td>1ï¸âƒ£ NUMAä¸CPUæ‹“æ‰‘</td>
<td>äº†è§£CPUä¸å†…å­˜ç»“æ„</td>
<td><code>lscpu</code>, <code>numactl</code></td>
</tr>
<tr>
<td>2ï¸âƒ£ ç½‘å¡ç¡¬ä»¶ä¸é˜Ÿåˆ—</td>
<td>ç¡®è®¤ç½‘å¡é˜Ÿåˆ—ã€RSSèƒ½åŠ›</td>
<td><code>ethtool -l</code>, <code>ethtool -x</code></td>
</tr>
<tr>
<td>3ï¸âƒ£ ä¸­æ–­ç»‘å®šå…³ç³»</td>
<td>åˆ†æIRQä¸CPUçš„åˆ†å¸ƒ</td>
<td><code>/proc/interrupts</code>, <code>/proc/irq/</code></td>
</tr>
<tr>
<td>4ï¸âƒ£ ç½‘ç»œæ€§èƒ½å‚æ•°</td>
<td>æ ¸å¿ƒé˜Ÿåˆ—ä¸ç¼“å†²</td>
<td><code>ethtool -S</code>, <code>sysctl net.core</code></td>
</tr>
<tr>
<td>5ï¸âƒ£ CPUè½¯ä¸­æ–­åˆ†æ</td>
<td>æ£€æŸ¥è½¯ä¸­æ–­ç“¶é¢ˆ</td>
<td><code>mpstat</code>, <code>/proc/softirqs</code></td>
</tr>
<tr>
<td>6ï¸âƒ£ ç³»ç»Ÿæ€§èƒ½å¿«ç…§</td>
<td>çœ‹ç³»ç»Ÿæ•´ä½“å¥åº·åº¦</td>
<td><code>pidstat</code>, <code>iostat</code>, <code>sar</code></td>
</tr>
<tr>
<td>7ï¸âƒ£ é™„åŠ ä¼˜åŒ–</td>
<td>æ‰‹åŠ¨è°ƒæ•´æŒ‡å¼•</td>
<td>RSS&#x2F;XPS, irqbalance</td>
</tr>
</tbody></table>
<h2 id="irqtop-ä¸-lsirq"><a href="#irqtop-ä¸-lsirq" class="headerlink" title="irqtop ä¸ lsirq"></a>irqtop ä¸ lsirq</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#cat /proc/interrupts æ ¼å¼ä¸å¤Ÿè‰¯å¥½</span><br><span class="line">#é»˜è®¤util-linux-2.38æ‰é›†æˆäº†irqtopä¸lsirqï¼Œå‡çº§util-linuxæœ‰ä¸€å®šé£é™©ï¼Œä»…ç¼–è¯‘å®‰è£…ä¸¤ä¸ªå·¥å…·</span><br><span class="line">#rpm -q util-linux</span><br><span class="line">util-linux-2.32.1-22.0.1.an8.x86_64</span><br><span class="line"></span><br><span class="line">#Anolis OS 8.2 ç¼–è¯‘å®‰è£…</span><br><span class="line">git clone https://github.com/util-linux/util-linux.git</span><br><span class="line">cd util-linux/</span><br><span class="line">./autogen.sh</span><br><span class="line"></span><br><span class="line">#ä¸¤ä¸ªå·¥å…·ä¾èµ–libsmartcols</span><br><span class="line">./configure --enable-libsmartcols --disable-all-programs --enable-lsirq --enable-irqtop</span><br><span class="line">make</span><br><span class="line">cp lsirq /usr/local/bin/</span><br><span class="line">cp irqtop /usr/local/bin/</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/10/31/numactl%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/31/numactl%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">numactlä½¿ç”¨æŒ‡å—</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-31 15:18:20" itemprop="dateCreated datePublished" datetime="2025-10-31T15:18:20+08:00">2025-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-11-04 17:15:55" itemprop="dateModified" datetime="2025-11-04T17:15:55+08:00">2025-11-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="numactl-å®Œæ•´ä½¿ç”¨æŒ‡å—"><a href="#numactl-å®Œæ•´ä½¿ç”¨æŒ‡å—" class="headerlink" title="numactl å®Œæ•´ä½¿ç”¨æŒ‡å—"></a>numactl å®Œæ•´ä½¿ç”¨æŒ‡å—</h1><h2 id="ä¸€ã€numactl-æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€numactl-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€numactl æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€numactl æ˜¯ä»€ä¹ˆ</h2><p><strong>numactl</strong> æ˜¯ä¸€ä¸ªæ§åˆ¶ NUMA ç­–ç•¥å’Œå†…å­˜åˆ†é…çš„å·¥å…·ï¼Œå…è®¸ä½ ï¼š</p>
<ul>
<li>å°†è¿›ç¨‹ç»‘å®šåˆ°ç‰¹å®š NUMA èŠ‚ç‚¹</li>
<li>æ§åˆ¶è¿›ç¨‹çš„å†…å­˜åˆ†é…ç­–ç•¥</li>
<li>æŸ¥çœ‹ NUMA æ‹“æ‰‘å’Œç»Ÿè®¡ä¿¡æ¯</li>
<li>ä¼˜åŒ–å¤šæ ¸æœåŠ¡å™¨æ€§èƒ½</li>
</ul>
<hr>
<h2 id="äºŒã€å®‰è£…-numactl"><a href="#äºŒã€å®‰è£…-numactl" class="headerlink" title="äºŒã€å®‰è£… numactl"></a>äºŒã€å®‰è£… numactl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS / RHEL</span></span><br><span class="line">yum install -y numactl</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu / Debian</span></span><br><span class="line">apt-get install -y numactl</span><br><span class="line"></span><br><span class="line"><span class="comment"># éªŒè¯å®‰è£…</span></span><br><span class="line">numactl --version</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸‰ã€æŸ¥çœ‹-NUMA-ä¿¡æ¯"><a href="#ä¸‰ã€æŸ¥çœ‹-NUMA-ä¿¡æ¯" class="headerlink" title="ä¸‰ã€æŸ¥çœ‹ NUMA ä¿¡æ¯"></a>ä¸‰ã€æŸ¥çœ‹ NUMA ä¿¡æ¯</h2><h3 id="3-1-æŸ¥çœ‹-NUMA-èŠ‚ç‚¹æ•°é‡"><a href="#3-1-æŸ¥çœ‹-NUMA-èŠ‚ç‚¹æ•°é‡" class="headerlink" title="3.1 æŸ¥çœ‹ NUMA èŠ‚ç‚¹æ•°é‡"></a>3.1 æŸ¥çœ‹ NUMA èŠ‚ç‚¹æ•°é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³• 1: ä½¿ç”¨ lscpu</span></span><br><span class="line">lscpu | grep NUMA</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹:</span></span><br><span class="line"><span class="comment"># NUMA node(s):            2</span></span><br><span class="line"><span class="comment"># NUMA node0 CPU(s):       0-15,32-47</span></span><br><span class="line"><span class="comment"># NUMA node1 CPU(s):       16-31,48-63</span></span><br></pre></td></tr></table></figure>

<p><strong>è§£é‡Š</strong>:</p>
<ul>
<li><code>NUMA node(s): 2</code> - ç³»ç»Ÿæœ‰ 2 ä¸ª NUMA èŠ‚ç‚¹</li>
<li><code>NUMA node0 CPU(s): 0-15,32-47</code> - èŠ‚ç‚¹ 0 åŒ…å« CPU 0-15 å’Œ 32-47ï¼ˆè¶…çº¿ç¨‹ï¼‰</li>
<li><code>NUMA node1 CPU(s): 16-31,48-63</code> - èŠ‚ç‚¹ 1 åŒ…å« CPU 16-31 å’Œ 48-63</li>
</ul>
<h3 id="3-2-æŸ¥çœ‹è¯¦ç»†-NUMA-æ‹“æ‰‘"><a href="#3-2-æŸ¥çœ‹è¯¦ç»†-NUMA-æ‹“æ‰‘" class="headerlink" title="3.2 æŸ¥çœ‹è¯¦ç»† NUMA æ‹“æ‰‘"></a>3.2 æŸ¥çœ‹è¯¦ç»† NUMA æ‹“æ‰‘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">numactl --hardware</span><br><span class="line"><span class="comment"># æˆ–ç®€å†™</span></span><br><span class="line">numactl -H</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºç¤ºä¾‹</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">available: 2 nodes (0-1)</span><br><span class="line">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</span><br><span class="line">node 0 size: 65536 MB</span><br><span class="line">node 0 free: 32768 MB</span><br><span class="line">node 1 cpus: 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</span><br><span class="line">node 1 size: 65536 MB</span><br><span class="line">node 1 free: 45678 MB</span><br><span class="line">node distances:</span><br><span class="line">node   0   1 </span><br><span class="line">  0:  10  21 </span><br><span class="line">  1:  21  10</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ä¿¡æ¯è§£è¯»</strong>:</p>
<ul>
<li><code>node 0 cpus</code> - èŠ‚ç‚¹ 0 çš„ CPU ç¼–å·</li>
<li><code>node 0 size</code> - èŠ‚ç‚¹ 0 çš„æ€»å†…å­˜</li>
<li><code>node 0 free</code> - èŠ‚ç‚¹ 0 çš„ç©ºé—²å†…å­˜</li>
<li><code>node distances</code> - èŠ‚ç‚¹é—´è®¿é—®æˆæœ¬ï¼ˆ10&#x3D;æœ¬åœ°ï¼Œ21&#x3D;è¿œç¨‹ï¼‰</li>
</ul>
<h3 id="3-3-æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„-NUMA-ç­–ç•¥"><a href="#3-3-æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„-NUMA-ç­–ç•¥" class="headerlink" title="3.3 æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ NUMA ç­–ç•¥"></a>3.3 æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„ NUMA ç­–ç•¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„ NUMA ç­–ç•¥</span></span><br><span class="line">numactl --show</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹:</span></span><br><span class="line"><span class="comment"># policy: default</span></span><br><span class="line"><span class="comment"># preferred node: current</span></span><br><span class="line"><span class="comment"># physcpubind: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</span></span><br><span class="line"><span class="comment"># cpubind: 0 1</span></span><br><span class="line"><span class="comment"># nodebind: 0 1</span></span><br><span class="line"><span class="comment"># membind: 0 1</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å››ã€æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸ç”¨å‘½ä»¤"><a href="#å››ã€æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸ç”¨å‘½ä»¤" class="headerlink" title="å››ã€æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸ç”¨å‘½ä»¤"></a>å››ã€æ ¸å¿ƒåŠŸèƒ½å’Œå¸¸ç”¨å‘½ä»¤</h2><h3 id="4-1-ç»‘å®šè¿›ç¨‹åˆ°æŒ‡å®š-NUMA-èŠ‚ç‚¹"><a href="#4-1-ç»‘å®šè¿›ç¨‹åˆ°æŒ‡å®š-NUMA-èŠ‚ç‚¹" class="headerlink" title="4.1 ç»‘å®šè¿›ç¨‹åˆ°æŒ‡å®š NUMA èŠ‚ç‚¹"></a>4.1 ç»‘å®šè¿›ç¨‹åˆ°æŒ‡å®š NUMA èŠ‚ç‚¹</h3><h4 id="âœ…-ç»‘å®šåˆ°èŠ‚ç‚¹-0"><a href="#âœ…-ç»‘å®šåˆ°èŠ‚ç‚¹-0" class="headerlink" title="âœ… ç»‘å®šåˆ°èŠ‚ç‚¹ 0"></a>âœ… ç»‘å®šåˆ°èŠ‚ç‚¹ 0</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†è¿›ç¨‹ç»‘å®šåˆ° NUMA èŠ‚ç‚¹ 0 çš„ CPU å’Œå†…å­˜</span></span><br><span class="line">numactl --cpunodebind=0 --membind=0 &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹: åœ¨èŠ‚ç‚¹ 0 è¿è¡Œ nginx</span></span><br><span class="line">numactl --cpunodebind=0 --membind=0 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹: åœ¨èŠ‚ç‚¹ 1 è¿è¡Œ MySQL</span></span><br><span class="line">numactl --cpunodebind=1 --membind=1 mysqld</span><br></pre></td></tr></table></figure>

<h4 id="âœ…-ç»‘å®šåˆ°ç‰¹å®š-CPU"><a href="#âœ…-ç»‘å®šåˆ°ç‰¹å®š-CPU" class="headerlink" title="âœ… ç»‘å®šåˆ°ç‰¹å®š CPU"></a>âœ… ç»‘å®šåˆ°ç‰¹å®š CPU</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»‘å®šåˆ° CPU 0-7</span></span><br><span class="line">numactl --physcpubind=0-7 --membind=0 &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šåˆ°ç‰¹å®š CPU åˆ—è¡¨</span></span><br><span class="line">numactl --physcpubind=0,2,4,6 &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-å†…å­˜åˆ†é…ç­–ç•¥"><a href="#4-2-å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="4.2 å†…å­˜åˆ†é…ç­–ç•¥"></a>4.2 å†…å­˜åˆ†é…ç­–ç•¥</h3><h4 id="ç­–ç•¥-1-æœ¬åœ°åˆ†é…ï¼ˆé»˜è®¤ï¼‰"><a href="#ç­–ç•¥-1-æœ¬åœ°åˆ†é…ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="ç­–ç•¥ 1: æœ¬åœ°åˆ†é…ï¼ˆé»˜è®¤ï¼‰"></a>ç­–ç•¥ 1: æœ¬åœ°åˆ†é…ï¼ˆé»˜è®¤ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># localalloc - ä¼˜å…ˆä»è¿›ç¨‹è¿è¡Œçš„èŠ‚ç‚¹åˆ†é…å†…å­˜</span></span><br><span class="line">numactl --localalloc &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ç­–ç•¥-2-äº¤é”™åˆ†é…"><a href="#ç­–ç•¥-2-äº¤é”™åˆ†é…" class="headerlink" title="ç­–ç•¥ 2: äº¤é”™åˆ†é…"></a>ç­–ç•¥ 2: äº¤é”™åˆ†é…</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># interleave - åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´è½®è¯¢åˆ†é…å†…å­˜ï¼ˆé€‚åˆå¤§å†…å­˜åº”ç”¨ï¼‰</span></span><br><span class="line">numactl --interleave=all &lt;<span class="built_in">command</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç‰¹å®šèŠ‚ç‚¹é—´äº¤é”™</span></span><br><span class="line">numactl --interleave=0,1 &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ç­–ç•¥-3-ä¼˜å…ˆèŠ‚ç‚¹"><a href="#ç­–ç•¥-3-ä¼˜å…ˆèŠ‚ç‚¹" class="headerlink" title="ç­–ç•¥ 3: ä¼˜å…ˆèŠ‚ç‚¹"></a>ç­–ç•¥ 3: ä¼˜å…ˆèŠ‚ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># preferred - ä¼˜å…ˆä»æŒ‡å®šèŠ‚ç‚¹åˆ†é…ï¼Œä¸è¶³æ—¶ä½¿ç”¨å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line">numactl --preferred=0 &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ç­–ç•¥-4-ä¸¥æ ¼ç»‘å®š"><a href="#ç­–ç•¥-4-ä¸¥æ ¼ç»‘å®š" class="headerlink" title="ç­–ç•¥ 4: ä¸¥æ ¼ç»‘å®š"></a>ç­–ç•¥ 4: ä¸¥æ ¼ç»‘å®š</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># membind - ä¸¥æ ¼åªä»æŒ‡å®šèŠ‚ç‚¹åˆ†é…ï¼ˆå†…å­˜ä¸è¶³ä¼šå¤±è´¥ï¼‰</span></span><br><span class="line">numactl --membind=0 &lt;<span class="built_in">command</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-æŸ¥çœ‹ç½‘å¡çš„-NUMA-èŠ‚ç‚¹"><a href="#4-3-æŸ¥çœ‹ç½‘å¡çš„-NUMA-èŠ‚ç‚¹" class="headerlink" title="4.3 æŸ¥çœ‹ç½‘å¡çš„ NUMA èŠ‚ç‚¹"></a>4.3 æŸ¥çœ‹ç½‘å¡çš„ NUMA èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³• 1: ç›´æ¥æŸ¥çœ‹</span></span><br><span class="line"><span class="built_in">cat</span> /sys/class/net/eth0/device/numa_node</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡º: 0 (è¡¨ç¤ºåœ¨ NUMA èŠ‚ç‚¹ 0)</span></span><br><span class="line"><span class="comment"># è¾“å‡º: -1 (è¡¨ç¤ºæœªç»‘å®šæˆ–ä¸æ”¯æŒ)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³• 2: æŸ¥çœ‹æ‰€æœ‰ç½‘å¡</span></span><br><span class="line"><span class="keyword">for</span> nic <span class="keyword">in</span> /sys/class/net/*; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$nic</span>/device/numa_node&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(basename $nic)</span>: <span class="subst">$(cat $nic/device/numa_node)</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹:</span></span><br><span class="line"><span class="comment"># eth0: 0</span></span><br><span class="line"><span class="comment"># eth1: 1</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-æŸ¥çœ‹-NUMA-ç»Ÿè®¡ä¿¡æ¯"><a href="#4-4-æŸ¥çœ‹-NUMA-ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="4.4 æŸ¥çœ‹ NUMA ç»Ÿè®¡ä¿¡æ¯"></a>4.4 æŸ¥çœ‹ NUMA ç»Ÿè®¡ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ NUMA å†…å­˜ç»Ÿè®¡</span></span><br><span class="line">numastat</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¾“å‡ºç¤ºä¾‹:</span></span><br><span class="line"><span class="comment">#                            node0           node1</span></span><br><span class="line"><span class="comment"># numa_hit              1234567890      9876543210</span></span><br><span class="line"><span class="comment"># numa_miss                  12345           54321</span></span><br><span class="line"><span class="comment"># numa_foreign               54321           12345</span></span><br><span class="line"><span class="comment"># interleave_hit              1234            5678</span></span><br><span class="line"><span class="comment"># local_node            1234500000      9876500000</span></span><br><span class="line"><span class="comment"># other_node                 67890           43210</span></span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®æŒ‡æ ‡</strong>:</p>
<ul>
<li><code>numa_hit</code> - è¿›ç¨‹ä»æœ¬åœ°èŠ‚ç‚¹åˆ†é…å†…å­˜çš„æ¬¡æ•°ï¼ˆâœ… è¶Šé«˜è¶Šå¥½ï¼‰</li>
<li><code>numa_miss</code> - è¿›ç¨‹ä»è¿œç¨‹èŠ‚ç‚¹åˆ†é…å†…å­˜çš„æ¬¡æ•°ï¼ˆâŒ åº”è¯¥ä½ï¼‰</li>
<li><code>numa_foreign</code> - å…¶ä»–è¿›ç¨‹è®¿é—®æœ¬èŠ‚ç‚¹å†…å­˜çš„æ¬¡æ•°</li>
<li><code>local_node</code> - è¿›ç¨‹åœ¨æœ¬åœ°èŠ‚ç‚¹è¿è¡Œå¹¶è®¿é—®æœ¬åœ°å†…å­˜</li>
<li><code>other_node</code> - è¿›ç¨‹åœ¨æœ¬åœ°èŠ‚ç‚¹è¿è¡Œä½†è®¿é—®è¿œç¨‹å†…å­˜ï¼ˆâŒ æ€§èƒ½æ€æ‰‹ï¼‰</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‰è¿›ç¨‹æŸ¥çœ‹ NUMA ç»Ÿè®¡</span></span><br><span class="line">numastat -p &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰è¿›ç¨‹åæŸ¥çœ‹</span></span><br><span class="line">numastat nginx</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº”ã€å®æˆ˜åœºæ™¯"><a href="#äº”ã€å®æˆ˜åœºæ™¯" class="headerlink" title="äº”ã€å®æˆ˜åœºæ™¯"></a>äº”ã€å®æˆ˜åœºæ™¯</h2><h3 id="åœºæ™¯-1-ç½‘ç»œæœåŠ¡ä¼˜åŒ–ï¼ˆNginxï¼‰"><a href="#åœºæ™¯-1-ç½‘ç»œæœåŠ¡ä¼˜åŒ–ï¼ˆNginxï¼‰" class="headerlink" title="åœºæ™¯ 1: ç½‘ç»œæœåŠ¡ä¼˜åŒ–ï¼ˆNginxï¼‰"></a>åœºæ™¯ 1: ç½‘ç»œæœåŠ¡ä¼˜åŒ–ï¼ˆNginxï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹ç½‘å¡æ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line">NUMA_NODE=$(<span class="built_in">cat</span> /sys/class/net/eth0/device/numa_node)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;eth0 åœ¨ NUMA èŠ‚ç‚¹: <span class="variable">$NUMA_NODE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç»‘å®š Nginx åˆ°ç›¸åŒèŠ‚ç‚¹</span></span><br><span class="line">numactl --cpunodebind=<span class="variable">$NUMA_NODE</span> --membind=<span class="variable">$NUMA_NODE</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éªŒè¯</span></span><br><span class="line">ps aux | grep nginx</span><br><span class="line">numactl --show $(pidof nginx | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯-2-æ•°æ®åº“ä¼˜åŒ–ï¼ˆMySQL-PostgreSQLï¼‰"><a href="#åœºæ™¯-2-æ•°æ®åº“ä¼˜åŒ–ï¼ˆMySQL-PostgreSQLï¼‰" class="headerlink" title="åœºæ™¯ 2: æ•°æ®åº“ä¼˜åŒ–ï¼ˆMySQL&#x2F;PostgreSQLï¼‰"></a>åœºæ™¯ 2: æ•°æ®åº“ä¼˜åŒ–ï¼ˆMySQL&#x2F;PostgreSQLï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æ•°æ®åº“åœ¨èŠ‚ç‚¹ 1</span></span><br><span class="line">numactl --cpunodebind=1 --membind=1 --interleave=1 mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯´æ˜:</span></span><br><span class="line"><span class="comment"># --cpunodebind=1: CPU ç»‘å®šåˆ°èŠ‚ç‚¹ 1</span></span><br><span class="line"><span class="comment"># --membind=1: å†…å­˜ä»èŠ‚ç‚¹ 1 åˆ†é…</span></span><br><span class="line"><span class="comment"># --interleave=1: åœ¨èŠ‚ç‚¹ 1 å†…äº¤é”™åˆ†é…ï¼ˆå¤§å†…å­˜åº”ç”¨ï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯-3-é«˜æ€§èƒ½è®¡ç®—"><a href="#åœºæ™¯-3-é«˜æ€§èƒ½è®¡ç®—" class="headerlink" title="åœºæ™¯ 3: é«˜æ€§èƒ½è®¡ç®—"></a>åœºæ™¯ 3: é«˜æ€§èƒ½è®¡ç®—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†è®¡ç®—ä»»åŠ¡å‡åŒ€åˆ†å¸ƒåˆ°æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">numactl --interleave=all ./my_app</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‚ç”¨äº:</span></span><br><span class="line"><span class="comment"># - å¤§è§„æ¨¡çŸ©é˜µè¿ç®—</span></span><br><span class="line"><span class="comment"># - ç§‘å­¦è®¡ç®—</span></span><br><span class="line"><span class="comment"># - å¤§æ•°æ®å¤„ç†</span></span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯-4-ç½‘å¡ä¸­æ–­ç»‘æ ¸é…åˆ-NUMA"><a href="#åœºæ™¯-4-ç½‘å¡ä¸­æ–­ç»‘æ ¸é…åˆ-NUMA" class="headerlink" title="åœºæ™¯ 4: ç½‘å¡ä¸­æ–­ç»‘æ ¸é…åˆ NUMA"></a>åœºæ™¯ 4: ç½‘å¡ä¸­æ–­ç»‘æ ¸é…åˆ NUMA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ï¼šä¸­æ–­å’Œåº”ç”¨éƒ½ç»‘å®šåˆ°ç½‘å¡æ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">NIC=<span class="string">&quot;eth0&quot;</span></span><br><span class="line">NUMA_NODE=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$NIC</span>/device/numa_node)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$NUMA_NODE</span>&quot;</span> = <span class="string">&quot;-1&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç½‘å¡æœªç»‘å®š NUMA èŠ‚ç‚¹&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç½‘å¡ <span class="variable">$NIC</span> åœ¨ NUMA èŠ‚ç‚¹ <span class="variable">$NUMA_NODE</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. è·å–è¯¥èŠ‚ç‚¹çš„ CPU åˆ—è¡¨</span></span><br><span class="line">NODE_CPUS=$(<span class="built_in">cat</span> /sys/devices/system/node/node<span class="variable">$&#123;NUMA_NODE&#125;</span>/cpulist)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;èŠ‚ç‚¹ <span class="variable">$NUMA_NODE</span> çš„ CPU: <span class="variable">$NODE_CPUS</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. ç»‘å®šç½‘å¡ä¸­æ–­åˆ°è¯¥èŠ‚ç‚¹çš„å‰ 8 ä¸ª CPU</span></span><br><span class="line">START_CPU=$(<span class="built_in">echo</span> <span class="variable">$NODE_CPUS</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;-&#x27;</span> -f1)</span><br><span class="line">END_CPU=$((START_CPU + <span class="number">7</span>))</span><br><span class="line">IRQ_CPUS=<span class="string">&quot;<span class="variable">$&#123;START_CPU&#125;</span>-<span class="variable">$&#123;END_CPU&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç»‘å®šä¸­æ–­åˆ° CPU: <span class="variable">$IRQ_CPUS</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> irq <span class="keyword">in</span> $(grep <span class="variable">$NIC</span> /proc/interrupts | awk -F: <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27; &#x27;</span>); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$IRQ_CPUS</span> &gt; /proc/irq/<span class="variable">$irq</span>/smp_affinity_list</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;IRQ <span class="variable">$irq</span> -&gt; CPU <span class="variable">$IRQ_CPUS</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯åŠ¨åº”ç”¨ç¨‹åºåˆ°ç›¸åŒèŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¯åŠ¨åº”ç”¨åˆ° NUMA èŠ‚ç‚¹ <span class="variable">$NUMA_NODE</span>&quot;</span></span><br><span class="line">numactl --cpunodebind=<span class="variable">$NUMA_NODE</span> --membind=<span class="variable">$NUMA_NODE</span> ./my_network_app</span><br></pre></td></tr></table></figure>

<h3 id="åœºæ™¯-5-å®¹å™¨åŒ–åº”ç”¨"><a href="#åœºæ™¯-5-å®¹å™¨åŒ–åº”ç”¨" class="headerlink" title="åœºæ™¯ 5: å®¹å™¨åŒ–åº”ç”¨"></a>åœºæ™¯ 5: å®¹å™¨åŒ–åº”ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker å®¹å™¨ç»‘å®š NUMA</span></span><br><span class="line">docker run --cpuset-cpus=<span class="string">&quot;0-15&quot;</span> --cpuset-mems=<span class="string">&quot;0&quot;</span> \</span><br><span class="line">    --name my-app nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kubernetes Pod é…ç½® (æ·»åŠ åˆ° pod spec)</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-numa</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx</span><br><span class="line">    image: nginx</span><br><span class="line">    resources:</span><br><span class="line">      limits:</span><br><span class="line">        cpu: <span class="string">&quot;16&quot;</span></span><br><span class="line">        memory: <span class="string">&quot;64Gi&quot;</span></span><br><span class="line">  <span class="comment"># ä½¿ç”¨ node selector é€‰æ‹©ç‰¹å®š NUMA é…ç½®çš„èŠ‚ç‚¹</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    numa.topology: <span class="string">&quot;2-nodes&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…­ã€æ€§èƒ½æµ‹è¯•å¯¹æ¯”"><a href="#å…­ã€æ€§èƒ½æµ‹è¯•å¯¹æ¯”" class="headerlink" title="å…­ã€æ€§èƒ½æµ‹è¯•å¯¹æ¯”"></a>å…­ã€æ€§èƒ½æµ‹è¯•å¯¹æ¯”</h2><h3 id="æµ‹è¯•-1-æœ¬åœ°-vs-è¿œç¨‹å†…å­˜è®¿é—®"><a href="#æµ‹è¯•-1-æœ¬åœ°-vs-è¿œç¨‹å†…å­˜è®¿é—®" class="headerlink" title="æµ‹è¯• 1: æœ¬åœ° vs è¿œç¨‹å†…å­˜è®¿é—®"></a>æµ‹è¯• 1: æœ¬åœ° vs è¿œç¨‹å†…å­˜è®¿é—®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># å¯¹æ¯”æœ¬åœ°å’Œè¿œç¨‹å†…å­˜è®¿é—®æ€§èƒ½</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æœ¬åœ°è®¿é—®ï¼ˆèŠ‚ç‚¹ 0ï¼‰</span></span><br><span class="line">numactl --cpunodebind=0 --membind=0 sysbench memory \</span><br><span class="line">    --memory-block-size=1M \</span><br><span class="line">    --memory-total-size=10G run &gt; local.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•è¿œç¨‹è®¿é—®ï¼ˆCPUåœ¨èŠ‚ç‚¹0ï¼Œå†…å­˜åœ¨èŠ‚ç‚¹1ï¼‰</span></span><br><span class="line">numactl --cpunodebind=0 --membind=1 sysbench memory \</span><br><span class="line">    --memory-block-size=1M \</span><br><span class="line">    --memory-total-size=10G run &gt; remote.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹æ¯”ç»“æœ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æœ¬åœ°è®¿é—®:&quot;</span></span><br><span class="line">grep <span class="string">&quot;transferred&quot;</span> local.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è¿œç¨‹è®¿é—®:&quot;</span></span><br><span class="line">grep <span class="string">&quot;transferred&quot;</span> remote.txt</span><br></pre></td></tr></table></figure>

<p><strong>å…¸å‹ç»“æœ</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åœ°è®¿é—®: 10240.00 MiB transferred (25600.00 MiB/sec)</span><br><span class="line">è¿œç¨‹è®¿é—®: 10240.00 MiB transferred (12800.00 MiB/sec)</span><br><span class="line">æ€§èƒ½å·®å¼‚: 2å€</span><br></pre></td></tr></table></figure>

<h3 id="æµ‹è¯•-2-iperf3-é…åˆ-NUMA"><a href="#æµ‹è¯•-2-iperf3-é…åˆ-NUMA" class="headerlink" title="æµ‹è¯• 2: iperf3 é…åˆ NUMA"></a>æµ‹è¯• 2: iperf3 é…åˆ NUMA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡ç«¯ï¼šç»‘å®šåˆ°ç½‘å¡æ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line">NUMA_NODE=$(<span class="built_in">cat</span> /sys/class/net/eth0/device/numa_node)</span><br><span class="line">numactl --cpunodebind=<span class="variable">$NUMA_NODE</span> --membind=<span class="variable">$NUMA_NODE</span> \</span><br><span class="line">    iperf3 -s -p 5201</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯ï¼šåŒæ ·ç»‘å®š</span></span><br><span class="line">numactl --cpunodebind=<span class="variable">$NUMA_NODE</span> --membind=<span class="variable">$NUMA_NODE</span> \</span><br><span class="line">    iperf3 -c &lt;server_ip&gt; -t 60 -P 10</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸ƒã€ç›‘æ§å’Œè°ƒè¯•"><a href="#ä¸ƒã€ç›‘æ§å’Œè°ƒè¯•" class="headerlink" title="ä¸ƒã€ç›‘æ§å’Œè°ƒè¯•"></a>ä¸ƒã€ç›‘æ§å’Œè°ƒè¯•</h2><h3 id="7-1-å®æ—¶ç›‘æ§-NUMA-çŠ¶æ€"><a href="#7-1-å®æ—¶ç›‘æ§-NUMA-çŠ¶æ€" class="headerlink" title="7.1 å®æ—¶ç›‘æ§ NUMA çŠ¶æ€"></a>7.1 å®æ—¶ç›‘æ§ NUMA çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒç»­ç›‘æ§ NUMA ç»Ÿè®¡</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;numastat&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘æ§ç‰¹å®šè¿›ç¨‹</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;numastat -p $(pidof nginx | head -n1)&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-æŸ¥çœ‹è¿›ç¨‹çš„-NUMA-å†…å­˜æ˜ å°„"><a href="#7-2-æŸ¥çœ‹è¿›ç¨‹çš„-NUMA-å†…å­˜æ˜ å°„" class="headerlink" title="7.2 æŸ¥çœ‹è¿›ç¨‹çš„ NUMA å†…å­˜æ˜ å°„"></a>7.2 æŸ¥çœ‹è¿›ç¨‹çš„ NUMA å†…å­˜æ˜ å°„</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹åœ¨å„èŠ‚ç‚¹çš„å†…å­˜åˆ†å¸ƒ</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;pid&gt;/numa_maps</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹è¾“å‡º:</span></span><br><span class="line"><span class="comment"># 7f8a00000000 default file=/lib/x86_64-linux-gnu/libc-2.31.so mapped=200 N0=150 N1=50</span></span><br><span class="line"><span class="comment"># è¯´æ˜: è¯¥å†…å­˜åŒºåŸŸåœ¨èŠ‚ç‚¹0æœ‰150é¡µï¼ŒèŠ‚ç‚¹1æœ‰50é¡µ</span></span><br></pre></td></tr></table></figure>

<h3 id="7-3-æ£€æµ‹-NUMA-ä¸å‡è¡¡"><a href="#7-3-æ£€æµ‹-NUMA-ä¸å‡è¡¡" class="headerlink" title="7.3 æ£€æµ‹ NUMA ä¸å‡è¡¡"></a>7.3 æ£€æµ‹ NUMA ä¸å‡è¡¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># æ£€æµ‹ç³»ç»Ÿæ˜¯å¦å­˜åœ¨ NUMA ä¸å‡è¡¡</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== NUMA ä¸å‡è¡¡æ£€æµ‹ ===&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æ£€æŸ¥ numa_miss</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n1. NUMA Miss ç‡:&quot;</span></span><br><span class="line">numastat | awk <span class="string">&#x27;/numa_miss/&#123;print &quot;Node 0:&quot;, $2, &quot;Node 1:&quot;, $3&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥è¿œç¨‹è®¿é—®</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n2. è¿œç¨‹å†…å­˜è®¿é—®:&quot;</span></span><br><span class="line">numastat | awk <span class="string">&#x27;/other_node/&#123;print &quot;Node 0:&quot;, $2, &quot;Node 1:&quot;, $3&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è®¡ç®—ä¸å‡è¡¡åº¦</span></span><br><span class="line">LOCAL0=$(numastat | awk <span class="string">&#x27;/local_node/&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">OTHER0=$(numastat | awk <span class="string">&#x27;/other_node/&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">RATIO=$(awk <span class="string">&quot;BEGIN &#123;print (<span class="variable">$OTHER0</span> / (<span class="variable">$LOCAL0</span> + <span class="variable">$OTHER0</span>)) * 100&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\n3. è¿œç¨‹è®¿é—®å æ¯”: <span class="variable">$&#123;RATIO&#125;</span>%&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (( $(echo &quot;<span class="variable">$RATIO</span> &gt; <span class="number">10</span>&quot; | bc -l) )); <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âš ï¸  è­¦å‘Š: è¿œç¨‹è®¿é—®è¶…è¿‡10%ï¼Œå­˜åœ¨ NUMA ä¸å‡è¡¡&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âœ… æ­£å¸¸: NUMA è®¿é—®æ¨¡å¼è‰¯å¥½&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…«ã€å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#å…«ã€å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å…«ã€å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"></a>å…«ã€å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2><h3 id="Q1-å¦‚ä½•ç¡®å®šç½‘å¡åº”è¯¥ç»‘å®šåˆ°å“ªä¸ª-NUMA-èŠ‚ç‚¹ï¼Ÿ"><a href="#Q1-å¦‚ä½•ç¡®å®šç½‘å¡åº”è¯¥ç»‘å®šåˆ°å“ªä¸ª-NUMA-èŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="Q1: å¦‚ä½•ç¡®å®šç½‘å¡åº”è¯¥ç»‘å®šåˆ°å“ªä¸ª NUMA èŠ‚ç‚¹ï¼Ÿ"></a>Q1: å¦‚ä½•ç¡®å®šç½‘å¡åº”è¯¥ç»‘å®šåˆ°å“ªä¸ª NUMA èŠ‚ç‚¹ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘å¡çš„ç‰©ç†ä½ç½®</span></span><br><span class="line">lspci -v -s $(ethtool -i eth0 | grep <span class="string">&quot;bus-info&quot;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–ç›´æ¥æŸ¥çœ‹</span></span><br><span class="line"><span class="built_in">cat</span> /sys/class/net/eth0/device/numa_node</span><br></pre></td></tr></table></figure>

<h3 id="Q2-è¿›ç¨‹è¿è¡Œæ—¶å¯ä»¥æ”¹å˜-NUMA-ç­–ç•¥å—ï¼Ÿ"><a href="#Q2-è¿›ç¨‹è¿è¡Œæ—¶å¯ä»¥æ”¹å˜-NUMA-ç­–ç•¥å—ï¼Ÿ" class="headerlink" title="Q2: è¿›ç¨‹è¿è¡Œæ—¶å¯ä»¥æ”¹å˜ NUMA ç­–ç•¥å—ï¼Ÿ"></a>Q2: è¿›ç¨‹è¿è¡Œæ—¶å¯ä»¥æ”¹å˜ NUMA ç­–ç•¥å—ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥ï¼Œä½¿ç”¨ numactl å’Œ taskset</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. æŸ¥æ‰¾è¿›ç¨‹ PID</span></span><br><span class="line">PID=$(pidof nginx | <span class="built_in">head</span> -n1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿ç§»åˆ°èŠ‚ç‚¹ 1</span></span><br><span class="line">numactl --cpunodebind=1 --membind=1 -p <span class="variable">$PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼šå·²åˆ†é…çš„å†…å­˜ä¸ä¼šè¿ç§»ï¼Œåªå½±å“æ–°åˆ†é…</span></span><br></pre></td></tr></table></figure>

<h3 id="Q3-å¦‚ä½•å¤„ç†-NUMA-èŠ‚ç‚¹å†…å­˜ä¸å‡è¡¡ï¼Ÿ"><a href="#Q3-å¦‚ä½•å¤„ç†-NUMA-èŠ‚ç‚¹å†…å­˜ä¸å‡è¡¡ï¼Ÿ" class="headerlink" title="Q3: å¦‚ä½•å¤„ç† NUMA èŠ‚ç‚¹å†…å­˜ä¸å‡è¡¡ï¼Ÿ"></a>Q3: å¦‚ä½•å¤„ç† NUMA èŠ‚ç‚¹å†…å­˜ä¸å‡è¡¡ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹å„èŠ‚ç‚¹å†…å­˜ä½¿ç”¨</span></span><br><span class="line">numastat -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¦‚æœæŸèŠ‚ç‚¹å†…å­˜ä¸è¶³ï¼Œå¯ä»¥ï¼š</span></span><br><span class="line"><span class="comment">#    a) è¿ç§»éƒ¨åˆ†è¿›ç¨‹åˆ°å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">#    b) ä½¿ç”¨ interleave ç­–ç•¥</span></span><br><span class="line"><span class="comment">#    c) é‡å¯åº”ç”¨å¹¶é‡æ–°ç»‘å®š</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. ä¸´æ—¶æ¸…ç†é¡µç¼“å­˜ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span></span><br><span class="line"><span class="built_in">echo</span> 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¹ã€æœ€ä½³å®è·µæ€»ç»“"><a href="#ä¹ã€æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="ä¹ã€æœ€ä½³å®è·µæ€»ç»“"></a>ä¹ã€æœ€ä½³å®è·µæ€»ç»“</h2><h3 id="âœ…-æ¨èåšæ³•"><a href="#âœ…-æ¨èåšæ³•" class="headerlink" title="âœ… æ¨èåšæ³•"></a>âœ… æ¨èåšæ³•</h3><ol>
<li><p><strong>ç½‘ç»œå¯†é›†å‹åº”ç”¨</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»‘å®šåˆ°ç½‘å¡æ‰€åœ¨ NUMA èŠ‚ç‚¹</span></span><br><span class="line">numactl --cpunodebind=&lt;node&gt; --membind=&lt;node&gt; &lt;app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å†…å­˜å¯†é›†å‹åº”ç”¨</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ interleave åˆ†å¸ƒå†…å­˜</span></span><br><span class="line">numactl --interleave=all &lt;app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ··åˆè´Ÿè½½</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸åŒæœåŠ¡ç»‘å®šåˆ°ä¸åŒèŠ‚ç‚¹</span></span><br><span class="line">numactl --cpunodebind=0 --membind=0 nginx &amp;</span><br><span class="line">numactl --cpunodebind=1 --membind=1 mysql &amp;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="âŒ-é¿å…çš„åšæ³•"><a href="#âŒ-é¿å…çš„åšæ³•" class="headerlink" title="âŒ é¿å…çš„åšæ³•"></a>âŒ é¿å…çš„åšæ³•</h3><ol>
<li><p><strong>è·¨ NUMA è®¿é—®</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é”™è¯¯: CPU åœ¨èŠ‚ç‚¹ 0ï¼Œå†…å­˜åœ¨èŠ‚ç‚¹ 1</span></span><br><span class="line">numactl --cpunodebind=0 --membind=1 &lt;app&gt;  <span class="comment"># âŒ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¿½ç•¥ç½‘å¡ä½ç½®</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç½‘å¡åœ¨èŠ‚ç‚¹ 0ï¼Œä½†è¿›ç¨‹åœ¨èŠ‚ç‚¹ 1</span></span><br><span class="line"><span class="comment"># å¯¼è‡´æ‰€æœ‰ç½‘ç»œæ•°æ®è·¨èŠ‚ç‚¹ä¼ è¾“  # âŒ</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¿‡åº¦ç»‘å®š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å¤ªå¤šè¿›ç¨‹ç»‘å®šåˆ°å•ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"># å¯¼è‡´è¯¥èŠ‚ç‚¹è¿‡è½½ï¼Œå…¶ä»–èŠ‚ç‚¹ç©ºé—²  # âŒ</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="åã€å¿«é€Ÿå‚è€ƒè¡¨"><a href="#åã€å¿«é€Ÿå‚è€ƒè¡¨" class="headerlink" title="åã€å¿«é€Ÿå‚è€ƒè¡¨"></a>åã€å¿«é€Ÿå‚è€ƒè¡¨</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>numactl --hardware</code></td>
<td>æŸ¥çœ‹ NUMA æ‹“æ‰‘</td>
</tr>
<tr>
<td><code>numactl --show</code></td>
<td>æŸ¥çœ‹å½“å‰ NUMA ç­–ç•¥</td>
</tr>
<tr>
<td><code>numastat</code></td>
<td>æŸ¥çœ‹ NUMA ç»Ÿè®¡</td>
</tr>
<tr>
<td><code>numactl --cpunodebind=N &lt;cmd&gt;</code></td>
<td>CPU ç»‘å®šåˆ°èŠ‚ç‚¹ N</td>
</tr>
<tr>
<td><code>numactl --membind=N &lt;cmd&gt;</code></td>
<td>å†…å­˜ç»‘å®šåˆ°èŠ‚ç‚¹ N</td>
</tr>
<tr>
<td><code>numactl --interleave=all &lt;cmd&gt;</code></td>
<td>å†…å­˜äº¤é”™åˆ†é…</td>
</tr>
<tr>
<td><code>numactl --localalloc &lt;cmd&gt;</code></td>
<td>æœ¬åœ°å†…å­˜ä¼˜å…ˆ</td>
</tr>
<tr>
<td><code>numactl --preferred=N &lt;cmd&gt;</code></td>
<td>ä¼˜å…ˆèŠ‚ç‚¹ N</td>
</tr>
<tr>
<td><code>cat /sys/class/net/*/device/numa_node</code></td>
<td>æŸ¥çœ‹ç½‘å¡èŠ‚ç‚¹</td>
</tr>
<tr>
<td><code>numastat -p &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹è¿›ç¨‹ NUMA ç»Ÿè®¡</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># CPU ä¿¡æ¯</span><br><span class="line">lscpu</span><br><span class="line">nproc  # æŸ¥çœ‹æ ¸å¿ƒæ•°</span><br><span class="line"></span><br><span class="line"># NUMA æ‹“æ‰‘</span><br><span class="line">lscpu | grep NUMA</span><br><span class="line">numactl --hardware</span><br><span class="line"></span><br><span class="line"># ç½‘å¡ä¿¡æ¯</span><br><span class="line">lspci | grep -i ethernet</span><br><span class="line">ip link show</span><br><span class="line">ethtool eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å½“å‰é˜Ÿåˆ—é…ç½®</span><br><span class="line">ethtool -l eth0</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ RSS é…ç½®</span><br><span class="line">ethtool -x eth0</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ç½‘å¡ç»Ÿè®¡</span><br><span class="line">ethtool -S eth0</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹ç½‘å¡æ‰€åœ¨ NUMA èŠ‚ç‚¹</span><br><span class="line">cat /sys/class/net/eth0/device/numa_node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»ˆç«¯ 1: ç›‘æ§ä¸­æ–­</span><br><span class="line">watch -n 1 &#x27;cat /proc/interrupts | grep -E &quot;(CPU|eth)&quot; | head -n 20&#x27;</span><br><span class="line"></span><br><span class="line"># ç»ˆç«¯ 2: ç›‘æ§ CPU</span><br><span class="line">mpstat -P ALL 1</span><br><span class="line"></span><br><span class="line"># ç»ˆç«¯ 3: ç›‘æ§ç½‘ç»œ</span><br><span class="line">sar -n DEV 1</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¯-å¿«é€Ÿå‚è€ƒå‘½ä»¤"><a href="#ğŸ¯-å¿«é€Ÿå‚è€ƒå‘½ä»¤" class="headerlink" title="ğŸ¯ å¿«é€Ÿå‚è€ƒå‘½ä»¤"></a>ğŸ¯ å¿«é€Ÿå‚è€ƒå‘½ä»¤</h2><h3 id="ä¿¡æ¯æŸ¥è¯¢"><a href="#ä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="ä¿¡æ¯æŸ¥è¯¢"></a>ä¿¡æ¯æŸ¥è¯¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NUMA æ‹“æ‰‘</span></span><br><span class="line">lscpu | grep NUMA</span><br><span class="line">numactl --hardware</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½‘å¡é˜Ÿåˆ—</span></span><br><span class="line">ethtool -l eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸­æ–­äº²å’Œæ€§</span></span><br><span class="line">grep eth0 /proc/interrupts</span><br><span class="line"><span class="built_in">cat</span> /proc/irq/120/smp_affinity_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç½‘å¡ NUMA èŠ‚ç‚¹</span></span><br><span class="line"><span class="built_in">cat</span> /sys/class/net/eth0/device/numa_node</span><br><span class="line"></span><br><span class="line"><span class="comment"># NUMA ç»Ÿè®¡</span></span><br><span class="line">numastat</span><br><span class="line">numastat -p $(pidof nginx)</span><br></pre></td></tr></table></figure>


<h4 id="2-1-å¯åŠ¨ç›‘æ§ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰"><a href="#2-1-å¯åŠ¨ç›‘æ§ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰" class="headerlink" title="2.1 å¯åŠ¨ç›‘æ§ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰"></a>2.1 å¯åŠ¨ç›‘æ§ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯ 1: ç›‘æ§ä¸­æ–­</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;cat /proc/interrupts | grep -E &quot;(CPU|eth)&quot; | head -n 20&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯ 2: ç›‘æ§ CPU</span></span><br><span class="line">mpstat -P ALL 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯ 3: ç›‘æ§ç½‘ç»œ</span></span><br><span class="line">sar -n DEV 1</span><br></pre></td></tr></table></figure>

<h4 id="2-2-æœåŠ¡ç«¯å‡†å¤‡ï¼ˆæµ‹è¯•æœåŠ¡å™¨ï¼‰"><a href="#2-2-æœåŠ¡ç«¯å‡†å¤‡ï¼ˆæµ‹è¯•æœåŠ¡å™¨ï¼‰" class="headerlink" title="2.2 æœåŠ¡ç«¯å‡†å¤‡ï¼ˆæµ‹è¯•æœåŠ¡å™¨ï¼‰"></a>2.2 æœåŠ¡ç«¯å‡†å¤‡ï¼ˆæµ‹è¯•æœåŠ¡å™¨ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£… iperf3</span></span><br><span class="line">yum install -y iperf3  <span class="comment"># CentOS/RHEL</span></span><br><span class="line"><span class="comment"># apt-get install -y iperf3  # Ubuntu/Debian</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --add-port=5201/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ iperf3 æœåŠ¡ç«¯</span></span><br><span class="line">iperf3 -s -p 5201</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–åå°è¿è¡Œ</span></span><br><span class="line">iperf3 -s -D</span><br></pre></td></tr></table></figure>

<h4 id="2-3-å®¢æˆ·ç«¯æµ‹è¯•ï¼ˆæµ‹è¯•å®¢æˆ·ç«¯ï¼‰"><a href="#2-3-å®¢æˆ·ç«¯æµ‹è¯•ï¼ˆæµ‹è¯•å®¢æˆ·ç«¯ï¼‰" class="headerlink" title="2.3 å®¢æˆ·ç«¯æµ‹è¯•ï¼ˆæµ‹è¯•å®¢æˆ·ç«¯ï¼‰"></a>2.3 å®¢æˆ·ç«¯æµ‹è¯•ï¼ˆæµ‹è¯•å®¢æˆ·ç«¯ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">SERVER_IP=<span class="string">&quot;192.168.1.100&quot;</span>  <span class="comment"># ä¿®æ”¹ä¸ºå®é™…æœåŠ¡å™¨ IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 1: å•æµåŸºå‡†</span></span><br><span class="line">iperf3 -c <span class="variable">$SERVER_IP</span> -t 60 -i 5 | <span class="built_in">tee</span> baseline_single.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 2: 10 å¹¶å‘æµ</span></span><br><span class="line">iperf3 -c <span class="variable">$SERVER_IP</span> -t 60 -P 10 -i 5 | <span class="built_in">tee</span> baseline_10streams.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 3: 20 å¹¶å‘æµ</span></span><br><span class="line">iperf3 -c <span class="variable">$SERVER_IP</span> -t 60 -P 20 -i 5 | <span class="built_in">tee</span> baseline_20streams.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 4: UDP ä¸¢åŒ…æµ‹è¯•</span></span><br><span class="line">iperf3 -c <span class="variable">$SERVER_IP</span> -u -b 5G -t 30 | <span class="built_in">tee</span> baseline_udp.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯ï¼šç»‘å®šåˆ°ç½‘å¡æ‰€åœ¨èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">#NUMA_NODE=$(cat /sys/class/net/eth0/device/numa_node)</span></span><br><span class="line"><span class="comment">#numactl --cpunodebind=$NUMA_NODE --membind=$NUMA_NODE \</span></span><br><span class="line">    iperf3 -s -p 5201</span><br><span class="line"></span><br><span class="line"><span class="comment">#numactl --cpunodebind=$NUMA_NODE --membind=$NUMA_NODE \</span></span><br><span class="line">    iperf3 -c 10.120.64.218 -t 60 -P 10</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âœ… åŸºå‡†æµ‹è¯•å®Œæˆï¼Œè®°å½•ååé‡å’Œé‡ä¼ æ¬¡æ•°&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-è®°å½•å…³é”®æŒ‡æ ‡"><a href="#2-4-è®°å½•å…³é”®æŒ‡æ ‡" class="headerlink" title="2.4 è®°å½•å…³é”®æŒ‡æ ‡"></a>2.4 è®°å½•å…³é”®æŒ‡æ ‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æå–å…³é”®æ•°æ®</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== åŸºå‡†æ€§èƒ½ ===&quot;</span> &gt; performance_baseline.txt</span><br><span class="line">grep <span class="string">&quot;sender&quot;</span> baseline_*.txt &gt;&gt; performance_baseline.txt</span><br><span class="line">grep <span class="string">&quot;Retr&quot;</span> baseline_*.txt &gt;&gt; performance_baseline.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜</span></span><br><span class="line"><span class="comment"># é—®é¢˜ä¿¡å·:</span></span><br><span class="line"><span class="comment"># 1. å¤šæµååé‡è¿œä½äºå•æµ (&lt; 80%)</span></span><br><span class="line"><span class="comment"># 2. é‡ä¼ æ¬¡æ•°é«˜ (&gt; 1000)</span></span><br><span class="line"><span class="comment"># 3. CPU é›†ä¸­åœ¨å°‘æ•°æ ¸å¿ƒ</span></span><br><span class="line"><span class="comment"># 4. æœ‰ä¸¢åŒ… (UDP æµ‹è¯•)</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸­æ–­ç±»å‹è¯¦è§£"><a href="#ä¸­æ–­ç±»å‹è¯¦è§£" class="headerlink" title="ä¸­æ–­ç±»å‹è¯¦è§£"></a>ä¸­æ–­ç±»å‹è¯¦è§£</h2><h3 id="ä¸­æ–­åˆ†ç±»è¡¨"><a href="#ä¸­æ–­åˆ†ç±»è¡¨" class="headerlink" title="ä¸­æ–­åˆ†ç±»è¡¨"></a>ä¸­æ–­åˆ†ç±»è¡¨</h3><table>
<thead>
<tr>
<th>ä¸­æ–­ç±»å‹</th>
<th>ç¼–å·èŒƒå›´</th>
<th>è§¦å‘æ–¹å¼</th>
<th>å…¸å‹ç”¨é€”</th>
<th>å¤„ç†ä¼˜å…ˆçº§</th>
<th>æ€§èƒ½å½±å“</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç¡¬ä»¶ä¸­æ–­(IRQ)</strong></td>
<td>0-255+</td>
<td>ç¡¬ä»¶è§¦å‘</td>
<td>è®¾å¤‡é€šçŸ¥CPU</td>
<td>é«˜</td>
<td>ç›´æ¥å½±å“å»¶è¿Ÿ</td>
</tr>
<tr>
<td><strong>è½¯ä¸­æ–­(Softirq)</strong></td>
<td>0-9</td>
<td>è½¯ä»¶è§¦å‘</td>
<td>å»¶è¿Ÿå¤„ç†</td>
<td>ä¸­</td>
<td>å½±å“ååé‡</td>
</tr>
<tr>
<td><strong>ç½‘ç»œä¸­æ–­(NET_RX)</strong></td>
<td>softirq 3</td>
<td>ç½‘å¡æ¥æ”¶</td>
<td>æ•°æ®åŒ…æ¥æ”¶</td>
<td>é«˜</td>
<td>é«˜è´Ÿè½½åœºæ™¯ç“¶é¢ˆ</td>
</tr>
<tr>
<td><strong>ç½‘ç»œä¸­æ–­(NET_TX)</strong></td>
<td>softirq 4</td>
<td>ç½‘å¡å‘é€</td>
<td>æ•°æ®åŒ…å‘é€</td>
<td>ä¸­</td>
<td>å½±å“å‘é€æ€§èƒ½</td>
</tr>
<tr>
<td><strong>å—è®¾å¤‡ä¸­æ–­</strong></td>
<td>å˜åŒ–</td>
<td>ç£ç›˜I&#x2F;O</td>
<td>ç£ç›˜è¯»å†™å®Œæˆ</td>
<td>ä¸­</td>
<td>å½±å“I&#x2F;Oæ€§èƒ½</td>
</tr>
<tr>
<td><strong>å®šæ—¶å™¨ä¸­æ–­</strong></td>
<td>softirq 1</td>
<td>å‘¨æœŸè§¦å‘</td>
<td>ç³»ç»Ÿæ—¶é’Ÿ</td>
<td>ä¸­</td>
<td>ç³»ç»Ÿçº§å½±å“</td>
</tr>
<tr>
<td><strong>è°ƒåº¦ä¸­æ–­</strong></td>
<td>softirq 7</td>
<td>è°ƒåº¦è§¦å‘</td>
<td>è¿›ç¨‹è°ƒåº¦</td>
<td>ä¸­</td>
<td>å½±å“å“åº”æ—¶é—´</td>
</tr>
<tr>
<td><strong>RCUä¸­æ–­</strong></td>
<td>softirq 8,9</td>
<td>å†…æ ¸åŒæ­¥</td>
<td>å†…å­˜å›æ”¶</td>
<td>ä½</td>
<td>åå°å½±å“</td>
</tr>
</tbody></table>
<h3 id="ç½‘ç»œä¸­æ–­å¤„ç†æµç¨‹"><a href="#ç½‘ç»œä¸­æ–­å¤„ç†æµç¨‹" class="headerlink" title="ç½‘ç»œä¸­æ–­å¤„ç†æµç¨‹"></a>ç½‘ç»œä¸­æ–­å¤„ç†æµç¨‹</h3><table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>ç±»å‹</th>
<th>å¤„ç†ä½ç½®</th>
<th>å…³é”®æ“ä½œ</th>
<th>å¯ä¼˜åŒ–ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>1. ç¡¬ä¸­æ–­</strong></td>
<td>Hardware IRQ</td>
<td>ä¸­æ–­å¤„ç†ç¨‹åº(ISR)</td>
<td>é€šçŸ¥å†…æ ¸ã€ç¦æ­¢ä¸­æ–­</td>
<td>IRQäº²å’Œæ€§ç»‘å®š</td>
</tr>
<tr>
<td><strong>2. è½¯ä¸­æ–­</strong></td>
<td>NET_RX_SOFTIRQ</td>
<td>ksoftirqdçº¿ç¨‹</td>
<td>æ•°æ®åŒ…å¤„ç†ã€åè®®æ ˆ</td>
<td>RPS&#x2F;RFSé…ç½®</td>
</tr>
<tr>
<td><strong>3. åº”ç”¨å±‚</strong></td>
<td>ç³»ç»Ÿè°ƒç”¨</td>
<td>ç”¨æˆ·ç©ºé—´</td>
<td>æ•°æ®è¯»å–</td>
<td>SO_REUSEPORT</td>
</tr>
</tbody></table>
<h3 id="I-Oä¸­æ–­ç±»å‹å¯¹æ¯”"><a href="#I-Oä¸­æ–­ç±»å‹å¯¹æ¯”" class="headerlink" title="I&#x2F;Oä¸­æ–­ç±»å‹å¯¹æ¯”"></a>I&#x2F;Oä¸­æ–­ç±»å‹å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>ç½‘ç»œä¸­æ–­</th>
<th>ç£ç›˜I&#x2F;Oä¸­æ–­</th>
<th>NVMeä¸­æ–­</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¢‘ç‡</strong></td>
<td>æé«˜(ç™¾ä¸‡çº§&#x2F;ç§’)</td>
<td>ä¸­ç­‰(ä¸‡çº§&#x2F;ç§’)</td>
<td>é«˜(åä¸‡çº§&#x2F;ç§’)</td>
</tr>
<tr>
<td><strong>å»¶è¿Ÿæ•æ„Ÿåº¦</strong></td>
<td>æé«˜</td>
<td>ä¸­ç­‰</td>
<td>é«˜</td>
</tr>
<tr>
<td><strong>CPUå ç”¨</strong></td>
<td>é«˜</td>
<td>ä¸­</td>
<td>ä¸­é«˜</td>
</tr>
<tr>
<td><strong>ä¼˜åŒ–æ–¹æ³•</strong></td>
<td>ä¸­æ–­åˆå¹¶ã€NAPI</td>
<td>I&#x2F;Oè°ƒåº¦å™¨</td>
<td>ä¸­æ–­ç»‘æ ¸ã€è½®è¯¢</td>
</tr>
<tr>
<td><strong>é˜Ÿåˆ—æ•°</strong></td>
<td>å¤šé˜Ÿåˆ—(RSS)</td>
<td>å•é˜Ÿåˆ—&#x2F;å¤šé˜Ÿåˆ—</td>
<td>å¤šé˜Ÿåˆ—(NVMeé˜Ÿåˆ—)</td>
</tr>
</tbody></table>
<h3 id="ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ğŸ¯-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ"></a>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h3><ol>
<li><p><strong>ç¡¬ä¸­æ–­ vs è½¯ä¸­æ–­</strong></p>
<ul>
<li>**ç¡¬ä¸­æ–­(IRQ)**ï¼šç¡¬ä»¶ç›´æ¥è§¦å‘ï¼Œå¤„ç†å¿«é€Ÿï¼Œä¸å¯ç¡çœ </li>
<li>**è½¯ä¸­æ–­(Softirq)**ï¼šå»¶è¿Ÿå¤„ç†ï¼Œå¯ä»¥è¢«è°ƒåº¦ï¼Œå¤„ç†å¤æ‚é€»è¾‘</li>
</ul>
</li>
<li><p><strong>RSS vs RPS vs RFS</strong></p>
<ul>
<li><strong>RSS</strong>ï¼ˆç¡¬ä»¶ï¼‰ï¼šç½‘å¡ç¡¬ä»¶æ ¹æ®å“ˆå¸Œå°†æ•°æ®åŒ…åˆ†å‘åˆ°ä¸åŒé˜Ÿåˆ—</li>
<li><strong>RPS</strong>ï¼ˆè½¯ä»¶ï¼‰ï¼šå†…æ ¸è½¯ä»¶å±‚é¢åˆ†å‘è½¯ä¸­æ–­åˆ°ä¸åŒCPU</li>
<li><strong>RFS</strong>ï¼ˆæµæ„ŸçŸ¥ï¼‰ï¼šå°†æ•°æ®åŒ…åˆ†å‘åˆ°åº”ç”¨ç¨‹åºæ‰€åœ¨çš„CPUæ ¸å¿ƒ</li>
</ul>
</li>
<li><p><strong>NAPIæœºåˆ¶</strong></p>
<ul>
<li>é«˜è´Ÿè½½æ—¶ä»ä¸­æ–­æ¨¡å¼åˆ‡æ¢åˆ°è½®è¯¢æ¨¡å¼</li>
<li>å‡å°‘ä¸­æ–­æ¬¡æ•°ï¼Œæé«˜ååé‡</li>
<li>é™ä½CPUä¸­æ–­å¼€é”€</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/10/16/%E6%B8%85%E7%90%86docker%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/16/%E6%B8%85%E7%90%86docker%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">æ¸…ç†dockerç¼“å­˜æ•°æ®</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-16 10:51:19 / ä¿®æ”¹æ—¶é—´ï¼š10:57:37" itemprop="dateCreated datePublished" datetime="2025-10-16T10:51:19+08:00">2025-10-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´"><a href="#ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´" class="headerlink" title="ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´"></a>ç°è±¡ï¼šæ„å»ºé•œåƒè®¾å¤‡æ— ç©ºé—´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#docker build xxx</span><br><span class="line">...</span><br><span class="line">mkdir /tmp/go-build1189934179/b521/: no space left on device</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹è®¾å¤‡å­˜å‚¨</span><br><span class="line">#df -lh</span><br><span class="line">/dev/sda1        99G   54G   41G  57% /</span><br><span class="line">/dev/sdb        100G  100G  945M 100% /data</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹dockerèµ„æºå ç”¨æƒ…å†µ</span><br><span class="line">#docker system df</span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images          69        15        13.21GB   10.8GB (81%)</span><br><span class="line">Containers      25        0         24.54MB   24.54MB (100%)</span><br><span class="line">Local Volumes   43        1         2.966GB   2.958GB (99%)</span><br><span class="line">Build Cache     376       0         85.73GB   85.73GB</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ğŸ§­-ä¸€ã€æ€»ä½“åˆ†æ"><a href="#ğŸ§­-ä¸€ã€æ€»ä½“åˆ†æ" class="headerlink" title="ğŸ§­ ä¸€ã€æ€»ä½“åˆ†æ"></a>ğŸ§­ ä¸€ã€æ€»ä½“åˆ†æ</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å ç”¨</th>
<th>å¯å›æ”¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Images</strong></td>
<td>13.21 GB</td>
<td>10.8 GB (81%)</td>
<td>å¾ˆå¤šæ—§é•œåƒæœªä½¿ç”¨</td>
</tr>
<tr>
<td><strong>Containers</strong></td>
<td>24 MB</td>
<td>100% å¯å›æ”¶</td>
<td>åœæ­¢å®¹å™¨æœªæ¸…ç†</td>
</tr>
<tr>
<td><strong>Local Volumes</strong></td>
<td>2.96 GB</td>
<td>99% å¯å›æ”¶</td>
<td>æ—§å·æœªä½¿ç”¨</td>
</tr>
<tr>
<td><strong>Build Cache</strong></td>
<td><strong>85.73 GB</strong></td>
<td><strong>85.73 GB (å·¨é‡)</strong></td>
<td>Docker build ä¸­äº§ç”Ÿçš„å¤§é‡ä¸­é—´å±‚ç¼“å­˜</td>
</tr>
</tbody></table>
<h2 id="ğŸ§¹-äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥"><a href="#ğŸ§¹-äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥" class="headerlink" title="ğŸ§¹ äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥"></a>ğŸ§¹ äºŒã€åˆ†çº§æ¸…ç†ç­–ç•¥</h2><blockquote>
<p>âœ… å»ºè®®åˆ†ä¸‰æ­¥æ‰§è¡Œï¼Œä»â€œå®‰å…¨â€åˆ°â€œå½»åº•â€ã€‚</p>
</blockquote>
<h3 id="1ï¸âƒ£-å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰"><a href="#1ï¸âƒ£-å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰" class="headerlink" title="1ï¸âƒ£ å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰"></a>1ï¸âƒ£ å®‰å…¨æ¸…ç†ï¼ˆé‡Šæ”¾æœ€å¤šç©ºé—´ï¼Œä½é£é™©ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ— ç”¨ build cacheï¼ˆæ¨èç¬¬ä¸€æ­¥ï¼‰</span></span><br><span class="line">docker builder prune</span><br></pre></td></tr></table></figure>

<blockquote>
<p>äº¤äº’æ—¶è¾“å…¥ <code>y</code> ç¡®è®¤å³å¯ï¼Œé€šå¸¸èƒ½é‡Šæ”¾ 80GB ä»¥ä¸Šç©ºé—´ã€‚<br>ä¸å½±å“ç°æœ‰é•œåƒæˆ–è¿è¡Œä¸­çš„å®¹å™¨ã€‚</p>
</blockquote>
<hr>
<h3 id="2ï¸âƒ£-æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰"><a href="#2ï¸âƒ£-æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰" class="headerlink" title="2ï¸âƒ£ æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰"></a>2ï¸âƒ£ æ·±åº¦æ¸…ç†ï¼ˆåˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€å·ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -a --volumes</span><br></pre></td></tr></table></figure>

<p>å«ä¹‰ï¼š</p>
<ul>
<li><code>-a</code>ï¼šåˆ é™¤æ‰€æœ‰æœªè¢«å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼ˆåŒ…æ‹¬æ‚¬ç©ºé•œåƒ <code>&lt;none&gt;</code>ï¼‰ã€‚</li>
<li><code>--volumes</code>ï¼šåˆ é™¤æœªè¢«æŒ‚è½½çš„å·ã€‚</li>
<li><code>system prune</code>ï¼šåŒæ—¶æ¸…ç† network &#x2F; container &#x2F; build cacheã€‚</li>
</ul>
<p>ğŸ’¡ <strong>æ…ç”¨</strong><br>æ­¤å‘½ä»¤ä¼šåˆ æ‰æ‰€æœ‰æ—§é•œåƒï¼Œä¸‹æ¬¡æ„å»ºä¼šé‡æ–°æ‹‰å–ï¼ˆæ—¶é—´æˆæœ¬è¾ƒé«˜ï¼Œä½†å¯å½»åº•é‡Šæ”¾ç©ºé—´ï¼‰ã€‚</p>
<hr>
<h3 id="3ï¸âƒ£-é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰"><a href="#3ï¸âƒ£-é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰" class="headerlink" title="3ï¸âƒ£ é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰"></a>3ï¸âƒ£ é’ˆå¯¹æ€§æ¸…ç†ï¼ˆæ›´ç²¾ç»†æ§åˆ¶ï¼‰</h3><h4 id="æ¸…ç†æ— ç”¨é•œåƒ"><a href="#æ¸…ç†æ— ç”¨é•œåƒ" class="headerlink" title="æ¸…ç†æ— ç”¨é•œåƒ"></a>æ¸…ç†æ— ç”¨é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune -a</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†åœæ­¢å®¹å™¨"><a href="#æ¸…ç†åœæ­¢å®¹å™¨" class="headerlink" title="æ¸…ç†åœæ­¢å®¹å™¨"></a>æ¸…ç†åœæ­¢å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container prune</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†æœªä½¿ç”¨çš„å·"><a href="#æ¸…ç†æœªä½¿ç”¨çš„å·" class="headerlink" title="æ¸…ç†æœªä½¿ç”¨çš„å·"></a>æ¸…ç†æœªä½¿ç”¨çš„å·</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure>

<h4 id="æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰"><a href="#æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰" class="headerlink" title="æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰"></a>æ¸…ç†æ„å»ºç¼“å­˜ï¼ˆæ‰€æœ‰æ„å»ºå™¨å®ä¾‹ï¼‰</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker builder prune --all</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”-ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ"><a href="#ğŸ”-ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ" class="headerlink" title="ğŸ” ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ"></a>ğŸ” ä¸‰ã€æŸ¥çœ‹æ¸…ç†æ•ˆæœ</h2><p>æ‰§è¡Œå®Œåå†æ£€æŸ¥ç©ºé—´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker system df</span></span><br><span class="line">TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE</span><br><span class="line">Images          69        15        13.21GB   10.8GB (81%)</span><br><span class="line">Containers      25        0         24.54MB   24.54MB (100%)</span><br><span class="line">Local Volumes   43        1         2.966GB   2.958GB (99%)</span><br><span class="line">Build Cache     63        0         0B        0B</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸ Build Cache ä¼šä» 85 GB é™åˆ° &lt;5 GBï¼Œç£ç›˜é‡Šæ”¾éå¸¸æ˜æ˜¾ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/23/bash-profile%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/23/bash-profile%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">bash_profileé…ç½®</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-23 15:10:53 / ä¿®æ”¹æ—¶é—´ï¼š15:17:38" itemprop="dateCreated datePublished" datetime="2025-09-23T15:10:53+08:00">2025-09-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="bash-profileé…ç½®"><a href="#bash-profileé…ç½®" class="headerlink" title=".bash_profileé…ç½®"></a>.bash_profileé…ç½®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">############################</span><br><span class="line"># åŸºç¡€å·¥å…·å¢å¼º</span><br><span class="line">############################</span><br><span class="line">alias grep=&#x27;grep --color=auto&#x27;</span><br><span class="line">alias fgrep=&#x27;fgrep --color=auto&#x27;</span><br><span class="line">alias egrep=&#x27;egrep --color=auto&#x27;</span><br><span class="line">alias lzd=&#x27;lazydocker&#x27;   # è½»é‡çº§ Docker ç®¡ç†å·¥å…·</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes åŸºç¡€å‘½ä»¤</span><br><span class="line">############################</span><br><span class="line">alias k=&#x27;kubecolor&#x27;                         # å½©è‰² kubectl è¾“å‡º</span><br><span class="line">alias kn=&#x27;k get nodes&#x27;                      # æŸ¥çœ‹èŠ‚ç‚¹</span><br><span class="line">alias knw=&#x27;k get nodes -o wide&#x27;             # æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…</span><br><span class="line">alias kp=&#x27;k get pod -o wide&#x27;                # å½“å‰å‘½åç©ºé—´ Pod</span><br><span class="line">alias kpa=&#x27;k get pod -A -o wide&#x27;            # æ‰€æœ‰å‘½åç©ºé—´ Pod</span><br><span class="line">alias kgn=&#x27;k get ns&#x27;                        # å‘½åç©ºé—´</span><br><span class="line">alias kgs=&#x27;k get secret&#x27;                    # Secret</span><br><span class="line">alias ki=&#x27;k get ing&#x27;                        # Ingress</span><br><span class="line">alias kio=&#x27;k get ing -o yaml&#x27;               # Ingress è¯¦ç»†</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes é…ç½®ç®¡ç†</span><br><span class="line">############################</span><br><span class="line">alias kcg=&#x27;k config get-contexts&#x27;           # æŸ¥çœ‹æ‰€æœ‰ context</span><br><span class="line">alias kcc=&#x27;k config current-context&#x27;        # å½“å‰ context</span><br><span class="line">alias kcu=&#x27;kubectl config use-context &#x27;     # åˆ‡æ¢ context</span><br><span class="line">alias kv=&#x27;k config view&#x27;                    # æŸ¥çœ‹é…ç½®</span><br><span class="line">alias kcn=&#x27;k config view --minify --output &quot;jsonpath=&#123;..namespace&#125;&quot; &#x27;  # å½“å‰ namespace</span><br><span class="line">alias kapi=&#x27;k api-resources --sort-by=name&#x27; # API èµ„æºåˆ—è¡¨</span><br><span class="line"></span><br><span class="line"># æ‰©å±•ï¼škrew æ’ä»¶ã€kubectl neat ç­‰</span><br><span class="line">alias kk=&#x27;kubectl krew &#x27;                    # krew æ’ä»¶ç®¡ç†</span><br><span class="line">alias kns=&#x27;kubectl config set-context --current --namespace &#x27;  # åˆ‡æ¢ namespace</span><br><span class="line">alias knw=&#x27;k get nodes -o wide&#x27;</span><br><span class="line">alias kn=&#x27;k get nodes&#x27;</span><br><span class="line">alias knyaml=&#x27;k neat -o yaml&#x27;               # è¾“å‡ºæ ¼å¼åŒ– yaml</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># Kubernetes è§£é‡Šä¸è°ƒè¯•</span><br><span class="line">############################</span><br><span class="line">alias ke=&#x27;kubectl explain &#x27;                 # è§£é‡Šèµ„æº</span><br><span class="line">alias ker=&#x27;kubectl explain --recursive &#x27;    # é€’å½’è§£é‡Š</span><br><span class="line">alias kdr=&#x27;kubectl --dry-run=client -o yaml&#x27; # ç”Ÿæˆ yaml è‰ç¨¿</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># è‡ªå®šä¹‰å°è£…</span><br><span class="line">############################</span><br><span class="line"># æ·»åŠ  kubeconfig contextï¼Œç®€åŒ–åˆ‡æ¢</span><br><span class="line">kcadd() &#123; kubectl kc add -cf /home/shijianpeng/.kube/$1.conf --context-name $1; &#125;</span><br><span class="line">pingt() &#123;</span><br><span class="line">    ping &quot;$@&quot; | ts &#x27;[%Y-%m-%d %H:%M:%S]&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å¸¸ç”¨ kc æ‰©å±•</span><br><span class="line">alias kc=&#x27;kubectl kc&#x27;</span><br><span class="line">alias kcl=&#x27;kubectl kc list&#x27;</span><br><span class="line">alias kcs=&#x27;kubectl kc switch&#x27;</span><br><span class="line"></span><br><span class="line">############################</span><br><span class="line"># é›†ç¾¤ä¿¡æ¯</span><br><span class="line">############################</span><br><span class="line">alias kci=&#x27;k cluster-info&#x27;   # é›†ç¾¤ä¿¡æ¯</span><br><span class="line"># kubectl version</span><br><span class="line"># kubectl api-resources</span><br><span class="line"># kubectl api-versions</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/19/%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/19/%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD/" class="post-title-link" itemprop="url">å®¹å™¨æ–‡ä»¶ç³»ç»ŸæŒ‚è½½</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-19 12:36:25 / ä¿®æ”¹æ—¶é—´ï¼š12:44:45" itemprop="dateCreated datePublished" datetime="2025-09-19T12:36:25+08:00">2025-09-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-æŸ¥çœ‹æŒ‚è½½æƒ…å†µ"><a href="#1-æŸ¥çœ‹æŒ‚è½½æƒ…å†µ" class="headerlink" title="1. æŸ¥çœ‹æŒ‚è½½æƒ…å†µ"></a>1. æŸ¥çœ‹æŒ‚è½½æƒ…å†µ</h2><ul>
<li><p><strong>çœ‹æŒ‚è½½æƒ…å†µ</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep /run/containerd/io.containerd.runtime.v2.task/k8s.io</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çœ‹æ˜¯å¦æœ‰è¿›ç¨‹å ç”¨</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y psmisc</span><br><span class="line">fuser -vm /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep 200ab1146de</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çœ‹ containerd é‡Œæ˜¯å¦æœ‰æ®‹ç•™ metadata</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctr -n k8s.io containers list | grep 200ab1146de</span><br><span class="line">ctr -n k8s.io tasks list | grep 200ab1146de</span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li><strong><code>ctr -n k8s.io tasks list | grep 200ab1146de</code> â†’ çŠ¶æ€ STOPPED</strong></li>
<li><strong><code>fuser -vm</code> æ˜¾ç¤ºå¾ˆå¤š <code>containerd-shim</code>ã€<code>qemu-system-x86</code>ã€<code>virtiofsd</code> ç­‰è¿›ç¨‹å¼•ç”¨è¿™ä¸ªç›®å½•</strong><ul>
<li>è¯´æ˜è¿™ä¸ªç›®å½•ï¼ˆmountpointï¼‰ä»ç„¶è¢«å¤šä¸ªè¿›ç¨‹å ç”¨ç€ã€‚</li>
<li>æ³¨æ„ï¼šè¿™é‡Œçš„ â€œF.c..â€ &#x2F; â€œfrc..â€ è¡¨ç¤ºæ‰“å¼€äº†è¿™ä¸ªç›®å½•çš„ <strong>æ–‡ä»¶æè¿°ç¬¦</strong>ï¼Œå¹¶ä¸”æœ‰è¯»å†™&#x2F;æ§åˆ¶å¼•ç”¨ã€‚</li>
</ul>
</li>
<li><strong>æ•´ä½“æƒ…å†µ</strong><ul>
<li>å†…æ ¸ <code>overlayfs</code> æŒ‚è½½ç‚¹è¿˜åœ¨ï¼Œinode æ²¡å›æ”¶ã€‚</li>
<li>å®¹å™¨å·²ç» â€œSTOPPEDâ€ï¼ˆä¸å¯ç”¨ï¼‰ï¼Œä½†æ˜¯æŒ‚è½½ç‚¹è¢«å…¶ä»– shim &#x2F; qemu &#x2F; virtiofsd å¼•ç”¨ï¼Œæ‰€ä»¥æ— æ³•è‡ªåŠ¨å¸è½½ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="2-mount-l-å‘½ä»¤å«ä¹‰ï¼š"><a href="#2-mount-l-å‘½ä»¤å«ä¹‰ï¼š" class="headerlink" title="2. mount -l å‘½ä»¤å«ä¹‰ï¼š"></a>2. mount -l å‘½ä»¤å«ä¹‰ï¼š</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep <span class="string">&#x27;/run/containerd/io.containerd.runtime.v2.task/k8s.io&#x27;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | xargs -r <span class="built_in">sudo</span> umount -l</span><br></pre></td></tr></table></figure>

<h3 id="è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ"><a href="#è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ" class="headerlink" title="è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ"></a>è¿™ä¸ªå‘½ä»¤ä¼šåšä»€ä¹ˆï¼Ÿ</h3><ul>
<li>æ‰¾å‡ºæ‰€æœ‰æŒ‚è½½åœ¨ <code>/run/containerd/io.containerd.runtime.v2.task/k8s.io/*</code> ä¸‹çš„ mount pointã€‚</li>
<li>å¯¹å®ƒä»¬æ‰§è¡Œ <code>umount -l</code>ï¼ˆlazy umountï¼‰ã€‚</li>
</ul>
<p><strong>lazy umount å«ä¹‰</strong>ï¼š</p>
<ul>
<li>é©¬ä¸ŠæŠŠæŒ‚è½½ç‚¹ä» mount namespace é‡Œâ€œæ‘˜æ‰â€ï¼Œè¿›ç¨‹ä¸å†èƒ½é€šè¿‡è·¯å¾„è®¿é—®å®ƒã€‚</li>
<li>å¦‚æœæœ‰è¿›ç¨‹ä»ç„¶æŒæœ‰ fdï¼Œä¼šç­‰å®ƒä»¬å…³é—­ fd ä¹‹åå†çœŸæ­£é‡Šæ”¾èµ„æºï¼ˆinodeã€dentryã€slabï¼‰ã€‚</li>
<li>è¿™æ ·é¿å…äº† <code>umount</code> æŠ¥é”™ â€œbusyâ€ï¼Œç®—æ˜¯æ¯”è¾ƒæ¸©å’Œçš„æ–¹å¼ã€‚</li>
</ul>
<hr>
<h2 id="3-å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“"><a href="#3-å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“" class="headerlink" title="3. å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“"></a>3. å¯¹å½“å‰ç³»ç»Ÿçš„å½±å“</h2><ul>
<li><p><strong>å¦‚æœå®¹å™¨ä»ç„¶æ´»è·ƒ</strong>ï¼šå¯¹åº” Pod ä¼šç«‹åˆ»å¤±æ•ˆï¼Œå› ä¸º rootfs è¢«æ‘˜æ‰äº†ï¼Œé‡Œé¢çš„æ–‡ä»¶ç³»ç»Ÿæ¶ˆå¤±ã€‚</p>
</li>
<li><p><strong>å¦‚æœå®¹å™¨å·²ç» STOPPED</strong>ï¼ˆåƒä½ è¿™ç§ï¼‰ï¼š</p>
<ul>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹å½±å“æœ‰é™ï¼Œç­‰ä»·äºæ¸…ç†åƒåœ¾æŒ‚è½½ç‚¹ã€‚</li>
<li>ä¸è¿‡è¦å°å¿ƒï¼šå¦‚æœ containerd metadata é‡Œè¿˜è®°å½•è¿™ä¸ªå®¹å™¨å­˜åœ¨ï¼Œcontainerd åœ¨åç»­ GC æˆ–è€…å›æ”¶æ—¶å¯èƒ½ä¼šå‘ç°æ‰¾ä¸åˆ°æŒ‚è½½ç‚¹ï¼Œä»è€ŒæŠ¥é”™ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-å»ºè®®æ“ä½œé¡ºåº"><a href="#4-å»ºè®®æ“ä½œé¡ºåº" class="headerlink" title="4. å»ºè®®æ“ä½œé¡ºåº"></a>4. å»ºè®®æ“ä½œé¡ºåº</h2><p>æ›´æ¸©å’Œçš„æ–¹æ¡ˆå¯ä»¥è¿™æ ·åˆ†çº§ï¼š</p>
<ol>
<li><p><strong>ä¼˜å…ˆè®© containerd æ¸…ç†</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctr -n k8s.io tasks <span class="built_in">rm</span> 200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br><span class="line">ctr -n k8s.io containers <span class="built_in">rm</span> 200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>

<p>ï¼ˆå¦‚æœå¡ä½ï¼Œè¯´æ˜ shim&#x2F;è¿›ç¨‹ä¾èµ–è¿˜åœ¨ï¼‰</p>
</li>
<li><p><strong>ç¡®è®¤ mount</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount | grep 200ab1146de</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å† lazy umount</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> umount -l /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9/rootfs</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æœ€åæ¸…ç†ç›®å½•</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /run/containerd/io.containerd.runtime.v2.task/k8s.io/200ab1146de738bcbe79e3e976eada34003b61de007a61d4b29f007eb5381bf9</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¦‚æœæœ‰å¤§é‡æ®‹ç•™</strong>ï¼Œä½ é‚£ä¸ª <code>awk | xargs umount -l</code> å¯ä»¥ä½œä¸ºæ‰¹é‡æ¸…ç†æ‰‹æ®µï¼Œä½†æœ€å¥½åœ¨ç¡®è®¤è¿™äº›å®¹å™¨éƒ½å·²ç» STOPPED æˆ–å·²è¢« K8s åˆ é™¤çš„å‰æä¸‹åšã€‚</p>
</li>
</ol>
<hr>
<p>âœ… ç»“è®ºï¼š</p>
<ul>
<li>ä½ çš„ <code>umount -l</code> æ˜¯æ¸©å’Œå¯è¡Œçš„ï¼Œä¸ä¼šç›´æ¥ kill è¿›ç¨‹ï¼Œä½†ä¼šè®©å®¹å™¨ rootfs æ¶ˆå¤±ã€‚</li>
<li><strong>å¦‚æœåªæ˜¯æ¸…ç† STOPPED çš„æ®‹ç•™å®¹å™¨</strong>ï¼Œå‡ ä¹æ²¡å‰¯ä½œç”¨ï¼Œè¿˜èƒ½å›æ”¶ inode&#x2F;slabã€‚</li>
<li>å»ºè®® <strong>å…ˆç”¨ ctr rm</strong> å°è¯•è®© containerd è‡ªå·±æ¸…ç†ï¼Œå†æ‰‹åŠ¨ umount + rm å…œåº•ã€‚</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/16/MTU%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%E5%92%8C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/16/MTU%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97%E5%92%8C%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" class="post-title-link" itemprop="url">MTUå®Œæ•´æŒ‡å—å’Œæ•…éšœæ’æŸ¥</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-16 11:03:44" itemprop="dateCreated datePublished" datetime="2025-09-16T11:03:44+08:00">2025-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-27 10:54:04" itemprop="dateModified" datetime="2025-10-27T10:54:04+08:00">2025-10-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ğŸ¯-MTUå¿«é€Ÿç†è§£"><a href="#ğŸ¯-MTUå¿«é€Ÿç†è§£" class="headerlink" title="ğŸ¯ MTUå¿«é€Ÿç†è§£"></a>ğŸ¯ MTUå¿«é€Ÿç†è§£</h2><h3 id="ä»€ä¹ˆæ˜¯MTUï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯MTUï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯MTUï¼Ÿ"></a>ä»€ä¹ˆæ˜¯MTUï¼Ÿ</h3><p><strong>MTU (Maximum Transmission Unit)</strong> &#x3D; ç½‘ç»œæ¥å£ä¸€æ¬¡èƒ½ä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ï¼ˆå­—èŠ‚ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç®€å•ç±»æ¯”ï¼š</span><br><span class="line">MTUå°±åƒè´§è½¦çš„è½½é‡é™åˆ¶</span><br><span class="line">- è´§è½¦é™é‡5å¨ï¼Œè£…6å¨å°±è¶…è½½äº†</span><br><span class="line">- ç½‘å¡MTU=1500ï¼Œå‘é€1600å­—èŠ‚åŒ…å°±ä¼šæœ‰é—®é¢˜</span><br></pre></td></tr></table></figure>

<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ ‡å‡†ä»¥å¤ªç½‘MTU = 1500å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ IPå¤´: 20å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ TCPå¤´: 20å­—èŠ‚  </span><br><span class="line">â””â”€â”€ æ•°æ®è½½è·: æœ€å¤§1460å­—èŠ‚</span><br><span class="line"></span><br><span class="line">è™šæ‹ŸåŒ–ç¯å¢ƒMTU &lt; 1500å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ åŸå§‹æ•°æ®: 1460å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ TCP/IPå¤´: 40å­—èŠ‚</span><br><span class="line">â”œâ”€â”€ è™šæ‹ŸåŒ–å¼€é”€: 50å­—èŠ‚</span><br><span class="line">â””â”€â”€ æ€»è®¡: 1550å­—èŠ‚ &gt; 1500å­—èŠ‚ âŒè¶…å‡ºé™åˆ¶</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”-MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤"><a href="#ğŸ”-MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤" class="headerlink" title="ğŸ” MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤"></a>ğŸ” MTUæ£€æµ‹å’ŒæŸ¥çœ‹å‘½ä»¤</h2><h3 id="1-æŸ¥çœ‹å½“å‰MTUå€¼"><a href="#1-æŸ¥çœ‹å½“å‰MTUå€¼" class="headerlink" title="1. æŸ¥çœ‹å½“å‰MTUå€¼"></a>1. æŸ¥çœ‹å½“å‰MTUå€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£MTU</span></span><br><span class="line">ip <span class="built_in">link</span> show</span><br><span class="line"><span class="comment"># æˆ–</span></span><br><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šæ¥å£</span></span><br><span class="line">ip <span class="built_in">link</span> show eth0</span><br><span class="line">ip <span class="built_in">link</span> show docker0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€è¡Œå‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æ¥å£MTU</span></span><br><span class="line">ip -o <span class="built_in">link</span> show | awk <span class="string">&#x27;&#123;print $2, $5&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-æµ‹è¯•MTUå¤§å°"><a href="#2-æµ‹è¯•MTUå¤§å°" class="headerlink" title="2. æµ‹è¯•MTUå¤§å°"></a>2. æµ‹è¯•MTUå¤§å°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pingæµ‹è¯•MTU (Linux)</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 8.8.8.8    <span class="comment"># 1472 + 28(ICMPå¤´) = 1500</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1500 8.8.8.8    <span class="comment"># ä¼šå¤±è´¥ï¼Œå› ä¸ºåŠ ä¸Šå¤´éƒ¨è¶…è¿‡MTU</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Windowsä¸‹æµ‹è¯•</span></span><br><span class="line">ping -f -l 1472 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨å‘ç°è·¯å¾„MTU</span></span><br><span class="line">tracepath google.com</span><br></pre></td></tr></table></figure>

<h3 id="3-Docker-MTUæŸ¥çœ‹"><a href="#3-Docker-MTUæŸ¥çœ‹" class="headerlink" title="3. Docker MTUæŸ¥çœ‹"></a>3. Docker MTUæŸ¥çœ‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹Dockerç½‘ç»œMTU</span></span><br><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">docker network inspect bridge | grep -i mtu</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ç½‘ç»œMTU</span></span><br><span class="line">docker <span class="built_in">exec</span> &lt;container&gt; ip <span class="built_in">link</span> show eth0</span><br></pre></td></tr></table></figure>

<h2 id="âš™ï¸-MTUé…ç½®æ–¹æ³•"><a href="#âš™ï¸-MTUé…ç½®æ–¹æ³•" class="headerlink" title="âš™ï¸ MTUé…ç½®æ–¹æ³•"></a>âš™ï¸ MTUé…ç½®æ–¹æ³•</h2><h3 id="1-ä¸´æ—¶ä¿®æ”¹MTU"><a href="#1-ä¸´æ—¶ä¿®æ”¹MTU" class="headerlink" title="1. ä¸´æ—¶ä¿®æ”¹MTU"></a>1. ä¸´æ—¶ä¿®æ”¹MTU</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç½‘ç»œæ¥å£MTU</span></span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 mtu 1450</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 mtu 1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹Dockeræ¡¥æ¥MTU</span></span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 down</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 mtu 1450</span><br><span class="line"><span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev docker0 up</span><br></pre></td></tr></table></figure>

<h3 id="2-æ°¸ä¹…é…ç½®MTU"><a href="#2-æ°¸ä¹…é…ç½®MTU" class="headerlink" title="2. æ°¸ä¹…é…ç½®MTU"></a>2. æ°¸ä¹…é…ç½®MTU</h3><h4 id="Docker-daemoné…ç½®"><a href="#Docker-daemoné…ç½®" class="headerlink" title="Docker daemoné…ç½®"></a>Docker daemoné…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mtu&quot;</span>: 1450,</span><br><span class="line">  <span class="string">&quot;bridge&quot;</span>: <span class="string">&quot;docker0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯DockeræœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®"><a href="#ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®" class="headerlink" title="ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®"></a>ç³»ç»Ÿç½‘ç»œæ¥å£é…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS/RHEL: /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line">MTU=1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu: /etc/netplan/01-netcfg.yaml</span></span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  ethernets:</span><br><span class="line">    eth0:</span><br><span class="line">      mtu: 1450</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> netplan apply</span><br></pre></td></tr></table></figure>

<h3 id="3-Kubernetesç¯å¢ƒMTUé…ç½®"><a href="#3-Kubernetesç¯å¢ƒMTUé…ç½®" class="headerlink" title="3. Kubernetesç¯å¢ƒMTUé…ç½®"></a>3. Kubernetesç¯å¢ƒMTUé…ç½®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CNIæ’ä»¶é…ç½® (ä»¥Calicoä¸ºä¾‹)</span></span><br><span class="line"><span class="comment"># /etc/cni/net.d/10-calico.conf</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;k8s-pod-network&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cniVersion&quot;</span>: <span class="string">&quot;0.3.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;calico&quot;</span>,</span><br><span class="line">      <span class="string">&quot;mtu&quot;</span>: 1450</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ğŸš¨-éœ€è¦å…³æ³¨MTUçš„åœºæ™¯"><a href="#ğŸš¨-éœ€è¦å…³æ³¨MTUçš„åœºæ™¯" class="headerlink" title="ğŸš¨ éœ€è¦å…³æ³¨MTUçš„åœºæ™¯"></a>ğŸš¨ éœ€è¦å…³æ³¨MTUçš„åœºæ™¯</h2><h3 id="1-è™šæ‹ŸåŒ–ç¯å¢ƒ-â­â­â­"><a href="#1-è™šæ‹ŸåŒ–ç¯å¢ƒ-â­â­â­" class="headerlink" title="1. è™šæ‹ŸåŒ–ç¯å¢ƒ â­â­â­"></a>1. è™šæ‹ŸåŒ–ç¯å¢ƒ â­â­â­</h3><p><strong>åœºæ™¯</strong>: VMwareã€KVMã€Hyper-Vç­‰è™šæ‹Ÿæœº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">ip <span class="built_in">link</span> show | grep mtu</span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 &lt;target&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- VMç½‘å¡MTU=1500ï¼Œä½†ç‰©ç†ç½‘å¡å®é™…æ”¯æŒ&lt;1500</span><br><span class="line">- å¤šå±‚è™šæ‹ŸåŒ–å åŠ å¯¼è‡´MTUé€’å‡</span><br><span class="line">- VXLAN/GREéš§é“é¢å¤–å¼€é”€</span><br></pre></td></tr></table></figure>

<h3 id="2-å®¹å™¨ç¯å¢ƒ-â­â­â­"><a href="#2-å®¹å™¨ç¯å¢ƒ-â­â­â­" class="headerlink" title="2. å®¹å™¨ç¯å¢ƒ â­â­â­"></a>2. å®¹å™¨ç¯å¢ƒ â­â­â­</h3><p><strong>åœºæ™¯</strong>: Dockerã€Kubernetesã€å®¹å™¨ç½‘ç»œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">docker network inspect bridge</span><br><span class="line">kubectl get nodes -o custom-columns=<span class="string">&quot;NAME:.metadata.name,MTU:.status.addresses[0].type&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- Dockeræ¡¥æ¥ç½‘ç»œMTUä¸åŒ¹é…</span><br><span class="line">- Overlayç½‘ç»œé¢å¤–å°è£…</span><br><span class="line">- CNIæ’ä»¶é…ç½®é”™è¯¯</span><br></pre></td></tr></table></figure>

<h3 id="3-äº‘ç¯å¢ƒ-â­â­"><a href="#3-äº‘ç¯å¢ƒ-â­â­" class="headerlink" title="3. äº‘ç¯å¢ƒ â­â­"></a>3. äº‘ç¯å¢ƒ â­â­</h3><p><strong>åœºæ™¯</strong>: AWSã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å…¬æœ‰äº‘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">curl -s http://169.254.169.254/latest/meta-data/network/interfaces/macs/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- äº‘ä¸»æœºé»˜è®¤MTUå¯èƒ½&lt;1500</span><br><span class="line">- VPCç½‘ç»œé—´MTUä¸ä¸€è‡´</span><br><span class="line">- è·¨å¯ç”¨åŒºç½‘ç»œMTUå·®å¼‚</span><br></pre></td></tr></table></figure>

<h3 id="4-SD-WAN-éš§é“ç½‘ç»œ-â­â­"><a href="#4-SD-WAN-éš§é“ç½‘ç»œ-â­â­" class="headerlink" title="4. SD-WAN&#x2F;éš§é“ç½‘ç»œ â­â­"></a>4. SD-WAN&#x2F;éš§é“ç½‘ç»œ â­â­</h3><p><strong>åœºæ™¯</strong>: VPNã€ä¸“çº¿ã€éš§é“è¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥å‘½ä»¤</span></span><br><span class="line">tracepath &lt;remote-host&gt;</span><br><span class="line">mtr --report &lt;remote-host&gt;</span><br><span class="line">mtr -rn www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚è€ƒ</span></span><br><span class="line">https://www.cnblogs.com/xzongblogs/p/15062134.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸¸è§é—®é¢˜</span></span><br><span class="line">- VPNéš§é“é¢å¤–å¼€é”€</span><br><span class="line">- MPLSç½‘ç»œMTUé™åˆ¶</span><br><span class="line">- è·¨è¿è¥å•†ç½‘ç»œMTUä¸ç»Ÿä¸€</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ› ï¸-MTUæ•…éšœæ’æŸ¥æµç¨‹"><a href="#ğŸ› ï¸-MTUæ•…éšœæ’æŸ¥æµç¨‹" class="headerlink" title="ğŸ› ï¸ MTUæ•…éšœæ’æŸ¥æµç¨‹"></a>ğŸ› ï¸ MTUæ•…éšœæ’æŸ¥æµç¨‹</h2><h3 id="é˜¶æ®µ1-ç—‡çŠ¶è¯†åˆ«"><a href="#é˜¶æ®µ1-ç—‡çŠ¶è¯†åˆ«" class="headerlink" title="é˜¶æ®µ1: ç—‡çŠ¶è¯†åˆ«"></a>é˜¶æ®µ1: ç—‡çŠ¶è¯†åˆ«</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¸¸è§ç—‡çŠ¶</span></span><br><span class="line">âœ“ å¤§æ–‡ä»¶ä¼ è¾“å¤±è´¥æˆ–å¾ˆæ…¢</span><br><span class="line">âœ“ SSHè¿æ¥å»ºç«‹åå‘½ä»¤æ‰§è¡Œå¡æ­»</span><br><span class="line">âœ“ HTTPè¯·æ±‚é—´æ­‡æ€§å¤±è´¥</span><br><span class="line">âœ“ æ•°æ®åº“è¿æ¥è¶…æ—¶</span><br><span class="line">âœ“ æ–‡ä»¶ä¸Šä¼ å¤±è´¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿«é€Ÿæ£€æµ‹å‘½ä»¤</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1472 &lt;target&gt;     <span class="comment"># æµ‹è¯•æ˜¯å¦èƒ½é€š</span></span><br><span class="line">ping -M <span class="keyword">do</span> -s 1400 &lt;target&gt;     <span class="comment"># é™ä½æµ‹è¯•</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ2-MTUè·¯å¾„å‘ç°"><a href="#é˜¶æ®µ2-MTUè·¯å¾„å‘ç°" class="headerlink" title="é˜¶æ®µ2: MTUè·¯å¾„å‘ç°"></a>é˜¶æ®µ2: MTUè·¯å¾„å‘ç°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹æ³•1: tracepath (æ¨è)</span></span><br><span class="line">tracepath google.com</span><br><span class="line"><span class="comment"># è¾“å‡ºä¼šæ˜¾ç¤ºè·¯å¾„ä¸Šçš„MTUå€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2: pingäºŒåˆ†æ³•æµ‹è¯•</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">find_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> host=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> low=1</span><br><span class="line">    <span class="built_in">local</span> high=1500</span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$low</span> -lt <span class="variable">$high</span> ]; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">local</span> mid=$(( (low + high + <span class="number">1</span>) / <span class="number">2</span> ))</span><br><span class="line">        <span class="keyword">if</span> ping -c 1 -M <span class="keyword">do</span> -s <span class="variable">$mid</span> <span class="variable">$host</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            low=<span class="variable">$mid</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            high=$((mid - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æœ€å¤§MTU: <span class="subst">$((low + 28)</span>)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: find_mtu google.com</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ3-åˆ†å±‚æ’æŸ¥"><a href="#é˜¶æ®µ3-åˆ†å±‚æ’æŸ¥" class="headerlink" title="é˜¶æ®µ3: åˆ†å±‚æ’æŸ¥"></a>é˜¶æ®µ3: åˆ†å±‚æ’æŸ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. ä¸»æœºç½‘ç»œå±‚</span></span><br><span class="line">ip <span class="built_in">link</span> show                    <span class="comment"># æŸ¥çœ‹æ¥å£MTU</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/route             <span class="comment"># æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line">netstat -i                      <span class="comment"># æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è™šæ‹ŸåŒ–å±‚</span></span><br><span class="line"><span class="comment"># VMware</span></span><br><span class="line">vmware-toolbox-cmd <span class="built_in">stat</span> speed</span><br><span class="line"><span class="comment"># KVM</span></span><br><span class="line">virsh domiflist &lt;vm-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®¹å™¨å±‚</span></span><br><span class="line">docker network inspect bridge</span><br><span class="line">kubectl describe node | grep -i mtu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. åº”ç”¨å±‚</span></span><br><span class="line">ss -i                           <span class="comment"># æŸ¥çœ‹TCPè¿æ¥ä¿¡æ¯</span></span><br><span class="line">netstat -s | grep -i fragment   <span class="comment"># æŸ¥çœ‹åˆ†ç‰‡ç»Ÿè®¡</span></span><br></pre></td></tr></table></figure>

<h3 id="é˜¶æ®µ4-æ€§èƒ½éªŒè¯"><a href="#é˜¶æ®µ4-æ€§èƒ½éªŒè¯" class="headerlink" title="é˜¶æ®µ4: æ€§èƒ½éªŒè¯"></a>é˜¶æ®µ4: æ€§èƒ½éªŒè¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è¯•è„šæœ¬</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># mtu_test.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== MTUæ€§èƒ½æµ‹è¯• ===&quot;</span></span><br><span class="line"><span class="keyword">for</span> size <span class="keyword">in</span> 1400 1450 1472 1500; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;æµ‹è¯• MTU <span class="variable">$size</span>: &quot;</span></span><br><span class="line">    <span class="keyword">if</span> ping -c 3 -M <span class="keyword">do</span> -s $((size-<span class="number">28</span>)) 8.8.8.8 &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âœ“ é€šè¿‡&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âœ— å¤±è´¥&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="ğŸ“Š-ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼"><a href="#ğŸ“Š-ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼" class="headerlink" title="ğŸ“Š ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼"></a>ğŸ“Š ä¸åŒåœºæ™¯çš„MTUæ¨èå€¼</h2><h3 id="æ ‡å‡†ç½‘ç»œç¯å¢ƒ"><a href="#æ ‡å‡†ç½‘ç»œç¯å¢ƒ" class="headerlink" title="æ ‡å‡†ç½‘ç»œç¯å¢ƒ"></a>æ ‡å‡†ç½‘ç»œç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä»¥å¤ªç½‘: 1500          <span class="comment"># æ ‡å‡†å€¼</span></span><br><span class="line">åƒå…†ä»¥å¤ªç½‘: 9000      <span class="comment"># Jumbo Frame</span></span><br><span class="line">Wi-Fi: 1500           <span class="comment"># é€šå¸¸ä¸ä»¥å¤ªç½‘ç›¸åŒ</span></span><br></pre></td></tr></table></figure>

<h3 id="è™šæ‹ŸåŒ–ç¯å¢ƒ"><a href="#è™šæ‹ŸåŒ–ç¯å¢ƒ" class="headerlink" title="è™šæ‹ŸåŒ–ç¯å¢ƒ"></a>è™šæ‹ŸåŒ–ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VMware vSphere: 1450-1480    <span class="comment"># è€ƒè™‘VXLANå¼€é”€</span></span><br><span class="line">KVM/QEMU: 1450               <span class="comment"># ä¿å®ˆå€¼</span></span><br><span class="line">Hyper-V: 1500                <span class="comment"># é€šå¸¸æ”¯æŒæ ‡å‡†å€¼</span></span><br><span class="line">Docker: 1450-1480            <span class="comment"># å–å†³äºåº•å±‚ç½‘ç»œ</span></span><br></pre></td></tr></table></figure>

<h3 id="äº‘ç¯å¢ƒ"><a href="#äº‘ç¯å¢ƒ" class="headerlink" title="äº‘ç¯å¢ƒ"></a>äº‘ç¯å¢ƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AWS EC2: 1500 (enhanced networking)</span><br><span class="line">       : 1500-9000 (placement group)</span><br><span class="line">é˜¿é‡Œäº‘ECS: 1500</span><br><span class="line">è…¾è®¯äº‘CVM: 1500</span><br><span class="line">Azure VM: 1500</span><br></pre></td></tr></table></figure>

<h3 id="å®¹å™¨ç½‘ç»œ"><a href="#å®¹å™¨ç½‘ç»œ" class="headerlink" title="å®¹å™¨ç½‘ç»œ"></a>å®¹å™¨ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Docker bridge: 1450-1480</span><br><span class="line">Kubernetes:</span><br><span class="line">  - Flannel: 1450</span><br><span class="line">  - Calico: 1440-1480  </span><br><span class="line">  - Weave: 1376</span><br><span class="line">  - Cilium: 1450</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ”§-è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬"><a href="#ğŸ”§-è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬" class="headerlink" title="ğŸ”§ è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬"></a>ğŸ”§ è‡ªåŠ¨åŒ–MTUç®¡ç†è„šæœ¬</h2><h3 id="MTUæ£€æµ‹è„šæœ¬"><a href="#MTUæ£€æµ‹è„šæœ¬" class="headerlink" title="MTUæ£€æµ‹è„šæœ¬"></a>MTUæ£€æµ‹è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># auto_mtu_detect.sh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">detect_optimal_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> target=<span class="variable">$&#123;1:-8.8.8.8&#125;</span></span><br><span class="line">    <span class="built_in">local</span> max_mtu=1500</span><br><span class="line">    <span class="built_in">local</span> min_mtu=1200</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æ£€æµ‹åˆ° <span class="variable">$target</span> çš„æœ€ä¼˜MTU...&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ((mtu=max_mtu; mtu&gt;=min_mtu; mtu-=<span class="number">50</span>)); <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> ping -c 2 -M <span class="keyword">do</span> -s $((mtu-<span class="number">28</span>)) <span class="variable">$target</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;å‘ç°å¯ç”¨MTU: <span class="variable">$mtu</span>&quot;</span></span><br><span class="line">            <span class="comment"># ç²¾ç¡®æœç´¢</span></span><br><span class="line">            <span class="keyword">for</span> ((i=mtu; i&lt;=mtu+<span class="number">50</span>; i++)); <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> ! ping -c 1 -M <span class="keyword">do</span> -s $((i-<span class="number">28</span>)) <span class="variable">$target</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">&quot;æœ€ä¼˜MTU: <span class="subst">$((i-1)</span>)&quot;</span></span><br><span class="line">                    <span class="built_in">return</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">done</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;æœªèƒ½æ£€æµ‹åˆ°åˆé€‚çš„MTUå€¼&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨</span></span><br><span class="line">detect_optimal_mtu</span><br></pre></td></tr></table></figure>

<h3 id="ç³»ç»ŸMTUé…ç½®è„šæœ¬"><a href="#ç³»ç»ŸMTUé…ç½®è„šæœ¬" class="headerlink" title="ç³»ç»ŸMTUé…ç½®è„šæœ¬"></a>ç³»ç»ŸMTUé…ç½®è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># set_system_mtu.sh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">set_system_mtu</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> mtu=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">local</span> interface=<span class="variable">$&#123;2:-eth0&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;è®¾ç½® <span class="variable">$interface</span> MTUä¸º <span class="variable">$mtu</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ä¸´æ—¶è®¾ç½®</span></span><br><span class="line">    <span class="built_in">sudo</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev <span class="variable">$interface</span> mtu <span class="variable">$mtu</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ°¸ä¹…è®¾ç½® (Ubuntu)</span></span><br><span class="line">    <span class="keyword">if</span> [[ -f /etc/netplan/01-netcfg.yaml ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">sudo</span> sed -i <span class="string">&quot;/mtu:/d&quot;</span> /etc/netplan/01-netcfg.yaml</span><br><span class="line">        <span class="built_in">sudo</span> sed -i <span class="string">&quot;/dhcp4: true/a\\      mtu: <span class="variable">$mtu</span>&quot;</span> /etc/netplan/01-netcfg.yaml</span><br><span class="line">        <span class="built_in">sudo</span> netplan apply</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Dockeré…ç½®</span></span><br><span class="line">    <span class="keyword">if</span> systemctl is-active --quiet docker; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;é…ç½®Docker MTU...&quot;</span></span><br><span class="line">        <span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;mtu&quot;: &#x27;</span><span class="variable">$mtu</span><span class="string">&#x27;&#125;&#x27;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json</span><br><span class="line">        <span class="built_in">sudo</span> systemctl restart docker</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;MTUé…ç½®å®Œæˆ&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: set_system_mtu 1450</span></span><br></pre></td></tr></table></figure>

<h2 id="âš ï¸-æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ"><a href="#âš ï¸-æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ" class="headerlink" title="âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ"></a>âš ï¸ æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ</h2><h3 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h3><ul>
<li><strong>ç”Ÿäº§ç¯å¢ƒä¿®æ”¹è¦è°¨æ…</strong>: MTUä¿®æ”¹å¯èƒ½å¯¼è‡´ç½‘ç»œä¸­æ–­</li>
<li><strong>é€æ­¥è°ƒæ•´</strong>: ä»å°å€¼å¼€å§‹ï¼Œé€æ­¥è°ƒæ•´åˆ°æœ€ä¼˜å€¼</li>
<li><strong>å¤‡ä»½é…ç½®</strong>: ä¿®æ”¹å‰å¤‡ä»½ç½‘ç»œé…ç½®æ–‡ä»¶</li>
<li><strong>æµ‹è¯•éªŒè¯</strong>: ä¿®æ”¹åå……åˆ†æµ‹è¯•ç½‘ç»œè¿é€šæ€§</li>
</ul>
<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><ol>
<li><strong>è‡ªåŠ¨å‘ç°ä¼˜äºæ‰‹åŠ¨é…ç½®</strong>: ä½¿ç”¨å·¥å…·è‡ªåŠ¨æ£€æµ‹æœ€ä¼˜MTU</li>
<li><strong>åˆ†å±‚ä¸€è‡´æ€§</strong>: ç¡®ä¿å„ç½‘ç»œå±‚MTUé…ç½®ä¸€è‡´</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>: ç›‘æ§ç½‘ç»œåˆ†ç‰‡å’Œä¸¢åŒ…æƒ…å†µ</li>
<li><strong>æ–‡æ¡£è®°å½•</strong>: è®°å½•MTUé…ç½®çš„åŸå› å’Œæ•°å€¼</li>
</ol>
<h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><p>âŒ <strong>è®¤ä¸ºMTUè¶Šå¤§è¶Šå¥½</strong>: ä¸æ˜¯çš„ï¼Œè¦åŒ¹é…ç½‘ç»œç¯å¢ƒ<br>âŒ <strong>åªè®¾ç½®åº”ç”¨å±‚MTU</strong>: éœ€è¦å…¨é“¾è·¯ä¸€è‡´<br>âŒ <strong>å¿½ç•¥è™šæ‹ŸåŒ–å¼€é”€</strong>: è™šæ‹Ÿç¯å¢ƒéœ€è¦é¢„ç•™å¼€é”€<br>âŒ <strong>è®¾ç½®åä¸éªŒè¯</strong>: å¿…é¡»é€šè¿‡å®é™…æµ‹è¯•éªŒè¯æ•ˆæœ</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/16/lsns%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/16/lsns%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/" class="post-title-link" itemprop="url">lsnså‘½ä»¤ä½¿ç”¨æŒ‡å—ä¸æ•…éšœæ’æŸ¥</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-16 10:49:11 / ä¿®æ”¹æ—¶é—´ï¼š10:49:35" itemprop="dateCreated datePublished" datetime="2025-09-16T10:49:11+08:00">2025-09-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="lsnsåŸºç¡€ç”¨æ³•"><a href="#lsnsåŸºç¡€ç”¨æ³•" class="headerlink" title="lsnsåŸºç¡€ç”¨æ³•"></a>lsnsåŸºç¡€ç”¨æ³•</h2><h3 id="1-åŸºæœ¬å‘½ä»¤"><a href="#1-åŸºæœ¬å‘½ä»¤" class="headerlink" title="1. åŸºæœ¬å‘½ä»¤"></a>1. åŸºæœ¬å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">lsns</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns -p &lt;PID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šç±»å‹çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns -t net        <span class="comment"># ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">lsns -t mnt        <span class="comment"># æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">lsns -t pid        <span class="comment"># PIDå‘½åç©ºé—´</span></span><br><span class="line">lsns -t user       <span class="comment"># ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">lsns -t uts        <span class="comment"># UTSå‘½åç©ºé—´</span></span><br><span class="line">lsns -t ipc        <span class="comment"># IPCå‘½åç©ºé—´</span></span><br><span class="line">lsns -t cgroup     <span class="comment"># cgroupå‘½åç©ºé—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¯¦ç»†è¾“å‡ºæ ¼å¼</span></span><br><span class="line">lsns -l            <span class="comment"># é•¿æ ¼å¼æ˜¾ç¤º</span></span><br><span class="line">lsns -J            <span class="comment"># JSONæ ¼å¼è¾“å‡º</span></span><br><span class="line">lsns -r            <span class="comment"># æ˜¾ç¤ºåŸå§‹è®¾å¤‡å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºç‰¹å®šåˆ—</span></span><br><span class="line">lsns -o NS,TYPE,NPROCS,PID,USER,NETNSID,COMMAND</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸æ˜¾ç¤ºå¤´éƒ¨</span></span><br><span class="line">lsns -n</span><br></pre></td></tr></table></figure>

<h3 id="2-é«˜çº§ç”¨æ³•"><a href="#2-é«˜çº§ç”¨æ³•" class="headerlink" title="2. é«˜çº§ç”¨æ³•"></a>2. é«˜çº§ç”¨æ³•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">lsns --nsfs-file /proc/1/ns/net</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‰ç±»å‹å’Œè¿›ç¨‹æ•°æ’åº</span></span><br><span class="line">lsns -t net -o NS,TYPE,NPROCS,PID,COMMAND | <span class="built_in">sort</span> -k3 -nr</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨ç›¸å…³çš„å‘½åç©ºé—´</span></span><br><span class="line">lsns | grep docker</span><br><span class="line">lsns | grep containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹systemdç›¸å…³å‘½åç©ºé—´</span></span><br><span class="line">lsns | grep systemd</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åç©ºé—´æ“ä½œå‘½ä»¤"><a href="#å‘½åç©ºé—´æ“ä½œå‘½ä»¤" class="headerlink" title="å‘½åç©ºé—´æ“ä½œå‘½ä»¤"></a>å‘½åç©ºé—´æ“ä½œå‘½ä»¤</h2><h3 id="1-è¿›å…¥å‘½åç©ºé—´"><a href="#1-è¿›å…¥å‘½åç©ºé—´" class="headerlink" title="1. è¿›å…¥å‘½åç©ºé—´"></a>1. è¿›å…¥å‘½åç©ºé—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ç‰¹å®šè¿›ç¨‹çš„ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å¤šä¸ªå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n -p -m bash     <span class="comment"># ç½‘ç»œ+PID+æŒ‚è½½</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -a bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ipå‘½ä»¤è¿›å…¥ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip netns <span class="built_in">exec</span> &lt;netns-name&gt; bash</span><br></pre></td></tr></table></figure>

<h3 id="2-æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…"><a href="#2-æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…" class="headerlink" title="2. æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…"></a>2. æŸ¥çœ‹å‘½åç©ºé—´è¯¦æƒ…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹çš„å‘½åç©ºé—´æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ls</span> -la /proc/&lt;PID&gt;/ns/</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip netns list</span><br><span class="line">ip netns show</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/mounts</span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/mountinfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PIDå‘½åç©ºé—´</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;PID&gt;/status | grep NSpid</span><br></pre></td></tr></table></figure>

<h3 id="3-å‘½åç©ºé—´ç›‘æ§"><a href="#3-å‘½åç©ºé—´ç›‘æ§" class="headerlink" title="3. å‘½åç©ºé—´ç›‘æ§"></a>3. å‘½åç©ºé—´ç›‘æ§</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®æ—¶ç›‘æ§å‘½åç©ºé—´å˜åŒ–</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;lsns -t net&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½åç©ºé—´ç»Ÿè®¡</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br></pre></td></tr></table></figure>

<h2 id="æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•"><a href="#æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•" class="headerlink" title="æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•"></a>æ•…éšœæ’æŸ¥åœºæ™¯å’Œå‘½ä»¤æ¸…å•</h2><h3 id="ğŸ”-åœºæ™¯1-å®¹å™¨ç½‘ç»œé—®é¢˜"><a href="#ğŸ”-åœºæ™¯1-å®¹å™¨ç½‘ç»œé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯1: å®¹å™¨ç½‘ç»œé—®é¢˜"></a>ğŸ” åœºæ™¯1: å®¹å™¨ç½‘ç»œé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨æ— æ³•è®¿é—®ç½‘ç»œï¼ŒDNSè§£æå¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹å®¹å™¨ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">docker inspect &lt;container&gt; | grep NetworkMode</span><br><span class="line">lsns -t net | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨ç½‘ç»œå‘½åç©ºé—´æ’æŸ¥</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -n bash</span><br><span class="line">ip addr show                    <span class="comment"># æŸ¥çœ‹ç½‘ç»œæ¥å£</span></span><br><span class="line">ip route show                   <span class="comment"># æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line"><span class="built_in">cat</span> /etc/resolv.conf            <span class="comment"># æŸ¥çœ‹DNSé…ç½®</span></span><br><span class="line">ping 8.8.8.8                    <span class="comment"># æµ‹è¯•ç½‘ç»œè¿é€šæ€§</span></span><br><span class="line">nslookup google.com             <span class="comment"># æµ‹è¯•DNSè§£æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯¹æ¯”å®¿ä¸»æœºç½‘ç»œ</span></span><br><span class="line"><span class="built_in">exit</span>  <span class="comment"># é€€å‡ºå®¹å™¨ç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">ip addr show                    <span class="comment"># å®¿ä¸»æœºç½‘ç»œæ¥å£</span></span><br><span class="line">ip route show                   <span class="comment"># å®¿ä¸»æœºè·¯ç”±è¡¨</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯2-å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜"><a href="#ğŸ”-åœºæ™¯2-å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯2: å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜"></a>ğŸ” åœºæ™¯2: å®¹å™¨æ–‡ä»¶ç³»ç»Ÿé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…æ–‡ä»¶ä¸¢å¤±ï¼ŒæŒ‚è½½ç‚¹å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">lsns -t mnt | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨æŒ‚è½½å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -m bash</span><br><span class="line">mount | grep &lt;path&gt;             <span class="comment"># æŸ¥çœ‹ç‰¹å®šè·¯å¾„æŒ‚è½½</span></span><br><span class="line"><span class="built_in">df</span> -h                           <span class="comment"># æŸ¥çœ‹ç£ç›˜ä½¿ç”¨</span></span><br><span class="line">findmnt                         <span class="comment"># è¯¦ç»†æŒ‚è½½ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å¯¹æ¯”å®¿ä¸»æœºæŒ‚è½½</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">mount | grep &lt;container-volume&gt;</span><br><span class="line">docker inspect &lt;container&gt; | grep Mounts</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯3-è¿›ç¨‹PIDé—®é¢˜"><a href="#ğŸ”-åœºæ™¯3-è¿›ç¨‹PIDé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯3: è¿›ç¨‹PIDé—®é¢˜"></a>ğŸ” åœºæ™¯3: è¿›ç¨‹PIDé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…PIDå†²çªï¼Œè¿›ç¨‹ç®¡ç†å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹PIDå‘½åç©ºé—´</span></span><br><span class="line">lsns -t pid | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. è¿›å…¥å®¹å™¨PIDå‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -p bash</span><br><span class="line">ps aux                          <span class="comment"># æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹</span></span><br><span class="line">pstree                          <span class="comment"># è¿›ç¨‹æ ‘</span></span><br><span class="line"><span class="built_in">cat</span> /proc/1/cmdline             <span class="comment"># å®¹å™¨å†…PID 1è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹å®¿ä¸»æœºè§†è§’çš„è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ps aux | grep &lt;container-name&gt;</span><br><span class="line">pstree -p &lt;container-pid&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯4-ç”¨æˆ·æƒé™é—®é¢˜"><a href="#ğŸ”-åœºæ™¯4-ç”¨æˆ·æƒé™é—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯4: ç”¨æˆ·æƒé™é—®é¢˜"></a>ğŸ” åœºæ™¯4: ç”¨æˆ·æƒé™é—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å†…ç”¨æˆ·æƒé™å¼‚å¸¸ï¼Œæ–‡ä»¶è®¿é—®è¢«æ‹’ç»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">lsns -t user | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥ç”¨æˆ·æ˜ å°„</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/uid_map</span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/gid_map</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¿›å…¥å®¹å™¨ç”¨æˆ·å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;container-pid&gt; -U bash</span><br><span class="line"><span class="built_in">id</span>                              <span class="comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">ls</span> -la /                        <span class="comment"># æŸ¥çœ‹æ–‡ä»¶æƒé™</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯5-ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜"><a href="#ğŸ”-åœºæ™¯5-ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯5: ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜"></a>ğŸ” åœºæ™¯5: ç³»ç»Ÿè°ƒç”¨å’Œcgroupé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨èµ„æºé™åˆ¶å¼‚å¸¸ï¼Œæ€§èƒ½é—®é¢˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹cgroupå‘½åç©ºé—´</span></span><br><span class="line">lsns -t cgroup | grep &lt;container-pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ£€æŸ¥cgroupé…ç½®</span></span><br><span class="line"><span class="built_in">cat</span> /proc/&lt;container-pid&gt;/cgroup</span><br><span class="line">systemd-cgls | grep &lt;container&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹èµ„æºä½¿ç”¨</span></span><br><span class="line">docker stats &lt;container&gt;</span><br><span class="line"><span class="built_in">cat</span> /sys/fs/cgroup/memory/docker/&lt;container-id&gt;/memory.usage_in_bytes</span><br><span class="line"><span class="built_in">cat</span> /sys/fs/cgroup/cpu/docker/&lt;container-id&gt;/cpu.shares</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯6-Kubernetes-Podç½‘ç»œé—®é¢˜"><a href="#ğŸ”-åœºæ™¯6-Kubernetes-Podç½‘ç»œé—®é¢˜" class="headerlink" title="ğŸ” åœºæ™¯6: Kubernetes Podç½‘ç»œé—®é¢˜"></a>ğŸ” åœºæ™¯6: Kubernetes Podç½‘ç»œé—®é¢˜</h3><p><strong>ç—‡çŠ¶</strong>: Podé—´é€šä¿¡å¤±è´¥ï¼ŒServiceè®¿é—®å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥æ‰¾Podè¿›ç¨‹</span></span><br><span class="line">kubectl get pods -o wide</span><br><span class="line">ps aux | grep &lt;pod-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æŸ¥çœ‹Podç½‘ç»œå‘½åç©ºé—´</span></span><br><span class="line">PID=$(pgrep -f &lt;pod-container&gt;)</span><br><span class="line">lsns -t net | grep <span class="variable">$PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. è¿›å…¥Podç½‘ç»œç©ºé—´æ’æŸ¥</span></span><br><span class="line">nsenter -t <span class="variable">$PID</span> -n bash</span><br><span class="line">ip addr show                    <span class="comment"># æŸ¥çœ‹Pod IP</span></span><br><span class="line">ip route show                   <span class="comment"># æŸ¥çœ‹è·¯ç”±</span></span><br><span class="line">iptables -L                     <span class="comment"># æŸ¥çœ‹é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚æœæœ‰æƒé™ï¼‰</span></span><br><span class="line">nslookup kubernetes.default     <span class="comment"># æµ‹è¯•é›†ç¾¤DNS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æŸ¥çœ‹CNIé…ç½®</span></span><br><span class="line"><span class="built_in">cat</span> /etc/cni/net.d/*            <span class="comment"># CNIæ’ä»¶é…ç½®</span></span><br><span class="line">ip <span class="built_in">link</span> show                    <span class="comment"># ç½‘ç»œè®¾å¤‡</span></span><br></pre></td></tr></table></figure>

<h3 id="ğŸ”-åœºæ™¯7-å®¹å™¨å¯åŠ¨å¤±è´¥"><a href="#ğŸ”-åœºæ™¯7-å®¹å™¨å¯åŠ¨å¤±è´¥" class="headerlink" title="ğŸ” åœºæ™¯7: å®¹å™¨å¯åŠ¨å¤±è´¥"></a>ğŸ” åœºæ™¯7: å®¹å™¨å¯åŠ¨å¤±è´¥</h3><p><strong>ç—‡çŠ¶</strong>: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡ºï¼ŒçŠ¶æ€å¼‚å¸¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span></span><br><span class="line">docker logs &lt;container&gt;</span><br><span class="line">kubectl logs &lt;pod&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æŸ¥çœ‹å®¹å™¨å‘½åç©ºé—´çŠ¶æ€</span></span><br><span class="line">docker inspect &lt;container&gt; | grep State -A 10</span><br><span class="line">lsns | grep &lt;container-name&gt;    <span class="comment"># çœ‹æ˜¯å¦è¿˜æœ‰å‘½åç©ºé—´æ®‹ç•™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ¨¡æ‹Ÿå®¹å™¨ç¯å¢ƒè°ƒè¯•</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> &lt;image&gt; bash</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">kubectl run debug-pod --image=&lt;image&gt; -it --<span class="built_in">rm</span> -- bash</span><br></pre></td></tr></table></figure>

<h2 id="å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ"><a href="#å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ" class="headerlink" title="å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ"></a>å‘½åç©ºé—´æ’æŸ¥æœ€ä½³å®è·µ</h2><h3 id="1-æ’æŸ¥æµç¨‹"><a href="#1-æ’æŸ¥æµç¨‹" class="headerlink" title="1. æ’æŸ¥æµç¨‹"></a>1. æ’æŸ¥æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 1: è¯†åˆ«é—®é¢˜è¿›ç¨‹</span></span><br><span class="line">ps aux | grep &lt;service-name&gt;</span><br><span class="line">pgrep -f &lt;pattern&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: æŸ¥çœ‹å‘½åç©ºé—´æ¦‚å†µ</span></span><br><span class="line">lsns -p &lt;PID&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: é’ˆå¯¹æ€§è¿›å…¥é—®é¢˜å‘½åç©ºé—´</span></span><br><span class="line">nsenter -t &lt;PID&gt; -n -p -m bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: åœ¨å‘½åç©ºé—´å†…æ’æŸ¥</span></span><br><span class="line"><span class="comment"># ç½‘ç»œ: ip addr, ip route, netstat</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶ç³»ç»Ÿ: mount, df, ls</span></span><br><span class="line"><span class="comment"># è¿›ç¨‹: ps, pstree</span></span><br><span class="line"><span class="comment"># æƒé™: id, whoami, ls -la</span></span><br></pre></td></tr></table></figure>

<h3 id="2-å¸¸ç”¨ç»„åˆå‘½ä»¤"><a href="#2-å¸¸ç”¨ç»„åˆå‘½ä»¤" class="headerlink" title="2. å¸¸ç”¨ç»„åˆå‘½ä»¤"></a>2. å¸¸ç”¨ç»„åˆå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¿«é€ŸæŸ¥çœ‹å®¹å™¨æ‰€æœ‰å‘½åç©ºé—´ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">container_ns_info</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> pid=<span class="variable">$1</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;=== å‘½åç©ºé—´æ¦‚å†µ ===&quot;</span></span><br><span class="line">    lsns -p <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== ç½‘ç»œä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -n ip addr show</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== æŒ‚è½½ä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -m mount | <span class="built_in">head</span> -10</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\n=== è¿›ç¨‹ä¿¡æ¯ ===&quot;</span></span><br><span class="line">    nsenter -t <span class="variable">$pid</span> -p ps aux | <span class="built_in">head</span> -10</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨: container_ns_info &lt;PID&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-ç›‘æ§è„šæœ¬"><a href="#3-ç›‘æ§è„šæœ¬" class="headerlink" title="3. ç›‘æ§è„šæœ¬"></a>3. ç›‘æ§è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ns_monitor.sh - å‘½åç©ºé—´ç›‘æ§è„šæœ¬</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== å‘½åç©ºé—´ç»Ÿè®¡ ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç±»å‹ç»Ÿè®¡:&quot;</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2&#125;&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nè¿›ç¨‹æ•°æœ€å¤šçš„å‘½åç©ºé—´:&quot;</span></span><br><span class="line">lsns | awk <span class="string">&#x27;NR&gt;1 &#123;print $2, $3, $5&#125;&#x27;</span> | <span class="built_in">sort</span> -k2 -nr | <span class="built_in">head</span> -5</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nå®¹å™¨ç›¸å…³å‘½åç©ºé—´:&quot;</span></span><br><span class="line">lsns | grep -E <span class="string">&quot;(docker|containerd|runc)&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>âš ï¸ <strong>å®‰å…¨æé†’</strong>:</p>
<ul>
<li>ä½¿ç”¨<code>nsenter</code>éœ€è¦rootæƒé™æˆ–ç›¸åº”çš„capabilities</li>
<li>è¿›å…¥ç”Ÿäº§å®¹å™¨å‘½åç©ºé—´è¦è°¨æ…ï¼Œé¿å…å½±å“ä¸šåŠ¡</li>
<li>æŸäº›å‘½åç©ºé—´æ“ä½œå¯èƒ½å½±å“ç³»ç»Ÿç¨³å®šæ€§</li>
</ul>
<p>ğŸ’¡ <strong>æœ€ä½³å®è·µ</strong>:</p>
<ul>
<li>å…ˆç”¨<code>lsns</code>è§‚å¯Ÿï¼Œå†ç”¨<code>nsenter</code>è¿›å…¥</li>
<li>æ’æŸ¥æ—¶è®°å½•æ“ä½œæ­¥éª¤ï¼Œä¾¿äºå¤ç°å’Œåˆ†æ</li>
<li>ç»“åˆå®¹å™¨ç¼–æ’å·¥å…·çš„æ—¥å¿—å’ŒçŠ¶æ€ä¿¡æ¯</li>
<li>å®šæœŸç›‘æ§å‘½åç©ºé—´æ•°é‡ï¼Œé¿å…æ³„æ¼</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/11/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/11/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">åŸºç¡€é•œåƒå¯¹æ¯”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-11 13:15:13 / ä¿®æ”¹æ—¶é—´ï¼š13:17:53" itemprop="dateCreated datePublished" datetime="2025-09-11T13:15:13+08:00">2025-09-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ğŸ“Š-åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian-Ubuntu-Alpine-CentOSï¼‰"><a href="#ğŸ“Š-åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian-Ubuntu-Alpine-CentOSï¼‰" class="headerlink" title="ğŸ“Š åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian &#x2F; Ubuntu &#x2F; Alpine &#x2F; CentOSï¼‰"></a>ğŸ“Š åŸºç¡€é•œåƒå¯¹æ¯”ï¼ˆDebian &#x2F; Ubuntu &#x2F; Alpine &#x2F; CentOSï¼‰</h1><table>
<thead>
<tr>
<th>ç³»ç»Ÿ</th>
<th>ä½“ç§¯ (é•œåƒå¤§å°)</th>
<th>å…¼å®¹æ€§</th>
<th>ç¨³å®šæ€§</th>
<th>ç”Ÿæ€æ”¯æŒ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Debian</strong></td>
<td><strong>ä¸­ç­‰</strong>ï¼ˆ<code>slim</code> ~ 22MBï¼Œå®Œæ•´ ~ 124MBï¼‰</td>
<td>ä¸ Linux ä¸»æµå‘è¡Œç‰ˆé«˜åº¦å…¼å®¹ï¼ˆglibcï¼‰</td>
<td>æé«˜ï¼Œé•¿æœŸæ”¯æŒ + å®‰å…¨æ›´æ–°å¿«</td>
<td>Docker å®˜æ–¹æ¨èï¼Œæ–‡æ¡£ä¸°å¯Œï¼ŒCI&#x2F;CD å¸¸ç”¨</td>
<td>æ¨èå¤§å¤šæ•°åº”ç”¨ï¼Œç¨³å®šã€å®‰å…¨ã€è½»é‡</td>
</tr>
<tr>
<td><strong>Ubuntu</strong></td>
<td>ä¸­ç­‰åå¤§ï¼ˆ<code>slim</code> ~ 29MBï¼Œå®Œæ•´ ~ 77MBï¼‰</td>
<td>ä¸ Debian å®Œå…¨å…¼å®¹ï¼Œé¢å¤–å¸¦ Canonical æ”¯æŒ</td>
<td>é«˜ï¼ŒLTS ç‰ˆæœ¬æ”¯æŒ 5 å¹´</td>
<td>æœ€æµè¡Œï¼Œç¤¾åŒº &amp; ä¼ä¸šæ–‡æ¡£æœ€å…¨ï¼Œäº‘åŸç”Ÿç”Ÿæ€å¥½</td>
<td>æ¨èéœ€è¦ LTS çš„åœºæ™¯ï¼Œå¦‚å¾®æœåŠ¡ã€ä¼ä¸šåº”ç”¨</td>
</tr>
<tr>
<td><strong>Alpine</strong></td>
<td><strong>æå°</strong>ï¼ˆ5MB å·¦å³ï¼‰</td>
<td>ä½¿ç”¨ <code>musl libc</code> ä¸ <code>busybox</code>ï¼Œéƒ¨åˆ†åº“å…¼å®¹æ€§å·®</td>
<td>ä¸­ç­‰ï¼Œæ»šåŠ¨æ›´æ–°å¿«ä½†å¯èƒ½å¼•å…¥é—®é¢˜</td>
<td>æ–‡æ¡£è¾ƒå°‘ï¼Œè°ƒè¯•å·¥å…·ç¼ºå¤±ï¼Œæ„å»ºå¤æ‚</td>
<td>é€‚åˆæç®€åº”ç”¨ï¼Œé™æ€ç¼–è¯‘ Go &#x2F; Rust &#x2F; Java é•œåƒ</td>
</tr>
<tr>
<td><strong>CentOS</strong>ï¼ˆå« Rocky&#x2F;Almaï¼‰</td>
<td>å¤§ï¼ˆ200MB+ï¼‰</td>
<td>ä¸ RHEL å®Œå…¨å…¼å®¹ï¼Œé€‚åˆä¼ä¸š RHEL ç¯å¢ƒ</td>
<td>é«˜ï¼Œä¼ä¸šçº§ï¼Œç”Ÿå‘½å‘¨æœŸé•¿ï¼ˆå–å†³äºç‰ˆæœ¬ï¼‰</td>
<td>ä¼ ç»Ÿä¼ä¸šç”¨å¾—å¤šï¼Œä½†äº‘åŸç”Ÿç¤¾åŒºçƒ­åº¦ä¸‹é™</td>
<td>é€‚åˆå¯¹ <strong>RHEL å…¼å®¹æ€§</strong> æœ‰å¼ºéœ€æ±‚çš„ç¯å¢ƒ</td>
</tr>
</tbody></table>
<hr>
<h1 id="ğŸ·-Debian-é•œåƒ-tag-è¯´æ˜"><a href="#ğŸ·-Debian-é•œåƒ-tag-è¯´æ˜" class="headerlink" title="ğŸ· Debian é•œåƒ tag è¯´æ˜"></a>ğŸ· Debian é•œåƒ tag è¯´æ˜</h1><p>Debian çš„ tag æ¯”è¾ƒå¤šï¼Œæˆ‘å¸®ä½ åˆ†ç±»æ•´ç†ï¼š</p>
<table>
<thead>
<tr>
<th>Tag ç¤ºä¾‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>bookworm</code></td>
<td>Debian 12 ç¨³å®šç‰ˆï¼ˆæœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰</td>
</tr>
<tr>
<td><code>bullseye</code></td>
<td>Debian 11 ç¨³å®šç‰ˆ</td>
</tr>
<tr>
<td><code>buster</code></td>
<td>Debian 10 ç¨³å®šç‰ˆï¼ˆè€ç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td><code>12</code>, <code>11</code>, <code>10</code></td>
<td>å¯¹åº” Debian ä¸»ç‰ˆæœ¬å·ï¼Œå’Œä»£å·ç­‰ä»·</td>
</tr>
<tr>
<td><code>bookworm-slim</code></td>
<td>ç²¾ç®€ç‰ˆï¼Œå»æ‰ man&#x2F;info&#x2F;localeï¼Œä¸å¸¦å¤šä½™å·¥å…·ï¼Œä½“ç§¯æ›´å°</td>
</tr>
<tr>
<td><code>bookworm-20240904</code></td>
<td>å¸¦æ„å»ºæ—¥æœŸçš„é•œåƒï¼Œä¿è¯å¯é‡å¤æ„å»º</td>
</tr>
<tr>
<td><code>stable</code></td>
<td>å½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆï¼ˆç›®å‰æ˜¯ <code>bookworm</code>ï¼‰</td>
</tr>
<tr>
<td><code>testing</code></td>
<td>å³å°†æˆä¸ºä¸‹ä¸€ä¸ªç¨³å®šç‰ˆçš„æ»šåŠ¨ç‰ˆæœ¬ï¼Œä¸ä¿è¯å®Œå…¨ç¨³å®š</td>
</tr>
<tr>
<td><code>unstable</code></td>
<td>æ°¸è¿œæŒ‡å‘ <strong>sid</strong>ï¼Œå¼€å‘ä¸­ï¼Œä¸æ¨èç”Ÿäº§ä½¿ç”¨</td>
</tr>
<tr>
<td><code>experimental</code></td>
<td>å®éªŒæ€§åˆ†æ”¯ï¼Œé£é™©é«˜</td>
</tr>
</tbody></table>
<p>ğŸ‘‰ <strong>æ¨èé€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒï¼š<code>debian:bookworm-slim</code>ï¼ˆå°è€Œç¨³ï¼‰</li>
<li>è°ƒè¯•ç¯å¢ƒï¼š<code>debian:bookworm</code>ï¼ˆå¸¦å·¥å…·ï¼Œæ–¹ä¾¿æ’æŸ¥ï¼‰</li>
<li>å¯é‡å¤æ„å»ºï¼š<code>debian:bookworm-20240904</code>ï¼ˆå›ºå®šå¿«ç…§ï¼‰</li>
</ul>
<hr>
<h1 id="ğŸ·-Ubuntu-é•œåƒ-tag-è¯´æ˜"><a href="#ğŸ·-Ubuntu-é•œåƒ-tag-è¯´æ˜" class="headerlink" title="ğŸ· Ubuntu é•œåƒ tag è¯´æ˜"></a>ğŸ· Ubuntu é•œåƒ tag è¯´æ˜</h1><p>Ubuntu çš„ç‰ˆæœ¬éµå¾ª <strong>å¹´.æœˆ</strong> æ ¼å¼ï¼Œåˆ†ä¸º <strong>LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰</strong> å’Œ <strong>é LTSï¼ˆçŸ­æœŸæ”¯æŒï¼‰</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>Tag ç¤ºä¾‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>22.04</code>, <code>jammy</code></td>
<td>Ubuntu 22.04 LTSï¼ˆæ”¯æŒè‡³ 2027ï¼ŒExtended Security åˆ° 2032ï¼‰</td>
</tr>
<tr>
<td><code>20.04</code>, <code>focal</code></td>
<td>Ubuntu 20.04 LTSï¼ˆæ”¯æŒè‡³ 2025ï¼‰</td>
</tr>
<tr>
<td><code>18.04</code>, <code>bionic</code></td>
<td>Ubuntu 18.04 LTSï¼ˆæ”¯æŒè‡³ 2023ï¼‰</td>
</tr>
<tr>
<td><code>24.04</code>, <code>noble</code></td>
<td>Ubuntu 24.04 LTSï¼ˆæœ€æ–° LTSï¼Œæ”¯æŒè‡³ 2029ï¼‰</td>
</tr>
<tr>
<td><code>latest</code></td>
<td>å½“å‰æœ€æ–°ç‰ˆæœ¬ï¼ˆâš ï¸ ä¸æ¨èç”Ÿäº§ç”¨ï¼Œå¯èƒ½éšæ—¶é—´å˜ï¼‰</td>
</tr>
<tr>
<td><code>22.04-slim</code></td>
<td>ç²¾ç®€ç‰ˆï¼Œä½“ç§¯æ›´å°</td>
</tr>
<tr>
<td><code>rolling</code></td>
<td>æ»šåŠ¨ç‰ˆæœ¬ï¼Œå§‹ç»ˆè·Ÿéšæœ€æ–°ç¨³å®šç‰ˆ</td>
</tr>
</tbody></table>
<p>ğŸ‘‰ <strong>æ¨èé€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒï¼š<code>ubuntu:22.04</code> æˆ– <code>ubuntu:22.04-slim</code></li>
<li>é•¿æœŸç»´æŠ¤ï¼š<code>ubuntu:24.04</code>ï¼ˆæ–° LTSï¼‰</li>
<li>å¿«é€Ÿè¯•éªŒï¼š<code>ubuntu:latest</code>ï¼ˆä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ï¼‰</li>
</ul>
<hr>
<h1 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h1><ul>
<li><strong>é¦–é€‰</strong>ï¼š<code>debian:bookworm-slim</code>ï¼ˆå°ã€ç¨³ã€å®‰å…¨æ›´æ–°å¿«ï¼‰</li>
<li><strong>éœ€è¦ LTS é•¿æœŸæ”¯æŒ</strong>ï¼š<code>ubuntu:22.04</code> æˆ– <code>ubuntu:24.04</code></li>
<li><strong>æå°é•œåƒ</strong>ï¼š<code>alpine:3.20</code>ï¼Œä½†è¦è€ƒè™‘å…¼å®¹æ€§é—®é¢˜</li>
<li><strong>ä¼ä¸š RHEL å…¼å®¹åœºæ™¯</strong>ï¼š<code>rockylinux:8</code> &#x2F; <code>almalinux:8</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://shispring.github.io/2025/09/10/%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="shispring">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/10/%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/" class="post-title-link" itemprop="url">å†…å­˜ç›¸å…³ä¿¡æ¯æ•´ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-10 14:15:38" itemprop="dateCreated datePublished" datetime="2025-09-10T14:15:38+08:00">2025-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-11 15:09:05" itemprop="dateModified" datetime="2025-09-11T15:09:05+08:00">2025-09-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="slab"><a href="#slab" class="headerlink" title="slab"></a>slab</h2><ul>
<li>SUnreclaimï¼ˆéå¯å›æ”¶ slabï¼‰</li>
<li>SReclaimableï¼ˆå¯å›æ”¶ slab, å¦‚ inode&#x2F;dentry cacheï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#å‡ ä¸ªè®¡ç®—å…³ç³»</span><br><span class="line">#Slab = å†…æ ¸ç»´æŠ¤å¯¹è±¡çš„ç¼“å­˜ï¼ˆinodeã€dentryã€socket buffer ç­‰ï¼‰</span><br><span class="line">Slab = SReclaimable + SUnreclaim</span><br><span class="line">#å«ä¹‰</span><br><span class="line">SUnreclaim â€“ Non-reclaimable slab memory (kernel objects) å æ¯”ç¨³å®šï¼Œå†…æ ¸ä¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line">SReclaimable â€“ Potentially reclaimable slab memory (e.g., inode cache) å æ¯”è¾ƒé«˜ï¼Œå†…æ ¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line"></span><br><span class="line"># buff/cache å¯å›æ”¶å†…å­˜ï¼ŒSReclaimableé«˜ã€å›æ”¶æ…¢å¯æŒç»­å¢é«˜ï¼Œä»è€Œå‡ºç°â€œå¯å›æ”¶ä½†å®é™…ä¸Šå›æ”¶ä¸æ‰â€ </span><br><span class="line">buff/cache â‰ˆ Buffers + Cached + SReclaimable</span><br><span class="line"></span><br><span class="line">#MemAvailable</span><br><span class="line">MemAvailable â‰ˆ MemFree + Buffers + Cached + SReclaimable - ä¸€äº›ä¸å¯å›æ”¶éƒ¨åˆ†</span><br><span class="line"></span><br><span class="line">#è§‚å¯Ÿæ–¹å¼ï¼š</span><br><span class="line">top</span><br><span class="line">watch -n1 &quot;grep -E &#x27;MemTotal|MemFree|MemAvailable|Cached|Slab|SReclaimable|SUnreclaim&#x27; /proc/meminfo&quot;</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹å†…æ ¸å†…å­˜å‚æ•°</span><br><span class="line">sysctl -a | grep vm</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹slabä¿¡æ¯: cat /proc/slabinfo</span><br><span class="line">#çœ‹å…·ä½“å“ªäº› slab ç±»å‹æ¶¨å¾—å¤š,å¦‚æœ top å‡ é¡¹æ˜¯ dentry/inode_cache â†’ è¯´æ˜ VFS å…ƒæ•°æ®ã€‚</span><br><span class="line">cat /proc/slabinfo | egrep -i &#x27;dentry|inode|path|ext4|xfs&#x27; </span><br><span class="line"></span><br><span class="line">#æˆ–è€…å‘½ä»¤</span><br><span class="line">slabtop</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å†…å­˜å›æ”¶-vfs-cache-pressure"><a href="#å†…å­˜å›æ”¶-vfs-cache-pressure" class="headerlink" title="å†…å­˜å›æ”¶:vfs_cache_pressure"></a>å†…å­˜å›æ”¶:vfs_cache_pressure</h2><blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/ygq13572549874/article/details/148332587">https://blog.csdn.net/ygq13572549874/article/details/148332587</a> </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#æŸ¥çœ‹è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">cat /proc/sys/vm/vfs_cache_pressure</span><br><span class="line"></span><br><span class="line">å«ä¹‰ï¼šæ§åˆ¶å†…æ ¸å›æ”¶ inode å’Œ dentry ç¼“å­˜çš„å€¾å‘ç¨‹åº¦ï¼š</span><br><span class="line">- inode ç¼“å­˜ï¼šå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿçš„å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶æƒé™ã€æ‰€æœ‰è€…ã€æ—¶é—´æˆ³ç­‰ï¼‰</span><br><span class="line">- dentry ç¼“å­˜ï¼šå­˜å‚¨ç›®å½•é¡¹ç¼“å­˜ï¼ˆå¦‚æ–‡ä»¶ååˆ° inode çš„æ˜ å°„å…³ç³»ï¼‰</span><br><span class="line"></span><br><span class="line">å‚æ•°å€¼èŒƒå›´ä¸º 0-1000ï¼Œé»˜è®¤å€¼ä¸º 100ï¼š</span><br><span class="line">- å€¼è¶Šå°ï¼šå†…æ ¸è¶Šå€¾å‘äºä¿ç•™ inode/dentry ç¼“å­˜ï¼ˆå³ä½¿å†…å­˜ç´§å¼ ï¼‰</span><br><span class="line">- å€¼è¶Šå¤§ï¼šå†…æ ¸è¶Šå€¾å‘äºä¼˜å…ˆå›æ”¶ inode/dentry ç¼“å­˜</span><br><span class="line"></span><br><span class="line">å½“ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶ï¼Œå†…æ ¸éœ€è¦å†³å®šå¦‚ä½•å¹³è¡¡å›æ”¶ä¸åŒç±»å‹çš„ç¼“å­˜ï¼š</span><br><span class="line">- é¡µé¢ç¼“å­˜ï¼ˆpage cacheï¼‰ï¼šæ–‡ä»¶å†…å®¹çš„ç¼“å­˜</span><br><span class="line">- inode/dentry ç¼“å­˜ï¼šæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®çš„ç¼“å­˜</span><br><span class="line">-äº¤æ¢ç©ºé—´ï¼ˆswapï¼‰ï¼šå†…å­˜åˆ°ç£ç›˜çš„äº¤æ¢</span><br></pre></td></tr></table></figure>

<h2 id="drop-caches"><a href="#drop-caches" class="headerlink" title="drop caches"></a>drop caches</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#drop cachesï¼ˆæµ‹è¯•æ˜¯å¦å¯å›æ”¶ï¼‰</span><br><span class="line"># 1=pagecache, 2=dentries+inodes, 3=both</span><br><span class="line">sudo sync</span><br><span class="line">sudo sh -c &#x27;echo 2 &gt; /proc/sys/vm/drop_caches&#x27;</span><br><span class="line"># ä¹‹åé‡æ–°æ£€æŸ¥ /proc/meminfo çš„ Slab/SReclaimable æ˜¯å¦æ˜¾è‘—ä¸‹é™</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="shispring"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">shispring</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">151</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shispring</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
